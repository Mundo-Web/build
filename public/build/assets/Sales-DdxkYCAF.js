var k=Object.defineProperty;var E=(n,c,o)=>c in n?k(n,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[c]=o;var N=(n,c,o)=>E(n,typeof c!="symbol"?c+"":c,o);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as x}from"./index-BOnQTV8N.js";import{c as T}from"./ReactAppend-QR5TrZfj.js";import{B as F}from"./Base-DVB0gmMQ.js";import{C as D}from"./CreateReactScript-ddpUFpqR.js";import{T as A}from"./Table-CjKaEY3W.js";import{D as B}from"./DxButton-DV0H-ZcL.js";import{R as _}from"./ReactAppend-Vm5G2nof.js";import"./ProductCard-D9l7c7at.js";import{B as O}from"./BasicRest-BML1C-ua.js";import{G as y}from"./Global-CazroCzF.js";import{C as i,N as l}from"./Number2Currency-jIsa99f9.js";import{M as P}from"./Modal-xDw9ufjg.js";import{i as M}from"./tippy-react.esm-DmkRJDEW.js";import{S as I}from"./SaleStatusesRest-BDuDyR5m.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-CvMo-oCB.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";import"./BooleanLimit-D-OsQsek.js";import"./CardProductKatya-ncpmQ0JU.js";import"./index-pSueRYGM.js";class V extends O{constructor(){super(...arguments);N(this,"path","customer/sales")}}const u=new V;new I;const Y=({statuses:n=[]})=>{var f;const c=x.useRef(),o=x.useRef(),[t,j]=x.useState(null),[p,q]=x.useState([]),g=async r=>{const s=await u.save({id:t.id,status_id:r.target.value});s&&(j(s),$(c.current).dxDataGrid("instance").refresh())},b=async r=>{const s=await u.get(r);j(s.data),$(o.current).modal("show")};x.useEffect(()=>{},[t]);const v=Number(t==null?void 0:t.amount)+Number((t==null?void 0:t.delivery)||0)+Number((t==null?void 0:t.seguro_importacion_total)||0)+Number((t==null?void 0:t.derecho_arancelario_total)||0)+Number((t==null?void 0:t.flete_total)||0)-Number((t==null?void 0:t.bundle_discount)||0)-Number((t==null?void 0:t.renewal_discount)||0)-Number((t==null?void 0:t.coupon_discount)||0);return e.jsxs(e.Fragment,{children:[e.jsx(A,{gridRef:c,title:"Pedidos",rest:u,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(r,{data:s})=>{r.css("cursor","pointer"),r.on("click",()=>{b(s.id)}),_(r,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block",children:[s.name," ",s.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",y.APP_CORRELATIVE,"-",s.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(r,{data:s})=>{r.text(moment(s.created_at).format("LLL"))}},{dataField:"status.name",caption:"Estado",cellTemplate:(r,{data:s})=>{_(r,e.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:s.status.color?`${s.status.color}2e`:"#3333332e",color:s.status.color??"#333"},children:s.status.name}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(r,{data:s})=>{const m=Number(s.amount)||0,h=Number(s.delivery)||0,a=Number(s.seguro_importacion_total)||0,d=Number(s.derecho_arancelario_total)||0,w=Number(s.flete_total)||0,C=Number(s.bundle_discount)||0,R=Number(s.renewal_discount)||0,S=Number(s.coupon_discount)||0;r.text(`${i()} ${l(m+h+a+d+w-C-R-S)}`)}},{caption:"Acciones",cellTemplate:(r,{data:s})=>{r.append(B({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>b(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(P,{modalRef:o,title:`Detalles del pedido #${y.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsx("td",{children:t==null?void 0:t.fullname})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"TelÃ©fono:"}),e.jsx("td",{children:t==null?void 0:t.phone})]}),(t==null?void 0:t.delivery_type)=="express"&&e.jsxs("tr",{children:[e.jsx("th",{children:"DirecciÃ³n:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),","," ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["-"," ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.payment_proof)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante de pago:"}),e.jsx("td",{children:e.jsx(M,{content:"Ver comprobante de pago",placement:"top",children:e.jsx("a",{href:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,target:"_blank",children:e.jsx("img",{src:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"150px",cursor:"pointer"}})})})})]})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"ArtÃ­culos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(f=t==null?void 0:t.details)==null?void 0:f.map((r,s)=>{const m=r.quantity*100/100,h=r.price*r.quantity;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("strong",{children:r.name}),(r.type==="combo"||r.combo_id)&&e.jsxs("div",{className:"mt-1",children:[e.jsxs("small",{className:"text-muted d-block",children:[e.jsx("span",{className:"badge bg-info me-1",children:"COMBO"}),"Contiene:"]}),r.combo_data&&r.combo_data.items&&r.combo_data.items.length>0?e.jsx("small",{className:"text-muted",children:r.combo_data.items.map((a,d)=>e.jsxs("span",{children:[a.quantity,"x ",a.name,d<r.combo_data.items.length-1?", ":""]},d))}):e.jsx("small",{className:"text-muted text-warning",children:"ðŸ“‹ InformaciÃ³n de combo no disponible"})]})]})}),e.jsx("td",{align:"right",children:e.jsxs("span",{className:"text-nowrap",children:[i()," ",l(r.price)]})}),e.jsx("td",{align:"center",children:m}),e.jsx("td",{align:"right",children:e.jsxs("span",{className:"text-nowrap",children:[i()," ",l(h)]})})]},s)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:[i()," ",l((t==null?void 0:t.amount)*1)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"EnvÃ­o:"}),e.jsxs("span",{children:[i()," ",l(t==null?void 0:t.delivery)]})]}),((t==null?void 0:t.seguro_importacion_total)>0||(t==null?void 0:t.derecho_arancelario_total)>0||(t==null?void 0:t.flete_total)>0)&&e.jsxs(e.Fragment,{children:[(t==null?void 0:t.seguro_importacion_total)>0&&e.jsxs("div",{className:"d-flex justify-content-between text-info",children:[e.jsx("b",{children:"Seguro de ImportaciÃ³n:"}),e.jsxs("span",{children:[i()," ",l(t==null?void 0:t.seguro_importacion_total)]})]}),(t==null?void 0:t.derecho_arancelario_total)>0&&e.jsxs("div",{className:"d-flex justify-content-between text-info",children:[e.jsx("b",{children:"Derecho Arancelario:"}),e.jsxs("span",{children:[i()," ",l(t==null?void 0:t.derecho_arancelario_total)]})]}),(t==null?void 0:t.flete_total)>0&&e.jsxs("div",{className:"d-flex justify-content-between text-info",children:[e.jsx("b",{children:"Flete:"}),e.jsxs("span",{children:[i()," ",l(t==null?void 0:t.flete_total)]})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:[i()," ",l(v)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:g,disabled:!0,children:n.map((r,s)=>e.jsx("option",{value:r.id,children:r.name}))})]})})]}),e.jsxs("div",{className:"card",hidden:!0,children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",children:p==null?void 0:p.map((r,s)=>{var m,h,a;return e.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:r.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:r.status.color||"#333"},children:(m=r==null?void 0:r.status)==null?void 0:m.name}),e.jsxs("small",{className:"d-block text-truncate",children:[(h=r==null?void 0:r.user)==null?void 0:h.name," ",(a=r==null?void 0:r.user)==null?void 0:a.lastname]}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},s)})})]})]})]})})]})};D((n,c)=>{T.createRoot(n).render(e.jsx(F,{...c,title:"Pedidos",children:e.jsx(Y,{...c})}))});

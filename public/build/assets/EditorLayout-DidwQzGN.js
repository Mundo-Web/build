import{j as e,E as t,az as a,aA as s,aE as n,aF as l,I as i,aB as r,T as o,r as c,aG as d,aN as m,aP as u,aO as g,aM as p,aL as x,aK as h,ca as f,aJ as b,aI as y,a9 as v,aH as j,bc as w,aS as N,at as C,as as k,aC as S,aD as E,cb as $,aR as M,aT as A,aU as D,aV as P,aQ as z,au as T,P as R,ax as L,ay as F}from"./vendor-react-CtPXetfm.js";import V from"./html2canvas.esm-BPY6V10C.js";import{F as I}from"./EditorLayout-CDKERdqe.js";import"./vendor-swiper-Cr_RrIb_.js";function O({children:t,onClick:a,className:s="",variant:n="default",size:l="default",disabled:i=!1,icon:r=null}){return e.jsxs("button",{className:`inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background ${{default:"bg-purple-600 text-white hover:bg-purple-700",outline:"border border-input hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",secondary:"bg-gray-100 text-gray-800 hover:bg-gray-200"}[n]} ${{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md text-sm",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10","icon-sm":"h-8 w-8"}[l]} ${s} gap-2`,onClick:a,disabled:i,children:[r&&e.jsx("span",{className:"w-4 h-4",children:r}),t]})}function U({onExport:n,onPreviewToggle:l,previewMode:i}){return e.jsxs("header",{className:"border-b bg-white p-4 flex items-center justify-between shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(O,{variant:"ghost",size:"sm",children:[e.jsx(t,{className:"h-5 w-5 mr-1"}),"Regresar"]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editor de Fotos Profesional"}),e.jsx("h2",{className:"text-lg text-gray-600",children:"Crea collages y diseños impresionantes"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"secondary",onClick:l,icon:e.jsx(a,{className:"h-4 w-4"}),children:i?"Editar":"Vista previa"}),e.jsx(O,{className:"bg-purple-600 hover:bg-purple-700",icon:e.jsx(s,{className:"h-4 w-4"}),onClick:n,children:"Exportar"})]})]})}function B({onUndo:t,onRedo:a,onAddImage:s,onAddText:c,onDeleteElement:d,canUndo:m,canRedo:u,hasSelectedElement:g}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 flex items-center gap-4",children:[e.jsx(O,{variant:"ghost",size:"icon",onClick:t,disabled:!m,children:e.jsx(n,{className:"h-5 w-5"})}),e.jsx(O,{variant:"ghost",size:"icon",onClick:a,disabled:!u,children:e.jsx(l,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-6 border-l"}),e.jsx(O,{variant:"ghost",size:"icon",onClick:s,children:e.jsx(i,{className:"h-5 w-5"})}),e.jsx(O,{variant:"ghost",size:"icon",onClick:c,children:e.jsx(r,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-6 border-l"}),e.jsx(O,{variant:"ghost",size:"icon",onClick:d,disabled:!g,children:e.jsx(o,{className:"h-5 w-5"})})]})}const H=[{id:"layout-1",name:"Cuatro fotos",template:"grid-cols-2 grid-rows-2 gap-4",cells:4,maskCategories:[{name:"Básicas",masks:["none","circle","rounded","square","rounded-sm","rounded-lg","rounded-full","rounded-rect"]},{name:"Formas",masks:["heart","star","hexagon","triangle","diamond","badge","speech","burst"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave","diagonal","bevel","poster","inner-frame"]},{name:"Creativas",masks:["leaf","cloud","flower","ornate","blob1","blob2","blob3"]}]}];function J({selectedLayout:t,onSelect:a}){return e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Layouts"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:H.map(s=>e.jsxs("div",{className:"border rounded-md p-1 cursor-pointer hover:border-purple-500 "+(t===s.id?"border-purple-500 ring-1 ring-purple-200":""),onClick:()=>a(s.id),children:[e.jsx("div",{className:`grid ${s.template} gap-1 h-20`,children:Array.from({length:s.cells}).map((t,a)=>e.jsx("div",{className:"bg-gray-100 rounded-sm flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:a+1})},a))}),e.jsx("p",{className:"text-xs text-center mt-1 truncate",children:s.name})]},s.id))})]})}function W({onAddImage:t,onAddText:a}){return e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Añadir"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(O,{variant:"outline",size:"sm",icon:e.jsx(i,{className:"h-4 w-4"}),onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{e.target.files&&e.target.files[0]&&t(e.target.files[0])},e.click()},children:"Imagen"}),e.jsx(O,{variant:"outline",size:"sm",icon:e.jsx(r,{className:"h-4 w-4"}),onClick:a,children:"Texto"})]})]})}function q({tabs:t,activeTab:a,onChange:s}){return e.jsx("div",{className:"flex border-b pb-4",children:t.map(t=>e.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+(a===t.id?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>s(t.id),children:t.label},t.id))})}function X({value:t=[50],min:a=0,max:s=100,step:n=1,onValueChange:l,label:i,unit:r="%"}){const[o,d]=c.useState(t[0]);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:i}),e.jsxs("span",{className:"text-sm text-gray-500",children:[o,r]})]}),e.jsx("div",{className:"relative flex w-full touch-none select-none items-center",children:e.jsx("input",{type:"range",min:a,max:s,step:n,value:o,onChange:e=>{const t=Number.parseInt(e.target.value);d(t),l&&l([t])},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})})]})}const Y=[{id:"none",name:"Sin máscara",class:"",category:"Básicas",icon:"square"},{id:"circle",name:"Círculo",class:"rounded-full",category:"Básicas",icon:"circle"},{id:"rounded",name:"Redondeado",class:"rounded-xl",category:"Básicas",icon:"square-rounded"},{id:"square",name:"Cuadrado",class:"",category:"Básicas",icon:"square"},{id:"heart",name:"Corazón",class:"mask-heart",category:"Formas",icon:"heart"},{id:"star",name:"Estrella",class:"mask-star-2",category:"Formas",icon:"star"},{id:"hexagon",name:"Hexágono",class:"mask-hexagon",category:"Formas",icon:"hexagon"},{id:"triangle",name:"Triángulo",class:"mask-triangle",category:"Formas",icon:"triangle"},{id:"diamond",name:"Diamante",class:"mask-diamond",category:"Formas",icon:"diamond"},{id:"polaroid",name:"Polaroid",class:"mask-polaroid",category:"Fotográficos",icon:"film"},{id:"vintage",name:"Vintage",class:"mask-vintage",category:"Fotográficos",icon:"feather"},{id:"wave",name:"Onda",class:"mask-wave",category:"Fotográficos",icon:"zap"},{id:"leaf",name:"Hoja",class:"mask-leaf",category:"Creativas",icon:"leaf"},{id:"cloud",name:"Nube",class:"mask-cloud",category:"Creativas",icon:"cloud"},{id:"flower",name:"Flor",class:"mask-flower",category:"Creativas",icon:"flower"}],_=({name:t,className:a=""})=>{const s={square:d,circle:j,heart:v,star:y,hexagon:b,triangle:f,diamond:h,film:x,feather:p,cloud:g,flower:u,zap:m,"square-rounded":d}[t]||d;return e.jsx(s,{className:`${a} ${"square-rounded"===t?"rounded-md":""}`})};function G({selectedMask:t,onSelect:a,availableMasks:s=[]}){const[n,l]=c.useState("Básicas"),i={};return Y.forEach(e=>{i[e.category]||(i[e.category]=[]),(s.includes(e.id)||"none"===e.id)&&i[e.category].push(e)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Máscaras de imagen"}),e.jsx("div",{className:"flex overflow-x-auto pb-2",children:Object.keys(i).map(t=>i[t].length>0&&e.jsx("button",{className:"px-3 py-1 text-sm whitespace-nowrap "+(n===t?"border-b-2 border-purple-500 font-medium text-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>l(t),children:t},t))}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:i[n]?.map(s=>e.jsxs("div",{className:"border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors "+(t===s.id?"border-purple-500 ring-2 ring-purple-200":""),onClick:()=>a(s.id),children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-2",children:e.jsx("div",{className:`w-16 h-16 bg-purple-300 ${s.class} flex items-center justify-center`,children:e.jsx(_,{name:s.icon,className:"h-8 w-8 text-purple-600"})})}),e.jsx("p",{className:"text-center text-sm",children:s.name})]},s.id))})]})}const K=[{name:"Normal",filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0}},{name:"Vintage",filters:{brightness:90,contrast:110,saturation:80,tint:20,hue:10,blur:1}},{name:"Blanco y negro",filters:{brightness:100,contrast:120,saturation:0,tint:0,hue:0,blur:0}},{name:"Brillante",filters:{brightness:120,contrast:90,saturation:120,tint:0,hue:0,blur:0}},{name:"Oscuro",filters:{brightness:80,contrast:120,saturation:90,tint:10,hue:0,blur:1}},{name:"Sepia",filters:{brightness:90,contrast:100,saturation:50,tint:80,hue:0,blur:0}},{name:"Cálido",filters:{brightness:100,contrast:100,saturation:110,tint:15,hue:20,blur:0}},{name:"Frío",filters:{brightness:100,contrast:100,saturation:110,tint:0,hue:200,blur:0}}],Q=[{value:"normal",label:"Normal"},{value:"multiply",label:"Multiplicar"},{value:"screen",label:"Pantalla"},{value:"overlay",label:"Superponer"},{value:"darken",label:"Oscurecer"},{value:"lighten",label:"Aclarar"},{value:"color-dodge",label:"Sobreexposición de color"},{value:"color-burn",label:"Subexposición de color"},{value:"hard-light",label:"Luz fuerte"},{value:"soft-light",label:"Luz suave"},{value:"difference",label:"Diferencia"},{value:"exclusion",label:"Exclusión"},{value:"hue",label:"Tono"},{value:"saturation",label:"Saturación"},{value:"color",label:"Color"},{value:"luminosity",label:"Luminosidad"}];function Z({element:t,filterTab:a,onFilterTabChange:s,onFilterChange:n,availableMasks:l=[]}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{tabs:[{id:"basic",label:"Básicos",icon:e.jsx(w,{size:16})},{id:"transform",label:"Transformar",icon:e.jsx(N,{size:16})},{id:"advanced",label:"Avanzados",icon:e.jsx(C,{size:16})}],activeTab:a,onChange:s}),"basic"===a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Filtros predefinidos"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:K.map(a=>e.jsx(O,{variant:"outline",size:"sm",onClick:()=>(e=>{n({filters:{...t.filters,...e}})})(a.filters),children:a.name},a.name))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Ajustes básicos"}),e.jsx(X,{label:"Brillo",value:[t.filters?.brightness||100],min:0,max:200,onValueChange:e=>n({filters:{...t.filters,brightness:e[0]}})}),e.jsx(X,{label:"Contraste",value:[t.filters?.contrast||100],min:0,max:200,onValueChange:e=>n({filters:{...t.filters,contrast:e[0]}})}),e.jsx(X,{label:"Saturación",value:[t.filters?.saturation||100],min:0,max:200,onValueChange:e=>n({filters:{...t.filters,saturation:e[0]}})}),e.jsx(X,{label:"Tono",value:[t.filters?.hue||0],min:0,max:360,unit:"°",onValueChange:e=>n({filters:{...t.filters,hue:e[0]}})}),e.jsx(X,{label:"Sepia",value:[t.filters?.tint||0],min:0,max:100,onValueChange:e=>n({filters:{...t.filters,tint:e[0]}})}),e.jsx(X,{label:"Desenfoque",value:[t.filters?.blur||0],min:0,max:20,unit:"px",onValueChange:e=>n({filters:{...t.filters,blur:e[0]}})})]})]}),"transform"===a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Transformación"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(O,{variant:t.filters?.flipHorizontal?"secondary":"outline",size:"sm",icon:e.jsx(S,{className:"h-4 w-4"}),onClick:()=>n({filters:{...t.filters,flipHorizontal:!t.filters?.flipHorizontal}}),children:"Voltear H"}),e.jsx(O,{variant:t.filters?.flipVertical?"secondary":"outline",size:"sm",icon:e.jsx(E,{className:"h-4 w-4"}),onClick:()=>n({filters:{...t.filters,flipVertical:!t.filters?.flipVertical}}),children:"Voltear V"})]}),e.jsx(X,{label:"Rotación",value:[t.filters?.rotate||0],min:0,max:360,unit:"°",onValueChange:e=>n({filters:{...t.filters,rotate:e[0]}})}),e.jsx(X,{label:"Escala",value:[100*(t.filters?.scale||1)],min:10,max:200,onValueChange:e=>n({filters:{...t.filters,scale:e[0]/100}})})]}),"advanced"===a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Ajustes avanzados"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modo de mezcla"}),e.jsx("select",{className:"w-full border rounded-md p-2 text-sm",value:t.filters?.blendMode||"normal",onChange:e=>n({filters:{...t.filters,blendMode:e.target.value}}),children:Q.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(X,{label:"Opacidad",value:[t.filters?.opacity||100],min:0,max:100,onValueChange:e=>n({filters:{...t.filters,opacity:e[0]}})})]}),"image"===t.type&&e.jsx(G,{selectedMask:t.mask||"none",onSelect:e=>n({mask:e}),availableMasks:l})]})}function ee({activeTab:t,onTabChange:a,selectedLayout:s,onLayoutChange:n,onAddImage:l,onAddText:i,selectedElement:r,onFilterChange:o,getSelectedElement:d,getCurrentLayout:m}){const[u,g]=c.useState("basic");return e.jsx("aside",{className:"w-64 border-r bg-white p-4 overflow-y-auto shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{tabs:[{id:"elements",label:"Elementos"},{id:"filters",label:"Filtros"}],activeTab:t,onChange:a}),"elements"===t?e.jsxs(e.Fragment,{children:[e.jsx(J,{selectedLayout:s,onSelect:n}),e.jsx(W,{onAddImage:l,onAddText:i})]}):r?e.jsx(Z,{element:d(),filterTab:u,onFilterTabChange:g,onFilterChange:o,availableMasks:m().maskCategories.flatMap(e=>e.masks)}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Selecciona un elemento para editar sus filtros"})]})})}function te({page:t,layout:a}){return e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-lg page-preview",children:e.jsx("div",{className:`grid ${a.template} gap-6 aspect-[4/3]`,children:t.cells.map(t=>e.jsx("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden",children:t.elements.map(t=>"image"===t.type?e.jsx(ae,{element:t},t.id):e.jsx(se,{element:t},t.id))},t.id))})})}function ae({element:t}){const a=imageMasks.find(e=>e.id===t.mask)||imageMasks[0];return e.jsx("div",{className:`absolute ${a.class}`,style:{left:`${t.position.x}px`,top:`${t.position.y}px`,width:"100%",height:"100%"},children:e.jsx("img",{src:t.content,alt:"",className:"w-full h-full object-cover",style:{filter:`\n              brightness(${(t.filters?.brightness||100)/100})\n              contrast(${(t.filters?.contrast||100)/100})\n              saturate(${(t.filters?.saturation||100)/100})\n              sepia(${(t.filters?.tint||0)/100})\n              hue-rotate(${3.6*(t.filters?.hue||0)}deg)\n              blur(${t.filters?.blur||0}px)\n            `,transform:`scale(${t.filters?.scale||1}) rotate(${t.filters?.rotate||0}deg) ${t.filters?.flipHorizontal?"scaleX(-1)":""} ${t.filters?.flipVertical?"scaleY(-1)":""}`,mixBlendMode:t.filters?.blendMode||"normal",opacity:(t.filters?.opacity||100)/100}})})}function se({element:t}){return e.jsx("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,fontFamily:t.style?.fontFamily,fontSize:t.style?.fontSize,fontWeight:t.style?.fontWeight,fontStyle:t.style?.fontStyle,textDecoration:t.style?.textDecoration,color:t.style?.color,textAlign:t.style?.textAlign,backgroundColor:t.style?.backgroundColor||"transparent",padding:t.style?.padding||"8px",borderRadius:t.style?.borderRadius||"0px",border:t.style?.border||"none",opacity:t.style?.opacity||1},children:t.content})}function ne({items:t}){const[a,s]=c.useState(null);return e.jsx("div",{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),s({x:e.clientX,y:e.clientY})},children:a&&e.jsx("div",{className:"fixed bg-white shadow-lg rounded-md z-50 py-1 w-48",style:{left:`${a.x}px`,top:`${a.y}px`},onClick:e=>e.stopPropagation(),children:t.map((t,a)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{t.action(),s(null)},children:[t.icon,t.label]},a))})})}function le({element:t,isSelected:a,onSelect:s,onUpdate:n,onDelete:l,availableMasks:i=[]}){const[{isDragging:r},d]=M(()=>({type:"IMAGE_ELEMENT",item:{id:t.id},collect:e=>({isDragging:!!e.isDragging()})})),m=c.useRef(null),[u,g]=c.useState(!1),[p,x]=c.useState({x:0,y:0}),h={filter:`\n      brightness(${(t.filters?.brightness||100)/100})\n      contrast(${(t.filters?.contrast||100)/100})\n      saturate(${(t.filters?.saturation||100)/100})\n      sepia(${(t.filters?.tint||0)/100})\n      hue-rotate(${3.6*(t.filters?.hue||0)}deg)\n      blur(${t.filters?.blur||0}px)\n    `,transform:`scale(${t.filters?.scale||1}) rotate(${t.filters?.rotate||0}deg) ${t.filters?.flipHorizontal?"scaleX(-1)":""} ${t.filters?.flipVertical?"scaleY(-1)":""}`,mixBlendMode:t.filters?.blendMode||"normal",opacity:(t.filters?.opacity||100)/100},f=Y.find(e=>e.id===t.mask)||Y[0],b=e=>{if(u&&m.current){const t=m.current.parentElement.getBoundingClientRect(),a=e.clientX-p.x,s=e.clientY-p.y,l=t.width-m.current.offsetWidth,i=t.height-m.current.offsetHeight,r=Math.max(0,Math.min(a,l)),o=Math.max(0,Math.min(s,i));n({position:{x:r,y:o}})}},y=()=>{g(!1)};c.useEffect(()=>(u&&(window.addEventListener("mousemove",b),window.addEventListener("mouseup",y)),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y)}),[u,p]);const v=c.useCallback(e=>{m.current=e,d(e)},[d]),j=[{label:"Reemplazar imagen",icon:e.jsx(A,{className:"h-4 w-4"}),action:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const t=new FileReader;t.onload=e=>{e.target?.result&&n({content:e.target.result})},t.readAsDataURL(e.target.files[0])}},e.click()}},{label:"Duplicar",icon:e.jsx(D,{className:"h-4 w-4"}),action:()=>{const e={...JSON.parse(JSON.stringify(t)),id:`img-${Date.now()}`,position:{x:t.position.x+20,y:t.position.y+20}};n(e,!0)}},{label:"Reducir opacidad",icon:e.jsx(P,{className:"h-4 w-4"}),action:()=>n({filters:{...t.filters,opacity:Math.max(0,(t.filters?.opacity||100)-10)}})},{label:"Eliminar",icon:e.jsx(o,{className:"h-4 w-4"}),action:l}];return e.jsxs("div",{ref:v,className:`absolute ${f.class} ${a?"ring-2 ring-purple-500":""} ${r?"opacity-50":"opacity-100"}`,style:{left:`${t.position.x}px`,top:`${t.position.y}px`,width:"100%",height:"100%",cursor:a?"move":"pointer"},onClick:e=>{e.stopPropagation(),s()},onMouseDown:e=>{a&&(e.stopPropagation(),g(!0),x({x:e.clientX-t.position.x,y:e.clientY-t.position.y}))},children:[e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:t.content,alt:"Imagen cargada",className:"w-full h-full object-cover",style:h})}),a&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:e=>{e.stopPropagation(),n({filters:{...t.filters,rotate:(t.filters?.rotate||0)+90}})},children:e.jsx(N,{className:"h-4 w-4 text-gray-700"})}),e.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:e=>{e.stopPropagation(),l()},children:e.jsx(o,{className:"h-4 w-4 text-gray-700"})})]}),e.jsx(ne,{items:j})]})}function ie({element:t,isSelected:a,onSelect:s,onUpdate:n,onDelete:l}){const[i,d]=c.useState(!1),m=c.useRef(null),u=c.useRef(null),[{isDragging:g},p]=M(()=>({type:"TEXT_ELEMENT",item:{id:t.id},collect:e=>({isDragging:!!e.isDragging()})})),[x,h]=c.useState(!1),[f,b]=c.useState({x:0,y:0}),y=e=>{if(x&&u.current){const t=u.current.parentElement.getBoundingClientRect(),a=e.clientX-f.x,s=e.clientY-f.y,l=t.width-u.current.offsetWidth,i=t.height-u.current.offsetHeight,r=Math.max(0,Math.min(a,l)),o=Math.max(0,Math.min(s,i));n({position:{x:r,y:o}})}},v=()=>{h(!1)};c.useEffect(()=>(x&&(window.addEventListener("mousemove",y),window.addEventListener("mouseup",v)),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",v)}),[x,f]);const j=c.useCallback(e=>{u.current=e,p(e)},[p]),w=t.style?.textShadow?`${t.style.textShadowX||0}px ${t.style.textShadowY||0}px ${t.style.textShadowBlur||0}px ${t.style.textShadowColor||"rgba(0,0,0,0.5)"}`:"none",N={...t.style,position:"absolute",left:`${t.position.x}px`,top:`${t.position.y}px`,cursor:a&&!i?"move":"pointer",textShadow:w,zIndex:10},C=[{label:"Editar texto",icon:e.jsx(r,{className:"h-4 w-4"}),action:()=>d(!0)},{label:"Duplicar",icon:e.jsx(D,{className:"h-4 w-4"}),action:()=>{const e={...JSON.parse(JSON.stringify(t)),id:`text-${Date.now()}`,position:{x:t.position.x+10,y:t.position.y+10}};n(e,!0)}},{label:"Reducir opacidad",icon:e.jsx(P,{className:"h-4 w-4"}),action:()=>n({style:{...t.style,opacity:Math.max(0,(t.style?.opacity||1)-.1)}})},{label:"Eliminar",icon:e.jsx(o,{className:"h-4 w-4"}),action:l}];return e.jsxs("div",{ref:j,className:`${a?"ring-2 ring-purple-500":""} ${g?"opacity-50":"opacity-100"}`,style:N,onClick:e=>{e.stopPropagation(),s()},onDoubleClick:()=>{d(!0),setTimeout(()=>{m.current&&(m.current.focus(),m.current.select())},0)},onMouseDown:e=>{a&&!i&&(e.stopPropagation(),h(!0),b({x:e.clientX-t.position.x,y:e.clientY-t.position.y}))},children:[i?e.jsx("input",{ref:m,type:"text",value:t.content,onChange:e=>{n({content:e.target.value})},onBlur:()=>{d(!1)},onKeyDown:e=>{"Enter"===e.key&&d(!1)},className:"w-full p-1 border border-gray-300 rounded bg-white",style:{fontFamily:t.style?.fontFamily,fontSize:t.style?.fontSize,fontWeight:t.style?.fontWeight,fontStyle:t.style?.fontStyle,textDecoration:t.style?.textDecoration,color:t.style?.color,textAlign:t.style?.textAlign,minWidth:"100px"},autoFocus:!0}):e.jsx("div",{className:"p-2 rounded",style:{backgroundColor:t.style?.backgroundColor||"transparent",padding:t.style?.padding||"8px",borderRadius:t.style?.borderRadius||"0px",border:t.style?.border||"none"},children:t.content||"Editar texto"}),a&&e.jsxs("div",{className:"absolute top-0 right-0 transform translate-y-[-100%] flex gap-1 bg-white rounded-t-md p-1 shadow-sm",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),n({style:{...t.style,fontWeight:"bold"===t.style?.fontWeight?"normal":"bold"}})},children:e.jsx("span",{className:"text-xs "+("bold"===t.style?.fontWeight?"font-bold":""),children:"B"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),n({style:{...t.style,fontStyle:"italic"===t.style?.fontStyle?"normal":"italic"}})},children:e.jsx("span",{className:"text-xs "+("italic"===t.style?.fontStyle?"italic":""),children:"I"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),n({style:{...t.style,textDecoration:"underline"===t.style?.textDecoration?"none":"underline"}})},children:e.jsx("span",{className:"text-xs "+("underline"===t.style?.textDecoration?"underline":""),children:"U"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),l()},children:e.jsx(o,{className:"h-3 w-3 text-gray-700"})})]}),e.jsx(ne,{items:C})]})}function re({id:t,elements:a=[],selectedElement:s,onSelectElement:n,onAddElement:l,availableMasks:i=[]}){const[{isOver:r},o]=z(()=>({accept:["IMAGE_FILE","TEXT_ELEMENT","IMAGE_ELEMENT"],drop:e=>{if(e.files){const t=new FileReader;t.onload=e=>{if(e.target?.result){const t={id:`img-${Date.now()}`,type:"image",content:e.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};l(t)}},t.readAsDataURL(e.files[0])}},collect:e=>({isOver:!!e.isOver({shallow:!0})})}));return e.jsx("div",{ref:o,className:"relative aspect-square bg-gray-50 rounded-lg overflow-hidden "+(r?"ring-2 ring-purple-500 bg-purple-50":""),onClick:()=>n(null),children:0===a.length?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const t=new FileReader;t.onload=e=>{if(e.target?.result){const t={id:`img-${Date.now()}`,type:"image",content:e.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};l(t)}},t.readAsDataURL(e.target.files[0])}},e.click()},children:[e.jsx(T,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Haz clic o arrastra una imagen"})]}):a.map(t=>e.jsx("div",{className:"absolute inset-0",children:"image"===t.type?e.jsx(le,{element:t,isSelected:s===t.id,onSelect:()=>n(t.id),availableMasks:i}):e.jsx(ie,{element:t,isSelected:s===t.id,onSelect:()=>n(t.id)})},t.id))})}function oe({page:t,layout:a,selectedElement:s,selectedCell:n,onSelectElement:l,onSelectCell:i,onAddElement:r,onUpdateElement:o,onDeleteElement:c,onUndo:d,onRedo:m,canUndo:u,canRedo:g,onAddImage:p,onAddText:x}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{onUndo:d,onRedo:m,onAddImage:p,onAddText:x,onDeleteElement:()=>{s&&n&&c(n,s)},canUndo:u,canRedo:g,hasSelectedElement:!!s}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden page-preview "+(a.cells<=4?"aspect-[4/3]":""),children:e.jsx("div",{className:`grid ${a.template} gap-4 h-full p-4`,children:t.cells.map(t=>e.jsx(re,{id:t.id,elements:t.elements,selectedElement:n===t.id?s:null,onSelectElement:e=>{l(e),i(t.id)},onAddElement:r,onUpdateElement:(e,a,s)=>{o(t.id,e,a,s)},onDeleteElement:e=>{c(t.id,e)},availableMasks:a.maskCategories.flatMap(e=>e.masks)},t.id))})})]})}function ce({currentPage:t,pages:a,selectedElement:s,selectedCell:n,onSelectElement:l,onSelectCell:i,onAddElement:r,onUpdateElement:o,onDeleteElement:c,getCurrentLayout:d,previewMode:m}){return e.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:m?e.jsx(te,{page:a[t],layout:d()}):e.jsx(oe,{page:a[t],layout:d(),selectedElement:s,selectedCell:n,onSelectElement:l,onSelectCell:i,onAddElement:r,onUpdateElement:o,onDeleteElement:c})})})}function de({pages:t,currentPage:a,onPageChange:s,onAddPage:n,onDuplicatePage:l,onDeletePage:i}){return e.jsx("aside",{className:"w-56 border-l bg-white p-4 overflow-y-auto shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium",children:"Páginas"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(O,{variant:"ghost",size:"icon-sm",onClick:l,children:e.jsx(D,{})}),e.jsx(O,{variant:"ghost",size:"icon-sm",onClick:i,disabled:t.length<=1,children:e.jsx(o,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid gap-3",children:[t.map((t,n)=>e.jsx(me,{page:t,index:n,isActive:a===n,onClick:()=>s(n)},t.id)),e.jsx(O,{variant:"outline",size:"sm",icon:e.jsx(R,{className:"h-4 w-4"}),onClick:n,children:"Añadir página"})]})]})})}function me({page:t,index:a,isActive:s,onClick:n}){return e.jsx("div",{className:"border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors "+(s?"border-purple-500 ring-2 ring-purple-200":""),onClick:n,children:e.jsxs("div",{className:"bg-gray-100 aspect-[4/3] rounded-sm flex items-center justify-center text-xs text-gray-500 relative",children:["Pág. ",a+1,t.cells.some(e=>e.elements.some(e=>"image"===e.type&&e.content))&&e.jsx("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1",children:Array.from({length:4}).map((a,s)=>{const n=t.cells[s],l=n?.elements.find(e=>"image"===e.type&&e.content);return e.jsx("div",{className:"bg-gray-200 rounded-sm overflow-hidden",children:l&&e.jsx("img",{src:l.content,alt:"",className:"w-full h-full object-cover"})},s)})})]})})}var ue,ge=new Uint8Array(16);function pe(){if(!ue&&!(ue="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ue(ge)}const xe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var he=[],fe=0;fe<256;++fe)he.push((fe+256).toString(16).substr(1));function be(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=(he[e[t+0]]+he[e[t+1]]+he[e[t+2]]+he[e[t+3]]+"-"+he[e[t+4]]+he[e[t+5]]+"-"+he[e[t+6]]+he[e[t+7]]+"-"+he[e[t+8]]+he[e[t+9]]+"-"+he[e[t+10]]+he[e[t+11]]+he[e[t+12]]+he[e[t+13]]+he[e[t+14]]+he[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&xe.test(e)}(a))throw TypeError("Stringified UUID is invalid");return a}function ye(e,t,a){var s=(e=e||{}).random||(e.rng||pe)();return s[6]=15&s[6]|64,s[8]=63&s[8]|128,be(s)}function ve(){const{pages:t,currentPageIndex:a,setCurrentPageIndex:s,addPage:n,duplicatePage:l,deletePage:i,changeLayout:r,currentPage:o,getCurrentLayout:d}=function(e=[]){const t=c.useCallback((e=H[0].id)=>{const t=H.find(t=>t.id===e)||H[0];return{id:ye(),layout:t.id,cells:Array.from({length:t.cells}).map(()=>({id:ye(),elements:[]}))}},[]),[a,s]=c.useState(e.length?e:[t()]),[n,l]=c.useState(0),i=c.useCallback(e=>{const a=t(e);return s(e=>[...e,a]),l(e=>e+1),a},[t]),r=c.useCallback(e=>{const t=a[e],n={...JSON.parse(JSON.stringify(t)),id:ye(),cells:t.cells.map(e=>({...e,id:ye(),elements:e.elements.map(e=>({...e,id:ye()}))}))};return s(e=>[...e,n]),l(a.length),n},[a]),o=c.useCallback(e=>{a.length<=1||(s(t=>t.filter((t,a)=>a!==e)),l(e=>Math.min(e,a.length-2)))},[a.length]),d=c.useCallback((e,t)=>{const a=H.find(e=>e.id===t);a&&s(s=>s.map((s,n)=>n!==e?s:{...s,layout:t,cells:Array.from({length:a.cells}).map((e,t)=>s.cells[t]||{id:ye(),elements:[]})}))},[]),m=c.useCallback(()=>H.find(e=>e.id===a[n]?.layout)||H[0],[n,a]);return{pages:a,currentPageIndex:n,setCurrentPageIndex:l,addPage:i,duplicatePage:r,deletePage:o,changeLayout:d,currentPage:a[n],getCurrentLayout:m}}(),{elements:m,selectedElement:u,selectedCell:g,setSelectedElement:p,setSelectedCell:x,addElement:h,deleteElement:f}=function(e=[]){const[t,a]=c.useState(e),[s,n]=c.useState(null),[l,i]=c.useState(null),r=e=>({id:ye(),type:"image",content:"",position:e,filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal",flipHorizontal:!1,flipVertical:!1},mask:"none"}),o=e=>({id:ye(),type:"text",content:"Haz clic para editar",position:e,style:{fontSize:"16px",fontFamily:"Arial, sans-serif",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1,textShadow:"none",textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"rgba(0,0,0,0.5)"}});return{elements:t,selectedElement:s,selectedCell:l,setSelectedElement:n,setSelectedCell:i,addElement:(e,s={x:10,y:10})=>{const l="image"===e?r(s):o(s);return a([...t,l]),n(l.id),l},updateElement:(e,s)=>{a(t.map(t=>t.id===e?{...t,...s}:t))},deleteElement:e=>{a(t.filter(t=>t.id!==e)),s===e&&n(null)},duplicateElement:e=>{const s=t.find(t=>t.id===e);if(!s)return;const l={...JSON.parse(JSON.stringify(s)),id:ye(),position:{x:s.position.x+10,y:s.position.y+10}};return a([...t,l]),n(l.id),l}}}(),{addToHistory:b}=function(e){const[t,a]=c.useState([JSON.stringify(e)]),[s,n]=c.useState(0),l=s>0,i=s<t.length-1;return{currentState:JSON.parse(t[s]),addToHistory:e=>{const l=[...t.slice(0,s+1),JSON.stringify(e)];a(l),n(l.length-1)},undo:()=>s>0?(n(s-1),JSON.parse(t[s-1])):null,redo:()=>s<t.length-1?(n(s+1),JSON.parse(t[s+1])):null,canUndo:l,canRedo:i}}(t),[y,v]=c.useState(!1),[j,w]=c.useState("elements"),[N,C]=c.useState("basic"),k=c.useCallback(()=>{(async(e,t="diseño-pagina")=>{const a=document.getElementById(e);if(!a)return;const s=document.createElement("canvas"),n=a.offsetWidth,l=a.offsetHeight;s.width=2*n,s.height=2*l;const i=s.getContext("2d");i.scale(2,2),i.fillStyle="white",i.fillRect(0,0,n,l);try{(await V(a,{scale:2,backgroundColor:null,canvas:s,logging:!1,useCORS:!0})).toBlob(e=>{I.saveAs(e,`${t}.png`)})}catch(r){}})("page-preview",`diseño-pagina-${a+1}`)},[a]),S=c.useCallback(()=>{v(e=>!e)},[]),E=c.useCallback((e,s,n)=>{const l=t.map((t,l)=>l!==a?t:{...t,cells:t.cells.map(t=>t.id!==e?t:{...t,elements:t.elements.map(e=>e.id!==s?e:{...e,...n})})});setPages(l),b(l)},[t,a,b]);return e.jsx(L,{backend:F,children:e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 mx-auto max-w-7xl",children:[e.jsx(U,{onExport:k,onPreviewToggle:S,previewMode:y}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(ee,{activeTab:j,onTabChange:w,selectedLayout:o.layout,onLayoutChange:e=>{r(a,e),b(t)},onAddImage:e=>{const t=new FileReader;t.onload=e=>{e.target?.result&&h("image",{content:e.target.result})},t.readAsDataURL(e)},onAddText:()=>{h("text")},selectedElement:u,onFilterChange:E,getSelectedElement:()=>m.find(e=>e.id===u),getCurrentLayout:d}),e.jsx(ce,{currentPage:a,pages:t,selectedElement:u,selectedCell:g,onSelectElement:p,onSelectCell:x,onAddElement:h,onUpdateElement:E,onDeleteElement:f,getCurrentLayout:d,previewMode:y}),e.jsx(de,{pages:t,currentPage:a,onPageChange:s,onAddPage:()=>{n(),b(t)},onDuplicatePage:()=>{l(a),b(t)},onDeletePage:()=>{i(a),b(t)}})]})]})})}export{ve as default};

var C=Object.defineProperty;var k=(i,c,l)=>c in i?C(i,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[c]=l;var b=(i,c,l)=>k(i,typeof c!="symbol"?c+"":c,l);import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as a}from"./index-BH53Isel.js";import{c as R}from"./ReactAppend-DTVVXReZ.js";import{B as T}from"./Base-DKTRxQ5O.js";import{C as D}from"./CreateReactScript-BoGwggCx.js";import{T as E}from"./Table-DitbKwtZ.js";import{D as f}from"./DxButton-DV0H-ZcL.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{S as F}from"./ProductCard-Ap6bpF1Q.js";import{B}from"./BasicRest-B3rfI5GY.js";import{G as g}from"./Global-ErywZRdd.js";import{N as r}from"./Number2Currency-e57Tgsuk.js";import{M as A}from"./Modal-CIqmjseY.js";import{i as P}from"./tippy-react.esm-BWiGTO87.js";import{S as O}from"./SaleStatusesRest-BClaSKoc.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-C_dOKkRB.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";class q extends B{constructor(){super(...arguments);b(this,"path","admin/sales")}}const h=new q;new O;const M=({statuses:i=[]})=>{var j;const c=a.useRef(),l=a.useRef(),[t,u]=a.useState(null),[p,G]=a.useState([]),_=async e=>{const n=await h.save({id:t.id,status_id:e.target.value});console.log("onStatusChange",n),n&&(u(n),$(c.current).dxDataGrid("instance").refresh())},y=async e=>{const{isConfirmed:n}=await F.fire({title:"Anular pedido",text:"¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!n||!await h.delete(e)||$(c.current).dxDataGrid("instance").refresh()},d=async e=>{const n=await h.get(e);u(n.data),$(l.current).modal("show")};a.useEffect(()=>{},[t]);const v=Number(t==null?void 0:t.amount)+Number((t==null?void 0:t.delivery)||0)-Number((t==null?void 0:t.bundle_discount)||0)-Number((t==null?void 0:t.renewal_discount)||0)-Number((t==null?void 0:t.coupon_discount)||0)-Number((t==null?void 0:t.promotion_discount)||0);return s.jsxs(s.Fragment,{children:[s.jsx(E,{gridRef:c,title:"Pedidos",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(e,{data:n})=>{e.css("cursor","pointer"),e.on("click",()=>{d(n.id)}),N(e,s.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[s.jsxs("b",{className:"d-block",children:[n.name," ",n.lastname]}),s.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",g.APP_CORRELATIVE,"-",n.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(e,{data:n})=>{e.text(moment(n.created_at).format("LLL"))}},{dataField:"status.name",caption:"Estado",cellTemplate:(e,{data:n})=>{console.log(n),N(e,s.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e",color:n.status.color??"#333"},children:n.status.name}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(e,{data:n})=>{const o=Number(n.amount)||0,m=Number(n.delivery)||0,x=Number(n.bundle_discount)||0,w=Number(n.renewal_discount)||0,S=Number(n.coupon_discount)||0;e.text(`S/. ${r(o+m-x-w-S)}`)}},{caption:"Acciones",cellTemplate:(e,{data:n})=>{e.append(f({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>d(n.id)})),e.append(f({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>y(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(A,{modalRef:l,title:`Detalles del pedido #${g.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-8",children:[s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header p-2",children:s.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),s.jsx("div",{className:"card-body p-2",children:s.jsx("table",{className:"table table-borderless table-sm mb-0",children:s.jsxs("tbody",{children:[(t==null?void 0:t.payment_method)&&s.jsxs("tr",{children:[s.jsx("th",{children:"Método de pago:"}),s.jsx("td",{children:t==null?void 0:t.payment_method})]}),(t==null?void 0:t.culqi_charge_id)&&s.jsxs("tr",{children:[s.jsx("th",{children:"ID de transacción:"}),s.jsx("td",{children:t==null?void 0:t.culqi_charge_id})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"Nombres:"}),s.jsx("td",{children:t==null?void 0:t.fullname})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"Email:"}),s.jsx("td",{children:t==null?void 0:t.email})]}),s.jsxs("tr",{children:[s.jsx("th",{children:"Teléfono:"}),s.jsx("td",{children:t==null?void 0:t.phone})]}),(t==null?void 0:t.delivery_type)&&s.jsxs("tr",{children:[s.jsx("th",{children:"Dirección:"}),s.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,s.jsxs("small",{className:"text-muted d-block",children:[t==null?void 0:t.district,","," ",t==null?void 0:t.province,","," ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&s.jsxs(s.Fragment,{children:["-"," ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&s.jsxs("tr",{children:[s.jsx("th",{children:"Referencia:"}),s.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&s.jsxs("tr",{children:[s.jsx("th",{children:"Comentario:"}),s.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.coupon_code)&&s.jsxs("tr",{children:[s.jsx("th",{children:"Cupón aplicado:"}),s.jsxs("td",{children:[s.jsx("span",{className:"badge bg-success",children:t==null?void 0:t.coupon_code}),s.jsxs("small",{className:"text-success d-block",children:["Descuento: S/ ",r((t==null?void 0:t.coupon_discount)||0)]})]})]}),(t==null?void 0:t.applied_promotions)&&t.applied_promotions!=="[]"&&s.jsxs("tr",{children:[s.jsx("th",{children:"Promociones aplicadas:"}),s.jsxs("td",{children:[JSON.parse(t.applied_promotions).map((e,n)=>s.jsxs("div",{className:"mb-2",children:[s.jsx("span",{className:"badge bg-info me-2",children:e.rule_name}),s.jsx("small",{className:"text-info d-block",children:e.description}),s.jsxs("small",{className:"text-success d-block",children:["Descuento: S/ ",r(e.discount_amount||0)]})]},n)),s.jsx("div",{className:"mt-2",children:s.jsxs("strong",{className:"text-info",children:["Total descuentos: S/ ",r((t==null?void 0:t.promotion_discount)||0)]})})]})]}),(t==null?void 0:t.invoiceType)&&s.jsxs("tr",{children:[s.jsxs("th",{children:[t==null?void 0:t.invoiceType,":"]}),s.jsxs("td",{children:[t==null?void 0:t.documentType," - ",t==null?void 0:t.document," ",s.jsx("br",{})," ",(t==null?void 0:t.document)&&(t==null?void 0:t.businessName)]})]}),(t==null?void 0:t.payment_proof)&&s.jsxs("tr",{children:[s.jsx("th",{children:"Comprobante de pago:"}),s.jsx("td",{children:s.jsx(P,{content:"Ver comprobante de pago",placement:"top",children:s.jsx("a",{href:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,target:"_blank",children:s.jsx("img",{src:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"150px",cursor:"pointer"}})})})})]})]})})})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header p-2",children:s.jsx("h5",{className:"card-title mb-0",children:"Artículos"})}),s.jsx("div",{className:"card-body p-2 table-responsive",children:s.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"w-20",children:"Imagen"}),s.jsx("th",{children:"Nombre"}),s.jsx("th",{children:"Precio"}),s.jsx("th",{children:"Cantidad"}),s.jsx("th",{children:"Subtotal"})]})}),s.jsx("tbody",{children:(j=t==null?void 0:t.details)==null?void 0:j.map((e,n)=>{const o=e.quantity*100/100,m=e.price*e.quantity;return s.jsxs("tr",{children:[s.jsx("td",{className:"max-w-20 p-0",children:e.image?s.jsx("img",{className:"object-scale-down mx-auto block",src:`/storage/images/item/${e.image}`,alt:e.name,style:{height:"5rem",width:"5rem",objectFit:"scale-down"}}):null}),s.jsxs("td",{children:[e.name,e.colors?" - "+e.colors:""]}),s.jsx("td",{align:"right",children:s.jsxs("span",{className:"text-nowrap",children:["S/"," ",r(e.price)]})}),s.jsx("td",{align:"center",children:o}),s.jsx("td",{align:"right",children:s.jsxs("span",{className:"text-nowrap",children:["S/"," ",r(m)]})})]},n)})})]})})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header p-2",children:s.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),s.jsxs("div",{className:"card-body p-2",children:[s.jsxs("div",{className:"d-flex justify-content-between",children:[s.jsx("b",{children:"Subtotal:"}),s.jsxs("span",{children:["S/"," ",r((t==null?void 0:t.amount)*1)]})]}),s.jsxs("div",{className:"d-flex justify-content-between",children:[s.jsx("b",{children:"Envío:"}),s.jsxs("span",{children:["S/"," ",r(t==null?void 0:t.delivery)]})]}),((t==null?void 0:t.bundle_discount)>0||(t==null?void 0:t.renewal_discount)>0||(t==null?void 0:t.coupon_discount)>0)&&s.jsxs(s.Fragment,{children:[s.jsx("hr",{className:"my-2"}),(t==null?void 0:t.bundle_discount)>0&&s.jsxs("div",{className:"d-flex justify-content-between text-success",children:[s.jsx("span",{children:"Descuento por paquete:"}),s.jsxs("span",{children:["-S/ ",r(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal_discount)>0&&s.jsxs("div",{className:"d-flex justify-content-between text-success",children:[s.jsx("span",{children:"Descuento por renovación:"}),s.jsxs("span",{children:["-S/ ",r(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon_discount)>0&&s.jsxs("div",{className:"d-flex justify-content-between text-success",children:[s.jsxs("span",{children:["Descuento con cupón",(t==null?void 0:t.coupon_code)&&s.jsxs("small",{className:"text-muted d-block",children:["Código: ",t==null?void 0:t.coupon_code]})]}),s.jsxs("span",{children:["-S/ ",r(t==null?void 0:t.coupon_discount)]})]}),(t==null?void 0:t.promotion_discount)>0&&s.jsxs("div",{className:"d-flex justify-content-between text-info",children:[s.jsxs("span",{children:["Descuentos por promociones",(t==null?void 0:t.applied_promotions)&&s.jsx("small",{className:"text-muted d-block",children:JSON.parse(t.applied_promotions).map((e,n)=>s.jsxs("div",{children:["• ",e.rule_name,": ",e.description]},n))})]}),s.jsxs("span",{children:["-S/ ",r(t==null?void 0:t.promotion_discount)]})]})]}),s.jsx("hr",{className:"my-2"}),s.jsxs("div",{className:"d-flex justify-content-between",children:[s.jsx("b",{children:"Total:"}),s.jsx("span",{children:s.jsxs("strong",{children:["S/ ",r(v)]})})]})]})]})]}),s.jsxs("div",{className:"col-md-4",children:[s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header p-2",children:s.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),s.jsx("div",{className:"card-body p-2",children:s.jsxs("div",{className:"",children:[s.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),s.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:_,children:i.map((e,n)=>s.jsx("option",{value:e.id,children:e.name}))})]})})]}),s.jsxs("div",{className:"card",hidden:!0,children:[s.jsx("div",{className:"card-header p-2",children:s.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),s.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",children:p==null?void 0:p.map((e,n)=>{var o,m,x;return s.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:e.status.color?`${e.status.color}2e`:"#3333332e"},children:[s.jsx("i",{className:"mdi mdi-circle left-2",style:{color:e.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),s.jsx("b",{style:{color:e.status.color||"#333"},children:(o=e==null?void 0:e.status)==null?void 0:o.name}),s.jsxs("small",{className:"d-block text-truncate",children:[(m=e==null?void 0:e.user)==null?void 0:m.name," ",(x=e==null?void 0:e.user)==null?void 0:x.lastname]}),s.jsx("small",{className:"d-block text-muted",children:moment(e.created_at).format("YYYY-MM-DD HH:mm")})]},n)})})]})]})]})})]})};D((i,c)=>{R.createRoot(i).render(s.jsx(T,{...c,title:"Pedidos",children:s.jsx(M,{...c})}))});

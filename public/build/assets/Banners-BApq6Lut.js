var Re=Object.defineProperty;var Se=(u,c,g)=>c in u?Re(u,c,{enumerable:!0,configurable:!0,writable:!0,value:g}):u[c]=g;var J=(u,c,g)=>Se(u,typeof c!="symbol"?c+"":c,g);import{j as n}from"./AboutSimple-Cf8x2fCZ.js";import{B as we}from"./Base-NbtpFRZL.js";import{T as ie}from"./TextareaFormGroup-CliirJM1.js";import{r}from"./index-BOnQTV8N.js";import{c as Fe}from"./ReactAppend-QR5TrZfj.js";import{s as ye}from"./server.browser-Bf4gQIc7.js";import{S as Pe}from"./ProductCard-D_AgkLlk.js";import{B as _e}from"./BasicRest-BML1C-ua.js";import{S as Ce}from"./SystemRest-DVRjGh0L.js";import{I as ae}from"./ImageFormGroup-DkVgPNU5.js";import{S as De}from"./SwitchFormGroup-DXN0cwVk.js";import{S as Q}from"./SelectFormGroup-X8WqJHHl.js";import{M as ke}from"./Modal-BYL-UsqM.js";import{T as Ie}from"./Table-BoAJpQpW.js";import{D as re}from"./DxButton-DV0H-ZcL.js";import{I as oe}from"./InputFormGroup-iZIO11ZN.js";import{C as Te}from"./CreateReactScript-BSTb2hiI.js";import{R as X}from"./ReactAppend-Vm5G2nof.js";import{S as se}from"./SortByAfterField-2AndDudn.js";import"./index-yBjzXJbu.js";import"./Global-DWbVqTT_.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DwXwpKCn.js";import"./index.esm-D6GvEWn_.js";import"./index-BQJyKPGC.js";import"./CanAccess-DgL4m2bH.js";import"./CardProductKatya-ncpmQ0JU.js";import"./BooleanLimit-D-OsQsek.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";class Ee extends _e{constructor(){super(...arguments);J(this,"path","admin/banners");J(this,"hasFiles",!0)}}const k=new Ee,le=new Ce,Ne=({pages:u,systems:c=[]})=>{const g=r.useRef(),I=r.useRef(),T=r.useRef(),y=r.useRef(),E=r.useRef(),p=r.useRef(),f=r.useRef(),N=r.useRef(),A=r.useRef(),P=r.useRef(),M=r.useRef(),_=r.useRef(),O=r.useRef(),[ce,z]=r.useState(!1),[S,G]=r.useState(c),[de,me]=r.useState([]),[L,U]=r.useState(""),[B,K]=r.useState(null),[ue,Y]=r.useState(!1),pe=()=>{if(!g.current)return;const e=$(g.current);if(typeof e.dxDataGrid!="function")return;const t=e.dxDataGrid("instance");t==null||t.refresh()},Z=[{id:"BannerSimple",name:"Banner Simple",icon:"mdi mdi-image-size-select-large"},{id:"BannerAd",name:"Banner Ad",icon:"mdi mdi-google-ads"},{id:"BannerFullWidth",name:"Banner Full Width",icon:"mdi mdi-view-carousel"},{id:"BannerFlex",name:"Banner Flex",icon:"mdi mdi-view-split-vertical"},{id:"BannerPublicitario",name:"Banner Publicitario",icon:"mdi mdi-bullhorn"},{id:"BannerPublicitarioPaani",name:"Banner Publicitario Paani",icon:"mdi mdi-bullhorn-variant"},{id:"BannerPostSuscriptionPaani",name:"Banner Post Suscripción Paani",icon:"mdi mdi-email-newsletter"},{id:"BannerStatic",name:"Banner Static",icon:"mdi mdi-image-frame"},{id:"BannerStaticSecond",name:"Banner Static Second",icon:"mdi mdi-image-multiple"},{id:"BannerSimpleSF",name:"Banner Simple SF",icon:"mdi mdi-image-outline"},{id:"BannerSimpleD2",name:"Banner Simple D2",icon:"mdi mdi-image"},{id:"BannerBananaLab",name:"Banner Banana Lab",icon:"mdi mdi-fruit-grapes"},{id:"BannerCTAMakita",name:"Banner CTA Makita",icon:"mdi mdi-call-to-action"},{id:"BannerContactMakita",name:"Banner Contact Makita",icon:"mdi mdi-contact-mail"},{id:"BannerPidelo",name:"Banner Pidelo",icon:"mdi mdi-shopping"},{id:"BannerMultivet",name:"Banner Multivet",icon:"mdi mdi-medical-bag"},{id:"BannerPublicitarioKatya",name:"Banner Publicitario Katya",icon:"mdi mdi-account-star"},{id:"BannerBlogSectionKatya",name:"Banner Blog Section Katya",icon:"mdi mdi-post"}],x=e=>e==null||e===""?null:e,ee=({pageId:e,baseSystems:t=[],insertedSystem:i=null})=>{const a=x(e);let o=se(t.map(l=>({...l})));if(i){const l={...i,page_id:a},b=l.after_component??null;if(!b)o=[l,...o];else{const m=o.findIndex(v=>v.id===b);m===-1?o=[...o,l]:o=[...o.slice(0,m+1),l,...o.slice(m+1)]}}const w={};return{ordered:o.map((l,b)=>{const v=(b===0?null:o[b-1].id)??null;return(l.after_component??null)!==v&&(w[l.id]=v),{...l,page_id:a,after_component:v}}),updates:w}},V=e=>{const t=x(e),i=S.filter(s=>x(s.page_id)===t),a=se(i);me(a)};r.useEffect(()=>{V()},[]),r.useEffect(()=>{V(L)},[L,S]);const te=e=>{e!=null&&e.id?(z(!0),K({id:e.id,page_id:x(e.page_id),after_component:e.after_component??null})):(z(!1),K(null));const t=(e==null?void 0:e.data)||{};T.current.value=(e==null?void 0:e.id)??"",y.current.value=t.name??"",E.current.value=t.description??"",p.image.src=t.background?`/storage/images/system/${t.background}`:"",p.current.value=null,f.image.src=t.image?`/storage/images/system/${t.image}`:"",f.current.value=null,p.resetDeleteFlag&&p.resetDeleteFlag(),f.resetDeleteFlag&&f.resetDeleteFlag(),N.current.value=t.button_text??"",A.current.value=t.button_link??"",P.current&&(P.current.checked=t.contenedor==="absoluto"),$(M.current).val((e==null?void 0:e.page_id)||"").trigger("change");const i=(e==null?void 0:e.page_id)||"";U(i),V(i),setTimeout(()=>{const a=(e==null?void 0:e.after_component)||"";$(_.current).val(a).trigger("change")},100),$(O.current).val(t.type||"BannerSimple").trigger("change"),$(I.current).modal("show")},fe=async e=>{var t;if(e.preventDefault(),!ue){Y(!0);try{const i=T.current.value,a=$(M.current).val(),s=x(a),o=$(_.current).val()||null,w=$(O.current).val(),W={name:`Banner - ${y.current.value}`,component:"banner",value:w,page_id:s,after_component:o,visible:!0};i&&(W.id=i);const l=await le.save(W);if(!l)return;const b={name:y.current.value,description:E.current.value,button_text:N.current.value,button_link:A.current.value,contenedor:(t=P.current)!=null&&t.checked?"absoluto":"relativo",type:w},m=new FormData;m.append("id",l.id),Object.entries(b).forEach(([d,D])=>m.append(d,D));const v=p.current.files[0];v&&m.append("background",v);const q=f.current.files[0];if(q&&m.append("image",q),p.getDeleteFlag&&p.getDeleteFlag()&&m.append("background_delete","DELETE"),f.getDeleteFlag&&f.getDeleteFlag()&&m.append("image_delete","DELETE"),!await k.save(m))return;p.resetDeleteFlag&&p.resetDeleteFlag(),f.resetDeleteFlag&&f.resetDeleteFlag();let h={...l,page_id:s,after_component:o??null,data:{...l.data||{},...b}};const H=x(B==null?void 0:B.page_id),C=x(h.page_id),j={};if(B!=null&&B.id&&H!==C){const d=S.filter(F=>x(F.page_id)===H&&F.id!==h.id).map(F=>({...F})),{updates:D}=ee({pageId:H,baseSystems:d});Object.assign(j,D)}const ve=S.filter(d=>x(d.page_id)===C&&d.id!==h.id).map(d=>({...d})),{ordered:Be,updates:je}=ee({pageId:C,baseSystems:ve,insertedSystem:h});Object.assign(j,je);const ne=Be.find(d=>d.id===h.id);if(ne&&(h={...h,after_component:ne.after_component??null}),Object.keys(j).length>0&&!await le.updateOrder(j))return;G(d=>[...d.filter(R=>R.id!==h.id).map(R=>Object.prototype.hasOwnProperty.call(j,R.id)?{...R,after_component:j[R.id]??null}:R),h]),U(C??""),pe(),$(I.current).modal("hide"),K(null),z(!1)}finally{Y(!1)}}},ge=e=>{const t=$(e.target).val();U(t),setTimeout(()=>{$(_.current).val("").trigger("change")},100)},xe=async({id:e,value:t})=>{await k.boolean({id:e,field:"visible",value:t})&&G(a=>a.map(s=>s.id===e?{...s,visible:t}:s))},he=async e=>{const{isConfirmed:t}=await Pe.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!t||!await k.delete(e)||G(a=>a.filter(s=>s.id!=e))};return n.jsxs(n.Fragment,{children:[n.jsx(Ie,{gridRef:g,title:"Banners",rest:k,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(g.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo banner",hint:"Nuevo banner",onClick:()=>te()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Información",cellTemplate:(e,{data:t})=>{const i=u.find(s=>s.id==(t==null?void 0:t.page_id)),a=Z.find(s=>{var o;return s.id===((o=t==null?void 0:t.data)==null?void 0:o.type)});e.html(ye.renderToString(n.jsx(n.Fragment,{children:n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:`${(a==null?void 0:a.icon)||"mdi mdi-image"} me-2`}),n.jsxs("div",{children:[n.jsx("b",{className:"d-block",children:t==null?void 0:t.name}),n.jsxs("small",{className:"text-muted d-block",children:["Tipo: ",(a==null?void 0:a.name)||"Banner Simple"]}),n.jsxs("small",{className:"text-muted",children:["Página: ",(i==null?void 0:i.name)||"Base Template"]})]})]})})))}},{dataField:"after_component",caption:"Después de",cellTemplate:(e,{data:t})=>{if(!t.after_component){e.text("Al inicio");return}const i=S.find(a=>a.id===t.after_component);e.text(i?i.name:"Componente eliminado")}},{dataField:"background",caption:"Fondo",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{var i;X(e,n.jsx("img",{src:`/storage/images/system/${(i=t==null?void 0:t.data)==null?void 0:i.background}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:a=>a.target.src="/api/cover/thumbnail/null"}))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{var i;X(e,n.jsx("img",{src:`/storage/images/system/${(i=t==null?void 0:t.data)==null?void 0:i.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:a=>a.target.src="/api/cover/thumbnail/null"}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),X(e,n.jsx(De,{checked:t.visible==1,onChange:()=>xe({id:t.id,value:!t.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(re({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>te(t)})),e.append(re({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>he(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),n.jsxs(ke,{modalRef:I,title:ce?"Editar banner":"Agregar banner",onSubmit:fe,size:"lg",children:[n.jsx("input",{ref:T,type:"hidden"}),n.jsx("div",{className:"row",id:"banner-container",children:n.jsxs("div",{className:"col-12",children:[n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-md-6",children:n.jsx(Q,{eRef:O,label:"Tipo de Banner",dropdownParent:"#banner-container",children:Z.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))})}),n.jsx("div",{className:"col-md-6",children:n.jsxs(Q,{eRef:M,label:"Página",onChange:ge,dropdownParent:"#banner-container",children:[n.jsx("option",{value:"",children:"Base Template"}),u.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))]})})]}),n.jsxs(Q,{eRef:_,label:"Posición (después de)",dropdownParent:"#banner-container",changeWith:[L],children:[n.jsx("option",{value:"",children:"Al inicio"}),de.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))]}),n.jsx(ae,{eRef:p,name:"background",label:"Fondo"}),n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-sm-6",children:n.jsx(ae,{eRef:f,name:"image",label:"Imagen",aspect:1})}),n.jsxs("div",{className:"col-sm-6",children:[n.jsx(ie,{eRef:y,label:"Titulo",rows:2}),n.jsx(ie,{eRef:E,label:"Descripción",rows:2}),n.jsx(oe,{eRef:N,label:"Texto botón"})]})]}),n.jsx(oe,{eRef:A,label:"URL botón"}),n.jsxs("div",{className:"form-group row",children:[n.jsx("label",{className:"col-sm-3 col-form-label",children:"Posición"}),n.jsxs("div",{className:"col-sm-9",children:[n.jsxs("div",{className:"custom-control custom-switch",children:[n.jsx("input",{type:"checkbox",className:"custom-control-input",id:"absoluteSwitch",ref:P}),n.jsx("label",{className:"custom-control-label",htmlFor:"absoluteSwitch",children:"Imagen absoluta"})]}),n.jsx("small",{className:"form-text text-muted",children:"Marca esta opción para posicionamiento absoluto de la imagen"})]})]})]})})]})]})};Te((u,c)=>{Fe.createRoot(u).render(n.jsx(we,{...c,title:"Banners",children:n.jsx(Ne,{...c})}))});

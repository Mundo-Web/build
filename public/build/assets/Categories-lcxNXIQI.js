var G=Object.defineProperty;var J=(u,f,b)=>f in u?G(u,f,{enumerable:!0,configurable:!0,writable:!0,value:b}):u[f]=b;var A=(u,f,b)=>J(u,typeof f!="symbol"?f+"":f,b);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{B as L}from"./Base-C3itgJ7e.js";import{S as M}from"./SwitchFormGroup-DXN0cwVk.js";import{T as U}from"./TextareaFormGroup-CliirJM1.js";import{r as h}from"./index-BOnQTV8N.js";import{c as W}from"./ReactAppend-QR5TrZfj.js";import{S as O}from"./CartKuchara-D9l7c7at.js";import{B as q}from"./BasicRest-BML1C-ua.js";import{I as _}from"./ImageFormGroup-40MuGzez.js";import{P as H}from"./plus-CTIomuuF.js";import{I as K}from"./image-BPmHvEaV.js";import{M as Q,a as X}from"./move-up-Gz4AiwKb.js";import{T as Y}from"./trash-2-DU7LB6-f.js";import{S as Z}from"./SelectAPIFormGroup-BZe8H0Ph.js";import{M as ee}from"./Modal-xDw9ufjg.js";import{T as se}from"./Table-O7_BONvQ.js";import{D as P}from"./DxButton-DV0H-ZcL.js";import{C as ae,F as g,h as te}from"./CreateReactScript-BVFa7_vB.js";import{R as I}from"./ReactAppend-Vm5G2nof.js";import{B as v}from"./BooleanLimit-D-OsQsek.js";import{I as V}from"./InputFormGroup-iZIO11ZN.js";import{S as re}from"./SetSelectValue-UxyCmHse.js";import"./index-yBjzXJbu.js";import"./Global-Bz6gVLc5.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-BOTQKW2g.js";import"./CardProductKatya-ncpmQ0JU.js";import"./createLucideIcon-DfjclApS.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";class ne extends q{constructor(){super(...arguments);A(this,"path","admin/categories");A(this,"hasFiles",!0)}}const z=h.forwardRef(({name:u="banners",label:f="Banners",initialValue:b=[],model:k="category"},C)=>{const[p,j]=h.useState([]),[c,d]=h.useState({}),o=h.useRef({});h.useImperativeHandle(C,()=>({getValue:()=>JSON.stringify(p),setValue:t=>{console.log("BannersJsonEditor.setValue called with:",t,"type:",typeof t);try{const r=typeof t=="string"?JSON.parse(t):t;if(console.log("Parsed value:",r,"is array:",Array.isArray(r)),j(Array.isArray(r)?r:[]),console.log("setBanners called, should trigger re-render"),Array.isArray(r)&&r.length>0){const l={};r.forEach((m,s)=>{l[s]=!0}),d(l)}}catch(r){console.error("Error setting banners:",r),j([])}},reset:()=>{j([]),o.current={}},getImageRefs:()=>o.current,getImageFiles:()=>{const t={};return console.log("getImageFiles - imageRefs.current:",o.current),Object.keys(o.current).forEach(r=>{var m,s;const l=o.current[r];console.log(`getImageFiles - index ${r}:`,l),(s=(m=l==null?void 0:l.current)==null?void 0:m.files)!=null&&s[0]&&(t[`banner_image_${r}`]=l.current.files[0],console.log(`getImageFiles - Added file for banner_image_${r}:`,l.current.files[0].name))}),console.log("getImageFiles - Final files object:",t),t}}));const R=()=>{const t={image:"",title:"",description:"",button_text:"",button_link:""},r=[...p,t];j(r),d({...c,[r.length-1]:!0}),o.current[r.length-1]={current:null}},S=async t=>{const{isConfirmed:r}=await O.fire({title:"¿Eliminar banner?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(r){const l=p.filter((a,n)=>n!==t);j(l),delete o.current[t];const m={};Object.keys(o.current).forEach(a=>{const n=parseInt(a);n>t?m[n-1]=o.current[a]:n<t&&(m[n]=o.current[a])}),o.current=m;const s={};Object.keys(c).forEach(a=>{const n=parseInt(a);n<t?s[n]=c[a]:n>t&&(s[n-1]=c[a])}),d(s)}},D=(t,r)=>{const l=r==="up"?t-1:t+1;if(l<0||l>=p.length)return;const m=[...p];[m[t],m[l]]=[m[l],m[t]],j(m);const s=o.current[t];o.current[t]=o.current[l],o.current[l]=s;const a=c[t],n=c[l];d({...c,[t]:n,[l]:a})},w=(t,r,l)=>{const m=[...p];m[t]={...m[t],[r]:l},j(m)},T=t=>{d({...c,[t]:!c[t]})};return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"font-weight-bold mb-2",children:f}),e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("small",{className:"text-muted",children:[p.length," banner",p.length!==1?"s":""," configurado",p.length!==1?"s":""]}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:R,children:[e.jsx(H,{size:16,className:"mr-1"}),"Agregar Banner"]})]}),p.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(K,{size:48,className:"mb-2 opacity-50",style:{display:"block",margin:"0 auto"}}),e.jsx("p",{className:"mb-0",children:"No hay banners configurados"}),e.jsx("small",{children:'Haz clic en "Agregar Banner" para comenzar'})]}):e.jsx("div",{className:"space-y-2",children:p.map((t,r)=>e.jsxs("div",{className:"card mb-2 shadow-sm",children:[e.jsxs("div",{className:"card-header bg-white d-flex justify-content-between align-items-center p-2",children:[e.jsxs("button",{type:"button",className:"btn btn-link text-left flex-grow-1 text-decoration-none p-2",onClick:()=>T(r),children:[e.jsxs("strong",{children:["Banner ",r+1]}),t.title&&e.jsxs("small",{className:"text-muted ml-2",children:["- ",t.title]})]}),e.jsxs("div",{className:"d-flex gap-1",children:[r>0&&e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>D(r,"up"),title:"Mover arriba",children:e.jsx(Q,{size:14})}),r<p.length-1&&e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>D(r,"down"),title:"Mover abajo",children:e.jsx(X,{size:14})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>S(r),title:"Eliminar",children:e.jsx(Y,{size:14})})]})]}),c[r]&&e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx(_,{eRef:(o.current[r]||(o.current[r]={current:null}),o.current[r]),name:`banner_image_${r}`,label:"Imagen del Banner",col:"col-12",aspect:16/9,onChange:l=>{if(l.target.files&&l.target.files[0]){const m=l.target.files[0];w(r,"image",m.name)}}}),t.image&&e.jsxs("small",{className:"text-muted d-block mt-2",children:["Archivo actual: ",e.jsx("strong",{children:t.image})]})]}),e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx("label",{className:"font-weight-semibold small",children:"Título"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Título del banner",value:t.title||"",onChange:l=>w(r,"title",l.target.value)})]}),e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx("label",{className:"font-weight-semibold small",children:"Descripción"}),e.jsx("textarea",{className:"form-control form-control-sm",rows:"3",placeholder:"Descripción del banner",value:t.description||"",onChange:l=>w(r,"description",l.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"font-weight-semibold small",children:"Texto del Botón"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Ver más",value:t.button_text||"",onChange:l=>w(r,"button_text",l.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"font-weight-semibold small",children:"Link del Botón"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"/ruta-destino",value:t.button_link||"",onChange:l=>w(r,"button_link",l.target.value)})]})]})})]},`banner-${r}-${t.image||"new"}`))})]}),e.jsx("input",{type:"hidden",name:u,value:JSON.stringify(p)})]})});z.displayName="BannersJsonEditor";const E=new ne,le=()=>{const u=h.useRef(),f=h.useRef(),b="categories",k=h.useRef(),C=h.useRef(),p=h.useRef(),j=h.useRef(),c=h.useRef(),d=h.useRef(),o=h.useRef(),R=h.useRef(),[S,D]=h.useState(!1),w=s=>{if(console.log("=== onModalOpen called ==="),console.log("Full data object:",s),console.log("data.banners specifically:",s==null?void 0:s.banners),console.log("typeof data.banners:",typeof(s==null?void 0:s.banners)),s!=null&&s.id?D(!0):D(!1),k.current.value=(s==null?void 0:s.id)??"",C.current.value=(s==null?void 0:s.name)??"",p.current.value=(s==null?void 0:s.alias)??"",j.current.value=(s==null?void 0:s.description)??"",c.current&&c.image&&(c.image.src=s!=null&&s.banner?`/storage/images/category/${s.banner}`:"",c.current.value=null,c.resetDeleteFlag&&c.resetDeleteFlag()),d.current&&d.image&&(d.image.src=s!=null&&s.image?`/storage/images/category/${s.image}`:"",d.current.value=null,d.resetDeleteFlag&&d.resetDeleteFlag()),o.current&&g.has("categories","banners")){let a=(s==null?void 0:s.banners)||[];if(console.log("Categories.onModalOpen - data.banners:",s==null?void 0:s.banners),console.log("Categories.onModalOpen - banners type:",typeof a),typeof a=="string")try{a=JSON.parse(a)}catch(x){console.error("Error parsing banners JSON:",x),a=[]}console.log("Categories.onModalOpen - calling setValue with:",a),o.current.setValue(a);const n=(x=1)=>{console.log(`Attempt ${x} to load banner images...`);const i=o.current.getImageRefs();console.log("imageRefs:",i);let N=!0;a.forEach((B,F)=>{if(B.image){const y=i[F];console.log(`Banner ${F} - Full ref:`,y),console.log(`Banner ${F} - imgRef.image:`,y==null?void 0:y.image),console.log(`Banner ${F} - All properties:`,Object.keys(y||{})),y!=null&&y.image?(y.image.src=`/storage/images/category/${B.image}`,console.log(`✓ Loaded image for banner ${F}:`,B.image)):(N=!1,console.log(`✗ Ref not ready for banner ${F}`))}}),!N&&x<5&&setTimeout(()=>n(x+1),300)};setTimeout(()=>n(),500)}R.current&&g.has("categories","stores")&&re(R.current,(s==null?void 0:s.stores)??[],"id","name"),$(f.current).modal("show")},T=async s=>{s.preventDefault();const a={id:k.current.value||void 0,name:C.current.value,alias:p.current.value,description:j.current.value},n=new FormData;for(const i in a)n.append(i,a[i]);if(d.current&&g.has("categories","image")){const i=d.current.files[0];i&&n.append("image",i),d.getDeleteFlag&&d.getDeleteFlag()&&n.append("image_delete","DELETE")}if(c.current&&g.has("categories","banner")){const i=c.current.files[0];i&&n.append("banner",i),c.getDeleteFlag&&c.getDeleteFlag()&&n.append("banner_delete","DELETE")}if(o.current&&g.has("categories","banners")){n.append("banners",o.current.getValue());const i=o.current.getImageFiles();Object.keys(i).forEach(N=>{n.append(N,i[N])})}if(R.current&&g.has("categories","stores")){const i=$(R.current).val();i&&i.length>0?n.append("stores",JSON.stringify(i)):n.append("stores",JSON.stringify([]))}for(let[i,N]of n.entries());await E.save(n)&&(c.current&&c.resetDeleteFlag&&c.resetDeleteFlag(),d.current&&d.resetDeleteFlag&&d.resetDeleteFlag(),$(u.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},t=async({id:s,value:a,previous:n})=>{if(a&&v.shouldBlock(b,"featured",n)){const i=v.get(b,"featured");let B=(i==null?void 0:i.message)??"Se alcanzó el límite de categorías destacadas.";i&&(B+=` Actualmente hay ${i.active??0} de ${i.max??0} categorías activas.`,te("Root")&&i.general_key&&(B+=` Puedes ajustar el límite en Generales usando la clave ${i.general_key}.`)),O.fire({icon:"warning",title:"Límite alcanzado",text:B});return}const x=await E.boolean({id:s,field:"featured",value:a});x&&(v.has(b,"featured")&&(typeof x=="object"&&(x!=null&&x.limit)?v.updateFromServer(b,x):v.applyChange(b,"featured",{previous:n,next:a})),$(u.current).dxDataGrid("instance").refresh())},r=async({id:s,value:a})=>{await E.boolean({id:s,field:"visible",value:a})&&$(u.current).dxDataGrid("instance").refresh()},l=async s=>{const{isConfirmed:a}=await O.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!a||!await E.delete(s.id)||(v.has(b,"featured")&&s.featured&&v.applyChange(b,"featured",{previous:!0,next:!1}),$(u.current).dxDataGrid("instance").refresh())},m=async s=>{const a=s.toIndex;try{await E.reorder(s.itemData.id,a)&&await s.component.refresh()}catch(n){console.error("Error reordering category:",n)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{gridRef:u,title:"Categorías",rest:E,toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(u.current).dxDataGrid("instance").refresh()}}),s.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>w()}})},rowDragging:{allowReordering:!0,onReorder:m,dropFeedbackMode:"push"},sorting:{mode:"single"},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"order_index",caption:"Orden",visible:!1,sortOrder:"asc",sortIndex:0},{dataField:"name",caption:"Categoría",width:"30%"},{dataField:"description",caption:"Descripción",width:"50%"},g.has("categories","image")&&{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(s,{data:a})=>{I(s,e.jsx("img",{src:`/storage/images/category/${a.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:n=>n.target.src="/api/cover/thumbnail/null"}))}},g.has("categories","banner")&&{dataField:"banner",caption:"Banner",width:"90px",allowFiltering:!1,cellTemplate:(s,{data:a})=>{I(s,e.jsx("img",{src:`/storage/images/category/${a.banner}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:n=>n.target.src="/api/cover/thumbnail/null"}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(s,{data:a})=>{$(s).empty();const n=a.featured==1,i=v.has(b,"featured")&&v.shouldBlock(b,"featured",n),N=i?v.getMessage(b,"featured"):null;N?$(s).attr("title",N):$(s).removeAttr("title"),I(s,e.jsx(M,{checked:n,disabled:i,onChange:()=>t({id:a.id,value:!n,previous:n})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(s,{data:a})=>{$(s).empty(),I(s,e.jsx(M,{checked:a.visible==1,onChange:()=>r({id:a.id,value:!a.visible})}))}},{caption:"Acciones",cellTemplate:(s,{data:a})=>{s.css("text-overflow","unset"),s.append(P({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>w(a)})),s.append(P({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>l(a)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsxs(ee,{modalRef:f,title:S?"Editar categoría":"Agregar categoría",onSubmit:T,size:"xl",children:[e.jsx("input",{ref:k,type:"hidden"}),e.jsxs("div",{id:"categories-container",children:[e.jsxs("ul",{className:"nav nav-pills nav-justified mb-4",role:"tablist",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",padding:"4px",border:"1px solid #e9ecef"},children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:"nav-link active",id:"basic-info-tab","data-bs-toggle":"pill","data-bs-target":"#basic-info",type:"button",role:"tab","aria-controls":"basic-info","aria-selected":"true",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),"Información Básica"]})}),(g.has("categories","banner")||g.has("categories","image"))&&e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:"nav-link",id:"multimedia-tab","data-bs-toggle":"pill","data-bs-target":"#multimedia",type:"button",role:"tab","aria-controls":"multimedia","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"fas fa-images me-2"}),"Multimedia"]})}),g.has("categories","banners")&&e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:"nav-link",id:"banners-tab","data-bs-toggle":"pill","data-bs-target":"#banners",type:"button",role:"tab","aria-controls":"banners","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"fas fa-panorama me-2"}),"Banners del Catálogo"]})}),g.has("categories","stores")&&e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:"nav-link",id:"stores-tab","data-bs-toggle":"pill","data-bs-target":"#stores",type:"button",role:"tab","aria-controls":"stores","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"fas fa-store me-2"}),"Ubicaciones"]})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane fade show active",id:"basic-info",role:"tabpanel","aria-labelledby":"basic-info-tab",children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-tag me-2 text-primary"}),"Identificación"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(V,{eRef:C,label:"Nombre de la Categoría",placeholder:"Ej: Electrónica",required:!0})}),e.jsx("div",{className:"col-md-6",children:e.jsx(V,{eRef:p,label:"Alias (Nombre para mostrar)",placeholder:"Ej: Tecnología y Electrónica"})}),e.jsx("div",{className:"col-12",children:e.jsx(U,{eRef:j,label:"Descripción",rows:4,placeholder:"Descripción detallada de la categoría..."})})]})})]})})})}),(g.has("categories","banner")||g.has("categories","image"))&&e.jsx("div",{className:"tab-pane fade",id:"multimedia",role:"tabpanel","aria-labelledby":"multimedia-tab",children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-images me-2 text-success"}),"Imágenes Principales"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[g.has("categories","banner")&&e.jsxs("div",{className:"col-md-6",children:[e.jsx(_,{eRef:c,name:"banner",label:"Banner Principal",col:"col-12",aspect:16/9}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle me-1"}),"Recomendado: 1600x900px (proporción 16:9)"]})]}),g.has("categories","image")&&e.jsxs("div",{className:"col-md-6",children:[e.jsx(_,{eRef:d,name:"image",label:"Imagen de Portada",col:"col-12",aspect:16/9}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle me-1"}),"Recomendado: 1600x900px (proporción 16:9)"]})]})]})})]})})})}),g.has("categories","banners")&&e.jsx("div",{className:"tab-pane fade",id:"banners",role:"tabpanel","aria-labelledby":"banners-tab",children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-panorama me-2 text-info"}),"Banners Personalizados del Catálogo"]})}),e.jsx("div",{className:"card-body",children:e.jsx(z,{ref:o,name:"banners",label:"Banners del Catálogo",initialValue:[],model:"category"})})]})})})}),g.has("categories","stores")&&e.jsx("div",{className:"tab-pane fade",id:"stores",role:"tabpanel","aria-labelledby":"stores-tab",children:e.jsx("div",{className:"row g-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-store me-2 text-warning"}),"Ubicaciones y Tiendas"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx(Z,{id:"stores",eRef:R,searchAPI:"/api/admin/stores/paginate",searchBy:"name",label:"Ubicaciones (Tiendas)",dropdownParent:"#categories-container",tags:!0,multiple:!0}),e.jsxs("small",{className:"text-muted mt-2 d-block",children:[e.jsx("i",{className:"fas fa-info-circle me-1"}),"Selecciona las tiendas donde esta categoría estará disponible"]})]})]})})})})]})]})]})]})};ae((u,f)=>{W.createRoot(u).render(e.jsx(L,{...f,title:"Categorías",children:e.jsx(le,{...f})}))});

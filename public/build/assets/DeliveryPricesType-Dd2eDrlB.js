var he=Object.defineProperty;var xe=(n,t,m)=>t in n?he(n,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):n[t]=m;var J=(n,t,m)=>xe(n,typeof t!="symbol"?t+"":t,m);import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BOnQTV8N.js";import{c as ge}from"./ReactAppend-QR5TrZfj.js";import{s as c}from"./server.browser-Bf4gQIc7.js";import{D as ve}from"./DeliveryPricesRest-Dr3vM_Yk.js";import"./main-B6F2O9-U.js";import{B as be}from"./BasicRest-BML1C-ua.js";import{S as je}from"./StoresRest-Bb6TODpG.js";import{C as ye}from"./CreateReactScript-BSTb2hiI.js";import{S as Ne}from"./ProductCard-D_AgkLlk.js";import{B as Re}from"./Base-NbtpFRZL.js";import{D as L}from"./DxButton-CsjWvhyj.js";import{M as V}from"./Modal-BYL-UsqM.js";import{T as re}from"./Table-BoAJpQpW.js";import{I as v}from"./InputFormGroup-iZIO11ZN.js";import{S as ke}from"./SelectFormGroup-X8WqJHHl.js";import{S as K}from"./SwitchFormGroup-DXN0cwVk.js";import{T as _e}from"./TextareaFormGroup-CliirJM1.js";import{C as T,N as C}from"./Number2Currency-D9Rjvh76.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CardProductKatya-ncpmQ0JU.js";import"./index-pSueRYGM.js";import"./BooleanLimit-D-OsQsek.js";import"./index.esm-D6GvEWn_.js";import"./index-BQJyKPGC.js";import"./Global-DWbVqTT_.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./CanAccess-DgL4m2bH.js";import"./tippy-react.esm-DmkRJDEW.js";import"./Logout-BpuTJ_83.js";import"./MenuItemContainer-DwXwpKCn.js";class we extends be{constructor(){super(...arguments);J(this,"path","admin/types_delivery");J(this,"hasFiles",!0)}}const D=new ve,ie=new we,Se=new je,Te=({ubigeo:n=[]})=>{const t=i.useRef(),m=i.useRef(),E=i.useRef(),Q=i.useRef(),F=i.useRef(),A=i.useRef(),y=i.useRef(),B=i.useRef(),I=i.useRef(),b=i.useRef(),h=i.useRef(),o=i.useRef(),G=i.useRef(),q=i.useRef(),z=i.useRef(),[W,X]=i.useState(!1),[le,Y]=i.useState(!1),[Ce,te]=i.useState(!1),[a,M]=i.useState(!1),[N,R]=i.useState(!1),[k,x]=i.useState(!1),[Z,d]=i.useState(""),[De,Ee]=i.useState([]),[_,P]=i.useState([]),[p,u]=i.useState([]),ee=e=>{console.log(e),e!=null&&e.id?X(!0):X(!1),u([]),A.current.value=(e==null?void 0:e.id)??"",$(y.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),te((e==null?void 0:e.price)===null),b.current&&(b.current.checked=(e==null?void 0:e.is_free)??!1,M((e==null?void 0:e.is_free)??!1),e!=null&&e.is_free&&(o.current.checked=!0,x(!0),d("Delivery gratis incluye retiro en tienda autom치ticamente. Configure precio normal y express."),w(),e!=null&&e.selected_stores&&Array.isArray(e.selected_stores)&&u(e.selected_stores))),h.current&&(h.current.checked=(e==null?void 0:e.is_agency)??!1,R((e==null?void 0:e.is_agency)??!1),e!=null&&e.is_agency&&d("Este es un env칤o que se realizar치 por empresas de env칤o como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")),o.current&&(o.current.checked=(e==null?void 0:e.is_store_pickup)??!1,x((e==null?void 0:e.is_store_pickup)??!1),e!=null&&e.is_store_pickup&&(d("Retiro en tienda disponible. Los clientes podr치n recoger sus pedidos en nuestras sucursales."),w(),e!=null&&e.selected_stores&&Array.isArray(e.selected_stores)&&u(e.selected_stores))),B.current.value=(e==null?void 0:e.price)??0,z.current.value=(e==null?void 0:e.price)??0,G.current.value=(e==null?void 0:e.express_price)??0,q.current.value=(e==null?void 0:e.agency_price)??0,I.current.value=(e==null?void 0:e.description)??"",$(E.current).modal("show")},w=async()=>{try{const e=await Se.paginate({page:1,per_page:100,filters:JSON.stringify([{field:"status",operator:"=",value:1}])});console.log("Cargando todas las tiendas disponibles:",e),e&&e.data&&Array.isArray(e.data)?P(e.data):P([])}catch(e){console.error("Error loading stores:",e),P([])}},ce=async e=>{e.preventDefault();const r=n.find(j=>j.reniec==y.current.value),l={id:A.current.value||void 0,name:`${r.distrito}, ${r.departamento}`.toTitleCase(),price:a?z.current.value:B.current.value,is_free:b.current.checked,is_agency:h.current.checked,is_store_pickup:o.current.checked,express_price:G.current.value,agency_price:q.current.value,description:I.current.value,ubigeo:y.current.value,selected_stores:o.current.checked&&p.length>0?p:null};console.log("Datos a enviar:",l),await D.save(l)&&(u([]),$(t.current).dxDataGrid("instance").refresh(),$(E.current).modal("hide"))},O=i.useRef(),U=i.useRef(),H=i.useRef(),[f,g]=i.useState([{value:""}]),ne=()=>{g([...f,{value:""}])},oe=(e,r)=>{const l=[...f];l[e].value=r,g(l)},ae=e=>{if(f.length<=1)return;const r=f.filter((l,S)=>S!==e);g(r)},de=()=>{$(Q.current).modal("show")},me=e=>{e!=null&&e.id?Y(!0):Y(!1),O.current.value=(e==null?void 0:e.id)??"",U.current.value=(e==null?void 0:e.name)??"",H.current.value=(e==null?void 0:e.description)??"",e!=null&&e.characteristics&&e.characteristics.length>0?g(e.characteristics.map(r=>({value:r}))):g([{value:""}]),$(F.current).modal("show")},pe=async e=>{e.preventDefault();const r=new FormData;r.append("name",U.current.value),r.append("description",H.current.value),le&&r.append("id",O.current.value);const l=f.map(j=>j.value.trim()).filter(j=>j.length>0);r.append("characteristics",JSON.stringify(l)),await ie.save(r)&&($(m.current).dxDataGrid("instance").refresh(),$(F.current).modal("hide"),g([{value:""}]))},ue=async e=>{const{isConfirmed:r}=await Ne.fire({title:"Eliminar registro",text:"쮼stas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!r||!await D.delete(e)||$(t.current).dxDataGrid("instance").refresh()},se=e=>$(c.renderToString(s.jsxs("span",{children:[s.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),s.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),fe=async e=>{const r=e.target.files[0];if(!r)return;e.target.value=null;const l=new FormData;l.append("excel",r),await D.upload(l)&&$(t.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx("input",{id:"file-input",type:"file",accept:".xlsx, .xls",style:{display:"none"},onChange:fe}),s.jsx(re,{gridRef:t,title:"Costos de env칤o",rest:D,exportable:!0,exportableName:"delivery.prices",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",hint:"Cargar archivo Excel",onClick:()=>document.getElementById("file-input").click()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>ee()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",text:"Actualizar datos de Delivery",hint:"Actualizar datos de Delivery",onClick:()=>de()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"ubigeo",caption:"Ubigeo (RENIEC)",width:"150px"},{dataField:"name",caption:"Env칤o a",width:"200px",allowExporting:!1},{dataField:"description",caption:"Descripci칩n",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripci칩n -</i>')}},{dataField:"is_free",dataType:"number",caption:"Tipo Envio",cellTemplate:(e,{data:r})=>{r.is_free?e.html(c.renderToString(s.jsxs("div",{className:"d-flex flex-column gap-1",children:[s.jsx("span",{className:"badge bg-success",children:"Delivery Gratis"}),s.jsx("span",{className:"badge bg-warning",children:"Delivery Express"}),s.jsx("span",{className:"badge bg-primary",children:"Retiro en Tienda"})]}))):r.is_agency?e.html(c.renderToString(s.jsx("span",{className:"badge bg-info",children:"Recojo en Agencia"}))):r.is_store_pickup?e.html(c.renderToString(s.jsx("span",{className:"badge bg-primary",children:"Retiro en Tienda"}))):e.html(c.renderToString(s.jsx("span",{className:"badge bg-secondary",children:"Delivery Normal"})))}},{dataField:"price",caption:"Precio",dataType:"number",width:"150px",cellTemplate:(e,{data:r})=>{r.is_free?e.html(c.renderToString(s.jsxs("div",{className:"d-flex flex-column",children:[s.jsx("span",{className:"text-success font-weight-bold",children:"Delivery Gratis (Condicional)"}),s.jsxs("small",{className:"text-muted",children:["Normal: ",T()," ",C(r.price)," | Express: ",T()," ",C(r.express_price)]}),s.jsx("small",{className:"text-primary",children:"+ Retiro en Tienda"})]}))):r.is_agency?e.html(c.renderToString(s.jsxs("div",{children:[s.jsx("span",{className:"text-muted font-italic",children:"Recojo en Agencia"}),s.jsx("br",{}),s.jsxs("small",{className:"text-muted",children:[T()," ",C(r.agency_price)]})]}))):r.is_store_pickup&&!r.is_free?e.html(c.renderToString(s.jsx("span",{className:"text-primary font-italic",children:"Solo Retiro en Tienda"}))):e.html(c.renderToString(s.jsxs("div",{children:[s.jsx("span",{className:"text-muted font-italic",children:"Delivery Normal"}),s.jsx("br",{}),s.jsxs("small",{className:"text-muted",children:[T()," ",C(r.price)]})]})))}},{dataField:"selected_stores",caption:"Tiendas",width:"200px",cellTemplate:(e,{data:r})=>{r.is_store_pickup||r.is_free?r.selected_stores&&Array.isArray(r.selected_stores)&&r.selected_stores.length>0?e.html(c.renderToString(s.jsx("div",{children:s.jsxs("span",{className:"badge bg-primary",children:[r.selected_stores.length," tienda",r.selected_stores.length>1?"s":""," espec칤fica",r.selected_stores.length>1?"s":""]})}))):e.html(c.renderToString(s.jsx("span",{className:"badge bg-success",children:"Todas las tiendas"}))):e.html(c.renderToString(s.jsx("span",{className:"text-muted font-italic",children:"No aplica"})))},allowFiltering:!1,allowExporting:!1},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(L({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>ee(r)})),e.append(L({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ue(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsxs(V,{modalRef:E,title:W?"Editar Costo de env칤o":"Agregar Costo de env칤o",onSubmit:ce,size:"lg",children:[s.jsx("input",{ref:A,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsx(ke,{eRef:y,label:"Distrito/Ubigeo",templateResult:se,templateSelection:se,dropdownParent:"#form-container",required:!0,children:n.map((e,r)=>s.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))}),s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tipo de Env칤o"}),s.jsxs("div",{className:"row",children:[s.jsx(K,{eRef:b,label:"쮻elivery gratis?",col:"col-4",onChange:e=>{M(e.target.checked),e.target.checked?(R(!1),x(!0),h.current.checked=!1,o.current.checked=!0,d("Delivery gratis incluye retiro en tienda autom치ticamente. Configure precio normal y express."),w()):(x(!1),o.current.checked=!1,d(""))},checked:a,refreshable:[a]}),s.jsx(K,{eRef:h,label:"Recojo en agencia?",col:"col-4",onChange:e=>{R(e.target.checked),e.target.checked?(M(!1),x(!1),b.current.checked=!1,o.current.checked=!1,d("Este es un env칤o que se realizar치 por empresas de env칤o como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")):d("")},checked:N,refreshable:[N]}),s.jsx(K,{eRef:o,label:"Retiro en tienda?",col:"col-4",onChange:e=>{x(e.target.checked),e.target.checked?(w(),a||(R(!1),h.current.checked=!1),d("Retiro en tienda disponible. Seleccione tiendas espec칤ficas o deje sin seleccionar para permitir retiro en cualquier tienda.")):(d(""),u([]))},checked:k,refreshable:[k]})]}),Z&&s.jsxs("div",{className:`alert ${a?"alert-success":"alert-info"} mt-2`,children:[s.jsx("i",{className:`fas ${a?"fa-check-circle":"fa-info-circle"} me-2`}),Z]})]}),a&&s.jsx("div",{className:"col-12 mb-3",children:s.jsxs("div",{className:"alert alert-info",children:[s.jsx("i",{className:"fas fa-info-circle me-2"}),s.jsx("strong",{children:"Delivery gratis incluye autom치ticamente retiro en tienda."}),s.jsx("br",{}),"Configure el precio normal (cuando no califica para env칤o gratuito) y el precio express."]})}),s.jsx("div",{className:"col-12",hidden:a||N||k,children:s.jsx(v,{eRef:B,label:"Costo de env칤o",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-12",hidden:!a,children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsx(v,{eRef:z,label:"Precio Normal (cuando no califica gratis)",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-md-6",children:s.jsx(v,{eRef:G,label:"Precio Express",col:"col-12",type:"number",step:.01,required:!0})})]})}),s.jsx("div",{className:"col-12",hidden:!N,children:s.jsx(v,{eRef:q,label:"Costo de env칤o a Agencia",col:"col-12",type:"number",step:.01,required:!0})}),k&&s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tiendas disponibles para retiro"}),_.length>0?s.jsxs("div",{children:[s.jsxs("div",{className:"alert alert-info mb-3",children:[s.jsx("i",{className:"fas fa-info-circle me-2"}),s.jsx("strong",{children:"Instrucciones:"}),s.jsxs("ul",{className:"mb-0 mt-2",children:[s.jsxs("li",{children:["Si no selecciona ninguna tienda, el retiro estar치 disponible en ",s.jsx("strong",{children:"todas las tiendas"})," de esta ubicaci칩n."]}),s.jsx("li",{children:"Si selecciona tiendas espec칤ficas, el retiro solo estar치 disponible en las tiendas marcadas."})]})]}),s.jsx("div",{className:"row",children:_.map(e=>s.jsx("div",{className:"col-md-6 mb-3",children:s.jsx("div",{className:`card border ${p.includes(e.id)?"border-primary bg-light":""}`,children:s.jsx("div",{className:"card-body p-3",children:s.jsxs("div",{className:"form-check",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",id:`store_${e.id}`,checked:p.includes(e.id),onChange:r=>{r.target.checked?u([...p,e.id]):u(p.filter(l=>l!==e.id))}}),s.jsx("label",{className:"form-check-label w-100",htmlFor:`store_${e.id}`,children:s.jsxs("div",{className:"d-flex",children:[s.jsx("div",{className:"flex-shrink-0",children:e.image?s.jsx("img",{src:`/storage/images/stores/${e.image}`,alt:e.name,className:"rounded",style:{width:"40px",height:"40px",objectFit:"cover"}}):s.jsx("div",{className:"bg-secondary rounded d-flex align-items-center justify-content-center text-white",style:{width:"40px",height:"40px"},children:s.jsx("i",{className:"fas fa-store"})})}),s.jsxs("div",{className:"flex-grow-1 ms-3",children:[s.jsx("h6",{className:"mb-1",children:e.name}),s.jsx("small",{className:"text-muted d-block",children:e.address}),e.phone&&s.jsxs("small",{className:"text-muted d-block",children:["游 ",e.phone]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:`badge ${e.status?"bg-success":"bg-danger"}`,children:e.status?"Activa":"Inactiva"})})]})})]})})})},e.id))}),s.jsx("div",{className:"mt-3",children:s.jsxs("small",{className:"text-muted",children:[s.jsx("strong",{children:"Tiendas seleccionadas:"}),p.length===0?s.jsxs("span",{className:"text-success",children:[" Todas las tiendas disponibles (",_.length,")"]}):s.jsxs("span",{className:"text-primary",children:[" ",p.length," de ",_.length," tiendas"]})]})})]}):s.jsxs("div",{className:"alert alert-warning",children:[s.jsx("i",{className:"fas fa-exclamation-triangle me-2"}),"No hay tiendas disponibles en esta ubicaci칩n.",s.jsx("a",{href:"/admin/stores",target:"_blank",className:"alert-link ms-1",children:"Administrar tiendas"})]})]}),s.jsx(_e,{eRef:I,label:"Descripci칩n",rows:2})]})]}),s.jsx(V,{modalRef:Q,title:"Tipos de Delivery",size:"lg",children:s.jsx(re,{gridRef:m,title:"Tipos de Delivery",rest:ie,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"150px",allowExporting:!1},{dataField:"description",caption:"Descripci칩n",width:"300px",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripci칩n -</i>')}},{dataField:"characteristics",caption:"Caracteristicas",width:"200px",cellTemplate:(e,{data:r})=>{r.characteristics&&r.characteristics.forEach(l=>{e.css("text-overflow","unset"),e.append(c.renderToString(s.jsx("li",{className:"d-flex gap-2",children:s.jsxs("i",{className:"text-muted font-italic d-block",children:["- ",l]})})))})}},{caption:"Acciones",width:"50px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(L({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>me(r)}))},allowFiltering:!1,allowExporting:!1}]})}),s.jsxs(V,{modalRef:F,title:W?"Editar tipo de Delivery":"Agregar tipo de Delivery",onSubmit:pe,size:"sm",children:[s.jsx("input",{ref:O,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsxs("div",{className:"col-12",children:[s.jsx(v,{eRef:U,label:"Nombre",col:"col-12",type:"string"}),s.jsx(v,{eRef:H,label:"descripcion",col:"col-12",type:"string",required:!0})]}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Caracter칤sticas"}),f.map((e,r)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:l=>oe(r,l.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>ae(r),disabled:f.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},r)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:ne,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar caracter칤stica"]})]})})]})]})]})};ye((n,t)=>{ge.createRoot(n).render(s.jsx(Re,{...t,title:"Costos de envio",children:s.jsx(Te,{...t})}))});

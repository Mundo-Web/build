var e=Object.defineProperty,a=(a,t,s)=>((a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s)(a,"symbol"!=typeof t?t+"":t,s);import{c as t,j as s,r as i}from"./vendor-react-CtPXetfm.js";import{B as r}from"./Base-B2hVq4yw.js";import{S as o}from"./SwitchFormGroup-CB0qoXn0.js";import{I as n}from"./ImageFormGroup-Cr7oEweG.js";import{S as l}from"./CartKuchara-CNLBbncw.js";import{B as c}from"./BasicRest-DtgqEuc9.js";import{I as d}from"./InputFormGroup-CRGKsLQr.js";import{M as m}from"./Modal-CUkY7A3F.js";import{T as p}from"./Table-Wc6W9AoI.js";import{D as u}from"./DxButton-C6FT_beP.js";import{C as f,F as g}from"./CreateReactScript-Cjoo020C.js";import{R as h}from"./ReactAppend-RIOEhuYO.js";import{G as x}from"./Footer-coriRrmf.js";import"./vendor-swiper-Cr_RrIb_.js";import"./TippyButton-Dqi9Vaf_.js";import"./Logout-DQyEsGXW.js";import"./MenuItemContainer-UDNHvqM7.js";import"./Menu-BjIZNCK0.js";import"./OpenPayCardModal-CbSnHq7o.js";import"./BooleanLimit-q2Ad9fGY.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";const j=new class extends c{constructor(){super(...arguments),a(this,"path","admin/tags"),a(this,"hasFiles",!0)}},b=()=>{const e=i.useRef(),a=i.useRef(),t=i.useRef(),r=i.useRef(),c=i.useRef(),f=i.useRef(),b=i.useRef(),v=i.useRef(),w=i.useRef(),N=i.useRef(),y=i.useRef(),[F,D]=i.useState(!1),_=e=>{D(!!e?.id),t.current.value=e?.id??"",r.current.value=e?.name??"",c.current.value=e?.description??"",f.current.value=e?.background_color??x.APP_COLOR_PRIMARY,b.current.value=e?.text_color??"#ffffff",N.current.value=e?.start_date?new Date(e.start_date).toISOString().slice(0,16):"",y.current.value=e?.end_date?new Date(e.end_date).toISOString().slice(0,16):"",v.image.src=e?.icon?`/storage/images/tag/${e.icon}`:"",w.image.src=e?.image?`/storage/images/tag/${e.image}`:"",$(a.current).modal("show")};return s.jsxs(s.Fragment,{children:[s.jsx(p,{gridRef:e,title:"Tags de Productos",rest:j,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"clock",text:"Actualizar Estados",hint:"Actualizar estados promocionales",onClick:async()=>{const{isConfirmed:a}=await l.fire({title:"Actualizar Estados Promocionales",text:"Â¿Deseas actualizar el estado de todas las etiquetas promocionales basado en sus fechas?",icon:"question",showCancelButton:!0,confirmButtonText:"SÃ­, actualizar",cancelButtonText:"Cancelar"});if(a)try{l.fire({title:"Actualizando...",text:"Por favor espera mientras se actualizan los estados",allowOutsideClick:!1,didOpen:()=>l.showLoading()});const a=await fetch("/api/admin/tags/update-promotional-status",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}}),t=await a.json();if(!t.success)throw new Error(t.message||"Error al actualizar estados");await l.fire({title:"Â¡ActualizaciÃ³n completada!",html:`\n                      <div class="text-start">\n                        <p><strong>ğŸ“Š EstadÃ­sticas:</strong></p>\n                        <ul class="list-unstyled">\n                          <li>ğŸ”„ Permanentes: ${t.data.permanent||0}</li>\n                          <li>âœ… Activos: ${t.data.active||0}</li>\n                          <li>âŒ Expirados: ${t.data.expired||0}</li>\n                          <li>ğŸ“ Actualizados: ${t.data.updated||0}</li>\n                        </ul>\n                      </div>\n                    `,icon:"success"}),$(e.current).dxDataGrid("instance").refresh()}catch(t){l.fire({title:"Error",text:t.message||"No se pudieron actualizar los estados",icon:"error"})}}}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo Tag de Producto",hint:"Nuevo Tag de Producto",onClick:()=>_()}})},rowDragging:{allowReordering:!0,onReorder:async e=>{const a=e.toIndex;try{await j.reorder(e.itemData.id,a)&&await e.component.refresh()}catch(t){}},dropFeedbackMode:"push"},sorting:{mode:"single"},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"order_index",caption:"Orden",visible:!1,sortOrder:"asc",sortIndex:0},g.has("tags","name")&&{dataField:"name",caption:"Etiqueta",width:"25%"},g.has("tags","description")&&{dataField:"description",caption:"ToolTip",width:"20%"},g.has("tags","promotional_status")&&{dataField:"promotional_status",caption:"Estado Promocional",width:"15%",allowSorting:!0,allowFiltering:!0,cellTemplate:(e,{data:a})=>{$(e).empty();const t={permanent:{text:"Permanente",class:"success",icon:"fas fa-infinity"},active:{text:"Activo",class:"primary",icon:"fas fa-play-circle"},expired:{text:"Expirado",class:"danger",icon:"fas fa-stop-circle"}}[a.promotional_status]||{text:"Desconocido",class:"secondary",icon:"fas fa-question-circle"},i=s.jsxs("span",{className:`badge bg-${t.class} d-flex align-items-center gap-1`,style:{fontSize:"11px"},children:[s.jsx("i",{className:t.icon}),t.text]});h(e,i)}},g.has("tags","menu")&&{dataField:"preview",caption:"Vista Previa",width:"20%",allowSorting:!1,allowFiltering:!1,cellTemplate:(e,{data:a})=>{$(e).empty();const t={backgroundColor:a.background_color||"#3b82f6",color:a.text_color||"#ffffff",padding:"4px 8px",borderRadius:"12px",fontSize:"12px",display:"inline-flex",alignItems:"center",gap:"4px",maxWidth:"150px"},i=s.jsxs("div",{children:[s.jsxs("span",{style:t,children:[a.icon&&s.jsx("img",{src:`/storage/images/tag/${a.icon}`,style:{width:"16px",height:"16px",borderRadius:"2px"},alt:"icon",onError:e=>e.target.src="/api/cover/thumbnail/null"}),s.jsx("span",{children:a.name})]}),g.has("tags","start_date")&&g.has("tags","end_date")&&(a.start_date||a.end_date)&&s.jsxs("div",{style:{fontSize:"10px",color:"#6c757d",marginTop:"2px"},children:[a.start_date&&s.jsxs("div",{children:["ğŸ“… Inicio: ",new Date(a.start_date).toLocaleDateString()]}),a.end_date&&s.jsxs("div",{children:["ğŸ Fin: ",new Date(a.end_date).toLocaleDateString()]})]})]});h(e,i)}},g.has("tags","image")&&{dataField:"image",caption:"Imagen Principal",width:"15%",allowSorting:!1,allowFiltering:!1,cellTemplate:(e,{data:a})=>{if($(e).empty(),a.image){const t=s.jsx("img",{src:`/storage/images/tag/${a.image}`,style:{width:"40px",height:"24px",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"},alt:"imagen principal"});h(e,t)}else e.text("Sin imagen")}},g.has("tags","menu")&&{dataField:"menu",caption:"MenÃº",dataType:"boolean",cellTemplate:(a,{data:t})=>{$(a).empty(),h(a,s.jsx(o,{checked:1==t.menu,onChange:()=>(async({id:a,value:t})=>{await j.boolean({id:a,field:"menu",value:t})&&$(e.current).dxDataGrid("instance").refresh()})({id:t.id,value:!t.menu})}))}},g.has("tags","visible")&&{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(a,{data:t})=>{$(a).empty(),h(a,s.jsx(o,{checked:1==t.visible,onChange:()=>(async({id:a,value:t})=>{await j.boolean({id:a,field:"visible",value:t})&&$(e.current).dxDataGrid("instance").refresh()})({id:t.id,value:!t.visible})}))}},{caption:"Acciones",cellTemplate:(a,{data:t})=>{a.css("text-overflow","unset"),a.append(u({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>_(t)})),a.append(u({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async a=>{const{isConfirmed:t}=await l.fire({title:"Eliminar registro",text:"Â¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});if(!t)return;await j.delete(a)&&$(e.current).dxDataGrid("instance").refresh()})(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(m,{modalRef:a,title:F?"Editar Tag de Producto":"Agregar Tag de Producto",onSubmit:async s=>{s.preventDefault();const i=N.current.value,o=y.current.value;if(i&&o&&new Date(i)>=new Date(o))return void(await l.fire({title:"Error de ValidaciÃ³n",text:"La fecha de inicio debe ser anterior a la fecha de fin",icon:"error"}));const n=new FormData;n.append("id",t.current.value||""),n.append("name",r.current.value),n.append("description",c.current.value),n.append("background_color",f.current.value),n.append("text_color",b.current.value),n.append("tag_type","item"),N.current.value&&n.append("start_date",N.current.value),y.current.value&&n.append("end_date",y.current.value),v.current.files&&v.current.files[0]&&n.append("icon",v.current.files[0]),w.current.files&&w.current.files[0]&&n.append("image",w.current.files[0]),v.getDeleteFlag&&v.getDeleteFlag()&&n.append("icon_delete","DELETE"),w.getDeleteFlag&&w.getDeleteFlag()&&n.append("image_delete","DELETE");await j.save(n)&&(w.resetDeleteFlag&&w.resetDeleteFlag(),v.resetDeleteFlag&&v.resetDeleteFlag(),$(e.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},size:"lg",children:s.jsxs("div",{className:"row",id:"tags-container",children:[s.jsx("input",{ref:t,type:"hidden"}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-8",children:[s.jsx(d,{eRef:r,label:"Nombre del Tag",col:"col-12",required:!0,hidden:!g.has("tags","name")}),s.jsx(d,{eRef:c,label:"ToolTip",col:"col-12",hidden:!g.has("tags","description")})]}),s.jsx(n,{eRef:v,name:"icon",label:"Icono",col:"col-md-4",aspect:"6/5",hidden:!g.has("tags","icon")})]}),g.has("tags","start_date")&&g.has("tags","end_date")&&s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"alert alert-info mb-3",children:[s.jsxs("h6",{className:"alert-heading mb-2",children:[s.jsx("i",{className:"fas fa-calendar-alt me-2"}),"ConfiguraciÃ³n Promocional"]}),s.jsxs("div",{className:"row small",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx("p",{className:"mb-1",children:s.jsx("strong",{children:"ğŸ”„ Etiquetas Permanentes:"})}),s.jsx("p",{className:"mb-2",children:"Sin fechas â†’ Siempre visibles"}),s.jsx("p",{className:"mb-1",children:s.jsx("strong",{children:"ğŸ“… Etiquetas Promocionales:"})}),s.jsx("p",{className:"mb-0",children:"Con fechas â†’ Solo activas en el perÃ­odo especificado"})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx("p",{className:"mb-1",children:s.jsx("strong",{children:"Ejemplos de uso:"})}),s.jsxs("ul",{className:"mb-0 small",children:[s.jsx("li",{children:"Black Friday: 29/11/2024 - 02/12/2024"}),s.jsx("li",{children:"Cyber Monday: 02/12/2024 - 03/12/2024"}),s.jsx("li",{children:"Descuentos NavideÃ±os: 15/12/2024 - 25/12/2024"}),s.jsx("li",{children:"Ofertas de AÃ±o Nuevo: 26/12/2024 - 05/01/2025"})]})]})]})]})}),s.jsx("div",{className:"col-md-6",hidden:!g.has("tags","start_date"),children:s.jsxs("div",{className:"form-group mb-2",children:[s.jsxs("label",{className:"form-label",children:[s.jsx("i",{className:"fas fa-play-circle text-success me-1"}),"Fecha y Hora de Inicio"]}),s.jsx("input",{ref:N,type:"datetime-local",className:"form-control",placeholder:"Opcional: Fecha de inicio de la promociÃ³n"}),s.jsx("small",{className:"text-muted",children:"Opcional: Deja vacÃ­o para etiqueta permanente"})]})}),s.jsx("div",{className:"col-md-6",hidden:!g.has("tags","end_date"),children:s.jsxs("div",{className:"form-group mb-2",children:[s.jsxs("label",{className:"form-label",children:[s.jsx("i",{className:"fas fa-stop-circle text-danger me-1"}),"Fecha y Hora de Fin"]}),s.jsx("input",{ref:y,type:"datetime-local",className:"form-control",placeholder:"Opcional: Fecha de fin de la promociÃ³n"}),s.jsx("small",{className:"text-muted",children:"Opcional: Deja vacÃ­o para etiqueta permanente"})]})}),s.jsxs("div",{className:"row col-md-6",children:[s.jsx("div",{className:"col-md-6",hidden:!g.has("tags","background_color"),children:s.jsxs("div",{className:"form-group mb-2",children:[s.jsx("label",{className:"form-label",children:"Color de Fondo"}),s.jsx("input",{ref:f,type:"color",className:"form-control form-control-color",defaultValue:"#3b82f6"})]})}),s.jsx("div",{className:"col-md-6",hidden:!g.has("tags","text_color"),children:s.jsxs("div",{className:"form-group mb-2",children:[s.jsx("label",{className:"form-label",children:"Color de Texto"}),s.jsx("input",{ref:b,type:"color",className:"form-control form-control-color",defaultValue:"#ffffff"})]})})]}),s.jsx(n,{eRef:w,name:"image",label:"Imagen Principal (para otros fines)",col:"col-md-6",aspect:"16/9",hidden:!g.has("tags","image")})]})})]})};f((e,a)=>{t.createRoot(e).render(s.jsx(r,{...a,title:"Tags de Productos",children:s.jsx(b,{...a})}))});

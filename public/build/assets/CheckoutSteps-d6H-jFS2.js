import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as l}from"./index-BOnQTV8N.js";import{C as f,N as b}from"./Number2Currency-jIsa99f9.js";import{D as Re,C as ct,B as Te,a as Be,P as lt,b as dt,A as mt,O as pt,I as Ye,S as ut,c as xt}from"./StorePickupSelector-Ct-h8IWE.js";import{i as Xe}from"./tippy-react.esm-DmkRJDEW.js";import{O as Ue,p as ht,U as ft,u as bt}from"./useEcommerceTracking-DJ8tdrxn.js";import{I as be}from"./InputForm-Dmyom2PO.js";import{S as yt}from"./SelectForm-BvZde-dr.js";import"./main-B6F2O9-U.js";import{l as gt}from"./ShippingStep-C6i134TO.js";import{t as Z}from"./CardProductKatya-ncpmQ0JU.js";import{G as K}from"./Global-CazroCzF.js";import{C as xe}from"./circle-x-5vreeYph.js";import{m as ve}from"./proxy-B0QLMKEh.js";import"./ProductNavigation-5QhNPets.js";import"./ProductCard-D9l7c7at.js";/* empty css              */import"./BlogCarousel-DCQ9UYu0.js";/* empty css               */import"./BlogCarrusel-klwTVD05.js";import{R as jt}from"./PolicyModal-C80IvD61.js";import{H as vt}from"./HtmlContent-ghmllTyl.js";import{X as Nt}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./General-apRuNwp7.js";import"./createLucideIcon-DfjclApS.js";import"./sparkles-DvmvZ6mJ.js";import"./package-DBFPPBi1.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./index-ngrFHoWO.js";import"./useStateManager-7e1e8489.esm-C6DnWqDr.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./index-pSueRYGM.js";import"./index-B6ujFmsw.js";import"./floating-ui.dom-CID5cQpR.js";import"./StoresRest-Bb6TODpG.js";import"./BasicRest-BML1C-ua.js";import"./BooleanLimit-D-OsQsek.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./check-D5vaIe6v.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./ItemsRest-Dp5IKigO.js";import"./HeaderSearch-j9L8kXPt.js";import"./CartItemRow-Dd2JdCJX.js";import"./index-BZvh78jk.js";import"./eye-ScgfreHn.js";import"./index-Chjiymov.js";function wt({data:v,cart:k,setCart:ee,onContinue:te,subTotal:se,envio:C,igv:ae,fleteTotal:re,seguroImportacionTotal:g,derechoArancelarioTotal:z,totalFinal:oe,openModal:T,categorias:H,automaticDiscounts:he,setAutomaticDiscounts:a,automaticDiscountTotal:W,setAutomaticDiscountTotal:x,totalWithoutDiscounts:Q,generals:h}){var de,me,ge,$,pe,we;const[fe,q]=l.useState(he||[]),[R,_]=l.useState(W||0),[U,V]=l.useState(!1),[ye,ie]=l.useState([]),[G,B]=l.useState([]),[ne,r]=l.useState(!1),[N,F]=l.useState(null),[Y,M]=l.useState(null),E=k.length===0;l.useEffect(()=>{if(k.filter(o=>o.type==="combo"),k.length>0&&se>0)d();else{const o=[];q(o),_(0),ie([]),B([]),a&&a(o),x&&x(0)}},[k,se]);const d=async()=>{V(!0);try{const o=k.reduce((w,D)=>w+(D.quantity||0),0),n=k.filter(w=>w.type==="combo"),y=await Re.applyToCart(k,Q);if(y.success&&y.data){const w=Re.formatDiscounts(y.data.applied_discounts),D=y.data.total_discount||0,X=Re.getFreeItems(y.data.applied_discounts),J=[];y.data.applied_discounts.forEach(O=>{O.suggested_items&&Array.isArray(O.suggested_items)&&J.push(...O.suggested_items)}),q(w),_(D),ie(X),B(J),a&&a(w),x&&x(D)}else{const w=[];q(w),_(0),ie([]),B([]),a&&a(w),x&&x(0)}}catch(o){console.error("Error applying discount rules:",o);const n=[],y=0;q(n),_(y),ie([]),B([]),a&&a(n),x&&x(y)}finally{V(!1)}},L=o=>G.some(n=>n.item_id===o||n.triggering_item_id===o),ce=o=>G.find(n=>n.item_id===o||n.triggering_item_id===o),Ne=o=>{const n=ce(o.id);n&&(F(n),M(o),r(!0))},le=async o=>{try{ee(n=>{const y=n.findIndex(w=>(w.item_id||w.id)===o.item_id);if(y!==-1){const w=[...n],D=o.quantity||o.suggested_quantity||1;return w[y].quantity+=D,w}else{const w={id:o.item_id,name:o.item_name,quantity:o.quantity||o.suggested_quantity||1,price:o.value||0,final_price:o.value||0,image:o.item_image||"default.jpg",brand:{name:o.item_brand||"N/A"},sku:o.item_sku||"PROMO",stock:999};return[...n,w]}}),setTimeout(()=>{d()},100)}catch(n){console.error("Error adding promotional item:",n)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:E?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito está vacío"}),e.jsx("p",{className:"text-gray-500",children:"¡Explora nuestros productos y encuentra algo especial!"})]}):k.map((o,n)=>e.jsx(ct,{...o,setCart:ee,categorias:H,hasPromotion:L(o.id),onPromotionClick:Ne},n))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:[f(),b(se)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["IGV (",Number(((de=h==null?void 0:h.find(o=>o.correlative==="igv_checkout"))==null?void 0:de.description)||18),"%)"]}),e.jsxs("span",{className:"font-semibold",children:[f(),b(ae)]})]}),Number((me=h==null?void 0:h.find(o=>o.correlative==="importation_seguro"))==null?void 0:me.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Seguro (",Number(((ge=h==null?void 0:h.find(o=>o.correlative==="importation_seguro"))==null?void 0:ge.description)||0).toFixed(2),"%)"]}),e.jsxs("span",{className:"font-semibold",children:[f(),b(g)]})]}),Number(($=h==null?void 0:h.find(o=>o.correlative==="importation_derecho_arancelario"))==null?void 0:$.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Derecho arancelario",((pe=h==null?void 0:h.find(o=>o.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:pe.description)&&e.jsx(Xe,{content:e.jsx("p",{className:"whitespace-pre-line",children:(we=h==null?void 0:h.find(o=>o.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:we.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[f(),b(z)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:[f(),b(C)]})]}),U&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!U&&fe.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6  customtext-neutral-dark mb-2",children:"🎉 Descuentos aplicados:"}),fe.map((o,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[o.name,o.description&&e.jsx("span",{className:"text-xs font-semibold block",children:o.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-",f(),b(o.amount)]})]},n)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-",f(),b(R)]})]})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[f(),b(oe)]})]}),R>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:[f(),b(Q||oe+R)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras ",f(),b(R)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(Te,{onClick:te,disabled:E,className:`w-full ${(v==null?void 0:v.class_button)||"text-white"}`,children:E?"Carrito Vacío":"Continuar Compra"}),e.jsx(Be,{href:"/",className:"w-full",children:E?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>T(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>T(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]}),e.jsx(lt,{isOpen:ne,onClose:()=>r(!1),suggestion:N,onAddToCart:le,productName:(Y==null?void 0:Y.name)||""})]})}function Ct({data:v,cart:k,setSale:ee,setCode:te,setDelivery:se,setCart:C,onContinue:ae,noContinue:re,subTotal:g,igv:z,fleteTotal:oe,seguroImportacionTotal:T,derechoArancelarioTotal:H,totalFinal:he,user:a,setEnvio:W,envio:x,ubigeos:Q=[],openModal:h,categorias:fe,setCouponDiscount:q,setCouponCode:R,automaticDiscounts:_=[],automaticDiscountTotal:U=0,setAutomaticDiscounts:V,setAutomaticDiscountTotal:ye,totalWithoutDiscounts:ie,conversionScripts:G,setConversionScripts:B,onPurchaseComplete:ne,generals:r}){var ze,He,Qe,Ve,Ge,Ke,We;const[N,F]=l.useState(null),[Y,M]=l.useState(null);_.reduce((t,s)=>s.free_items&&Array.isArray(s.free_items)?[...t,...s.free_items]:t,[]);const E=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[d,L]=l.useState({name:(a==null?void 0:a.name)||"",lastname:(a==null?void 0:a.lastname)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",documentType:((ze=a==null?void 0:a.document_type)==null?void 0:ze.toLowerCase())||"",document:(a==null?void 0:a.document_number)||"",department:(a==null?void 0:a.department)||"",province:(a==null?void 0:a.province)||"",district:(a==null?void 0:a.district)||"",address:(a==null?void 0:a.address)||"",number:(a==null?void 0:a.number)||"",comment:"",reference:(a==null?void 0:a.reference)||"",ubigeo:(a==null?void 0:a.ubigeo)||null});l.useEffect(()=>{if(a!=null&&a.ubigeo)if(!(a!=null&&a.district)||!(a!=null&&a.province)||!(a!=null&&a.department))fetch(`/api/ubigeo/find/${a.ubigeo}`).then(t=>t.json()).then(t=>{if(t&&t.distrito){const s={value:a.ubigeo,label:`${t.distrito}, ${t.provincia}, ${t.departamento}`,data:{reniec:a.ubigeo,departamento:t.departamento,provincia:t.provincia,distrito:t.distrito}};M(s),F(s),Le(s)}else console.log("❌ ShippingStep - No se encontró ubicación para ubigeo:",a.ubigeo)}).catch(t=>{console.error("❌ ShippingStep - Error al buscar ubicación:",t)});else{const t={value:a.ubigeo,label:`${a.district}, ${a.province}, ${a.department}`,data:{reniec:a.ubigeo,departamento:a.department,provincia:a.province,distrito:a.district}};M(t),F(t),Le(t)}else console.log("❌ ShippingStep - Usuario sin ubigeo registrado")},[a]),l.useEffect(()=>{a&&L(t=>{var s;return{...t,name:a.name||t.name,lastname:a.lastname||t.lastname,email:a.email||t.email,phone:a.phone||t.phone,documentType:((s=a.document_type)==null?void 0:s.toLowerCase())||t.documentType,document:a.document_number||t.document,department:a.department||t.department,province:a.province||t.province,district:a.district||t.district,address:a.address||t.address,number:a.number||t.number,reference:a.reference||t.reference,ubigeo:a.ubigeo||t.ubigeo}})},[a]);const[ce,Ne]=l.useState(!1),[le,de]=l.useState(!1),[me,ge]=l.useState([]),[$,pe]=l.useState(null),[we,o]=l.useState(null),[n,y]=l.useState({}),[w,D]=l.useState(""),[X,J]=l.useState(!1),[O,Ce]=l.useState(""),[c,P]=l.useState(null),[ue,_e]=l.useState(0),[je,Ee]=l.useState(!1),[Fe,ke]=l.useState(""),[Pe,$e]=l.useState(null),[Je,Me]=l.useState(!1),[Ze,qe]=l.useState(!1),et=t=>{$e(t),y(s=>({...s,store:""}))},tt=t=>{var p,S,m;const s=["name","lastname","documentType","document","email","phone","ubigeo","address","shipping"];for(const i of s)if(t[i]){let u=null,I=!1;if(i==="ubigeo"?u=((S=(p=document.querySelector('[name="ubigeo"]'))==null?void 0:p.parentElement)==null?void 0:S.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):i==="shipping"?u=((m=document.querySelector('input[name="shipping"]'))==null?void 0:m.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(u=document.querySelector(`[name="${i}"]`),I=!0),u){u.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),I&&setTimeout(()=>{try{u.focus(),u.tagName==="INPUT"&&u.type==="text"&&u.select()}catch(A){console.warn("No se pudo enfocar el elemento:",A)}},600),st(u);break}}},st=t=>{if(!t)return;const s=document.createElement("div");if(s.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const S=document.createElement("style");S.id="error-highlight-styles",S.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(S)}const p=t.style.position;(!p||p==="static")&&(t.style.position="relative"),t.appendChild(s),setTimeout(()=>{s.parentNode&&(s.parentNode.removeChild(s),(!p||p==="static")&&(t.style.position=p))},1200)},Le=async t=>{var p,S;if(!t)return;y(m=>({...m,ubigeo:""}));const{data:s}=t;L(m=>({...m,department:s.departamento,province:s.provincia,district:s.distrito,ubigeo:s.reniec})),Ne(!0);try{const m=k.reduce((A,Ie)=>A+Ie.final_price*Ie.quantity,0),i=await dt.getShippingCost({ubigeo:s.reniec,cart_total:m}),u=[];let I=!1;if(i.data.is_free&&i.data.qualifies_free_shipping&&u.push({type:"free",price:0,description:i.data.standard.description,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics}),i.data.standard&&(!i.data.is_free||i.data.is_free&&!i.data.qualifies_free_shipping)){let A=i.data.standard.description;i.data.is_free||(A=A.replace(/envío gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),A||(A="Delivery a domicilio")),u.push({type:"standard",price:i.data.standard.price,description:A,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics})}i.data.express&&i.data.express.price>0&&u.push({type:"express",price:i.data.express.price,description:i.data.express.description,deliveryType:i.data.express.type,characteristics:i.data.express.characteristics}),i.data.is_agency&&i.data.agency&&u.push({type:"agency",price:i.data.agency.price||0,description:i.data.agency.description,deliveryType:i.data.agency.type,characteristics:i.data.agency.characteristics}),i.data.is_store_pickup&&(I=!0),I||i.data.is_store_pickup?(u.some(Ie=>Ie.type==="store_pickup")||(i.data.store_pickup?u.push({type:"store_pickup",price:i.data.store_pickup.price,description:i.data.store_pickup.description,deliveryType:i.data.store_pickup.type,characteristics:i.data.store_pickup.characteristics}):u.push({type:"store_pickup",price:0,description:"Retira tu pedido en una de nuestras tiendas",deliveryType:"Retiro en Tienda",characteristics:["Sin costo de envío","Horarios flexibles","Atención personalizada"]})),Me(!0)):(Me(!1),$e(null)),ge(u),pe(((p=u[0])==null?void 0:p.type)||null),W(((S=u[0])==null?void 0:S.price)||0),J(!1)}catch{Z.error("Sin cobertura",{description:"No realizamos envíos a esta ubicación.",icon:e.jsx(Ue,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),ge([]),pe(null),W(0),J(!1)}Ne(!1)},Oe=async t=>{var m,i;if(t.preventDefault(),le)return;if(!a){qe(!0);return}const s={},p=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,S=/^[0-9]{9}$/;if(d.name.trim()||(s.name="Nombre es requerido"),d.lastname.trim()||(s.lastname="Apellido es requerido"),d.documentType.trim()||(s.documentType="Tipo de documento es requerido"),d.document.trim()||(s.document="Número de documento es requerido"),d.email.trim()?p.test(d.email)||(s.email="Email inválido"):s.email="Email es requerido",d.phone.trim()?S.test(d.phone.trim())||(s.phone="Teléfono debe tener exactamente 9 dígitos"):s.phone="Teléfono es requerido",d.ubigeo||(s.ubigeo="Ubicación es requerida"),d.address||(s.address="Dirección es requerida"),$||(s.shipping="Seleccione un método de envío"),Object.keys(s).length>0){y(s);const u=Object.keys(s)[0],I={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",documentType:"Por favor seleccione el tipo de documento",document:"Por favor ingrese su número de documento",email:(m=s.email)!=null&&m.includes("inválido")?"Por favor ingrese un correo electrónico válido":"Por favor ingrese su correo electrónico",phone:(i=s.phone)!=null&&i.includes("9 dígitos")?"El teléfono debe tener exactamente 9 dígitos":"Por favor ingrese su número de teléfono",ubigeo:"Por favor seleccione su ubicación de entrega",address:"Por favor ingrese su dirección de entrega",shipping:"Por favor seleccione un método de envío"};Z.error("Complete el campo requerido",{description:I[u],icon:e.jsx(xe,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),tt(s);return}de(!0);try{if(!K.CULQI_ENABLED){Z.error("Método de pago no disponible",{description:"El procesamiento de pagos con tarjeta está temporalmente deshabilitado",icon:e.jsx(xe,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),de(!1);return}if(!K.CULQI_PUBLIC_KEY){Z.error("Error de configuración",{description:"El sistema de pagos no está configurado correctamente",icon:e.jsx(xe,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),de(!1);return}const u={user_id:a.id,...d,fullname:`${d.name} ${d.lastname}`,country:"Perú",document_type:d.documentType,amount:j(De),delivery:j(x),seguro_importacion_total:j(T||0),derecho_arancelario_total:j(H||0),flete_total:j(oe||0),delivery_type:$,store_id:$==="store_pickup"?Pe==null?void 0:Pe.id:null,cart:k,coupon_id:(c==null?void 0:c.id)||null,coupon_code:(c==null?void 0:c.code)||null,coupon_discount:j(ue||0),applied_promotions:_||[],promotion_discount:j(U||0)},I=await ht(u);if(I.status){if(ee(I.sale),se(I.delivery),te(I.code),I.conversion_scripts&&(B(I.conversion_scripts),ne))try{await ne(I.sale_id,I.conversion_scripts)}catch(A){console.error("❌ Error en callback onPurchaseComplete:",A)}C([]),ae()}else Z.error("Error en el pago",{description:I.message||"Pago rechazado",icon:e.jsx(Ue,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(u){console.error("💥 Error completo en handlePayment:",u),console.error("💥 Stack trace:",u.stack),console.error("💥 Error name:",u.name),console.error("💥 Error message:",u.message),Z.error("Lo sentimos, no puede continuar con la compra",{description:`Ocurrió un error al procesar el pedido: ${u.message}`,icon:e.jsx(Ue,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{de(!1)}},at=l.useCallback(gt.debounce((t,s)=>{if(t.length<3){s([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(t)}`).then(p=>{if(!p.ok)throw new Error("Error en la respuesta");return p.json()}).then(p=>{const S=p.map(m=>({value:m.reniec,label:`${m.distrito}, ${m.provincia}, ${m.departamento}`,data:{inei:m.inei,reniec:m.reniec,departamento:m.departamento,provincia:m.provincia,distrito:m.distrito}}));s(S)}).catch(p=>{s([])})},300),[]);l.useEffect(()=>{y(t=>{const s={...t};return d.name.trim()&&delete s.name,d.lastname.trim()&&delete s.lastname,d.documentType.trim()&&delete s.documentType,d.document.trim()&&delete s.document,d.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)&&delete s.email,d.phone.trim()&&/^[0-9]{9}$/.test(d.phone.trim())&&delete s.phone,d.address.trim()&&delete s.address,d.ubigeo&&delete s.ubigeo,$&&delete s.shipping,s})},[d,$]);const rt=t=>({control:s=>({...s,border:`1px solid ${t?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:t?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:s=>({...s,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:s=>({...s,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),ot=async()=>{var t;if(!O.trim()){ke("Ingrese un código de cupón");return}Ee(!0),ke("");try{const s=[...new Set(k.map(i=>i.category_id).filter(Boolean))],p=k.map(i=>i.id),S=await xt.validateCoupon({code:O.trim(),cart_total:g,category_ids:s,product_ids:p}),m=S.data||S;if(m&&m.valid){P(m.coupon);const i=Math.round(m.discount*100)/100;_e(i),q&&q(i),R&&R(((t=m.coupon)==null?void 0:t.code)||O.trim()),Z.success("Cupón aplicado",{description:m.message||"Cupón aplicado correctamente",duration:3e3,position:"top-center"})}else{const i=(m==null?void 0:m.message)||"Cupón no válido";ke(i),Z.error("Cupón no válido",{description:i,icon:e.jsx(xe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(s){console.error("Error al validar cupón:",s),ke("Error al validar el cupón"),Z.error("Error",{description:s.message||"No se pudo validar el cupón. Intente nuevamente.",icon:e.jsx(xe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{Ee(!1)}},it=()=>{P(null),_e(0),Ce(""),ke(""),q&&q(0),R&&R(""),Z.success("Cupón removido",{description:"El cupón ha sido removido de su pedido",duration:2e3,position:"top-center"})},j=t=>{const s=typeof t=="string"?parseFloat(t):t;return parseFloat(s.toFixed(2))},Ae=j(g)+j(z)+j(x)+j(T)+j(H)-j(U);let Se=0;c&&(c.type==="percentage"||c.type==="percent"?Se=Ae*Number(c.value)/100:c.type==="fixed"&&(Se=Number(c.value))),l.useEffect(()=>{_e(j(Se)),q&&q(j(Se))},[c,g,z,x,U]);const De=Math.max(0,j(Ae-Se)),nt=()=>{if(!Ze)return null;const t=s=>{s.target===s.currentTarget&&qe(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-2xl transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4",children:e.jsx(ft,{className:"h-8 w-8 customtext-primary"})}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-3",children:"Acceso requerido"}),e.jsx("p",{className:"customtext-neutral-light text-sm leading-relaxed",children:"Para continuar con su compra necesita iniciar sesión o crear una cuenta nueva."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{window.location.href="/iniciar-sesion"},className:"w-full py-3 px-6 bg-primary text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Iniciar sesión"}),e.jsx("button",{onClick:()=>{window.location.href="/crear-cuenta"},className:"w-full py-3 px-6 bg-accent text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Crear cuenta nueva"}),e.jsx("button",{onClick:()=>qe(!1),className:"w-full py-3 px-6 customtext-neutral-light hover:customtext-neutral-dark border border-secondary rounded-lg hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200",children:"Cancelar"})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:Oe,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(be,{name:"name",label:"Nombres",value:d.name,error:n.name,onChange:t=>{L(s=>({...s,name:t.target.value})),t.target.value.trim()&&n.name&&y(s=>({...s,name:""}))},required:!0,className:`border-gray-200 ${n.name?"border-red-500 bg-red-50":""}`}),e.jsx(be,{name:"lastname",label:"Apellidos",value:d.lastname,error:n.lastname,onChange:t=>{L(s=>({...s,lastname:t.target.value})),t.target.value.trim()&&n.lastname&&y(s=>({...s,lastname:""}))},required:!0,className:`border-gray-200 ${n.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(yt,{label:"Tipo de documento",options:E,placeholder:"Selecciona tu documento",labelClass:"block text-sm 2xl:!text-base mb-1 customtext-neutral-dark",value:d.documentType,error:n.documentType,onChange:t=>{L(s=>({...s,documentType:t})),t&&n.documentType&&y(s=>({...s,documentType:""}))},required:!0})}),e.jsx(be,{name:"document",label:"Número de documento",value:d.document,error:n.document,onChange:t=>{L(s=>({...s,document:t.target.value})),t.target.value.trim()&&n.document&&y(s=>({...s,document:""}))},placeholder:"Ej: 12345678",required:!0,className:`border-gray-200 ${n.document?"border-red-500 bg-red-50":""}`})]}),e.jsx(be,{name:"email",label:"Correo electrónico",type:"email",value:d.email,error:n.email,onChange:t=>{L(s=>({...s,email:t.target.value})),t.target.value.trim()&&n.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.target.value)&&y(p=>({...p,email:""}))},required:!0,className:`border-gray-200 ${n.email?"border-red-500 bg-red-50":""}`}),e.jsx(be,{name:"phone",label:"Teléfono",type:"tel",value:d.phone,error:n.phone,onChange:t=>{const s=t.target.value.replace(/\D/g,"");L(p=>({...p,phone:s})),s.length===9&&n.phone&&y(p=>({...p,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${n.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (Ubicación de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(mt,{name:"ubigeo",cacheOptions:!0,value:N,loadOptions:at,onChange:t=>{F(t),Le(t),D("")},inputValue:w,onInputChange:(t,{action:s})=>{s==="input-change"&&D(t)},onFocus:()=>{F(null),D("")},onMenuOpen:()=>{N&&(F(null),D(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:t})=>t.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:ce,styles:rt(!!n.ubigeo),formatOptionLabel:({data:t})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:t.distrito}),e.jsxs("div",{className:"text-gray-500",children:[t.provincia,", ",t.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),n.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:n.ubigeo})]}),e.jsx(be,{name:"address",label:"Dirección ",value:d.address,error:n.address,onChange:t=>{L(s=>({...s,address:t.target.value})),t.target.value.trim()&&n.address&&y(s=>({...s,address:""}))},required:!0,className:`border-gray-200 ${n.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(be,{label:"Número",value:d.number,onChange:t=>L(s=>({...s,number:t.target.value})),className:"border-gray-200"}),e.jsx(be,{label:"Referencia",value:d.reference,onChange:t=>L(s=>({...s,reference:t.target.value})),className:"border-gray-200"})]}),me.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Método de envío"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:me.map(t=>e.jsx(pt,{title:t.deliveryType,price:t.price,description:t.description,selected:$===t.type,onSelect:()=>{pe(t.type),W(t.price),y(s=>({...s,shipping:"",store:""})),J(!1),t.type!=="store_pickup"&&$e(null)}},t.type))}),$&&me.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(()=>{var S;const t=((S=me.find(m=>m.type===$))==null?void 0:S.characteristics)||[],s=t.length>1,p=s&&!X?t.slice(0,1):t;return e.jsxs(e.Fragment,{children:[p.map((m,i)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(Ye,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:m})})]},`char-${i}`)),s&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{type:"button",onClick:()=>J(!X),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium customtext-primary hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:X?"Ver menos información":`Ver más información (${t.length-1} más)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${X?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})})()})]}),$==="store_pickup"&&Je&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(ut,{ubigeoCode:d.ubigeo,onStoreSelect:et,selectedStore:Pe,className:"border border-gray-200 rounded-xl p-4"}),n.store&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),n.store]})]}),!re&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(Be,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(Te,{type:"submit",loading:ce,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:k.map(t=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t.type==="combo"?`/storage/images/combo/${t.image}`:`/storage/images/item/${t.image}`,alt:t.name,className:"w-16 h-16 object-cover rounded-lg",onError:s=>s.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",t.quantity]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:[f(),b(t.final_price)]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[f(),b(j(g))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["IGV (",Number(((He=r==null?void 0:r.find(t=>t.correlative==="igv_checkout"))==null?void 0:He.description)||18),"%):"]}),e.jsxs("span",{children:[f(),b(j(z))]})]}),Number((Qe=r==null?void 0:r.find(t=>t.correlative==="importation_seguro"))==null?void 0:Qe.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Seguro (",Number(((Ve=r==null?void 0:r.find(t=>t.correlative==="importation_seguro"))==null?void 0:Ve.description)||0).toFixed(2),"%):"]}),e.jsxs("span",{children:[f(),b(j(T))]})]}),Number((Ge=r==null?void 0:r.find(t=>t.correlative==="importation_derecho_arancelario"))==null?void 0:Ge.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Derecho arancelario",((Ke=r==null?void 0:r.find(t=>t.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:Ke.description)&&e.jsx(Xe,{content:e.jsx("p",{className:"whitespace-pre-line",children:(We=r==null?void 0:r.find(t=>t.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:We.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[f(),b(j(H))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Envío:"}),e.jsx("span",{className:"font-semibold",children:$==="free"||$==="store_pickup"||x===0?e.jsx("span",{className:"customtext-neutral-dark",children:"Gratis"}):`${f()} ${b(x)}`})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"¿Tienes un cupón de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu código de cupón",value:O,onChange:t=>Ce(t.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${Fe?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":c?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!c||je}),je&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),c?e.jsx("button",{type:"button",onClick:it,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cupón",children:e.jsx(xe,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:ot,disabled:je||!O.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:je?"Validando...":"Aplicar"})]}),Fe&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(xe,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:Fe})]}),c&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",c.type==="percentage"?`${c.value}%`:`${f()}${b(c.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:c.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-",f(),b(j(ue))]})})]})})]})}),_&&_.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"🎉 Descuentos automáticos aplicados:"}),_.map((t,s)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:t.name}),t.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:t.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-",f(),b(t.amount)]})})]})},s)),U>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos automáticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-",f(),b(U)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[f(),b(j(De))]})]})}),!K.CULQI_ENABLED&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ye,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"El procesamiento de pagos con tarjeta está temporalmente deshabilitado"})]})}),K.CULQI_ENABLED&&!K.CULQI_PUBLIC_KEY&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:"Error de configuración: Sistema de pagos no configurado"})]})}),e.jsx(Te,{onClick:Oe,disabled:le||!K.CULQI_ENABLED||!K.CULQI_PUBLIC_KEY,loading:le,className:`w-full mt-6 ${(v==null?void 0:v.class_button)||"text-white"} ${!K.CULQI_ENABLED||!K.CULQI_PUBLIC_KEY?"opacity-50 cursor-not-allowed":""}`,children:le?"Procesando...":K.CULQI_ENABLED?K.CULQI_PUBLIC_KEY?`Pagar ${f()}${b(j(De))}`:"Configuración pendiente":"Pago no disponible"}),e.jsx(Be,{onClick:re,className:"w-full mt-3",disabled:le,children:"Regresar al carrito"}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>h(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>h(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})]})]})]})]})}function _t({cart:v,code:k,delivery:ee,subTotal:te,igv:se,fleteTotal:C=0,seguroImportacionTotal:ae=0,derechoArancelarioTotal:re=0,totalFinal:g,couponDiscount:z=0,couponCode:oe=null,conversionScripts:T=null,automaticDiscounts:H=[],automaticDiscountTotal:he=0,generals:a}){var G,B,ne;const W=v.reduce((r,N)=>r+(N.type==="combo"?N.final_price||N.price:N.final_price)*N.quantity,0),x=te>0?te:parseFloat((W/1.18).toFixed(2)),Q=te>0?se:parseFloat((W-x).toFixed(2)),h=v.reduce((r,N)=>{const F=parseFloat(N.weight)||0;return r+F*N.quantity},0),fe=Number((G=a==null?void 0:a.find(r=>r.correlative==="importation_flete"))==null?void 0:G.description)||0,q=C>0?C:fe>0?h*fe:0,R=(Number((B=a==null?void 0:a.find(r=>r.correlative==="importation_seguro"))==null?void 0:B.description)||0)/100,_=ae>0?ae:x*R,U=parseFloat(x)+parseFloat(q)+parseFloat(_),V=(Number((ne=a==null?void 0:a.find(r=>r.correlative==="importation_derecho_arancelario"))==null?void 0:ne.description)||0)/100,ye=re>0?re:U*V,ie=x+Q+(ee||0)+_+ye-(z||0)-(he||0);return l.useEffect(()=>{if(T)try{if(T.head){const r=document.createElement("script");r.innerHTML=T.head,document.head.appendChild(r)}if(T.body){const r=document.createElement("script");r.innerHTML=T.body,document.body.appendChild(r)}}catch(r){console.error("Error executing conversion scripts:",r)}},[T]),e.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(ve.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(ve.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"✓"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"¡Gracias por tu compra! 🎉"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(ve.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"Código de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${k}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:v.map((r,N)=>{var Y,M;const F=()=>r.type==="combo"?r.final_price||r.price:r.final_price;return e.jsx(ve.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:N*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:(r==null?void 0:r.type)==="combo"?`/storage/images/combo/${r==null?void 0:r.image}`:`/storage/images/item/${r==null?void 0:r.image}`,alt:r==null?void 0:r.name,className:"w-24 h-24 object-cover rounded-lg",onError:E=>E.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsxs("div",{className:"lg:w-8/12",children:[e.jsx("h3",{className:"font-semibold text-xl line-clamp-3 mb-2",children:r==null?void 0:r.name}),r.type==="combo"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full",children:"COMBO"})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contiene:"}),e.jsx("div",{className:"mt-1",children:r.combo_items&&r.combo_items.length>0?r.combo_items.map((E,d)=>e.jsxs("div",{className:"text-xs text-gray-500",children:["• ",E.quantity||1,"x ",E.name]},d)):r.items&&r.items.length>0?r.items.map((E,d)=>e.jsxs("div",{className:"text-xs text-gray-500",children:["• ",E.quantity||1,"x ",E.name]},d)):e.jsx("span",{className:"text-xs text-gray-400",children:"Información de combo no disponible"})})]})]})]}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:[f(),b(F()*(r==null?void 0:r.quantity))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[((Y=r==null?void 0:r.brand)==null?void 0:Y.name)&&e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:((M=r==null?void 0:r.brand)==null?void 0:M.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:r==null?void 0:r.quantity})]}),(r==null?void 0:r.sku)&&e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:(r==null?void 0:r.sku)||"N/A"})]})]})]})]})},N)})}),e.jsxs(ve.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[[{label:"Subtotal",value:x},{label:"IGV",value:Q},..._>0?[{label:"Seguro de Importación",value:_}]:[],...ye>0?[{label:"Derecho Arancelario",value:ye}]:[],{label:"Envío",value:ee}].map((r,N)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:r.label}),e.jsxs("span",{className:"font-semibold",children:[f(),b(r.value)]})]},N)),z>0&&oe&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark text-start",children:["Cupón: ",e.jsx("br",{className:"lg:hidden"}),e.jsxs("span",{className:"font-semibold text-xs lg:text-base",children:["(",oe,")"]})]}),e.jsxs("span",{className:"font-semibold",children:["-",f(),b(z)]})]}),he>0&&H.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 customtext-neutral-dark mb-2",children:"🎉 Descuentos aplicados:"}),H.map((r,N)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[r.name,r.description&&e.jsx("span",{className:"text-xs font-semibold block",children:r.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-",f(),b(r.amount)]})]},N)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-",f(),b(he)]})]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[f(),b(ie)]})]})})]}),e.jsx(ve.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(Te,{href:"/catalogo",className:"w-full mx-auto md:w-auto text-white",children:"Seguir Comprando"})})]})]})})})}function ws({cart:v,setCart:k,user:ee,ubigeos:te=[],items:se,generals:C,data:ae,categorias:re}){var J,O,Ce;const[g,z]=l.useState(1);l.useEffect(()=>{v.filter(P=>P.type==="combo").length===0&&v.length===0&&console.warn("🚨 ALERT: Cart is empty - this might indicate combos were removed")},[v,g]);const oe=c=>c.type==="combo"?c.final_price||c.price:c.final_price,T=v.reduce((c,P)=>{const ue=oe(P);return c+ue*P.quantity},0),{trackCheckoutPageView:H,trackInitiateCheckout:he,trackPurchase:a,resetTracking:W}=bt(),x=parseFloat((T/1.18).toFixed(2)),Q=parseFloat((T-x).toFixed(2)),[h,fe]=l.useState(0),q=v.reduce((c,P)=>{const ue=Number(P.weight)||0;return c+ue*P.quantity},0),R=Number((J=C==null?void 0:C.find(c=>c.correlative==="importation_flete"))==null?void 0:J.description)||0,_=R>0?q*R:0,U=(Number((O=C==null?void 0:C.find(c=>c.correlative==="importation_seguro"))==null?void 0:O.description)||0)/100,V=x*U,ye=parseFloat(x)+parseFloat(_)+parseFloat(V),ie=(Number((Ce=C==null?void 0:C.find(c=>c.correlative==="importation_derecho_arancelario"))==null?void 0:Ce.description)||0)/100,G=ye*ie,[B,ne]=l.useState(0),[r,N]=l.useState(null),[F,Y]=l.useState([]),[M,E]=l.useState(0),d=x+Q+parseFloat(h)+parseFloat(V)+parseFloat(G),L=B+M,ce=Math.max(0,d-L),[Ne,le]=l.useState([]),[de,me]=l.useState([]),[ge,$]=l.useState([]),[pe,we]=l.useState(null);l.useEffect(()=>(H(g,v),()=>W()),[]),l.useEffect(()=>{H(g,v),g===2&&he(v,ce)},[g]);const o=c=>{z(c),window.scrollTo({top:0,behavior:"smooth"})},n={privacy_policy:"Políticas de privacidad",terms_conditions:"Términos y condiciones",saleback_policy:"Políticas de devolucion y cambio"},[y,w]=l.useState(null),D=c=>w(c),X=()=>w(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${g===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:g>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${g>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${g>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Envío"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:g>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${g===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${g===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmación"})]})]})}),g===1&&e.jsx(wt,{data:ae,cart:v,setCart:k,onContinue:()=>o(2),subTotal:x,envio:h,igv:Q,fleteTotal:_,seguroImportacionTotal:V,derechoArancelarioTotal:G,totalFinal:ce,openModal:D,categorias:re,automaticDiscounts:F,setAutomaticDiscounts:Y,automaticDiscountTotal:M,setAutomaticDiscountTotal:E,totalWithoutDiscounts:d,generals:C}),g===2&&e.jsx(Ct,{data:ae,items:se,setCode:me,setDelivery:$,cart:v,setSale:le,setCart:k,onContinue:()=>o(3),noContinue:()=>o(1),subTotal:x,envio:h,setEnvio:fe,igv:Q,fleteTotal:_,seguroImportacionTotal:V,derechoArancelarioTotal:G,totalFinal:ce,user:ee,ubigeos:te,categorias:re,openModal:D,setCouponDiscount:ne,setCouponCode:N,automaticDiscounts:F,setAutomaticDiscounts:Y,automaticDiscountTotal:M,setAutomaticDiscountTotal:E,totalWithoutDiscounts:d,conversionScripts:pe,setConversionScripts:we,onPurchaseComplete:(c,P)=>{a(c,P)},generals:C}),g===3&&e.jsx(_t,{code:de,delivery:ge,cart:Ne,subTotal:x,envio:h,igv:Q,fleteTotal:_,seguroImportacionTotal:V,derechoArancelarioTotal:G,totalFinal:ce,couponDiscount:B,couponCode:r,automaticDiscounts:F,automaticDiscountTotal:M,totalWithoutDiscounts:d,conversionScripts:pe,setConversionScripts:we,onPurchaseComplete:(c,P)=>{a(c,P)},generals:C})]}),Object.keys(n).map((c,P)=>{var je;const ue=n[c],_e=((je=C.find(Ee=>Ee.correlative==c))==null?void 0:je.description)??"";return e.jsx(jt,{isOpen:y===P,onRequestClose:X,contentLabel:ue,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:ue}),e.jsx("button",{onClick:X,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(Nt,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(vt,{html:_e})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:X,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},P)})]})}export{ws as default};

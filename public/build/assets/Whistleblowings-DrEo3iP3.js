var w=Object.defineProperty;var y=(t,r,s)=>r in t?w(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var x=(t,r,s)=>y(t,typeof r!="symbol"?r+"":r,s);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BOnQTV8N.js";import{c as D}from"./ReactAppend-QR5TrZfj.js";import{B as C}from"./Base-BTD9kfbn.js";import{C as R}from"./CreateReactScript-B14pMYdF.js";import{T as E}from"./Table-CvxUJB3V.js";import{D as u}from"./DxButton-DV0H-ZcL.js";import{R as j}from"./ReactAppend-Vm5G2nof.js";import{B as F}from"./BasicRest-BML1C-ua.js";import{M as _}from"./Modal-xDw9ufjg.js";import{S as o}from"./ProductCard-D9l7c7at.js";import"./server.browser-Bf4gQIc7.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./Global-CazroCzF.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-BkcJL55s.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";import"./BooleanLimit-D-OsQsek.js";import"./CardProductKatya-ncpmQ0JU.js";class S extends F{constructor(){super(...arguments);x(this,"path","admin/whistleblowings")}}const a=new S,T=()=>{const t=c.useRef(),r=c.useRef(),[s,b]=c.useState(null),[m,d]=c.useState(""),g=async i=>{const{isConfirmed:n}=await o.fire({title:"Eliminar denuncia",text:"¿Estas seguro de eliminar esta denuncia?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!n||!await a.delete(i)||$(t.current).dxDataGrid("instance").refresh()},p=i=>{b(i),d(i.notas_admin||""),$(r.current).modal("show")},N=async(i,n)=>{await a.save({id:i,estado:n})&&($(t.current).dxDataGrid("instance").refresh(),o.fire("Estado actualizado","","success"))},f=async()=>{await a.save({id:s.id,notas_admin:m})&&(o.fire("Notas guardadas","","success"),$(r.current).modal("hide"),$(t.current).dxDataGrid("instance").refresh())};return e.jsxs(e.Fragment,{children:[e.jsx(E,{gridRef:t,title:"Denuncias",rest:a,toolBar:i=>{i.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",width:70},{dataField:"nombre",caption:"Nombre",cellTemplate:(i,{data:n})=>{j(i,e.jsx("span",{style:{cursor:"pointer",color:"#007bff",textDecoration:"underline"},onClick:()=>p(n),children:n.nombre}))}},{dataField:"email",caption:"Email"},{dataField:"ambito",caption:"Ámbito",cellTemplate:(i,{data:n})=>{const h={Laboral:"primary",Ético:"warning","Técnico u operativo":"info","Comercial o ventas":"success",Seguridad:"danger","Discriminación o acoso":"dark",Otro:"secondary"}[n.ambito]||"secondary";j(i,e.jsx("span",{className:`badge bg-${h} rounded-pill`,children:n.ambito}))}},{dataField:"relacion_compania",caption:"Relación",width:120},{dataField:"departamento",caption:"Departamento",width:120},{dataField:"estado",caption:"Estado",cellTemplate:(i,{data:n})=>{const v=`
                            <select class="form-select form-select-sm bg-${{Pendiente:"warning","En revisión":"info",Resuelta:"success",Archivada:"secondary"}[n.estado]||"secondary"} text-white border-0" 
                                    onchange="window.handleStatusChange(${n.id}, this.value)"
                                    style="cursor: pointer; font-weight: 500;">
                                <option value="Pendiente" ${n.estado==="Pendiente"?"selected":""}>Pendiente</option>
                                <option value="En revisión" ${n.estado==="En revisión"?"selected":""}>En revisión</option>
                                <option value="Resuelta" ${n.estado==="Resuelta"?"selected":""}>Resuelta</option>
                                <option value="Archivada" ${n.estado==="Archivada"?"selected":""}>Archivada</option>
                            </select>
                        `;i.html(v),window.handleStatusChange=N}},{dataField:"created_at",caption:"Fecha",dataType:"datetime",format:"yyyy-MM-dd HH:mm",sortOrder:"desc",width:150},{caption:"Acciones",width:120,cellTemplate:(i,{data:n})=>{i.append(u({className:"btn btn-xs btn-soft-primary",title:"Ver denuncia",icon:"fa fa-eye",onClick:()=>p(n)})),i.append(u({className:"btn btn-xs btn-soft-danger ms-1",title:"Eliminar",icon:"fa fa-trash",onClick:()=>g(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsxs(_,{modalRef:r,title:"Detalle de la Denuncia",size:"xl",hideFooter:!0,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"mb-3 text-primary",children:[e.jsx("i",{className:"mdi mdi-map-marker me-2"}),"Ubicación del Incidente"]}),e.jsxs("div",{className:"bg-light p-3 rounded mb-3",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Departamento:"})," ",s==null?void 0:s.departamento]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Ciudad:"})," ",s==null?void 0:s.ciudad]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Dirección:"})," ",s==null?void 0:s.direccion_exacta]})]}),e.jsxs("h6",{className:"mb-3 text-primary mt-4",children:[e.jsx("i",{className:"mdi mdi-account me-2"}),"Información de Contacto"]}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Nombre:"})," ",s==null?void 0:s.nombre]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",s==null?void 0:s.email]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Teléfono:"})," ",(s==null?void 0:s.telefono)||e.jsx("i",{className:"text-muted",children:"No proporcionado"})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"mb-3 text-primary",children:[e.jsx("i",{className:"mdi mdi-alert-circle me-2"}),"Detalles del Incidente"]}),e.jsxs("div",{className:"bg-light p-3 rounded mb-3",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Ámbito:"}),e.jsx("span",{className:"badge bg-primary ms-2",children:s==null?void 0:s.ambito})]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Relación:"})," ",s==null?void 0:s.relacion_compania]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Empresa:"})," ",(s==null?void 0:s.empresa)||e.jsx("i",{className:"text-muted",children:"No especificada"})]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Fecha del incidente:"})," ",s==null?void 0:s.cuando_ocurrio]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Estado:"}),e.jsx("span",{className:`badge bg-${(s==null?void 0:s.estado)==="Pendiente"?"warning":(s==null?void 0:s.estado)==="En revisión"?"info":(s==null?void 0:s.estado)==="Resuelta"?"success":"secondary"} ms-2`,children:s==null?void 0:s.estado})]})]}),e.jsxs("h6",{className:"mb-3 text-primary mt-4",children:[e.jsx("i",{className:"mdi mdi-information me-2"}),"Metadata"]}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"IP:"})," ",e.jsx("code",{children:s==null?void 0:s.ip_address})]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Fecha de registro:"})," ",new Date(s==null?void 0:s.created_at).toLocaleString("es-PE")]})]})]})]}),e.jsx("div",{className:"row mt-4",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("h6",{className:"mb-3 text-primary",children:[e.jsx("i",{className:"mdi mdi-file-document me-2"}),"¿Qué ha sucedido?"]}),e.jsx("div",{className:"border rounded p-3 bg-light",children:s==null?void 0:s.que_sucedio})]})}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"mb-3 text-primary",children:[e.jsx("i",{className:"mdi mdi-account-multiple me-2"}),"¿Quién está implicado?"]}),e.jsx("div",{className:"border rounded p-3 bg-light",children:s==null?void 0:s.quien_implicado})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"mb-3 text-primary",children:[e.jsx("i",{className:"mdi mdi-message-text me-2"}),"Diálogo con superior"]}),e.jsx("div",{className:"border rounded p-3 bg-light",children:(s==null?void 0:s.dialogo_superior)||e.jsx("i",{className:"text-muted",children:"No especificado"})})]})]}),e.jsx("div",{className:"row mt-4",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("h6",{className:"mb-3 text-danger",children:[e.jsx("i",{className:"mdi mdi-shield-lock me-2"}),"Notas Internas (Confidencial)"]}),e.jsx("textarea",{className:"form-control",rows:"4",value:m,onChange:i=>d(i.target.value),placeholder:"Agregar notas internas sobre el seguimiento de esta denuncia..."}),e.jsxs("button",{className:"btn btn-primary mt-2",onClick:f,children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),"Guardar Notas"]})]})})]})]})};R((t,r)=>{D.createRoot(t).render(e.jsx(C,{...r,title:"Denuncias",children:e.jsx(T,{...r})}))});

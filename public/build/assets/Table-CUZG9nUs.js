var e=Object.defineProperty,a=(a,t,l)=>((a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l)(a,"symbol"!=typeof t?t+"":t,l);import{m as t,r as l,j as o}from"./vendor-react-DD0uBW7s.js";import{F as s,h as r}from"./CreateReactScript-C92mMLGn.js";import{M as i}from"./Modal-CfnJHMl_.js";import{t as n,T as c}from"./GoogleSignInButton-BciphYP2.js";import{B as d}from"./BooleanLimit-q2Ad9fGY.js";const m=new class{constructor(){a(this,"save",async(e,a)=>{try{const{status:l,result:o}=await t.Fetch(`/api/admin/fillable/${e}`,{method:"POST",body:JSON.stringify(a)});if(!l)throw new Error(o?.message??"Ocurrió un error inesperado");return o.data??!0}catch(l){return n.error("¡Error!",{description:l.message,duration:3e3,position:"bottom-center",richColors:!0}),null}})}},u=new class{constructor(){a(this,"save",async(e=[])=>{try{const{status:a,result:l}=await t.Fetch("/api/admin/boolean-limits",{method:"POST",body:JSON.stringify({limits:e})});if(!a)throw new Error(l?.message??"Ocurrió un error inesperado");return n.success("¡Excelente!",{description:l?.message??"Límites actualizados correctamente",duration:3e3,position:"bottom-center",richColors:!0}),l?.data??!0}catch(a){return n.error("¡Error!",{description:a.message,duration:3e3,position:"bottom-center",richColors:!0}),!1}})}},p=({gridRef:e,pageSize:a=10,rest:t,columns:n,toolBar:p,masterDetail:g,filterValue:h,exportable:f,exportableName:x,customizeCell:b=()=>{},onRefresh:v=()=>{},rowDragging:y,sorting:w,withRelations:j})=>{const k=l.useRef(),C=l.useRef(),[N,R]=l.useState(!1),[S,z]=l.useState(s.models[0]??null),[E,B]=l.useState(!1),[D,O]=l.useState([]),P=()=>{if(!S)return;const e=d.list(S);e.length&&(O(e.map(e=>({field:e.field,label:e.label??e.field,max:"number"==typeof e.max?e.max:"",message:e.message??"",general_key:e.general_key,model:S}))),$(C.current).modal("show"))},F=(e,a)=>{O(t=>t.map((t,l)=>l===e?{...t,...a}:t))};return l.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(e.current).dxDataGrid({language:"es",dataSource:{load:async e=>{const a=await t.paginate({...e,requireTotalCount:!0,...j&&{with:j}});return v(a),a}},onToolbarPreparing:e=>{const{items:a}=e.toolbarOptions;r("Root")&&d.list(S).length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-shield-account",hint:"Configurar límites",text:"Límites",onClick:P}}),r("Root")&&s.models.length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-cog",hint:"Configurar campos",text:"Configurar",onClick:()=>$(k.current).modal("show")}}),p(a)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:h,export:{enabled:f},onExporting:function(e){var a=new ExcelJS.Workbook,t=a.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:t,component:e.component,customizeCell:function(e){b(e),e.excelCell.alignment={horizontal:"left",vertical:"top",...e.excelCell.alignment}},includeHiddenColumns:!0}).then(function(){a.xlsx.writeBuffer().then(function(e){saveAs(new Blob([e],{type:"application/octet-stream"}),`${x}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:a},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:n,masterDetail:g,rowDragging:y,sorting:w,onContentReady:(...e)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[]),o.jsxs(o.Fragment,{children:[o.jsx(c,{}),o.jsx("div",{ref:e}),o.jsxs(i,{modalRef:k,title:"Configurar campos visibles",onSubmit:async e=>{e.preventDefault();const a=document.querySelectorAll(`input[type="checkbox"][id^="fillable-ck-${S}"]`),t=Array.from(a).reduce((e,a)=>(e[a.value]=a.checked,e),{});R(!0);const l=await m.save(S,t);R(!1),l&&s.set(S,l)},onClose:()=>{s.models.forEach(e=>{Object.keys(s.values[e]).forEach(a=>{const t=document.getElementById(`fillable-ck-${e}-${a}`);t&&(t.checked=s.values[e][a])})})},loading:N,children:[o.jsx("ul",{class:"nav nav-tabs nav-bordered",children:s.models.map((e,a)=>o.jsx("li",{class:"nav-item",children:o.jsx("button",{href:`#fillable-${e}`,"data-bs-toggle":"tab","aria-expanded":"false",class:`nav-link ${S==e&&"active"}`,onClick:()=>z(e),disabled:N,type:"button",children:e})},a))}),o.jsx("div",{class:"tab-content",style:{minHeight:"240px"},children:s.models.map((e,a)=>o.jsx("div",{class:`tab-pane ${S==e&&"active"}`,id:`fillable-${e}`,children:o.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:Object.keys(s.values[e]).map((a,t)=>o.jsxs("label",{class:"form-check form-check-success border cursor-pointer",htmlFor:`fillable-ck-${e}-${a}`,style:{padding:"2px 10px 2px 30px",borderRadius:"8px",userSelect:"none"},children:[o.jsx("input",{class:"form-check-input cursor-pointer",type:"checkbox",value:a,id:`fillable-ck-${e}-${a}`,defaultChecked:s.values[e][a]}),o.jsx("span",{class:"form-check-label",children:a})]},t))})},a))})]}),o.jsxs(i,{modalRef:C,title:"Configurar límites",onSubmit:async e=>{if(e.preventDefault(),!D.length)return void $(C.current).modal("hide");const a=D.filter(e=>e.general_key).map(e=>({model:e.model??S,field:e.field,general_key:e.general_key,max:Number(""===e.max?0:e.max),message:e.message?.trim()??null,label:e.label}));B(!0);const t=await u.save(a);B(!1),t&&(t?.limits?.length&&(d.bulkUpdate(S,t.limits),O(t.limits.map(({field:e,limit:t})=>({field:e,label:t.label??e,max:"number"==typeof t.max?t.max:"",message:t.message??"",general_key:t.general_key??a.find(a=>a.field===e)?.general_key,model:S})))),$(C.current).modal("hide"))},loading:E,onClose:()=>O([]),children:[!D.length&&o.jsx("p",{className:"text-muted mb-0",children:"No hay límites configurados para este módulo."}),D.map((e,a)=>o.jsxs("div",{className:"row g-2 align-items-center mb-3",children:[o.jsx("div",{className:"col-md-12",children:o.jsx("label",{className:"form-label mb-0",children:e.label})}),o.jsx("div",{className:"col-md-3",children:o.jsx("input",{type:"number",min:"0",className:"form-control",value:""===e.max?"":e.max,onChange:e=>{const t=e.target.value;F(a,{max:""===t?"":Number(t)})}})}),o.jsx("div",{className:"col-md-9",children:o.jsx("input",{type:"text",className:"form-control",value:e.message??"",onChange:e=>F(a,{message:e.target.value}),placeholder:"Mensaje personalizado (opcional)"})})]},e.field))]})]})},g=({title:e,gridRef:a,pageSize:t,rest:l,columns:s,toolBar:r,masterDetail:i,filterValue:n=[],onRefresh:c,exportable:d,exportableName:m,customizeCell:u=()=>{},rowDragging:g,sorting:h,withRelations:f})=>o.jsx("div",{className:"row",children:o.jsx("div",{className:"col-12",children:o.jsxs("div",{className:"card",children:["object"==typeof e?o.jsx("div",{className:"card-header",children:e}):"",o.jsxs("div",{className:"card-body",children:["object"!=typeof e?o.jsxs("h4",{className:"header-title",children:[o.jsx("div",{id:"header-title-options",className:"float-end"}),o.jsx("span",{id:"header-title-prefix"})," Lista de ",e," ",o.jsx("span",{id:"header-title-suffix"})]}):"",o.jsx(p,{gridRef:a,rest:l,pageSize:t,columns:s.filter(Boolean),toolBar:r,masterDetail:i,filterValue:n,onRefresh:c,exportable:d,exportableName:m,customizeCell:u,rowDragging:g,sorting:h,withRelations:f})]})]})})});export{g as T};

import{j as e,k as t,c3 as a,l as s,P as r,T as i,r as n,aq as c,X as l,ca as o,y as d,bt as p,N as x,an as m,be as u,f as h,K as b,aY as g,bC as f,J as j,z as k,a6 as v,a7 as N,aZ as y,c1 as w,cb as _,C,m as S,ah as A,g as T,cc as D,a5 as E}from"./vendor-react-SBvaUJTK.js";import{C as O,N as R}from"./Number2Currency-BX4epFEo.js";import{D as P,a as I}from"./DeliveryPricesRest-CcCm6cds.js";import{A as q,m as z}from"./vendor-motion-DsSUWJCr.js";import{G as F}from"./General-ClVW7qxN.js";import{C as $,p as L}from"./culqiPayment-B172ojHS.js";import{t as M}from"./OpenPayCardModal-C0HhlOHJ.js";import{S as G}from"./StoresRest-BOjvDtH9.js";import{G as U}from"./Footer-BligNWSa.js";import{p as B,a as W}from"./openPayPayment-DUCaFARQ.js";import{U as Y,a as V}from"./ShippingStepRainstar-C0cGWw5S.js";import{r as H}from"./recoveryOrderData-B_YMuU-0.js";import K from"./html2canvas.esm-BPY6V10C.js";import{E as J}from"./ThankYouRainstar-67UDjWIk.js";import{S as X}from"./SalesRest-vA4KDG2S.js";import{H as Z}from"./HtmlContent-C3m8iMPg.js";import"./vendor-swiper-Cr_RrIb_.js";import"./BasicRest-Cgj77E-j.js";import"./BooleanLimit-q2Ad9fGY.js";import"./BancDropDown-FaFwF0Mb.js";import"./preload-helper-DAHR15QK.js";const Q=({setCart:n,hasPromotion:c,onPromotionClick:l,categorias:o,...d})=>{o?.find(e=>e.id===d?.category_id);const p="combo"===d.type,x=()=>{n(e=>e.filter(e=>p?!(e.id===d?.id&&"combo"===e.type):e.id!==d?.id))},m=p?d.final_price||d.price:d.final_price,u=d.price;return e.jsx("div",{className:"w-full bg-white border-2 border-black p-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,0.05)] hover:shadow-none transition-all group",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 w-full",children:[e.jsxs("div",{className:"flex items-center gap-6 flex-grow",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-24 h-24 border-2 border-black overflow-hidden bg-white grayscale group-hover:grayscale-0 transition-all duration-500",children:e.jsx("img",{src:p?d?.image?`/storage/images/combo/${d.image}`:`/storage/images/item/${d.image}`:`/storage/images/item/${d?.image}`,alt:d?.name,className:"w-full h-full object-cover object-top",onError:e=>e.target.src="/api/cover/thumbnail/null"})}),p&&e.jsx("div",{className:"absolute -top-3 -right-3 bg-black text-white border-2 border-white p-2",children:e.jsx(t,{size:14})}),c&&e.jsx("button",{onClick:()=>l(d),className:"absolute -bottom-3 -right-3 bg-red-600 text-white border-2 border-white p-2 animate-bounce hover:scale-110 transition-transform",title:"¡Tienes una promoción disponible!",children:e.jsx(a,{size:14})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-black text-xs md:text-sm uppercase tracking-tighter leading-tight mb-2 line-clamp-2",children:d?.name}),e.jsxs("div",{className:"space-y-1",children:[p?e.jsxs("p",{className:"text-[10px] font-bold text-red-600 uppercase tracking-widest",children:["Combo / ",d.combo_items?.length||0," ","productos"]}):e.jsxs("p",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:["SKU: ",d?.sku]}),d?.brand?.name&&e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-tight",children:["MARCA:"," ",e.jsx("span",{className:"text-neutral-500",children:d?.brand?.name})]})]})]})]}),e.jsxs("div",{className:"flex flex-row justify-between md:flex-col items-center md:items-end gap-6 flex-shrink-0 border-t-2 md:border-t-0 pt-4 md:pt-0 border-black/5",children:[e.jsxs("div",{className:"text-right",children:[(p||d?.discount>0)&&u>m&&e.jsxs("div",{className:"text-[10px] font-bold text-neutral-400 line-through tracking-tighter",children:[O()," ",Number(u*d?.quantity).toFixed(2)]}),e.jsxs("div",{className:"font-black text-2xl tracking-tighter",children:[O()," ",Number(m*d?.quantity).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center border-2 border-black bg-white h-10",children:[e.jsx("button",{type:"button",onClick:()=>{n(e=>e.map(e=>{if(p?e.id===d?.id&&"combo"===e.type:e.id===d?.id){const t=(e.quantity||1)-1;return t<=0?(x(),null):{...e,quantity:t}}return e}).filter(Boolean))},className:"w-8 h-full flex items-center justify-center hover:bg-black hover:text-white transition-colors",children:e.jsx(s,{size:14,strokeWidth:3})}),e.jsx("span",{className:"w-10 text-center font-black text-xs border-x-2 border-black",children:d?.quantity||1}),e.jsx("button",{type:"button",onClick:()=>{n(e=>e.map(e=>p?e.id===d?.id&&"combo"===e.type?{...e,quantity:(e.quantity||1)+1}:e:e.id===d?.id?{...e,quantity:(e.quantity||1)+1}:e))},className:"w-8 h-full flex items-center justify-center hover:bg-black hover:text-white transition-colors",children:e.jsx(r,{size:14,strokeWidth:3})})]}),e.jsx("button",{onClick:x,className:"p-2 border-2 border-transparent hover:border-red-600 text-neutral-400 hover:text-red-600 transition-all hover:scale-110",children:e.jsx(i,{size:20,strokeWidth:2.5})})]})]})]})})},ee=({children:t,onClick:a,disabled:s,className:r,variant:i="primary",type:n="button"})=>e.jsx("button",{type:n,onClick:a,disabled:s,className:`px-8 py-4 font-black uppercase tracking-[0.2em] text-xs transition-all duration-300 border-2 border-black disabled:opacity-50 disabled:cursor-not-allowed active:translate-y-0.5 active:translate-x-0.5 active:shadow-none ${{primary:"bg-black text-white hover:bg-white hover:text-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",secondary:"bg-white text-black hover:bg-black hover:text-white shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]",outline:"bg-transparent text-black hover:bg-black hover:text-white border-2 border-black",danger:"bg-red-600 text-white hover:bg-white hover:text-red-600 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"}[i]} ${r}`,children:t});function te({isOpen:t,onClose:s,suggestion:r,onAddToCart:i,productName:o}){const[d,p]=n.useState(!1);if(!t||!r)return null;return e.jsx(q,{children:e.jsxs("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center p-4",children:[e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-sm",onClick:s}),e.jsxs(z.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-white border-2 border-black max-w-lg w-full p-10 overflow-hidden shadow-[8px_8px_0px_0px_rgba(0,0,0,0.1)]",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 pointer-events-none",children:e.jsx(c,{size:200})}),e.jsx("button",{onClick:s,className:"absolute top-4 right-4 hover:rotate-90 transition-transform z-10",children:e.jsx(l,{size:32,strokeWidth:3})}),e.jsxs("div",{className:"text-center mb-10",children:[e.jsxs("div",{className:"relative inline-block mb-6",children:[e.jsx("div",{className:"bg-black text-white p-6 inline-block rotate-3 hover:rotate-0 transition-transform border-2 border-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:e.jsx(a,{size:48,strokeWidth:2.5})}),e.jsx(c,{size:24,className:"absolute -top-4 -right-4 text-red-600 animate-pulse"})]}),e.jsx("h2",{className:"text-4xl font-black uppercase tracking-tighter mb-2",children:"PREMIO RAINSTAR"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-neutral-400",children:"Desbloqueado por tu compra actual"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-neutral-50 border-2 border-black p-6 space-y-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-[10px] font-bold uppercase tracking-widest text-neutral-500 mb-4",children:["CRITERIO:"," ",e.jsxs("span",{className:"text-black",children:[r.current_quantity,' unidades de "',o,'"']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-black text-xl uppercase tracking-tight",children:r.rule_name}),e.jsx("p",{className:"text-xs font-bold text-neutral-500 uppercase tracking-widest leading-relaxed",children:r.description||"OBTÉN UN ARTÍCULO COMPLEMENTARIO SIN COSTO"})]})]})}),e.jsx("div",{className:"border-2 border-black border-dashed p-6 bg-white group",children:e.jsxs("div",{className:"flex items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6 flex-1",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-black bg-white flex items-center justify-center grayscale group-hover:grayscale-0 transition-all",children:e.jsx(a,{className:"text-black",size:32})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-black text-xs uppercase tracking-tighter truncate",children:r.item_name}),e.jsxs("p",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:["CANTIDAD:"," ",r.suggested_quantity]})]})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"text-2xl font-black tracking-tighter text-red-600",children:"GRATIS"}),e.jsxs("p",{className:"text-[10px] font-bold text-neutral-400 line-through tracking-widest",children:["VALOR: ",O()," ",Number(r.value||0).toFixed(2)]})]})]})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(ee,{onClick:async()=>{p(!0);try{await i(r),s()}catch(e){}finally{p(!1)}},disabled:d,className:"w-full flex items-center justify-between h-16",children:[e.jsx("span",{className:"text-sm",children:d?"AGREGANDO...":"RECLAMAR REGALO"}),e.jsx(c,{size:20,className:d?"animate-spin":""})]}),e.jsx("button",{onClick:s,className:"w-full text-[10px] font-black uppercase tracking-[0.5em] text-neutral-400 hover:text-black transition-colors py-2",children:"[ NO, GRACIAS ]"})]}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-300 text-center uppercase tracking-widest",children:"* Oferta disponible por tiempo limitado en entornos digitales Rainstar"})]})]})]})})}function ae({data:t,cart:a,setCart:s,user:r,onContinue:i,subTotal:c,envio:l,igv:u,totalFinal:h,openModal:b,automaticDiscounts:g,setAutomaticDiscounts:f,automaticDiscountTotal:j,setAutomaticDiscountTotal:k,totalWithoutDiscounts:v}){const[N,y]=n.useState(g||[]),[w,_]=n.useState(j||0),[C,S]=n.useState(!1),[A,T]=n.useState([]),[D,E]=n.useState(!1),[I,F]=n.useState(null),[$,L]=n.useState(null),[M,G]=n.useState(!1),U=0===a.length;n.useEffect(()=>{if(a.length>0&&c>0)B();else{const e=[];y(e),_(0),T([]),f&&f(e),k&&k(0)}},[a,c]);const B=async()=>{S(!0);try{const e=await P.applyToCart(a,v);if(e.success&&e.data){const t=P.formatDiscounts(e.data.applied_discounts),a=e.data.total_discount||0,s=[];e.data.applied_discounts.forEach(e=>{e.suggested_items&&Array.isArray(e.suggested_items)&&s.push(...e.suggested_items)}),y(t),_(a),T(s),f&&f(t),k&&k(a)}else{const e=[];y(e),_(0),T([]),f&&f(e),k&&k(0)}}catch(e){}finally{S(!1)}},W=e=>{const t=A.find(t=>t.item_id===e.id||t.triggering_item_id===e.id);t&&(F(t),L(e),E(!0))};return e.jsxs("div",{className:"grid lg:grid-cols-12 gap-12 pt-8 pb-20",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b-4 border-black pb-6",children:[e.jsxs("h2",{className:"text-4xl font-black uppercase tracking-tighter flex items-center gap-4",children:[e.jsx(o,{className:"w-10 h-10"}),"Carrito"]}),e.jsxs("span",{className:"bg-black text-white px-3 py-1 font-black text-[10px] uppercase tracking-widest",children:[a.length," Artículos"]})]}),e.jsx(q,{mode:"popLayout",children:U?e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-24 border-4 border-dashed border-black/5",children:[e.jsx(d,{className:"w-24 h-24 text-black/10 mb-8"}),e.jsx("h3",{className:"text-2xl font-black uppercase tracking-tighter text-black/20",children:"Tu carrito está vacío"}),e.jsx(ee,{variant:"outline",className:"mt-8",onClick:()=>window.location.href="/catalogo",children:"Ir al catálogo"})]}):e.jsx("div",{className:"space-y-6",children:a.map((t,a)=>{return e.jsx(Q,{...t,setCart:s,hasPromotion:(r=t.id,A.some(e=>e.item_id===r||e.triggering_item_id===r)),onPromotionClick:W},`${t.id}-${a}`);var r})})}),e.jsxs("div",{className:"border-2 border-black p-6 flex flex-col md:flex-row items-center gap-6 bg-neutral-50 shadow-[4px_4px_0px_0px_rgba(0,0,0,0.05)]",children:[e.jsx(p,{className:"w-10 h-10 text-black shrink-0"}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h4",{className:"font-black uppercase tracking-tight text-[10px]",children:"Compra Segura"}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest leading-loose",children:"Protegemos tus datos con los más altos estándares de cifrado. Tu transacción está garantizada."})]})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"sticky top-24 border-2 border-black bg-white p-6 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.05)]",children:[e.jsx("h3",{className:"text-3xl font-black uppercase tracking-tighter mb-6 border-b-2 border-black pb-4",children:"Resumen"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Subtotal"}),e.jsxs("span",{className:"text-xl font-black tracking-tighter",children:[O()," ",R(c)]})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Impuestos (I.G.V.)"}),e.jsxs("span",{className:"text-xl font-black tracking-tighter",children:[O()," ",R(u)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-y-2 border-black/5",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Costo de Envío"}),e.jsx("span",{className:"text-[10px] font-black bg-neutral-100 px-3 py-1 uppercase tracking-tighter",children:l>0?`${O()} ${R(l)}`:"Calculado en el siguiente paso"})]}),C&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("span",{className:"animate-pulse text-[10px] font-black uppercase tracking-widest italic",children:"Calculando beneficios Rainstar..."})}),!C&&N.length>0&&e.jsxs("div",{className:"space-y-3 pt-4 border-t-2 border-black/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(x,{size:14,strokeWidth:3}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Beneficios Aplicados"})]}),N.map((t,a)=>e.jsxs("div",{className:"flex justify-between text-[10px] font-bold",children:[e.jsx("span",{className:"uppercase text-neutral-500",children:t.name}),e.jsxs("span",{className:"text-red-600 font-black",children:["-",O()," ",R(t.amount)]})]},a)),e.jsxs("div",{className:"flex justify-between pt-2 border-t-2 border-black/5 text-[10px] font-black uppercase tracking-widest text-red-600",children:[e.jsx("span",{children:"Total Descuentos"}),e.jsxs("span",{children:["-",O()," ",R(w)]})]})]})]}),e.jsxs("div",{className:"bg-black text-white p-6 mb-8 -mx-6 relative overflow-hidden group",children:[e.jsxs("div",{className:"flex justify-between items-end relative z-10",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Total Final"}),e.jsxs("span",{className:"text-4xl font-black tracking-tighter",children:[O()," ",R(h)]})]}),w>0&&e.jsxs("div",{className:"mt-2 text-[10px] font-bold uppercase tracking-widest text-white/40 line-through text-right relative z-10",children:["Antes: ",O()," ",R(v||h+w)]}),e.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-10 group-hover:rotate-12 transition-transform",children:e.jsx(d,{size:40})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ee,{onClick:()=>{r?i():G(!0)},disabled:U,className:"w-full flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:"Continuar Compra"}),e.jsx(m,{size:18,strokeWidth:3})]}),e.jsx("button",{onClick:()=>window.location.href="/",className:"w-full text-[10px] font-black uppercase tracking-[0.5em] text-neutral-400 hover:text-black transition-colors",children:"[ Seguir Comprando ]"})]}),e.jsx("div",{className:"mt-8 pt-8 border-t-4 border-black border-dashed text-center",children:e.jsxs("p",{className:"text-[9px] font-bold text-neutral-400 uppercase leading-relaxed tracking-widest",children:["Al proceder aceptas nuestros"," ",e.jsx("a",{href:"#",onClick:e=>{e.preventDefault(),b("terms_conditions")},className:"text-black underline font-black",children:"términos"})," ","y"," ",e.jsx("a",{href:"#",onClick:e=>{e.preventDefault(),b("privacy_policy")},className:"text-black underline font-black",children:"políticas"}),"."]})})]})}),e.jsx(te,{isOpen:D,onClose:()=>E(!1),suggestion:I,onAddToCart:async e=>{s(t=>{const a=t.findIndex(t=>(t.item_id||t.id)===e.item_id);if(-1!==a){const s=[...t],r=e.quantity||e.suggested_quantity||1;return s[a].quantity+=r,s}return[...t,{id:e.item_id,name:e.item_name,quantity:e.quantity||e.suggested_quantity||1,price:e.value||0,final_price:e.value||0,image:e.item_image||"default.jpg",brand:{name:e.item_brand||"N/A"},sku:e.item_sku||"PROMO",stock:999}]}),setTimeout(()=>B(),100)},productName:$?.name||""}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999]",children:e.jsxs(z.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white border-[10px] border-black p-12 max-w-lg w-full relative shadow-[30px_30px_0px_0px_rgba(0,0,0,1)]",children:[e.jsx("button",{onClick:()=>G(!1),className:"absolute top-8 right-8 hover:rotate-90 transition-transform p-2 border-4 border-black group",children:e.jsx(se,{size:32,className:"group-hover:scale-110"})}),e.jsxs("div",{className:"mb-12",children:[e.jsx("div",{className:"inline-block bg-black text-white px-4 py-1 font-black text-[10px] uppercase tracking-widest mb-6",children:"Acceso Requerido"}),e.jsx("h2",{className:"text-5xl font-black uppercase tracking-tighter leading-none mb-6",children:"Identifícate"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.2em] text-neutral-400 leading-loose",children:"Para procesar tu compra de forma segura en nuestro ecosistema, necesitamos verificar tu identidad."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(ee,{size:"lg",onClick:()=>window.location.href="/iniciar-sesion",className:"w-full text-center",children:e.jsx("span",{className:"w-full",children:"Acceder al Sistema"})}),e.jsx(ee,{size:"lg",variant:"outline",onClick:()=>window.location.href="/crear-cuenta",className:"w-full text-center",children:e.jsx("span",{className:"w-full",children:"Crear Nueva Cuenta"})})]}),e.jsxs("div",{className:"mt-12 pt-8 border-t-4 border-black border-dashed flex items-center gap-4",children:[e.jsx(Shield,{className:"w-8 h-8 opacity-20"}),e.jsx("p",{className:"text-[8px] font-black uppercase tracking-widest text-neutral-300",children:"Protocolo SSL de grado bancario activado"})]})]})})]})}const se=({size:t,className:a})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"square",strokeLinejoin:"miter",className:a,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),re=({ubigeoCode:t,ubigeo:a,onStoreSelect:s,selectedStore:r=null,specificStores:i=null,className:c=""})=>{const[l,o]=n.useState([]),[d,p]=n.useState(!1),[x,m]=n.useState(null);n.useEffect(()=>{h()},[i]);const h=async()=>{p(!0),m(null);try{const e=new G,t=await e.paginate({status:!0,visible:!0});let a=t?.data||[];a=a.filter(e=>{const t=!0===e.visible||1===e.visible,a=!0===e.status||1===e.status,s=!0===e.pickup_available||1===e.pickup_available||void 0===e.pickup_available;return t&&a&&s}),i&&Array.isArray(i)&&i.length>0&&(a=a.filter(e=>i.includes(e.id))),o(a)}catch(e){m("No se pudieron cargar las tiendas disponibles"),o([])}finally{p(!1)}};return d?e.jsxs("div",{className:"py-12 border-2 border-black border-dashed flex flex-col items-center justify-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-black border-t-transparent animate-spin"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Escaneando sistema logístico..."})]}):x?e.jsx("div",{className:"p-8 border-2 border-red-500 bg-red-50",children:e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-red-500",children:x})}):0===l.length?e.jsx("div",{className:"p-8 border-2 border-black bg-neutral-50 text-center",children:e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"No hay puntos de retiro activos en esta zona."})}):e.jsxs("div",{className:`space-y-6 ${c}`,children:[e.jsxs("div",{className:"border-b-2 border-black pb-4",children:[e.jsx("h3",{className:"text-xl font-black uppercase tracking-tighter",children:"Puntos de Retiro Rainstar"}),e.jsx("p",{className:"text-[9px] font-bold text-neutral-400 uppercase tracking-widest mt-1",children:"Selecciona una base para la recolección de suministros"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:l.map(t=>e.jsxs("button",{type:"button",onClick:()=>s(t),className:"p-6 border-2 text-left relative transition-all group overflow-hidden "+(r?.id===t.id?"border-black bg-black text-white shadow-none translate-x-1 translate-y-1":"border-black/10 bg-white hover:border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,0.05)] hover:shadow-none"),children:[e.jsxs("div",{className:"flex gap-4 relative z-10",children:[e.jsx("div",{className:"w-16 h-16 border-2 shrink-0 overflow-hidden "+(r?.id===t.id?"border-white":"border-black"),children:e.jsx("img",{src:`/storage/images/store/${t.image}`,alt:t.name,className:"w-full h-full object-cover grayscale",onError:e=>e.target.src="/api/cover/thumbnail/null"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-black uppercase tracking-tight text-sm truncate",children:t.name}),e.jsx("div",{className:"inline-block px-2 py-0.5 mt-2 text-[8px] font-black uppercase tracking-widest "+(r?.id===t.id?"bg-white text-black":"bg-black text-white"),children:t.type?.replace("_"," ")||"SUCURSAL"}),e.jsx("p",{className:"mt-3 text-[9px] font-bold uppercase tracking-widest line-clamp-2 "+(r?.id===t.id?"text-white/60":"text-neutral-400"),children:t.address})]})]}),r?.id===t.id&&e.jsx("div",{className:"absolute -bottom-4 -right-4 bg-white/10 p-4 rotate-12",children:e.jsx(u,{size:48})})]},t.id))})]})},ie=({active:t,id:a,label:s,description:r,icon:i,onClick:n,commission:c})=>e.jsxs("div",{className:"pb-1 pr-1",children:[" ",e.jsxs("button",{type:"button",onClick:n,className:"w-full p-6 text-left border-2 transition-all relative overflow-hidden group "+(t?"border-black bg-black text-white shadow-none translate-x-1 translate-y-1":"border-black bg-white hover:border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-1 hover:translate-y-1"),children:[e.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h5",{className:"font-black uppercase tracking-tighter text-lg leading-none",children:s}),e.jsx("p",{className:"text-[10px] uppercase tracking-widest leading-tight "+(t?"text-white/60":"text-neutral-400"),children:r}),c>0&&e.jsxs("p",{className:"text-[9px] font-black uppercase tracking-widest mt-1 "+(t?"text-white/40":"text-amber-500"),children:["+ COMISIÓN DEL ",c,"%"]})]}),i&&e.jsx(i,{className:`w-8 h-8 ${t?"text-white":"text-black/10 group-hover:text-black/30"} transition-colors`,strokeWidth:t?2.5:1.5})]}),t&&e.jsx("div",{className:"absolute -bottom-2 -right-4 bg-white/10 p-4 rotate-12",children:e.jsx(u,{size:40})})]})]});function ne({isOpen:t,onClose:a,onPaymentComplete:s,contacts:r=[]}){const[i,c]=n.useState(null),[o,d]=n.useState(!1);n.useEffect(()=>{t||(d(!1),c(null))},[t]);const p=r?.find(e=>"checkout_mercadopago"===e.correlative),x=r?.find(e=>"checkout_openpay"===e.correlative),m=r?.find(e=>"checkout_culqi"===e.correlative),u="true"!==p?.description&&"true"!==x?.description&&"true"!==m?.description&&"true"!==F.get("checkout_dwallet")&&"true"!==F.get("checkout_transfer");return e.jsx(h,{isOpen:t,onRequestClose:a,className:"absolute left-1/2 -translate-x-1/2 bg-white border-4 border-black shadow-[16px_16px_0px_0px_rgba(0,0,0,1)] w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden outline-none",overlayClassName:"fixed inset-0 bg-white/80 backdrop-blur-sm z-[100]",ariaHideApp:!1,children:e.jsxs("div",{className:"flex flex-col md:flex-row min-h-[500px]",children:[e.jsxs("div",{className:"md:w-5/12 hidden md:block relative overflow-hidden bg-[#f8f5f2] border-r-4 border-black",children:[e.jsx("img",{src:`/assets/resources/payments.png?v=${crypto.randomUUID()}`,alt:U.APP_NAME,className:"h-full w-full object-cover grayscale contrast-125",onError:e=>{e.target.onerror=null,e.target.src="/assets/img/logo-bk.svg"}}),e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[2px] p-10 flex flex-col justify-between text-white",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h2",{className:"text-5xl font-black uppercase tracking-tight leading-[0.85] italic mb-6 drop-shadow-[4px_4px_0px_rgba(0,0,0,1)]",children:["PAGAR ES EL ",e.jsx("br",{}),e.jsx("span",{className:"text-white/50",children:"PASO"})," ",e.jsx("br",{}),"FINAL"]}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em] leading-relaxed opacity-80 max-w-[200px]",children:"TU SEGURIDAD ES NUESTRA PRIORIDAD. TODOS NUESTROS PROCESOS ESTÁN ENCRIPTADOS."})]})})]}),e.jsxs("div",{className:"flex-1 p-8 md:p-12 relative",children:[e.jsx("button",{onClick:a,className:"absolute top-8 right-8 text-black/20 hover:text-black transition-colors",children:e.jsx(l,{size:24})}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h3",{className:"text-2xl font-black uppercase tracking-tight mb-2",children:"Método de Pago"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400",children:"SELECCIONA UNA DE LAS OPCIONES DISPONIBLES"})]}),u?e.jsxs("div",{className:"p-12 border-2 border-dashed border-black/10 flex flex-col items-center justify-center text-center",children:[e.jsx(l,{className:"text-black/10 mb-4",size:48}),e.jsx("p",{className:"font-black uppercase tracking-tight text-neutral-300",children:"Sin métodos de pago configurados"})]}):e.jsxs("div",{className:"space-y-4 max-h-[420px] overflow-y-auto overflow-x-hidden p-2 -m-2 brutalist-scroll",children:["true"===p?.description&&e.jsx(ie,{id:"tarjeta",active:"tarjeta"===i,onClick:()=>c("tarjeta"),label:"Tarjeta",description:"CRÉDITO Y DÉBITO (MERCADO PAGO)",commission:parseFloat(F.get("checkout_mercadopago_commission")||0)}),"true"===x?.description&&e.jsx(ie,{id:"openpay",active:"openpay"===i,onClick:()=>c("openpay"),label:"Tarjeta",description:"PAGO SEGURO BBVA",commission:parseFloat(F.get("checkout_openpay_commission")||0)}),"true"===m?.description&&e.jsx(ie,{id:"culqi",active:"culqi"===i,onClick:()=>c("culqi"),label:"Tarjeta",description:"TODAS LAS TARJETAS Y YAPE",commission:parseFloat(F.get("checkout_culqi_commission")||0)}),"true"===F.get("checkout_dwallet")&&e.jsx(ie,{id:"yape",active:"yape"===i,onClick:()=>c("yape"),label:"Yape / Plin",description:"PAGO RÁPIDO DESDE TU CELULAR",commission:parseFloat(F.get("checkout_dwallet_commission")||0)}),"true"===F.get("checkout_transfer")&&e.jsx(ie,{id:"transferencia",active:"transferencia"===i,onClick:()=>c("transferencia"),label:"Transferencia",description:"BANCA POR INTERNET O APP",commission:parseFloat(F.get("checkout_transfer_commission")||0)})]}),e.jsxs("div",{className:"mt-10 pt-8 border-t-2 border-black/5 flex flex-col md:flex-row gap-4",children:[e.jsxs("button",{disabled:!i||o,onClick:()=>{i&&(d(!0),s(i))},className:"flex-1 h-16 bg-black text-white px-8 flex items-center justify-between group transition-all "+(!i||o?"opacity-30 grayscale cursor-not-allowed":"hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)]"),children:[e.jsx("span",{className:"font-black uppercase tracking-widest italic",children:o?"PROCESANDO...":"CONFIRMAR PAGO"}),!o&&e.jsx(b,{className:"group-hover:translate-x-1 transition-transform",strokeWidth:3})]}),e.jsx("button",{disabled:o,onClick:a,className:"h-16 px-8 border-2 border-black font-black uppercase tracking-widest hover:bg-neutral-50 transition-colors italic",children:"CANCELAR"})]})]})]})})}function ce({isOpen:t,onClose:a,onTokenCreated:s}){const[r,i]=n.useState({card_number:"",holder_name:"",expiration_month:"",expiration_year:"",cvv2:""}),[c,o]=n.useState(!1),[d,p]=n.useState({}),[x,m]=n.useState(null),[u,j]=n.useState(null),k=n.useRef(null),v=n.useRef(null),N=n.useRef(null),y=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{t?_():(i({card_number:"",holder_name:"",expiration_month:"",expiration_year:"",cvv2:""}),p({}),m(null),j(null))},[t]);const _=()=>{try{if(void 0===window.OpenPay)throw new Error("OpenPay no está disponible. Por favor, recarga la página.");const e=window.OPENPAY_MERCHANT_ID,t=window.OPENPAY_PUBLIC_KEY,a=void 0===window.OPENPAY_SANDBOX_MODE||window.OPENPAY_SANDBOX_MODE;if(!e||!t)throw new Error("Configuración de OpenPay incompleta.");window.OpenPay.setId(e),window.OpenPay.setApiKey(t),window.OpenPay.setSandboxMode(a);const s=window.OpenPay.deviceData.setup();m(s)}catch(e){M.error(e.message||"Error al inicializar pasarela")}},C=(e,t)=>{i({...r,[e]:t})};return e.jsx(h,{isOpen:t,onRequestClose:a,className:"absolute left-1/2 -translate-x-1/2 bg-white border-4 border-black shadow-[16px_16px_0px_0px_rgba(0,0,0,1)] w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden outline-none",overlayClassName:"fixed inset-0 bg-white/80 backdrop-blur-sm z-[100]",ariaHideApp:!1,children:e.jsxs("div",{className:"flex flex-col md:flex-row min-h-[500px]",children:[e.jsxs("div",{className:"md:w-5/12 bg-black text-white p-10 flex flex-col justify-between relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h2",{className:"text-4xl font-black uppercase tracking-tight leading-[0.85] italic mb-8",children:["PAGO ",e.jsx("br",{})," CON ",e.jsx("br",{})," ",e.jsx("span",{className:"text-neutral-500",children:"TARJETA"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 group",children:[e.jsx("div",{className:"p-3 border-2 border-neutral-700 bg-neutral-900 group-hover:bg-white group-hover:text-black transition-colors",children:e.jsx(g,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Certificación"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-tight italic",children:"PCI-DSS SECURITY FLAG"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 group",children:[e.jsx("div",{className:"p-3 border-2 border-neutral-700 bg-neutral-900 group-hover:bg-white group-hover:text-black transition-colors",children:e.jsx(f,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Pasarela"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-tight italic text-neutral-200",children:"BBVA OPENPAY SECURE"})]})]})]})]}),e.jsx("div",{className:"relative z-10 text-[9px] font-black uppercase tracking-[0.4em] opacity-40",children:"RAINSTAR HIGH-SPEED CHECKOUT"}),e.jsx("div",{className:"absolute -bottom-16 -left-16 text-[160px] font-black opacity-[0.03] select-none pointer-events-none italic leading-none",children:"CARD"})]}),e.jsxs("div",{className:"flex-1 p-8 md:p-14 relative flex flex-col justify-center",children:[e.jsx("button",{onClick:a,className:"absolute top-8 right-8 text-black/20 hover:text-black transition-colors",children:e.jsx(l,{size:24})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};(!r.card_number||r.card_number.replace(/\s/g,"").length<13)&&(e.card_number="Inválido"),(!r.holder_name||r.holder_name.trim().length<3)&&(e.holder_name="Requerido"),(!r.expiration_month||parseInt(r.expiration_month)<1||parseInt(r.expiration_month)>12)&&(e.expiration_month="MM");const t=(new Date).getFullYear().toString().slice(-2);return(!r.expiration_year||parseInt(r.expiration_year)<parseInt(t))&&(e.expiration_year="YY"),(!r.cvv2||r.cvv2.length<3)&&(e.cvv2="CVV"),p(e),0===Object.keys(e).length})())if(x){o(!0);try{const e={card_number:r.card_number.replace(/\s/g,""),holder_name:r.holder_name.toUpperCase(),expiration_year:2===r.expiration_year.length?r.expiration_year:r.expiration_year.slice(-2),expiration_month:r.expiration_month.padStart(2,"0"),cvv2:r.cvv2};window.OpenPay.token.create(e,e=>{o(!1),s({token:e.data.id,device_session_id:x,card_info:{brand:e.data.brand||"card",card_number:e.data.card_number||`****${r.card_number.slice(-4)}`,holder_name:r.holder_name}}),a()},e=>{o(!1),M.error(e.data?.description||"Error al validar tarjeta")})}catch(t){o(!1),M.error("Error al procesar la tarjeta")}}else M.error("Error de sesión. Intente cerrar y abrir nuevamente.")},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-400 mb-2 block",children:"Número de Tarjeta"}),e.jsx("input",{ref:k,type:"text",value:r.card_number,onChange:e=>{const t=(e=>{const t=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),a=[];for(let s=0,r=t.length;s<r;s+=4)a.push(t.substring(s,s+4));return a.join(" ")})(e.target.value);i({...r,card_number:t}),16===t.replace(/\s/g,"").length&&v.current?.focus()},placeholder:"0000 0000 0000 0000",maxLength:"19",className:"w-full h-14 px-4 bg-white border-2 font-black tracking-widest outline-none transition-all "+(d.card_number?"border-red-500 bg-red-50":"border-black focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-400 mb-2 block",children:"Nombre del Titular"}),e.jsx("input",{ref:v,type:"text",value:r.holder_name,onChange:e=>C("holder_name",e.target.value.toUpperCase()),placeholder:"TITULAR DE LA TARJETA",className:"w-full h-14 px-4 bg-white border-2 font-black tracking-widest outline-none transition-all "+(d.holder_name?"border-red-500 bg-red-50":"border-black focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 mb-2 block text-center",children:"MM"}),e.jsx("input",{ref:N,type:"text",value:r.expiration_month,onChange:e=>C("expiration_month",e.target.value.replace(/\D/g,"")),placeholder:"01",maxLength:"2",className:"w-full h-14 text-center bg-white border-2 font-black outline-none transition-all "+(d.expiration_month?"border-red-500":"border-black focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 mb-2 block text-center",children:"YY"}),e.jsx("input",{ref:y,type:"text",value:r.expiration_year,onChange:e=>C("expiration_year",e.target.value.replace(/\D/g,"")),placeholder:"28",maxLength:"2",className:"w-full h-14 text-center bg-white border-2 font-black outline-none transition-all "+(d.expiration_year?"border-red-500":"border-black focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400 mb-2 block text-center",children:"CVV"}),e.jsx("input",{ref:w,type:"text",value:r.cvv2,onChange:e=>C("cvv2",e.target.value.replace(/\D/g,"")),placeholder:"***",maxLength:"4",className:"w-full h-14 text-center bg-white border-2 font-black outline-none transition-all "+(d.cvv2?"border-red-500":"border-black focus:shadow-[4px_4_0px_0px_rgba(0,0,0,1)]")})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 pt-6",children:[e.jsxs("button",{type:"submit",disabled:c,className:"h-16 bg-black text-white px-8 flex items-center justify-between group transition-all "+(c?"opacity-30 cursor-not-allowed":"hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,0.2)]"),children:[e.jsx("span",{className:"font-black uppercase tracking-widest italic text-lg",children:c?"PROCESANDO...":"CONFIRMAR PAGO"}),!c&&e.jsx(b,{size:24,className:"group-hover:translate-x-1 transition-transform",strokeWidth:3})]}),e.jsx("button",{type:"button",onClick:a,className:"h-16 px-8 border-2 border-black font-black uppercase tracking-widest hover:bg-neutral-50 transition-colors italic",children:"CANCELAR"})]})]})]})]})})}const le=({label:t,icon:a,name:s,error:r,...i})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400",children:t}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{...i,name:s,className:`w-full border-2 p-4 font-bold outline-none transition-all ${r?"border-red-500 bg-red-50":"border-black focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:border-black"} ${a?"pl-12":""}`}),a&&e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 group-hover:text-black transition-colors",children:e.jsx(a,{size:18})})]}),r&&e.jsx("p",{className:"text-[9px] font-bold text-red-500 uppercase tracking-widest mt-1",children:r})]}),oe=({label:t,icon:a,children:s,error:r,...i})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400",children:t}),e.jsxs("div",{className:"relative group",children:[e.jsx("select",{...i,className:`w-full border-2 p-4 font-bold outline-none appearance-none bg-white cursor-pointer transition-all ${r?"border-red-500 bg-red-50":"border-black focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"} ${a?"pl-12":""}`,children:s}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-neutral-400 group-hover:text-black transition-colors",children:e.jsx(C,{size:18})}),a&&e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-400 group-hover:text-black transition-colors",children:e.jsx(a,{size:18})})]}),r&&e.jsx("p",{className:"text-[9px] font-bold text-red-500 uppercase tracking-widest mt-1",children:r})]});function de({data:t,cart:a,setCart:s,user:r,onContinue:i,onBack:c,subTotal:o,igv:d,totalFinal:p,setDataCheckout:m,dataCheckout:u,totalWithoutDiscounts:h,ubigeos:f=[],prefixes:C=[],generals:S=[],contacts:A=[],openModal:T,envio:D,setEnvio:E,additionalShippingCost:P,setAdditionalShippingCost:q,additionalShippingDescription:z,setAdditionalShippingDescription:G,calculateAdditionalShippingCost:U,couponDiscount:H=0,setCouponDiscount:K,setCouponCode:J,automaticDiscountTotal:X=0,automaticDiscounts:Z=[]}){const[Q,te]=n.useState(!1),[ae,se]=n.useState(!1),[ie,de]=n.useState(()=>{const e=r?.phone_prefix||"51",t=(s=e,(a=r?.phone||"")?a.startsWith(s)?a.substring(s.length):a:"");var a,s;return{name:r?.name||"",lastname:r?.lastname||"",email:r?.email||"",phone_prefix:e,phone:t,documentType:r?.document_type?.toLowerCase()||"dni",document:r?.document_number||"",department:r?.department||"",province:r?.province||"",district:r?.district||"",address:r?.address||"",number:r?.number||"",comment:r?.comment||"",reference:r?.reference||"",shippingOption:u?.delivery_type||"delivery",ubigeo:r?.ubigeo||u?.ubigeo||null,invoiceType:u?.invoiceType||"boleta",businessName:u?.businessName||""}}),[pe,xe]=n.useState({}),[me,ue]=n.useState([]),[he,be]=n.useState(u?.delivery_type||null),[ge,fe]=n.useState(null),[je,ke]=n.useState(u?.payment_method||""),[ve,Ne]=n.useState(u?.coupon_code||""),[ye,we]=n.useState(u?.coupon_discount>0?{code:u?.coupon_code,value:u?.coupon_discount}:null),[_e,Ce]=n.useState(!1),[Se,Ae]=n.useState(""),[Te,De]=n.useState(null),[Ee,Oe]=n.useState(!1),[Re,Pe]=n.useState(!1),[Ie,qe]=n.useState(!1),[ze,Fe]=n.useState(!1),[$e,Le]=n.useState(!1),[Me,Ge]=n.useState(null),[Ue,Be]=n.useState(null),[We,Ye]=n.useState(0),[Ve,He]=n.useState("");n.useEffect(()=>{ie.ubigeo&&fetch(`/api/ubigeo/find/${ie.ubigeo}`).then(e=>e.json()).then(e=>{if(e&&e.distrito){const t={value:ie.ubigeo,label:`${e.distrito}, ${e.provincia}, ${e.departamento}`,data:{reniec:ie.ubigeo,departamento:e.departamento,provincia:e.provincia,distrito:e.distrito}};fe(t),Je(t)}})},[]);const Ke=e=>{const{name:t,value:a}=e.target;de(e=>({...e,[t]:a})),"invoiceType"===t&&de(e=>({...e,documentType:"factura"===a?"ruc":"dni",document:"",businessName:"factura"===a?e.businessName:""}))},Je=async e=>{if(!e)return;xe(e=>({...e,ubigeo:""}));const{data:t}=e;fe(e),de(e=>({...e,department:t.departamento,province:t.provincia,district:t.distrito,ubigeo:t.reniec||t.inei})),te(!0);try{const e=a.reduce((e,t)=>e+t.final_price*t.quantity,0),s=await I.getShippingCost({ubigeo:t.reniec||t.inei,cart_total:e}),r=[];if(s.data.is_free&&s.data.qualifies_free_shipping&&r.push({type:"free",price:0,description:s.data.standard.description,deliveryType:s.data.standard.type,characteristics:s.data.standard.characteristics}),s.data.is_standard&&s.data.standard&&(!s.data.is_free||s.data.is_free&&!s.data.qualifies_free_shipping)){let e=s.data.standard.description;s.data.is_free||(e=e.replace(/envío gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),e||(e="Delivery a domicilio")),r.push({type:"standard",price:s.data.standard.price,description:e,deliveryType:s.data.standard.type,characteristics:s.data.standard.characteristics})}s.data.express&&s.data.express.price>0&&r.push({type:"express",price:s.data.express.price,description:s.data.express.description,deliveryType:s.data.express.type,characteristics:s.data.express.characteristics}),s.data.is_agency&&s.data.agency&&r.push({type:"agency",price:s.data.agency.price||0,description:s.data.agency.description,deliveryType:s.data.agency.type,characteristics:s.data.agency.characteristics,paymentOnDelivery:s.data.agency.payment_on_delivery||!1,showConsultButton:s.data.needs_consultation||!1}),s.data.is_store_pickup&&s.data.store_pickup&&r.push({type:"store_pickup",price:0,description:s.data.store_pickup.description,deliveryType:s.data.store_pickup.type,characteristics:s.data.store_pickup.characteristics,selectedStores:s.data.store_pickup.selected_stores}),ue(r),r[0]&&Ze(r[0])}catch(s){M.error("Sin cobertura",{description:"No realizamos envíos a esta ubicación"}),ue([]),be(null),E(0),q(0),G("")}finally{te(!1)}},Xe=async()=>{if(ve){Ce(!0),Ae("");try{const e=await $.validate(ve,h);e.success?(we(e.coupon),K(e.discount),J(ve),M.success("Cupón aplicado")):(Ae(e.message),we(null),K(0),J(null))}catch(e){Ae("Error al validar cupón")}finally{Ce(!1)}}},Ze=e=>{if(be(e.type),E(parseFloat(e.price||0)),U){const t=parseFloat(o)+parseFloat(d),a=U(e.type,t);q(a.cost),G(a.description)}else q(0),G("");"store_pickup"===e.type?Oe(!0):(Oe(!1),De(null))},Qe=e=>Math.round(100*(e+Number.EPSILON))/100;return e.jsxs("div",{className:"pt-8 pb-20 max-w-7xl mx-auto px-4 md:px-0",children:[e.jsxs("div",{className:"mb-12 flex items-center justify-between border-b-4 border-black pb-8",children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-2 group",children:[e.jsx("div",{className:"p-2 border-2 border-black group-hover:bg-black group-hover:text-white transition-all",children:e.jsx(j,{size:20})}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Volver"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Paso 02"}),e.jsx("h2",{className:"text-4xl md:text-5xl font-black uppercase tracking-tighter",children:"Envío & Pago"})]})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return ie.name||(e.name="Requerido"),ie.lastname||(e.lastname="Requerido"),ie.email||(e.email="Requerido"),ie.phone||(e.phone="Requerido"),ie.ubigeo||(e.ubigeo="Selecciona ubicación"),ie.address||(e.address="Requerido"),ie.number||(e.number="Requerido"),ie.document||(e.document="Requerido"),"factura"!==ie.invoiceType||ie.businessName||(e.businessName="Requerido para factura"),xe(e),0===Object.keys(e).length})()?Pe(!0):M.error("Por favor completa todos los campos requeridos")},className:"grid lg:grid-cols-12 gap-16",children:[e.jsxs("div",{className:"lg:col-span-7 space-y-16",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"w-10 h-10 bg-black text-white flex items-center justify-center font-black",children:"01"}),e.jsx("h3",{className:"text-2xl font-black uppercase tracking-tight",children:"Tus Datos"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(le,{label:"Nombre",name:"name",value:ie.name,onChange:Ke,error:pe.name,icon:k,required:!0}),e.jsx(le,{label:"Apellidos",name:"lastname",value:ie.lastname,onChange:Ke,error:pe.lastname,icon:k,required:!0}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(le,{label:"Email",name:"email",type:"email",value:ie.email,onChange:Ke,error:pe.email,icon:v,required:!0})}),e.jsxs("div",{className:"md:col-span-2 flex gap-4",children:[e.jsx("div",{className:"w-32",children:e.jsx(oe,{label:"Prefijo",name:"phone_prefix",value:ie.phone_prefix,onChange:Ke,children:C.map((t,a)=>e.jsxs("option",{value:t.code,children:["+",t.code," ",t.country]},`prefix-${a}`))})}),e.jsx("div",{className:"flex-1",children:e.jsx(le,{label:"Teléfono / WhatsApp",name:"phone",value:ie.phone,onChange:Ke,error:pe.phone,icon:N,required:!0})})]}),e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-neutral-400",children:"Tipo de Comprobante"}),e.jsx("div",{className:"flex gap-4",children:["boleta","factura"].map(t=>e.jsx("button",{type:"button",onClick:()=>Ke({target:{name:"invoiceType",value:t}}),className:"flex-1 p-4 border-2 font-black uppercase text-xs tracking-widest transition-all "+(ie.invoiceType===t?"bg-black text-white border-black":"border-black/10 hover:border-black"),children:t},t))})]}),e.jsxs(oe,{label:"Tipo de Identidad",name:"documentType",value:ie.documentType,onChange:Ke,icon:y,children:[e.jsx("option",{value:"dni",children:"DNI"},"dni"),e.jsx("option",{value:"ce",children:"C.E."},"ce"),e.jsx("option",{value:"ruc",children:"R.U.C."},"ruc"),e.jsx("option",{value:"pasaporte",children:"Pasaporte"},"pasaporte")]}),e.jsx(le,{label:"Nº de Documento",name:"document",value:ie.document,onChange:Ke,error:pe.document,required:!0}),"factura"===ie.invoiceType&&e.jsx("div",{className:"md:col-span-2",children:e.jsx(le,{label:"Razón Social",name:"businessName",value:ie.businessName,onChange:Ke,error:pe.businessName,required:!0})})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"w-10 h-10 bg-black text-white flex items-center justify-center font-black",children:"02"}),e.jsx("h3",{className:"text-2xl font-black uppercase tracking-tight",children:"Entrega"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{id:"ubigeo-select-container",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest mb-2 block "+(pe.ubigeo?"text-red-500":"text-neutral-400"),children:"Ubicación (Distrito, Provincia, Departamento)"}),e.jsx(w,{cacheOptions:!0,loadOptions:async e=>{if(e.length<3)return[];try{const t=await fetch(`/api/ubigeo/search?q=${encodeURIComponent(e)}`);return(await t.json()).map(e=>({value:e.reniec,label:`${e.distrito}, ${e.provincia}, ${e.departamento}`,data:e}))}catch(t){return[]}},onChange:Je,value:ge,placeholder:"Buscar ubicación...",className:"brutalist-select",styles:{control:e=>({...e,border:"2px solid black",borderRadius:"0",padding:"8px",fontWeight:"900",boxShadow:"none","&:hover":{border:"2px solid black"}}),menu:e=>({...e,borderRadius:"0",border:"2px solid black",marginTop:"4px"}),option:(e,t)=>({...e,backgroundColor:t.isFocused?"black":"white",color:t.isFocused?"white":"black",fontWeight:"bold",textTransform:"uppercase",fontSize:"10px",letterSpacing:"0.1em"})}}),pe.ubigeo&&e.jsx("p",{className:"text-red-500 text-[10px] font-bold mt-1 uppercase italic",children:pe.ubigeo})]}),ge&&"store_pickup"!==he&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 bg-neutral-50 p-8 border-2 border-black border-dashed my-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(le,{label:"Dirección / Avenida / Calle",name:"address",value:ie.address,onChange:Ke,error:pe.address,required:!0})}),e.jsx(le,{label:"Número / Lote",name:"number",value:ie.number,onChange:Ke,error:pe.number,required:!0}),e.jsx(le,{label:"Interior / Piso / Dpto",name:"comment",value:ie.comment,onChange:Ke}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(le,{label:"Referencia",name:"reference",value:ie.reference,onChange:Ke})})]}),me.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t-4 border-black border-dotted mt-8",children:[e.jsx("h4",{className:"font-black uppercase text-sm tracking-widest mb-4",children:"Selecciona un método:"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:me.map(t=>{const a=F.get("whatsapp_advisors")||[],s=`Hola, necesito consultar el costo de envío para: ${ge?.label||"mi ubicación"}. ¿Me pueden ayudar?`;return e.jsx("div",{className:"relative group",children:e.jsxs("button",{type:"button",onClick:()=>Ze(t),className:"w-full p-6 border-2 text-left transition-all "+(he===t.type?"bg-black text-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)]":"border-black/10 hover:border-black"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-black uppercase text-xs tracking-tighter",children:t.deliveryType}),!t.showConsultButton&&e.jsx("span",{className:"font-black text-sm",children:0===t.price?"GRATIS":`${O()} ${R(t.price)}`})]}),e.jsx("p",{className:"text-[9px] uppercase tracking-widest leading-relaxed "+(he===t.type?"text-white/60":"text-neutral-400"),children:t.description}),t.showConsultButton&&a.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-black/10 border-dashed",children:e.jsxs("button",{type:"button",onClick:t=>{t.stopPropagation(),1===a.length?window.open(`https://api.whatsapp.com/send?phone=${a[0].phone}&text=${encodeURIComponent(s)}`,"_blank"):M.info("Elige un asesor",{description:e.jsx("div",{className:"flex flex-col gap-2 mt-4",children:a.map((t,a)=>e.jsxs("button",{onClick:()=>window.open(`https://api.whatsapp.com/send?phone=${t.phone}&text=${encodeURIComponent(s)}`,"_blank"),className:"p-2 bg-black text-white font-black text-[10px] uppercase tracking-widest",children:["Hablar con"," ",t.name]},a))})})},className:"w-full py-2 flex items-center justify-center gap-2 font-black text-[10px] uppercase tracking-widest transition-all "+(he===t.type?"bg-white text-black hover:bg-neutral-100":"bg-green-500 text-white hover:bg-green-600"),children:[e.jsx(N,{size:12}),"Consultar Costo"]})})]})},t.type)})})]}),Ee&&e.jsx("div",{className:"mt-8",children:e.jsx(re,{ubigeo:ie.ubigeo,onStoreSelect:De,selectedStore:Te,specificStores:me.find(e=>"store_pickup"===e.type)?.selectedStores})})]})]})]}),e.jsx("div",{className:"lg:col-span-5",children:e.jsxs("div",{className:"sticky top-24 space-y-8",children:[e.jsxs("div",{className:"border-4 border-black bg-white p-10 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[e.jsx("h4",{className:"text-2xl font-black uppercase tracking-tighter mb-8 border-b-4 border-black pb-4",children:"Detalle de Orden"}),e.jsx("div",{className:"space-y-4 mb-10 max-h-80 overflow-y-auto pr-4 brutalist-scroll",children:a.map((t,a)=>e.jsxs("div",{className:"flex gap-4 pb-4 border-b-2 border-black/5",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-black bg-white p-1 shrink-0",children:e.jsx("img",{src:`/storage/images/item/${t.image}`,className:"w-full h-full object-cover grayscale"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-tighter leading-tight",children:t.name}),e.jsxs("p",{className:"text-[9px] font-bold text-neutral-400 mt-1",children:["CANT: ",t.quantity," ×"," ",O()," ",R(t.final_price||t.price)]})]}),e.jsxs("span",{className:"font-black text-xs tracking-tighter",children:[O()," ",R((t.final_price||t.price)*t.quantity)]})]},a))}),e.jsxs("div",{className:"mb-10",children:[ye?e.jsxs("div",{className:"bg-black text-white p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{size:16}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase",children:ye.code}),e.jsxs("p",{className:"text-[8px] font-bold text-white/50",children:["DSCTO: ",O()," ",R(H)]})]})]}),e.jsx("button",{onClick:()=>{we(null),Ne(""),J(null),K(0)},className:"hover:text-red-500 transition-colors",children:e.jsx(l,{size:16})})]}):e.jsxs("div",{className:"flex border-2 border-black",children:[e.jsx("input",{type:"text",value:ve,onChange:e=>setCouponCode(e.target.value.toUpperCase()),className:"flex-1 p-4 font-black text-xs uppercase outline-none",placeholder:"CÓDIGO CUPÓN",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),Xe())}),e.jsx("button",{type:"button",onClick:Xe,disabled:_e,className:"bg-black text-white px-6 font-black text-[10px] uppercase hover:bg-neutral-800",children:_e?"...":"Aplicar"})]}),Se&&e.jsx("p",{className:"text-red-500 text-[9px] font-black uppercase mt-2 italic",children:Se})]}),e.jsxs("div",{className:"space-y-4 mb-10",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest",children:"Subtotal"}),e.jsxs("span",{className:"font-black text-xl tracking-tighter",children:[O()," ",R(o)]})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest",children:"I.G.V."}),e.jsxs("span",{className:"font-black text-xl tracking-tighter",children:[O()," ",R(d)]})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-neutral-400 tracking-widest",children:"Envío"}),e.jsx("span",{className:"font-black text-xl tracking-tighter",children:D>0?`${O()} ${R(D)}`:"GRATIS"})]}),(H>0||X>0)&&e.jsxs("div",{className:"flex justify-between items-end text-red-600",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Descuentos"}),e.jsxs("span",{className:"font-black text-xl tracking-tighter",children:["-",O()," ",R((H||0)+(X||0))]})]})]}),e.jsxs("div",{className:"bg-black text-white p-8 -mx-10 mb-10 text-center relative overflow-hidden group",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.5em] mb-4 opacity-30",children:"Total Final"}),e.jsxs("p",{className:"text-5xl font-black tracking-tighter italic",children:[O()," ",R(p)]}),e.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-5 scale-150 rotate-12 group-hover:rotate-0 transition-transform",children:e.jsx(_,{size:64})})]}),e.jsxs(ee,{type:"submit",className:"w-full h-24 text-xl flex items-center justify-between px-8",size:"lg",disabled:ae,children:[e.jsx("span",{children:ae?"Procesando...":"Proceder al Pago"}),e.jsx(b,{strokeWidth:4})]})]}),e.jsxs("div",{className:"border-2 border-black p-6 flex gap-4 items-start bg-neutral-50 shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]",children:[e.jsx(g,{className:"shrink-0"}),e.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest leading-relaxed text-neutral-400",children:"Tu pago será procesado de forma segura. Cumplimos con los estándares PCI-DSS de seguridad informática."})]})]})})]}),e.jsx(ne,{isOpen:Re,onClose:()=>Pe(!1),onPaymentComplete:async e=>{try{let i=0;switch(e){case"tarjeta":i=parseFloat(F.get("checkout_mercadopago_commission")||0);break;case"culqi":i=parseFloat(F.get("checkout_culqi_commission")||0);break;case"openpay":i=parseFloat(F.get("checkout_openpay_commission")||0);break;case"yape":i=parseFloat(F.get("checkout_dwallet_commission")||0);break;case"transferencia":i=parseFloat(F.get("checkout_transfer_commission")||0)}Ye(i),He(e),Pe(!1),Be(e);const n=me.find(e=>e.type===he),c=n?n.deliveryType:"domicilio",l=parseFloat(o)+parseFloat(d)+parseFloat(D)+parseFloat(P),p=Math.max(0,Qe(l-H)),x=Qe(p*(i/100)),m=Math.max(0,Qe(p+x)),u={user_id:r?.id||"",name:ie.name,lastname:ie.lastname,fullname:`${ie.name} ${ie.lastname}`,phone_prefix:ie.phone_prefix,email:ie.email,phone:(t=ie.phone_prefix,s=ie.phone,s?s.startsWith(t)?s:`${t}${s}`:""),country:"Perú",department:ie.department,province:ie.province,district:ie.district,ubigeo:ie.ubigeo,address:ie.address,number:ie.number,comment:ie.comment,reference:ie.reference,amount:m,delivery:D,delivery_type:c,additional_shipping_cost:P,additional_shipping_description:z||"",cart:a,details:JSON.stringify(a.map(e=>({id:e.id||e.item_id,quantity:e.quantity,price:e.final_price||e.price||0}))),invoiceType:ie.invoiceType,documentType:ie.documentType,document:ie.document,businessName:ie.businessName,payment_method:e,coupon_id:ye?ye.id:null,coupon_discount:H,payment_commission:x,payment_commission_percentage:i,automatic_discounts:Z,automatic_discount_total:X,applied_promotions:Z,promotion_discount:X,total_amount:m};if(Ge(u),"openpay"===e)Le(!0);else if("tarjeta"===e){se(!0);const e=await B(u);e.status?location.href=`${location.origin}/cart?code=${e.code}`:M.error("Pago rechazado")}else if("culqi"===e){se(!0);const e=await L(u);e.status?location.href=`${location.origin}/cart?code=${e.code}`:M.error(e.message||"Error en el pago")}else"yape"===e?qe(!0):"transferencia"===e&&Fe(!0)}catch(i){M.error("Ocurrió un error al procesar el pago")}finally{se(!1)}var t,s},contacts:A}),e.jsx(ce,{isOpen:$e,onClose:()=>Le(!1),onTokenCreated:async e=>{try{se(!0);const t={...Me,token_id:e.id,device_session_id:e.device_session_id},a=await W(t);a.status?location.href=`${location.origin}/cart?code=${a.code}`:M.error("Error en el pago con OpenPay")}catch(t){M.error("Error procesando pago con OpenPay")}finally{se(!1)}}}),e.jsx(Y,{isOpen:Ie,cart:a,subTotal:o,igv:d,totalFinal:Me?.total_amount||p,envio:D,request:Me,onClose:()=>qe(!1),paymentMethod:Ue,coupon:ye,descuentofinal:H,autoDiscountTotal:X,autoDiscounts:Z}),e.jsx(V,{isOpen:ze,cart:a,subTotal:o,igv:d,totalFinal:Me?.total_amount||p,envio:D,contacts:A,request:Me,onClose:()=>Fe(!1),paymentMethod:Ue,coupon:ye,descuentofinal:H,autoDiscountTotal:X,autoDiscounts:Z})]})}function pe({setCart:a,cart:s,code:r,delivery:i,data:c,automaticDiscounts:l=[],automaticDiscountTotal:o=0,couponDiscount:d=0,couponCode:p=null,conversionScripts:m=[]}){const[h,b]=n.useState(null),[g,f]=n.useState(!0),[j,k]=n.useState(null),[v,N]=n.useState(!1),y=n.useRef();if(n.useEffect(()=>{m&&Array.isArray(m)&&m.length>0&&m.forEach(e=>{try{const t=document.createElement("script");t.text=e,document.body.appendChild(t)}catch(t){}})},[m]),n.useEffect(()=>{r&&((async()=>{try{const e=await H({code:r});b(e.order)}catch(e){k(e.message)}finally{f(!1)}})(),S.Local.set(`${U.APP_CORRELATIVE}_cart`,[]),a([]))},[r]),g)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-40 bg-white",children:[e.jsx("div",{className:"w-20 h-20 border-[10px] border-black border-t-transparent animate-spin"}),e.jsx("p",{className:"mt-8 font-black uppercase tracking-[0.4em] text-xs",children:"Validando Orden..."})]});if(j||!h)return e.jsx("div",{className:"max-w-2xl mx-auto py-20 px-4",children:e.jsxs("div",{className:"border-[10px] border-black p-12 bg-red-50 text-center",children:[e.jsx("h2",{className:"text-4xl font-black uppercase tracking-tighter mb-4 text-red-600",children:"Error Crítico"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest leading-loose mb-10",children:j||"No se pudo recuperar la información de tu orden. Por favor contacta a soporte."}),e.jsx(ee,{onClick:()=>window.location.href="/catalogo",children:"Volver al Catálogo"})]})});const w=h?.items?.reduce((e,t)=>e+("combo"===t.type?t.final_price||t.price||0:t.price||0)*(t.quantity||0),0)||0,_=parseFloat((w/1.18).toFixed(2)),C=parseFloat((w-_).toFixed(2)),P=parseFloat(h.delivery||0),I=parseFloat(h.additional_shipping_cost||0),q=parseFloat(h.coupon_discount||0),F=parseFloat(h.automatic_discount_total||0),$=parseFloat(_)+parseFloat(C)+P+I-q-F;return e.jsxs("div",{className:"pt-8 pb-20 max-w-4xl mx-auto px-4",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"\n                @media print {\n                    .no-print { display: none !important; }\n                    .print-only { display: block !important; }\n                    body { \n                        background: white !important; \n                        padding: 0 !important;\n                        margin: 0 !important;\n                    }\n                    @page {\n                        size: A4;\n                        margin: 15mm;\n                    }\n                    * {\n                        -webkit-print-color-adjust: exact !important;\n                        print-color-adjust: exact !important;\n                    }\n                    .print-container {\n                        width: 100% !important;\n                        max-width: none !important;\n                        padding: 0 !important;\n                        margin: 0 !important;\n                        border: none !important;\n                        box-shadow: none !important;\n                    }\n                }\n            "}}),v&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-white bg-opacity-95 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center animate-in fade-in duration-300",children:[e.jsxs("div",{className:"relative w-24 h-24 mb-10",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-neutral-100 rounded-none"}),e.jsx("div",{className:"absolute inset-0 border-4 border-black border-t-transparent animate-spin rounded-none"})]}),e.jsx("h2",{className:"text-2xl font-black uppercase tracking-tighter mb-4",children:"Generando PDF"}),e.jsx("p",{className:"text-neutral-500 text-[10px] font-bold uppercase tracking-[0.3em] max-w-xs leading-relaxed",children:"Estamos preparando tu comprobante de orden. Por favor, no cierres esta ventana."})]}),e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-12",children:[e.jsxs("div",{className:"text-center mb-16 space-y-6",children:[e.jsx(z.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},className:"inline-flex items-center justify-center w-24 h-24 bg-black text-white rounded-full border-4 border-white shadow-xl mb-4",children:e.jsx(u,{size:48})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-5xl font-black uppercase tracking-tighter",children:"¡Orden Lista!"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.5em] text-neutral-400",children:"Gracias por tu preferencia"})]})]}),e.jsx("div",{ref:y,className:"grid md:grid-cols-12 gap-12",children:e.jsx("div",{className:"md:col-span-12",children:e.jsxs("div",{className:"print-container border-2 border-black bg-white shadow-[8px_8px_0px_0px_rgba(0,0,0,0.05)] overflow-hidden",children:[e.jsxs("div",{className:"bg-black text-white p-8 flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest opacity-40 mb-1",children:"Número de Orden"}),e.jsx("h4",{className:"text-3xl font-black tracking-tighter",children:r})]}),e.jsxs("div",{className:"text-center md:text-right",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest opacity-40 mb-1",children:"Estado"}),e.jsx("span",{className:"px-4 py-1 font-black text-xs uppercase tracking-widest bg-white  text-primary",children:h.status_name||"Pendiente"})]})]}),e.jsxs("div",{className:"p-8 space-y-12",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-[10px] font-black uppercase tracking-widest border-b-2 border-black pb-4 mb-6",children:"Artículos Adquiridos"}),e.jsxs("div",{className:"space-y-6",children:[(h.items||[]).map((t,a)=>e.jsxs("div",{className:"flex justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-black grayscale shrink-0 overflow-hidden",children:e.jsx("img",{src:t.image?`/storage/images/item/${t.image}`:"/assets/img/noimage/no_img.jpg",className:"w-full h-full object-cover",alt:t.name,onError:e=>e.target.src="/assets/img/noimage/no_img.jpg"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-black uppercase tracking-tight line-clamp-1",children:t.name}),e.jsxs("p",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-widest",children:["Cantidad:"," ",parseInt(t.quantity)," ","×"," ",O()," ",R(t.price||t.final_price)]})]})]}),e.jsxs("span",{className:"font-black text-sm",children:[O()," ",R((t.price||t.final_price)*t.quantity)]})]},a)),h.free_items&&h.free_items.length>0&&e.jsxs("div",{className:"pt-6 border-t-2 border-black border-dashed space-y-4",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-green-600 flex items-center gap-2",children:[e.jsx(x,{size:12}),"Artículos de Regalo"]}),h.free_items.map((t,a)=>e.jsxs("div",{className:"flex justify-between items-center gap-6 opacity-80",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-green-600 grayscale shrink-0 overflow-hidden bg-green-50",children:e.jsx("img",{src:t.image?`/storage/images/item/${t.image}`:"/assets/img/noimage/no_img.jpg",className:"w-full h-full object-cover",alt:t.name})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-black uppercase tracking-tight line-clamp-1",children:t.name}),e.jsxs("p",{className:"text-[10px] font-bold text-green-600 uppercase tracking-widest",children:["GIFT (CANT:"," ",parseInt(t.quantity),")"]})]})]}),e.jsx("span",{className:"font-black text-xs uppercase tracking-tighter text-green-600",children:"GRATIS"})]},`free-${a}`))]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-12 pt-8 border-t-2 border-black/5",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h5",{className:"text-[10px] font-black uppercase tracking-widest border-b-2 border-black pb-4",children:"Detalles de Envío"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(A,{className:"text-neutral-400 shrink-0",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-tight",children:"Dirección"}),e.jsxs("p",{className:"text-xs font-bold text-neutral-500 uppercase leading-relaxed",children:[h.address||("store_pickup"===h.delivery_type?"Recojo en tienda":"Coordinar con soporte"),h.address&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{className:"text-[9px] text-neutral-400",children:[h.district,","," ",h.provincia||h.province,","," ",h.departamento||h.department]})]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(t,{className:"text-neutral-400 shrink-0",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-tight",children:"Método"}),e.jsx("p",{className:"text-xs font-bold text-neutral-500 uppercase",children:"store_pickup"===h.delivery_type?"RECOJO EN TIENDA":"agency"===h.delivery_type?"ENVÍO POR AGENCIA":"DOMICILIO"})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(T,{className:"text-neutral-400 shrink-0",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-tight",children:"Fecha de Orden"}),e.jsx("p",{className:"text-xs font-bold text-neutral-500 uppercase",children:new Date(h.created_at).toLocaleDateString("es-PE",{day:"2-digit",month:"long",year:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"bg-neutral-50 p-6 border-2 border-black border-dashed flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-widest text-neutral-400",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[O()," ",R(_)]})]}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-widest text-neutral-400",children:[e.jsx("span",{children:"I.G.V."}),e.jsxs("span",{children:[O()," ",R(C)]})]}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-widest text-neutral-400",children:[e.jsx("span",{children:"Envío"}),e.jsx("span",{children:P>0?`${O()} ${R(P)}`:"Gratis"})]}),(q>0||F>0)&&e.jsxs("div",{className:"flex justify-between text-[10px] font-black uppercase tracking-widest text-red-600",children:[e.jsx("span",{children:"Beneficios (Dsctos)"}),e.jsxs("span",{children:["-",O()," ",R(q+F)]})]})]}),e.jsxs("div",{className:"pt-4 border-t-2 border-black flex justify-between items-end",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Total Final"}),e.jsxs("span",{className:"text-3xl font-black tracking-tighter",children:[O()," ",R($)]})]})]})]})]})]})})})]}),e.jsxs("div",{className:"mt-12 p-8 bg-neutral-100 border-2 border-black flex flex-col md:flex-row gap-4 no-print","data-html2canvas-ignore":"true",children:[e.jsxs(ee,{className:"flex-1 flex items-center justify-center gap-3",onClick:async()=>{N(!0),await new Promise(e=>setTimeout(e,500));try{const e=y.current,t=(await K(e,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"})).toDataURL("image/png"),a=new J("p","mm","a4"),s=a.getImageProperties(t),i=a.internal.pageSize.getWidth(),n=s.height*i/s.width;a.addImage(t,"PNG",0,0,i,n),a.save(`orden-${r}.pdf`)}catch(e){}finally{N(!1)}},disabled:v,children:[e.jsx(D,{size:18}),e.jsx("span",{children:"Descargar PDF"})]}),e.jsxs(ee,{variant:"secondary",className:"flex-1 flex items-center justify-center gap-3",onClick:()=>window.location.href="/catalogo",children:[e.jsx(E,{size:18}),e.jsx("span",{children:"Seguir Comprando"})]})]})]})}function xe({data:t,cart:a,setCart:s,user:r,ubigeos:i,prefixes:c,contacts:o,generals:d,categorias:p}){const[x,m]=n.useState(1),[u,b]=n.useState(0),[g,f]=n.useState(S.Local.get("dataCheckout")||{}),[j,k]=n.useState([]),[v,N]=n.useState(0),[y,w]=n.useState(0),[_,C]=n.useState(null),[A,T]=n.useState(0),[D,E]=n.useState(""),[O,R]=n.useState(g?.code||null),[P,I]=n.useState([]),[q,z]=n.useState(null),$={terms_conditions:"Términos y condiciones",privacy_policy:"Políticas de privacidad",delivery_policy:"Políticas de envío",saleback_policy:"Políticas de cambios y devoluciones"},G=()=>z(null),U=a.reduce((e,t)=>e+(t.type,t.final_price||t.price||0)*(t.quantity||0),0),Y=parseFloat(F.get("igv_checkout")||0);let V,H;Y>0?(V=U,H=parseFloat((U*(Y/100)).toFixed(2))):(V=parseFloat((U/1.18).toFixed(2)),H=parseFloat((U-V).toFixed(2)));const K=Number(V||0)+Number(H||0)+Number(u||0)+Number(A||0),J=Number(y||0)+Number(v||0),Q=Math.max(0,K-J);n.useEffect(()=>{S.Local.set("dataCheckout",g)},[g]),n.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("code");e&&(R(e),m(3))},[window.location.search]);const ee=async()=>{try{const e={...g,cart:a.map(e=>({id:e.id,quantity:e.quantity,price:e.final_price||e.price,type:e.type||"item"})),total:Q-(g.coupon_discount||0)-v,delivery:u,coupon_code:g.coupon_code,coupon_discount:g.coupon_discount,automatic_discount_total:v,automatic_discounts:j},t=new X,s=await t.save(e);s&&s.code?(R(s.code),I(s.conversion_scripts||[]),m(3),window.scrollTo(0,0)):s&&(R(s.code||s),m(3),window.scrollTo(0,0))}catch(e){M.error("Error al procesar la transferencia")}},te=async()=>{try{const e={...g,cart:a,total:Q-(g.coupon_discount||0)-v,delivery:u,automatic_discount_total:v,automatic_discounts:j};await B(e)}catch(e){}},se=async()=>{try{const e={...g,amount:Q-(g.coupon_discount||0)-v};await L(e)}catch(e){}},re=async()=>{try{const e={...g,amount:Q-(g.coupon_discount||0)-v};await W(e)}catch(e){}};return e.jsxs("section",{className:"bg-white min-h-screen",children:[e.jsxs("div",{className:"max-w-[1400px] mx-auto px-[5%]",children:[1===x&&e.jsx(ae,{data:t,cart:a,setCart:s,user:r,onContinue:()=>{m(2),window.scrollTo(0,0)},subTotal:V,envio:u,igv:H,totalFinal:Q,totalWithoutDiscounts:K,automaticDiscounts:j,setAutomaticDiscounts:k,automaticDiscountTotal:v,setAutomaticDiscountTotal:N,openModal:e=>z(e)}),2===x&&e.jsx(de,{data:t,cart:a,setCart:s,user:r,onContinue:async()=>{const e=g.payment_method;"mercadopago"===e?await te():"culqi"===e?await se():"openpay"===e?await re():"transferencia"===e?await ee():M.error("Método de pago no soportado")},onBack:()=>{m(1),window.scrollTo(0,0)},subTotal:V,envio:u,setEnvio:b,igv:H,totalFinal:Q,totalWithoutDiscounts:K,automaticDiscountTotal:v,automaticDiscounts:j,dataCheckout:g,setDataCheckout:f,ubigeos:i,prefixes:c,generals:d,contacts:o,additionalShippingCost:A,setAdditionalShippingCost:T,additionalShippingDescription:D,setAdditionalShippingDescription:E,couponDiscount:y,setCouponDiscount:w,setCouponCode:C,calculateAdditionalShippingCost:(e,t)=>{const a=F.get("additional_shipping_costs")||[];if(!Array.isArray(a)||0===a.length)return{cost:0,description:""};for(const s of a){if(!s.enabled)continue;if(!("all"===s.delivery_method||s.delivery_method===e))continue;const a=parseFloat(s.min_amount)||0,r=parseFloat(s.max_amount)||0;if(t>=a&&(0===r||t<=r))return{cost:parseFloat(s.additional_cost)||0,description:s.description||"Costo adicional de envío"}}return{cost:0,description:""}},openModal:e=>z(e)}),3===x&&e.jsx(pe,{code:O,cart:a,setCart:s,data:t,conversionScripts:P}),e.jsxs("div",{className:"py-12 border-t border-black/5",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-x-8 gap-y-4",children:Object.keys($).map(t=>e.jsxs("button",{onClick:()=>z(t),className:"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400 hover:text-black transition-colors",children:["[ ",$[t]," ]"]},t))}),e.jsxs("p",{className:"text-center text-[9px] font-bold text-neutral-300 mt-8 uppercase tracking-widest",children:["© ",(new Date).getFullYear()," Rainstar. Todos los derechos reservados."]})]})]}),Object.keys($).map(t=>{const a=$[t],s=d.find(e=>e.correlative==t)?.description??"";return e.jsx(h,{isOpen:q===t,onRequestClose:G,contentLabel:a,className:"fixed inset-0 flex items-center justify-center p-4 z-[10000]",overlayClassName:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[9999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white border-2 border-black w-full max-w-4xl max-h-[90vh] flex flex-col shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[e.jsxs("div",{className:"flex items-center justify-between p-8 border-b-2 border-black bg-black text-white",children:[e.jsx("h2",{className:"text-2xl font-black uppercase tracking-tighter",children:a}),e.jsx("button",{onClick:G,className:"hover:rotate-90 transition-transform p-2 border-2 border-white/20 hover:border-white",children:e.jsx(l,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 prose prose-neutral max-w-none",children:e.jsx(Z,{html:s})}),e.jsx("div",{className:"p-8 border-t-2 border-black bg-neutral-50 flex justify-end",children:e.jsx("button",{onClick:G,className:"px-8 py-3 bg-black text-white font-black uppercase text-xs tracking-[0.2em] hover:bg-neutral-800 transition-colors",children:"Entendido"})})]})},t)})]})}export{xe as default};

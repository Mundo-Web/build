import{m as r}from"./vendor-react-SBvaUJTK.js";import{G as e}from"./Footer-BligNWSa.js";import{t as o}from"./OpenPayCardModal-C0HhlOHJ.js";const i=e=>new Promise(async(o,i)=>{try{const{status:a,result:n}=await r.Fetch("./api/mercadopago/preference",{method:"POST",body:JSON.stringify(e)});if(!a||!n.preference_id)return r.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:n?.message||"Error al crear la preferencia de pago",type:"danger"}),void i(n?.message||"Error al crear la preferencia de pago");new window.MercadoPago(n.public_key,{locale:"es-PE"});setTimeout(()=>{window.location.href=n.redirect_url},500),o(n)}catch(a){r.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message||"Error en la integración con MercadoPago",type:"danger"}),i(a.message||"Error en la integración con MercadoPago")}});const a=i=>new Promise(async(a,n)=>{try{if(void 0===window.OpenPay)return void n("Error en la integración con OpenPay: Script no cargado");const t=window.OPENPAY_MERCHANT_ID||e.OPENPAY_MERCHANT_ID,s=window.OPENPAY_PUBLIC_KEY||e.OPENPAY_PUBLIC_KEY;void 0!==window.OPENPAY_SANDBOX_MODE?window.OPENPAY_SANDBOX_MODE:e.OPENPAY_SANDBOX_MODE;if(!t||!s)return void n("Error de configuración: Credenciales de OpenPay no encontradas");const c=function(){let r="";for(let e=0;e<12;e++)r+=Math.floor(10*Math.random());return r}();if(!i.source_id&&!i.token)return void n("Error: Token de tarjeta no proporcionado");if(!i.device_session_id)return void n("Error: device_session_id no proporcionado (requerido para antifraude)");const d={...i,orderNumber:c,method:"card",source_id:i.source_id||i.token,device_session_id:i.device_session_id},{status:p,result:g}=await r.Fetch("./api/openpay/charge",{method:"POST",body:JSON.stringify(d)});if(!p)return o.error("Error en el pago",{description:g?.message||"No se pudo procesar el pago",duration:3e3,position:"top-right",richColors:!0}),void n(g?.message||"Error al procesar el pago");o.success("¡Pago exitoso!",{description:"Tu pago se procesó correctamente. Pronto recibirás la confirmación de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),a(g)}catch(t){o.error("Error en el pago",{description:t.message||"Error en la integración con OpenPay",duration:3e3,position:"top-right",richColors:!0}),n(t.message||"Error en la integración con OpenPay")}});export{a,i as p};

var I=Object.defineProperty;var G=(a,o,c)=>o in a?I(a,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[o]=c;var F=(a,o,c)=>G(a,typeof o!="symbol"?o+"":o,c);import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as M}from"./Base-C3itgJ7e.js";import{S as D}from"./SwitchFormGroup-DXN0cwVk.js";import{T as L}from"./TextareaFormGroup-CliirJM1.js";import{r as g}from"./index-BOnQTV8N.js";import{c as A}from"./ReactAppend-QR5TrZfj.js";import{S as y}from"./CartKuchara-D9l7c7at.js";import{B as O}from"./BasicRest-BML1C-ua.js";import{I as N}from"./ImageFormGroup-40MuGzez.js";import{M as P}from"./Modal-xDw9ufjg.js";import{T as z}from"./Table-O7_BONvQ.js";import{D as C}from"./DxButton-DV0H-ZcL.js";import{C as q,F as m,h as V}from"./CreateReactScript-BVFa7_vB.js";import{R as h}from"./ReactAppend-Vm5G2nof.js";import{B as d}from"./BooleanLimit-D-OsQsek.js";import{I as K}from"./InputFormGroup-iZIO11ZN.js";import"./index-yBjzXJbu.js";import"./Global-Bz6gVLc5.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-BOTQKW2g.js";import"./CardProductKatya-ncpmQ0JU.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";class H extends O{constructor(){super(...arguments);F(this,"path","admin/service-categories");F(this,"hasFiles",!0)}}const p=new H,J=()=>{const a=g.useRef(),o=g.useRef(),c="service_categories",x=g.useRef(),v=g.useRef(),u=g.useRef(),n=g.useRef(),l=g.useRef(),[E,w]=g.useState(!1),R=e=>{e!=null&&e.id?w(!0):w(!1),x.current.value=(e==null?void 0:e.id)??"",v.current.value=(e==null?void 0:e.name)??"",u.current&&(u.current.value=(e==null?void 0:e.description)??""),n.current&&n.image&&(n.image.src=e!=null&&e.banner?`/storage/images/service_category/${e.banner}`:"",n.current.value=null,n.resetDeleteFlag&&n.resetDeleteFlag()),l.current&&l.image&&(l.image.src=e!=null&&e.image?`/storage/images/service_category/${e.image}`:"",l.current.value=null,l.resetDeleteFlag&&l.resetDeleteFlag()),$(o.current).modal("show")},B=async e=>{e.preventDefault();const s={id:x.current.value||void 0,name:v.current.value,description:u.current.value},i=new FormData;for(const t in s)i.append(t,s[t]);if(l.current){const t=l.current.files[0];t&&i.append("image",t),l.getDeleteFlag&&l.getDeleteFlag()&&i.append("image_delete","DELETE")}if(n.current){const t=n.current.files[0];t&&i.append("banner",t),n.getDeleteFlag&&n.getDeleteFlag()&&i.append("banner_delete","DELETE")}await p.save(i)&&(n.current&&n.resetDeleteFlag&&n.resetDeleteFlag(),l.current&&l.resetDeleteFlag&&l.resetDeleteFlag(),$(a.current).dxDataGrid("instance").refresh(),$(o.current).modal("hide"))},_=async({id:e,value:s,previous:i})=>{if(s&&d.shouldBlock(c,"featured",i)){const t=d.get(c,"featured");let j=(t==null?void 0:t.message)??"Se alcanzó el límite de categorías de servicios destacadas.";t&&(j+=` Actualmente hay ${t.active??0} de ${t.max??0} categorías activas.`,V("Root")&&t.general_key&&(j+=` Puedes ajustar el límite en Generales usando la clave ${t.general_key}.`)),y.fire({icon:"warning",title:"Límite alcanzado",text:j});return}const f=await p.boolean({id:e,field:"featured",value:s});f&&(d.has(c,"featured")&&(typeof f=="object"&&(f!=null&&f.limit)?d.updateFromServer(c,f):d.applyChange(c,"featured",{previous:i,next:s})),$(a.current).dxDataGrid("instance").refresh())},S=async({id:e,value:s})=>{await p.boolean({id:e,field:"visible",value:s})&&$(a.current).dxDataGrid("instance").refresh()},T=async e=>{const{isConfirmed:s}=await y.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!s||!await p.delete(e.id)||(d.has(c,"featured")&&e.featured&&d.applyChange(c,"featured",{previous:!0,next:!1}),$(a.current).dxDataGrid("instance").refresh())},k=async e=>{const s=e.toIndex;try{await p.reorder(e.itemData.id,s)&&await e.component.refresh()}catch(i){console.error("Error reordering service category:",i)}};return r.jsxs(r.Fragment,{children:[r.jsx(z,{gridRef:a,title:"Categorías de Servicios",rest:p,rowDragging:{allowReordering:!0,onReorder:k,dropFeedbackMode:"push"},sorting:{mode:"single"},toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>R()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"order_index",caption:"Orden",visible:!1,sortOrder:"asc",sortIndex:0},{dataField:"name",caption:"Categoría",width:"30%"},m.has("service_categories","description")&&{dataField:"description",caption:"Descripción",width:"50%"},m.has("service_categories","image")&&{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:s})=>{h(e,r.jsx("img",{src:`/storage/images/service_category/${s.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:i=>i.target.src="/api/cover/thumbnail/null"}))}},m.has("service_categories","banner")&&{dataField:"banner",caption:"Banner",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:s})=>{h(e,r.jsx("img",{src:`/storage/images/service_category/${s.banner}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:i=>i.target.src="/api/cover/thumbnail/null"}))}},m.has("service_categories","featured")&&{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:s})=>{$(e).empty();const i=s.featured==1,t=d.has(c,"featured")&&d.shouldBlock(c,"featured",i),b=t?d.getMessage(c,"featured"):null;b?$(e).attr("title",b):$(e).removeAttr("title"),h(e,r.jsx(D,{checked:i,disabled:t,onChange:()=>_({id:s.id,value:!i,previous:i})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:s})=>{$(e).empty(),h(e,r.jsx(D,{checked:s.visible==1,onChange:()=>S({id:s.id,value:!s.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(C({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>R(s)})),e.append(C({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>T(s)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(P,{modalRef:o,title:E?"Editar categoría de servicio":"Agregar categoría de servicio",onSubmit:B,size:"lg",children:[r.jsx("input",{ref:x,type:"hidden"}),r.jsx("div",{id:"service-categories-container",children:r.jsxs("div",{className:"row g-3",children:[r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card border-0 shadow-sm",children:[r.jsx("div",{className:"card-header bg-light",children:r.jsxs("h6",{className:"mb-0",children:[r.jsx("i",{className:"fas fa-info-circle me-2 text-primary"}),"Información Básica"]})}),r.jsx("div",{className:"card-body",children:r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-12",children:r.jsx(K,{eRef:v,label:"Nombre de la Categoría",placeholder:"Ej: Cirugías Bariátricas",required:!0})}),m.has("service_categories","description")&&r.jsx("div",{className:"col-12",children:r.jsx(L,{eRef:u,label:"Descripción",rows:4,placeholder:"Descripción detallada de la categoría..."})})]})})]})}),(m.has("service_categories","banner")||m.has("service_categories","image"))&&r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card border-0 shadow-sm",children:[r.jsx("div",{className:"card-header bg-light",children:r.jsxs("h6",{className:"mb-0",children:[r.jsx("i",{className:"fas fa-images me-2 text-success"}),"Multimedia"]})}),r.jsx("div",{className:"card-body",children:r.jsxs("div",{className:"row g-3",children:[m.has("service_categories","banner")&&r.jsxs("div",{className:"col-md-6",children:[r.jsx(N,{eRef:n,name:"banner",label:"Banner Principal",col:"col-12",aspect:1/1}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"fas fa-info-circle me-1"}),"Recomendado: 1200x400px (proporción 3:1)"]})]}),m.has("service_categories","image")&&r.jsxs("div",{className:"col-md-6",children:[r.jsx(N,{eRef:l,name:"image",label:"Icono / Imagen del Servicio",col:"col-12",aspect:1/1}),r.jsxs("small",{className:"text-muted",children:[r.jsx("i",{className:"fas fa-info-circle me-1"}),"Recomendado: 1600x900px (proporción 16:9)"]})]})]})})]})})]})})]})]})};q((a,o)=>{A.createRoot(a).render(r.jsx(M,{...o,title:"Categorías de Servicios",children:r.jsx(J,{...o})}))});

import{r as e,j as s,f as t,i as a,bz as l,m as r}from"./vendor-react-SBvaUJTK.js";import{t as n}from"./OpenPayCardModal-C0HhlOHJ.js";import{G as o}from"./Footer-BligNWSa.js";import"./ShippingStep-BtY0Ow3m.js";import{C as c,N as i}from"./Number2Currency-BX4epFEo.js";import"./VoucherUpload-BLNakoW3.js";import{G as d}from"./General-ClVW7qxN.js";import{S as m}from"./SalesRest-vA4KDG2S.js";import{B as x}from"./BancDropDown-FaFwF0Mb.js";import"./vendor-swiper-Cr_RrIb_.js";import"./filepond-plugin-image-preview-DXJLhvZS.js";import"./CartKuchara-8a8jAeu-.js";import"./BasicRest-Cgj77E-j.js";import"./BooleanLimit-q2Ad9fGY.js";const p=new m;function u({isOpen:m,onClose:x,onUpload:u,paymentMethod:h,cart:j=[],subTotal:f,igv:b,envio:g,totalFinal:N,request:y,coupon:v=null,descuentofinal:w=0,autoDiscounts:k=[],autoDiscountTotal:C=0}){const[E,_]=e.useState(null),[$,R]=e.useState(!1),[S,D]=e.useState(""),O=e.useRef(null),P=async()=>{if(!$)if(S){R(!0);try{const e={...y,payment_proof:S,delivery_type:y.delivery_type||"domicilio",applied_promotions:y.applied_promotions?"string"==typeof y.applied_promotions?y.applied_promotions:JSON.stringify(y.applied_promotions):null},s=new FormData;Object.keys(e).forEach(t=>{null!==e[t]&&void 0!==e[t]&&s.append(t,e[t])});const t=await p.save(s);t&&(r.Local.delete(`${o.APP_CORRELATIVE}_cart`),location.href=`${location.origin}/cart?code=${t.code}`)}catch(e){n.error("Error al procesar el pago:",{description:"Ocurrió un error al procesar tu pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}finally{R(!1)}}else n.error("Error al subir comprobante",{description:"Por favor, sube tu comprobante de pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})};return e.useEffect(()=>(document.body.style.overflow=m?"hidden":"",()=>{document.body.style.overflow=""}),[m]),s.jsx(t,{isOpen:m,onRequestClose:x,className:"absolute left-1/2 -translate-x-1/2 bg-[#f5f5f5] rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden font-paragraph",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:s.jsxs("div",{className:"py-6 px-10 flex flex-col gap-3 max-h-[90vh] md:max-h-[95vh] overflow-y-auto",children:[s.jsx("div",{className:"flex justify-center items-center z-40",children:s.jsx("a",{href:"/",className:"flex items-center gap-2",children:s.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:o.APP_NAME,className:"h-14 object-contain object-center",onError:e=>{e.target.onerror=null,e.target.src="/assets/img/logo-bk.svg"}})})}),s.jsx("h2",{className:"text-xl 2xl:text-2xl font-bold customtext-primary text-center mt-3",children:d.get("checkout_dwallet_name")}),s.jsx("p",{className:"customtext-primary text-sm 2xl:text-base text-center",children:d.get("checkout_dwallet_description")}),s.jsx("div",{className:"w-full flex flex-row items-center justify-center my-1",children:s.jsx(a,{content:"Escanee codigo QR",children:s.jsx("img",{src:`/assets/resources/${d.get("checkout_dwallet_qr")}`,alt:d.get("checkout_dwallet_name"),className:"h-40 w-auto object-cover",onError:e=>{e.currentTarget.src="/assets/img/salafabulosa/logoyape.png"}})})}),s.jsxs("div",{className:"bg-[#EAE8E6] rounded-xl shadow-lg p-6 col-span-2 h-max font-paragraph",children:[s.jsx("h3",{className:"text-xl 2xl:text-2xl font-semibold pb-6 customtext-neutral-dark",children:"Detalle de compras"}),s.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:j.map((e,t)=>s.jsx("div",{className:"rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"bg-white p-0 rounded-xl",children:s.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover rounded  "})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold customtext-neutral-dark text-sm 2xl:text-base mb-1",children:e.name}),e?.color&&s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Color:"," ",s.jsx("span",{className:"customtext-neutral-dark",children:e.color})]}),s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Cantidad:"," ",s.jsxs("span",{className:"customtext-neutral-dark",children:[e.quantity," "]})]})]})]})},e.id))}),s.jsxs("div",{className:"space-y-2 mt-6 bg-white p-4 rounded-xl",children:[s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),s.jsxs("span",{className:"font-semibold",children:[c()," ",i(f)]})]}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),s.jsxs("span",{className:"font-semibold",children:[c()," ",i(b)]})]}),v&&s.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[s.jsxs("span",{children:["Cupón aplicado"," ",s.jsx(a,{content:"Eliminar",children:s.jsx("i",{className:"mdi mdi-close text-red-500 cursor-pointer",onClick:()=>setCoupon(null)})}),s.jsxs("small",{className:"block text-xs font-light",children:[v.code," ",s.jsx(a,{content:v.description,children:s.jsx("i",{className:"mdi mdi-information-outline ms-1"})})," ","(","percentage"===v.type?`${v.value}%`:`${c()} ${i(v.value)}`,")"]})]}),s.jsxs("span",{children:[c()," -",i(w)]})]}),k&&k.length>0&&s.jsx("div",{className:"mb-2 mt-2 border-b pb-2",children:s.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[s.jsx("span",{children:"Total descuentos automáticos:"}),s.jsxs("span",{children:[c()," -",i(C)]})]})}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),s.jsxs("span",{className:"font-semibold",children:[c()," ",i(g)]})]}),s.jsx("div",{className:"py-1 border-y",children:s.jsxs("div",{className:"flex justify-between font-bold text-lg 2xl:text-xl items-center",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:[c()," ",i(N)]})]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("input",{type:"file",ref:O,onChange:e=>{const s=e.target.files[0];s&&D(s)},accept:"image/png, image/jpeg, application/pdf",className:"hidden"}),S&&s.jsxs("div",{className:"bg-[#f1f1f1] p-4 rounded-lg border border-dashed",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm truncate",children:S.name}),s.jsx("button",{onClick:()=>{D(""),O.current&&(O.current.value="")},className:"text-red-500 hover:text-red-700",children:s.jsx(l,{className:"h-5 w-5"})})]}),S.type.startsWith("image/")&&s.jsx("div",{className:"mt-2",children:s.jsx("img",{src:URL.createObjectURL(S),alt:"Voucher preview",className:"max-h-28 mx-auto"})})]}),s.jsxs("div",{className:"pt-2 space-y-3",children:[s.jsx("button",{onClick:()=>{S?P():O.current?.click()},disabled:$,className:"w-full bg-primary text-white text-sm 2xl:text-base py-3 rounded-3xl font-medium "+($?"opacity-70 cursor-not-allowed":""),children:$?"Procesando...":S?"Confirmar pago":"Subir la captura del pago"}),s.jsx("button",{onClick:x,className:"w-full border border-primary text-sm 2xl:text-base py-3 rounded-3xl font-medium",children:"Cancelar"})]})]})]})})}const h=new m;function j({isOpen:d,onClose:m,onUpload:p,paymentMethod:u,cart:j=[],subTotal:f,igv:b,envio:g,totalFinal:N,request:y,contacts:v=[],coupon:w=null,descuentofinal:k=0,autoDiscounts:C=[],autoDiscountTotal:E=0}){const[_,$]=e.useState(null),[R,S]=e.useState(!1),[D,O]=e.useState(""),P=e.useRef(null),A=async()=>{if(!R)if(D){S(!0);try{const e={...y,payment_proof:D},s=new FormData;Object.keys(e).forEach(t=>{s.append(t,e[t])});const t=await h.save(s);t&&(r.Local.delete(`${o.APP_CORRELATIVE}_cart`),location.href=`${location.origin}/cart?code=${t.code}`)}catch(e){n.error("Error al procesar el pago:",{description:"Ocurrió un error al procesar tu pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}finally{S(!1)}}else n.error("Error al subir comprobante",{description:"Por favor, sube tu comprobante de pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})};return e.useEffect(()=>(document.body.style.overflow=d?"hidden":"",()=>{document.body.style.overflow=""}),[d]),s.jsx(t,{isOpen:d,onRequestClose:m,className:"absolute left-1/2 -translate-x-1/2 bg-[#f5f5f5] rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden font-paragraph",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:s.jsxs("div",{className:"py-6 px-10 flex flex-col gap-3 max-h-[90vh] md:max-h-[95vh] overflow-y-auto font-paragraph",children:[s.jsx("div",{className:"flex justify-center items-center z-40",children:s.jsx("a",{href:"/",className:"flex items-center gap-2",children:s.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:o.APP_NAME,className:"h-14 object-contain object-center",onError:e=>{e.target.onerror=null,e.target.src="/assets/img/logo-bk.svg"}})})}),s.jsx("h2",{className:"text-xl 2xl:text-2xl font-bold customtext-primary text-center mt-3",children:"Felicitaciones!"}),s.jsx("p",{className:"customtext-primary mb-1 text-sm 2xl:text-base text-center",children:"Estás a un paso de completar tu compra, realiza la transferencia/depósito a nuestras cuentas."}),s.jsx("div",{className:"p-4 rounded-3xl bg-[#EAE8E6] flex flex-col gap-3 items-center",children:s.jsx("div",{className:"flex flex-col gap-3 w-full",children:s.jsx(x,{contacts:v})})}),s.jsxs("div",{className:"bg-[#EAE8E6] rounded-xl shadow-lg p-6 col-span-2 h-max font-paragraph",children:[s.jsx("h3",{className:"text-xl 2xl:text-2xl font-semibold pb-6 customtext-neutral-dark",children:"Detalle de compras"}),s.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:j.map((e,t)=>s.jsx("div",{className:"rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"bg-white p-0 rounded-xl",children:s.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover rounded  "})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold customtext-neutral-dark text-sm 2xl:text-base mb-1",children:e.name}),s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Color:"," ",s.jsx("span",{className:"customtext-neutral-dark",children:e.color})]}),s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Cantidad:"," ",s.jsxs("span",{className:"customtext-neutral-dark",children:[e.quantity," "]})]})]})]})},e.id))}),s.jsxs("div",{className:"space-y-2 mt-6 bg-white p-4 rounded-xl",children:[s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),s.jsxs("span",{className:"font-semibold",children:[c()," ",i(f)]})]}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),s.jsxs("span",{className:"font-semibold",children:[c()," ",i(b)]})]}),w&&s.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[s.jsxs("span",{children:["Cupón aplicado"," ",s.jsx(a,{content:"Eliminar",children:s.jsx("i",{className:"mdi mdi-close text-red-500 cursor-pointer",onClick:()=>setCoupon(null)})}),s.jsxs("small",{className:"block text-xs font-light",children:[w.name," ",s.jsx(a,{content:w.description,children:s.jsx("i",{className:"mdi mdi-information-outline ms-1"})})," ","(","percentage"===w.type?`-${Math.round(100*w.amount)/100}%`:`${c()} -${i(w.amount)}`,")"]})]}),s.jsxs("span",{children:[c()," -",i(k)]})]}),C&&C.length>0&&s.jsxs("div",{className:"mb-2 mt-2 border-b pb-2",children:[s.jsx("div",{className:"text-sm font-bold text-green-600 mb-1",children:"Descuentos automáticos aplicados:"}),C.map((e,t)=>s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsxs("span",{className:"text-green-700",children:[e.rule_name||e.name||"Descuento automático",s.jsx("small",{className:"block text-xs font-light text-gray-600",children:e.description||"Promoción especial"})]}),s.jsxs("span",{className:"font-semibold text-green-600",children:[c()," -",i(e.discount_amount||e.amount||0)]})]},t)),s.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[s.jsx("span",{children:"Total descuentos automáticos:"}),s.jsxs("span",{children:[c()," -",i(E)]})]})]}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),s.jsxs("span",{className:"font-semibold",children:[c()," ",i(g)]})]}),s.jsx("div",{className:"py-1 border-y",children:s.jsxs("div",{className:"flex justify-between font-bold text-lg 2xl:text-xl items-center",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:[c()," ",i(N)]})]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("input",{type:"file",ref:P,onChange:e=>{const s=e.target.files[0];s&&O(s)},accept:"image/png, image/jpeg, application/pdf",className:"hidden"}),D&&s.jsxs("div",{className:"bg-[#f1f1f1] p-4 rounded-lg border border-dashed",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm truncate",children:D.name}),s.jsx("button",{onClick:()=>{O(""),P.current&&(P.current.value="")},className:"text-red-500 hover:text-red-700",children:s.jsx(l,{className:"h-5 w-5"})})]}),D.type.startsWith("image/")&&s.jsx("div",{className:"mt-2",children:s.jsx("img",{src:URL.createObjectURL(D),alt:"Voucher preview",className:"max-h-28 mx-auto"})})]}),s.jsxs("div",{className:"pt-2 space-y-3",children:[s.jsx("button",{onClick:()=>{D?A():P.current?.click()},disabled:R,className:"w-full bg-primary text-white text-sm 2xl:text-base py-3 rounded-3xl font-medium "+(R?"opacity-70 cursor-not-allowed":""),children:R?"Procesando...":D?"Confirmar pago":"Subir la captura del pago"}),s.jsx("button",{onClick:m,className:"w-full border border-primary text-sm 2xl:text-base py-3 rounded-3xl font-medium",children:"Cancelar"})]})]})]})})}export{u as U,j as a};

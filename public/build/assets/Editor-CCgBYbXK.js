import{r as e,j as s,ax as a,ay as t,E as l,az as i,aA as n,I as r,aB as o,aC as c,aD as d,aE as m,aF as g,T as u,P as x,aG as p,aH as h,a9 as f,aI as y,aJ as b,aK as j,aL as v,aM as w,aN as N,aO as k,aP as C,aQ as S,au as $,aR as E,aS as M,aT as D,aU as z,aV as F}from"./vendor-react-BX-OgZ1w.js";import{h as V,F as R}from"./EditorLayout-DgQgJohA.js";import"./vendor-swiper-Cr_RrIb_.js";const A=[{id:"layout-1",name:"Cuatro fotos",template:"grid-cols-2 grid-rows-2 gap-4",cells:4,maskCategories:[{name:"Básicas",masks:["none","circle","rounded","square","rounded-sm","rounded-lg","rounded-full","rounded-rect"]},{name:"Formas",masks:["heart","star","hexagon","triangle","diamond","badge","speech","burst"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave","diagonal","bevel","poster","inner-frame"]},{name:"Creativas",masks:["leaf","cloud","flower","ornate","blob1","blob2","blob3"]}]},{id:"layout-2",name:"Dos fotos horizontales",template:"grid-rows-2",cells:2,maskCategories:[{name:"Básicas",masks:["none","circle","rounded","square"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave"]}]},{id:"layout-3",name:"Tres fotos mixtas",template:"grid-cols-3 [grid-template-columns:1fr_2fr]",cells:3,maskCategories:[{name:"Formas",masks:["heart","star","hexagon","triangle"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave"]}]},{id:"layout-4",name:"Collage 2x2",template:"grid-cols-2 grid-rows-2",cells:4,maskCategories:[{name:"Básicas",masks:["none","circle","rounded"]},{name:"Formas",masks:["heart","star","hexagon"]}]},{id:"layout-5",name:"Mosaico",template:"grid-cols-3 grid-rows-2",cells:6,maskCategories:[{name:"Básicas",masks:["none","circle","square"]},{name:"Creativas",masks:["leaf","cloud","flower"]}]}],B=[{id:"none",name:"Sin máscara",class:"",category:"Básicas",icon:s.jsx(p,{className:"h-4 w-4"})},{id:"circle",name:"Círculo",class:"rounded-full",category:"Básicas",icon:s.jsx(h,{className:"h-4 w-4"})},{id:"rounded",name:"Redondeado",class:"rounded-xl",category:"Básicas",icon:s.jsx(p,{className:"h-4 w-4 rounded-md"})},{id:"square",name:"Cuadrado",class:"",category:"Básicas",icon:s.jsx(p,{className:"h-4 w-4"})},{id:"heart",name:"Corazón",class:"mask-heart",category:"Formas",icon:s.jsx(f,{className:"h-4 w-4"})},{id:"star",name:"Estrella",class:"mask-star-2",category:"Formas",icon:s.jsx(y,{className:"h-4 w-4"})},{id:"hexagon",name:"Hexágono",class:"mask-hexagon",category:"Formas",icon:s.jsx(b,{className:"h-4 w-4"})},{id:"triangle",name:"Triángulo",class:"mask-triangle",category:"Formas",icon:s.jsx("div",{className:"w-4 h-4 bg-current clip-triangle"})},{id:"diamond",name:"Diamante",class:"mask-diamond",category:"Formas",icon:s.jsx(j,{className:"h-4 w-4"})},{id:"polaroid",name:"Polaroid",class:"mask-polaroid",category:"Fotográficos",icon:s.jsx(v,{className:"h-4 w-4"})},{id:"vintage",name:"Vintage",class:"mask-vintage",category:"Fotográficos",icon:s.jsx(w,{className:"h-4 w-4"})},{id:"wave",name:"Onda",class:"mask-wave",category:"Fotográficos",icon:s.jsx(N,{className:"h-4 w-4"})},{id:"diagonal",name:"Diagonal",class:"mask-diagonal",category:"Fotográficos",icon:s.jsx("div",{className:"w-4 h-4 bg-current clip-diagonal"})},{id:"frame",name:"Marco",class:"mask-frame",category:"Fotográficos",icon:s.jsx(p,{className:"h-4 w-4"})},{id:"leaf",name:"Hoja",class:"mask-leaf",category:"Creativas",icon:s.jsx(w,{className:"h-4 w-4"})},{id:"cloud",name:"Nube",class:"mask-cloud",category:"Creativas",icon:s.jsx(k,{className:"h-4 w-4"})},{id:"flower",name:"Flor",class:"mask-flower",category:"Creativas",icon:s.jsx(C,{className:"h-4 w-4"})},{id:"ornate",name:"Ornamento",class:"mask-ornate",category:"Creativas",icon:s.jsx("div",{className:"w-4 h-4 bg-current clip-ornate"})},{id:"blob1",name:"Mancha 1",class:"mask-blob1",category:"Creativas",icon:s.jsx("div",{className:"w-4 h-4 bg-current rounded-full"})},{id:"blob2",name:"Mancha 2",class:"mask-blob2",category:"Creativas",icon:s.jsx("div",{className:"w-4 h-4 bg-current rounded-full"})},{id:"blob3",name:"Mancha 3",class:"mask-blob3",category:"Creativas",icon:s.jsx("div",{className:"w-4 h-4 bg-current rounded-full"})},{id:"rounded-sm",name:"Redondeado pequeño",class:"rounded-md",category:"Básicas",icon:s.jsx(p,{className:"h-4 w-4 rounded-sm"})},{id:"rounded-lg",name:"Redondeado grande",class:"rounded-2xl",category:"Básicas",icon:s.jsx(p,{className:"h-4 w-4 rounded-lg"})},{id:"rounded-full",name:"Círculo perfecto",class:"rounded-full",category:"Básicas",icon:s.jsx(h,{className:"h-4 w-4"})},{id:"bevel",name:"Biselado",class:"mask-bevel",category:"Fotográficos",icon:s.jsx(p,{className:"h-4 w-4"})},{id:"poster",name:"Poster",class:"mask-poster",category:"Fotográficos",icon:s.jsx(v,{className:"h-4 w-4"})},{id:"badge",name:"Insignia",class:"mask-badge",category:"Formas",icon:s.jsx("div",{className:"w-4 h-4 bg-current clip-badge"})},{id:"speech",name:"Globo de texto",class:"mask-speech",category:"Formas",icon:s.jsx("div",{className:"w-4 h-4 bg-current clip-speech"})},{id:"burst",name:"Estallido",class:"mask-burst",category:"Formas",icon:s.jsx(N,{className:"h-4 w-4"})},{id:"rounded-rect",name:"Rectángulo redondeado",class:"mask-rounded-rect",category:"Básicas",icon:s.jsx(p,{className:"h-4 w-4 rounded-md"})},{id:"inner-frame",name:"Marco interno",class:"mask-inner-frame",category:"Fotográficos",icon:s.jsx(p,{className:"h-4 w-4"})}],H=["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],L=[{name:"Normal",filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0}},{name:"Vintage",filters:{brightness:90,contrast:110,saturation:80,tint:20,hue:10,blur:1}},{name:"Blanco y negro",filters:{brightness:100,contrast:120,saturation:0,tint:0,hue:0,blur:0}},{name:"Brillante",filters:{brightness:120,contrast:90,saturation:120,tint:0,hue:0,blur:0}},{name:"Oscuro",filters:{brightness:80,contrast:120,saturation:90,tint:10,hue:0,blur:1}},{name:"Sepia",filters:{brightness:90,contrast:100,saturation:50,tint:80,hue:0,blur:0}},{name:"Cálido",filters:{brightness:100,contrast:100,saturation:110,tint:15,hue:20,blur:0}},{name:"Frío",filters:{brightness:100,contrast:100,saturation:110,tint:0,hue:200,blur:0}}],P=({children:e,onClick:a,className:t="",variant:l="default",size:i="default",disabled:n=!1,icon:r=null})=>s.jsxs("button",{className:`inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background ${{default:"bg-purple-600 text-white hover:bg-purple-700",outline:"border border-input hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",secondary:"bg-gray-100 text-gray-800 hover:bg-gray-200"}[l]} ${{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md text-sm",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10","icon-sm":"h-8 w-8"}[i]} ${t} gap-2`,onClick:a,disabled:n,children:[r&&s.jsx("span",{className:"w-4 h-4",children:r}),e]}),I=({value:a=[50],min:t=0,max:l=100,step:i=1,onValueChange:n,label:r,unit:o="%"})=>{const[c,d]=e.useState(a[0]);return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r}),s.jsxs("span",{className:"text-sm text-gray-500",children:[c,o]})]}),s.jsx("div",{className:"relative flex w-full touch-none select-none items-center",children:s.jsx("input",{type:"range",min:t,max:l,step:i,value:c,onChange:e=>{const s=Number.parseInt(e.target.value);d(s),n&&n([s])},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})})]})},O=({id:e,elements:a=[],selectedElement:t,onSelectElement:l,onAddElement:i,onUpdateElement:n,onDeleteElement:r,availableMasks:o=[]})=>{const[{isOver:c},d]=S(()=>({accept:["IMAGE_FILE","TEXT_ELEMENT","IMAGE_ELEMENT"],drop:e=>{if(e.files){const s=new FileReader;s.onload=e=>{if(e.target?.result){const s={id:`img-${Date.now()}`,type:"image",content:e.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};i(s)}},s.readAsDataURL(e.files[0])}},collect:e=>({isOver:!!e.isOver({shallow:!0})})}));return s.jsx("div",{ref:d,className:"relative aspect-square bg-gray-50 rounded-lg overflow-hidden "+(c?"ring-2 ring-purple-500 bg-purple-50":""),onClick:()=>l(null),children:0===a.length?s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const s=new FileReader;s.onload=e=>{if(e.target?.result){const s={id:`img-${Date.now()}`,type:"image",content:e.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};i(s)}},s.readAsDataURL(e.target.files[0])}},e.click()},children:[s.jsx($,{className:"h-8 w-8 text-gray-400"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Haz clic o arrastra una imagen"})]}):a.map(e=>s.jsx("div",{className:"absolute inset-0",children:"image"===e.type?s.jsx(T,{element:e,isSelected:t===e.id,onSelect:()=>l(e.id),onUpdate:s=>n(e.id,s),onDelete:()=>r(e.id),availableMasks:o}):s.jsx(U,{element:e,isSelected:t===e.id,onSelect:()=>l(e.id),onUpdate:s=>n(e.id,s),onDelete:()=>r(e.id)})},e.id))})},T=({element:a,isSelected:t,onSelect:l,onUpdate:i,onDelete:n,availableMasks:r=[]})=>{const[{isDragging:o},c]=E(()=>({type:"IMAGE_ELEMENT",item:{id:a.id},collect:e=>({isDragging:!!e.isDragging()})})),d=e.useRef(null),[m,g]=e.useState(!1),[x,p]=e.useState({x:0,y:0}),[h,f]=e.useState(!1),[y,b]=e.useState({x:0,y:0}),j={filter:`\n      brightness(${(a.filters?.brightness||100)/100})\n      contrast(${(a.filters?.contrast||100)/100})\n      saturate(${(a.filters?.saturation||100)/100})\n      sepia(${(a.filters?.tint||0)/100})\n      hue-rotate(${3.6*(a.filters?.hue||0)}deg)\n      blur(${a.filters?.blur||0}px)\n    `,transform:`scale(${a.filters?.scale||1}) rotate(${a.filters?.rotate||0}deg) ${a.filters?.flipHorizontal?"scaleX(-1)":""} ${a.filters?.flipVertical?"scaleY(-1)":""}`,mixBlendMode:a.filters?.blendMode||"normal",opacity:(a.filters?.opacity||100)/100},v=B.find(e=>e.id===a.mask)||B[0],w=e=>{if(m&&d.current){const s=d.current.parentElement.getBoundingClientRect(),a=e.clientX-x.x,t=e.clientY-x.y,l=s.width-d.current.offsetWidth,n=s.height-d.current.offsetHeight,r=Math.max(0,Math.min(a,l)),o=Math.max(0,Math.min(t,n));i({position:{x:r,y:o}})}},N=()=>{g(!1)};e.useEffect(()=>(m&&(window.addEventListener("mousemove",w),window.addEventListener("mouseup",N)),()=>{window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",N)}),[m,x]);const k=e.useCallback(e=>{d.current=e,c(e)},[c]);return s.jsxs("div",{ref:k,className:`absolute ${v.class} ${t?"ring-2 ring-purple-500":""} ${o?"opacity-50":"opacity-100"}`,style:{left:`${a.position.x}px`,top:`${a.position.y}px`,width:"100%",height:"100%",cursor:t?"move":"pointer"},onClick:e=>{e.stopPropagation(),l()},onMouseDown:e=>{t&&(e.stopPropagation(),g(!0),p({x:e.clientX-a.position.x,y:e.clientY-a.position.y}))},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),b({x:e.clientX,y:e.clientY}),f(!0)},children:[s.jsx("div",{className:"w-full h-full overflow-hidden",children:s.jsx("img",{src:a.content,alt:"Imagen cargada",className:"w-full h-full object-cover",style:j})}),t&&s.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[s.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:e=>{e.stopPropagation(),i({filters:{...a.filters,rotate:(a.filters?.rotate||0)+90}})},children:s.jsx(M,{className:"h-4 w-4 text-gray-700"})}),s.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:e=>{e.stopPropagation(),n()},children:s.jsx(u,{className:"h-4 w-4 text-gray-700"})})]}),h&&s.jsxs("div",{className:"fixed bg-white shadow-lg rounded-md z-50 py-1 w-48",style:{left:`${y.x}px`,top:`${y.y}px`},onClick:e=>e.stopPropagation(),children:[s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const s=new FileReader;s.onload=e=>{e.target?.result&&i({content:e.target.result})},s.readAsDataURL(e.target.files[0])}},e.click(),f(!1)},children:[s.jsx(D,{className:"h-4 w-4"}),"Reemplazar imagen"]}),s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{const e={...JSON.parse(JSON.stringify(a)),id:`img-${Date.now()}`,position:{x:a.position.x+20,y:a.position.y+20}};i(e,!0),f(!1)},children:[s.jsx(z,{className:"h-4 w-4"}),"Duplicar"]}),s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{i({filters:{...a.filters,opacity:Math.max(0,(a.filters?.opacity||100)-10)}}),f(!1)},children:[s.jsx(F,{className:"h-4 w-4"}),"Reducir opacidad"]}),s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{n(),f(!1)},children:[s.jsx(u,{className:"h-4 w-4"}),"Eliminar"]})]})]})},U=({element:a,isSelected:t,onSelect:l,onUpdate:i,onDelete:n})=>{const[r,c]=e.useState(!1),d=e.useRef(null),m=e.useRef(null),[{isDragging:g},x]=E(()=>({type:"TEXT_ELEMENT",item:{id:a.id},collect:e=>({isDragging:!!e.isDragging()})})),[p,h]=e.useState(!1),[f,y]=e.useState({x:0,y:0}),[b,j]=e.useState(!1),[v,w]=e.useState({x:0,y:0}),N=e=>{if(p&&m.current){const s=m.current.parentElement.getBoundingClientRect(),a=e.clientX-f.x,t=e.clientY-f.y,l=s.width-m.current.offsetWidth,n=s.height-m.current.offsetHeight,r=Math.max(0,Math.min(a,l)),o=Math.max(0,Math.min(t,n));i({position:{x:r,y:o}})}},k=()=>{h(!1)};e.useEffect(()=>(p&&(window.addEventListener("mousemove",N),window.addEventListener("mouseup",k)),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",k)}),[p,f]);const C=e.useCallback(e=>{m.current=e,x(e)},[x]),S=a.style?.textShadow?`${a.style.textShadowX||0}px ${a.style.textShadowY||0}px ${a.style.textShadowBlur||0}px ${a.style.textShadowColor||"rgba(0,0,0,0.5)"}`:"none",$={...a.style,position:"absolute",left:`${a.position.x}px`,top:`${a.position.y}px`,cursor:t&&!r?"move":"pointer",textShadow:S,zIndex:10};return s.jsxs("div",{ref:C,className:`${t?"ring-2 ring-purple-500":""} ${g?"opacity-50":"opacity-100"}`,style:$,onClick:e=>{e.stopPropagation(),l()},onDoubleClick:()=>{c(!0),setTimeout(()=>{d.current&&(d.current.focus(),d.current.select())},0)},onMouseDown:e=>{t&&!r&&(e.stopPropagation(),h(!0),y({x:e.clientX-a.position.x,y:e.clientY-a.position.y}))},onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),w({x:e.clientX,y:e.clientY}),j(!0)},children:[r?s.jsx("input",{ref:d,type:"text",value:a.content,onChange:e=>{i({content:e.target.value})},onBlur:()=>{c(!1)},onKeyDown:e=>{"Enter"===e.key&&c(!1)},className:"w-full p-1 border border-gray-300 rounded bg-white",style:{fontFamily:a.style?.fontFamily,fontSize:a.style?.fontSize,fontWeight:a.style?.fontWeight,fontStyle:a.style?.fontStyle,textDecoration:a.style?.textDecoration,color:a.style?.color,textAlign:a.style?.textAlign,minWidth:"100px"},autoFocus:!0}):s.jsx("div",{className:"p-2 rounded",style:{backgroundColor:a.style?.backgroundColor||"transparent",padding:a.style?.padding||"8px",borderRadius:a.style?.borderRadius||"0px",border:a.style?.border||"none"},children:a.content||"Editar texto"}),t&&s.jsxs("div",{className:"absolute top-0 right-0 transform translate-y-[-100%] flex gap-1 bg-white rounded-t-md p-1 shadow-sm",children:[s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),i({style:{...a.style,fontWeight:"bold"===a.style?.fontWeight?"normal":"bold"}})},children:s.jsx("span",{className:"text-xs "+("bold"===a.style?.fontWeight?"font-bold":""),children:"B"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),i({style:{...a.style,fontStyle:"italic"===a.style?.fontStyle?"normal":"italic"}})},children:s.jsx("span",{className:"text-xs "+("italic"===a.style?.fontStyle?"italic":""),children:"I"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),i({style:{...a.style,textDecoration:"underline"===a.style?.textDecoration?"none":"underline"}})},children:s.jsx("span",{className:"text-xs "+("underline"===a.style?.textDecoration?"underline":""),children:"U"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),n()},children:s.jsx(u,{className:"h-3 w-3 text-gray-700"})})]}),b&&s.jsxs("div",{className:"fixed bg-white shadow-lg rounded-md z-50 py-1 w-48",style:{left:`${v.x}px`,top:`${v.y}px`},onClick:e=>e.stopPropagation(),children:[s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{c(!0),j(!1)},children:[s.jsx(o,{className:"h-4 w-4"}),"Editar texto"]}),s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{const e={...JSON.parse(JSON.stringify(a)),id:`text-${Date.now()}`,position:{x:a.position.x+10,y:a.position.y+10}};i(e,!0),j(!1)},children:[s.jsx(z,{className:"h-4 w-4"}),"Duplicar"]}),s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{i({style:{...a.style,opacity:Math.max(0,(a.style?.opacity||1)-.1)}}),j(!1)},children:[s.jsx(F,{className:"h-4 w-4"}),"Reducir opacidad"]}),s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{n(),j(!1)},children:[s.jsx(u,{className:"h-4 w-4"}),"Eliminar"]})]})]})},W=({selectedMask:a,onSelect:t,availableMasks:l=[]})=>{const[i,n]=e.useState("Básicas"),r={};return B.forEach(e=>{r[e.category]||(r[e.category]=[]),(l.includes(e.id)||"none"===e.id)&&r[e.category].push(e)}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Máscaras de imagen"}),s.jsx("div",{className:"flex overflow-x-auto pb-2",children:Object.keys(r).map(e=>r[e].length>0&&s.jsx("button",{className:"px-3 py-1 text-sm whitespace-nowrap "+(i===e?"border-b-2 border-purple-500 font-medium text-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>n(e),children:e},e))}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:r[i]?.map(e=>s.jsxs("div",{className:"border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors "+(a===e.id?"border-purple-500 ring-2 ring-purple-200":""),onClick:()=>t(e.id),children:[s.jsx("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-2",children:s.jsx("div",{className:`w-16 h-16 bg-purple-300 ${e.class}`})}),s.jsx("p",{className:"text-center text-sm",children:e.name})]},e.id))})]})},J=({element:e,onUpdate:a})=>s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Ajustes avanzados"}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modo de mezcla"}),s.jsx("select",{className:"w-full border rounded-md p-2 text-sm",value:e.filters?.blendMode||"normal",onChange:s=>a({filters:{...e.filters,blendMode:s.target.value}}),children:H.map(e=>s.jsx("option",{value:e,children:e},e))})]}),s.jsx(I,{label:"Opacidad",value:[e.filters?.opacity||100],min:0,max:100,onValueChange:s=>a({filters:{...e.filters,opacity:s[0]}})}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs(P,{variant:e.filters?.flipHorizontal?"secondary":"outline",size:"sm",onClick:()=>a({filters:{...e.filters,flipHorizontal:!e.filters?.flipHorizontal}}),children:[s.jsx(c,{className:"h-4 w-4 mr-1"}),"Voltear H"]}),s.jsxs(P,{variant:e.filters?.flipVertical?"secondary":"outline",size:"sm",onClick:()=>a({filters:{...e.filters,flipVertical:!e.filters?.flipVertical}}),children:[s.jsx(d,{className:"h-4 w-4 mr-1"}),"Voltear V"]})]})]}),X=({onSelectPreset:e})=>s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Filtros predefinidos"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:L.map(a=>s.jsx(P,{variant:"outline",size:"sm",onClick:()=>e(a.filters),children:a.name},a.name))})]});function q(){const[p,h]=e.useState([{id:"page-1",layout:"layout-1",cells:Array.from({length:4}).map((e,s)=>({id:`cell-1-${s+1}`,elements:[]}))}]),[f,y]=e.useState(0),[b,j]=e.useState(null),[v,w]=e.useState(null),[N,k]=e.useState("elements"),[C,S]=e.useState("basic"),[$,E]=e.useState([JSON.stringify(p)]),[M,D]=e.useState(0),[z,F]=e.useState(!1),H=()=>A.find(e=>e.id===p[f].layout)||A[0],L=()=>{if(!b||!v)return null;const e=p[f].cells.find(e=>e.id===v);return e?e.elements.find(e=>e.id===b):null},T=e=>{h(e);const s=[...$.slice(0,M+1),JSON.stringify(e)];E(s),D(s.length-1)},U=(e,s)=>{const a=[...p],t=a[f].cells.findIndex(s=>s.id===e);-1!==t&&(a[f].cells[t].elements.push(s),T(a),j(s.id),w(e))},q=(e,s,a,t=!1)=>{const l=[...p],i=l[f].cells.findIndex(s=>s.id===e);if(-1!==i){if(t)l[f].cells[i].elements.push({...l[f].cells[i].elements.find(e=>e.id===s),...a});else{const e=l[f].cells[i].elements.findIndex(e=>e.id===s);-1!==e&&(l[f].cells[i].elements[e]={...l[f].cells[i].elements[e],...a})}T(l)}},Y=()=>{const e={id:`text-${Date.now()}`,type:"text",content:"Haz clic para editar",position:{x:20,y:20},style:{fontSize:"16px",fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1}};U(v||p[f].cells[0].id,e)};return s.jsx(a,{backend:t,children:s.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 mx-auto max-w-7xl",children:[s.jsxs("header",{className:"border-b bg-white p-4 flex items-center justify-between shadow-sm",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(P,{variant:"ghost",size:"sm",children:[s.jsx(l,{className:"h-5 w-5 mr-1"}),"Regresar"]})}),s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editor"}),s.jsx("h2",{className:"text-lg text-gray-600",children:"Crea collages y diseños impresionantes"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(P,{variant:"secondary",onClick:()=>{F(!z)},icon:s.jsx(i,{className:"h-4 w-4"}),children:z?"Editar":"Vista previa"}),s.jsx(P,{className:"bg-purple-600 hover:bg-purple-700",icon:s.jsx(n,{className:"h-4 w-4"}),onClick:()=>{const e=document.createElement("canvas"),s=document.querySelector(".page-preview");if(!s)return;const a=s.offsetWidth,t=s.offsetHeight;e.width=2*a,e.height=2*t;const l=e.getContext("2d");l.scale(2,2),l.fillStyle="white",l.fillRect(0,0,a,t),V(s,{scale:2,backgroundColor:null,canvas:e,logging:!1,useCORS:!0}).then(e=>{e.toBlob(e=>{R.saveAs(e,`diseño-pagina-${f+1}.png`)})})},children:"Exportar"})]})]}),s.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[s.jsx("aside",{className:"w-64 border-r bg-white p-4 overflow-y-auto shadow-sm",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex border-b pb-4",children:[s.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+("elements"===N?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>k("elements"),children:"Elementos"}),s.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+("filters"===N?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>k("filters"),children:"Filtros"})]}),"elements"===N&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Layouts"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:A.map(e=>s.jsxs("div",{className:"border rounded-md p-1 cursor-pointer hover:border-purple-500 "+(p[f].layout===e.id?"border-purple-500 ring-1 ring-purple-200":""),onClick:()=>(e=>{const s=A.find(s=>s.id===e);if(!s)return;const a=[...p],t=a[f],l=Array.from({length:s.cells}).map((e,s)=>t.cells[s]||{id:`cell-${t.id}-${s+1}`,elements:[]});a[f]={...t,layout:e,cells:l},T(a),j(null),w(null)})(e.id),children:[s.jsx("div",{className:`grid ${e.template} gap-1 h-20`,children:Array.from({length:e.cells}).map((e,a)=>s.jsx("div",{className:"bg-gray-100 rounded-sm flex items-center justify-center",children:s.jsx(r,{className:"h-3 w-3 text-gray-400"})},a))}),s.jsx("p",{className:"text-xs text-center mt-1 truncate",children:e.name})]},e.id))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Añadir"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(P,{variant:"outline",size:"sm",icon:s.jsx(r,{className:"h-4 w-4"}),onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const s={id:`img-${Date.now()}`,type:"image",content:"",position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"},a=new FileReader;a.onload=e=>{e.target?.result&&(s.content=e.target.result,U(v||p[f].cells[0].id,s))},a.readAsDataURL(e.target.files[0])}},e.click()},children:"Imagen"}),s.jsx(P,{variant:"outline",size:"sm",icon:s.jsx(o,{className:"h-4 w-4"}),onClick:Y,children:"Texto"})]})]})]}),"filters"===N&&b&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex border-b",children:[s.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+("basic"===C?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>S("basic"),children:"Básicos"}),s.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+("transform"===C?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>S("transform"),children:"Transformar"}),s.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+("advanced"===C?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>S("advanced"),children:"Avanzados"})]}),"basic"===C&&s.jsxs(s.Fragment,{children:["image"===L()?.type&&s.jsx(X,{onSelectPreset:e=>{b&&v&&q(v,b,{filters:{...L()?.filters,...e}})}}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Ajustes básicos"}),s.jsx(I,{label:"Brillo",value:[L()?.filters?.brightness||100],min:0,max:200,onValueChange:e=>q(v,b,{filters:{...L()?.filters,brightness:e[0]}})}),s.jsx(I,{label:"Contraste",value:[L()?.filters?.contrast||100],min:0,max:200,onValueChange:e=>q(v,b,{filters:{...L()?.filters,contrast:e[0]}})}),s.jsx(I,{label:"Saturación",value:[L()?.filters?.saturation||100],min:0,max:200,onValueChange:e=>q(v,b,{filters:{...L()?.filters,saturation:e[0]}})}),s.jsx(I,{label:"Tono",value:[L()?.filters?.hue||0],min:0,max:360,unit:"°",onValueChange:e=>q(v,b,{filters:{...L()?.filters,hue:e[0]}})}),s.jsx(I,{label:"Sepia",value:[L()?.filters?.tint||0],min:0,max:100,onValueChange:e=>q(v,b,{filters:{...L()?.filters,tint:e[0]}})}),s.jsx(I,{label:"Desenfoque",value:[L()?.filters?.blur||0],min:0,max:20,unit:"px",onValueChange:e=>q(v,b,{filters:{...L()?.filters,blur:e[0]}})})]})]}),"transform"===C&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Transformación"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(P,{variant:L()?.filters?.flipHorizontal?"secondary":"outline",size:"sm",icon:s.jsx(c,{className:"h-4 w-4"}),onClick:()=>q(v,b,{filters:{...L()?.filters,flipHorizontal:!L()?.filters?.flipHorizontal}}),children:"Voltear H"}),s.jsx(P,{variant:L()?.filters?.flipVertical?"secondary":"outline",size:"sm",icon:s.jsx(d,{className:"h-4 w-4"}),onClick:()=>q(v,b,{filters:{...L()?.filters,flipVertical:!L()?.filters?.flipVertical}}),children:"Voltear V"})]}),s.jsx(I,{label:"Rotación",value:[L()?.filters?.rotate||0],min:0,max:360,unit:"°",onValueChange:e=>q(v,b,{filters:{...L()?.filters,rotate:e[0]}})}),s.jsx(I,{label:"Escala",value:[100*(L()?.filters?.scale||1)],min:10,max:200,onValueChange:e=>q(v,b,{filters:{...L()?.filters,scale:e[0]/100}})})]}),"advanced"===C&&s.jsx(J,{element:L(),onUpdate:e=>q(v,b,e)}),"image"===L()?.type&&s.jsx(W,{onSelect:e=>q(v,b,{mask:e}),selectedMask:L()?.mask||"none",availableMasks:H().maskCategories.flatMap(e=>e.masks)})]})]})}),s.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:z?s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-lg page-preview",children:s.jsx("div",{className:`grid ${H().template} gap-6 aspect-[4/3]`,children:p[f].cells.map(e=>s.jsx("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden",children:e.elements.map(e=>"image"===e.type?s.jsx("div",{className:`absolute ${B.find(s=>s.id===e.mask)?.class||""}`,style:{left:`${e.position.x}px`,top:`${e.position.y}px`,width:"100%",height:"100%"},children:s.jsx("img",{src:e.content,alt:"",className:"w-full h-full object-cover",style:{filter:`\n                                    brightness(${(e.filters?.brightness||100)/100})\n                                    contrast(${(e.filters?.contrast||100)/100})\n                                    saturate(${(e.filters?.saturation||100)/100})\n                                    sepia(${(e.filters?.tint||0)/100})\n                                    hue-rotate(${3.6*(e.filters?.hue||0)}deg)\n                                    blur(${e.filters?.blur||0}px)\n                                  `,transform:`scale(${e.filters?.scale||1}) rotate(${e.filters?.rotate||0}deg) ${e.filters?.flipHorizontal?"scaleX(-1)":""} ${e.filters?.flipVertical?"scaleY(-1)":""}`,mixBlendMode:e.filters?.blendMode||"normal",opacity:(e.filters?.opacity||100)/100}})},e.id):s.jsx("div",{className:"absolute",style:{left:`${e.position.x}px`,top:`${e.position.y}px`,fontFamily:e.style?.fontFamily,fontSize:e.style?.fontSize,fontWeight:e.style?.fontWeight,fontStyle:e.style?.fontStyle,textDecoration:e.style?.textDecoration,color:e.style?.color,textAlign:e.style?.textAlign,backgroundColor:e.style?.backgroundColor||"transparent",padding:e.style?.padding||"8px",borderRadius:e.style?.borderRadius||"0px",border:e.style?.border||"none",opacity:e.style?.opacity||1},children:e.content},e.id))},e.id))})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 flex items-center gap-4",children:[s.jsx(P,{variant:"ghost",size:"icon",onClick:()=>{M>0&&(D(M-1),h(JSON.parse($[M-1])),j(null),w(null))},disabled:M<=0,children:s.jsx(m,{className:"h-5 w-5"})}),s.jsx(P,{variant:"ghost",size:"icon",onClick:()=>{M<$.length-1&&(D(M+1),h(JSON.parse($[M+1])),j(null),w(null))},disabled:M>=$.length-1,children:s.jsx(g,{className:"h-5 w-5"})}),s.jsx("div",{className:"h-6 border-l"}),s.jsx(P,{variant:"ghost",size:"icon",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const s={id:`img-${Date.now()}`,type:"image",content:"",position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"},a=new FileReader;a.onload=e=>{e.target?.result&&(s.content=e.target.result,U(v||p[f].cells[0].id,s))},a.readAsDataURL(e.target.files[0])}},e.click()},children:s.jsx(r,{className:"h-5 w-5"})}),s.jsx(P,{variant:"ghost",size:"icon",onClick:Y,children:s.jsx(o,{className:"h-5 w-5"})}),s.jsx("div",{className:"h-6 border-l"}),s.jsx(P,{variant:"ghost",size:"icon",onClick:()=>{b&&v&&((e,s)=>{const a=[...p],t=a[f].cells.findIndex(s=>s.id===e);-1!==t&&(a[f].cells[t].elements=a[f].cells[t].elements.filter(e=>e.id!==s),T(a),b===s&&j(null))})(v,b)},disabled:!b,children:s.jsx(u,{className:"h-5 w-5"})})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden page-preview "+(H().cells<=4?"aspect-[4/3]":""),children:s.jsx("div",{className:`grid ${H().template} gap-4 h-full p-4`,children:p[f].cells.map(e=>s.jsx(O,{id:e.id,elements:e.elements,selectedElement:v===e.id?b:null,onSelectElement:s=>{j(s),w(e.id)},onAddElement:s=>{const a=[...p],t=a[f].cells.findIndex(s=>s.id===e.id);-1!==t&&(a[f].cells[t].elements.push(s),T(a),j(s.id),w(e.id))},onUpdateElement:(s,a,t)=>{const l=[...p],i=l[f].cells.findIndex(s=>s.id===e.id);if(-1!==i){if(t)l[f].cells[i].elements.push({...l[f].cells[i].elements.find(e=>e.id===s),...a});else{const e=l[f].cells[i].elements.findIndex(e=>e.id===s);-1!==e&&(l[f].cells[i].elements[e]={...l[f].cells[i].elements[e],...a})}T(l)}},onDeleteElement:s=>{const a=[...p],t=a[f].cells.findIndex(s=>s.id===e.id);-1!==t&&(a[f].cells[t].elements=a[f].cells[t].elements.filter(e=>e.id!==s),T(a),b===s&&j(null))},availableMasks:H().maskCategories.flatMap(e=>e.masks)},e.id))})})]})})}),s.jsx("aside",{className:"w-56 border-l bg-white p-4 overflow-y-auto shadow-sm",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"font-medium",children:"Páginas"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(P,{variant:"ghost",size:"icon-sm",onClick:()=>{const e=p[f],s={...JSON.parse(JSON.stringify(e)),id:`page-${p.length+1}-copy`},a=[...p,s];T(a),y(a.length-1)},children:s.jsx("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",children:s.jsx("path",{d:"M1 9.50006C1 10.3285 1.67157 11.0001 2.5 11.0001H4L4 10.0001H2.5C2.22386 10.0001 2 9.7762 2 9.50006L2 2.50006C2 2.22392 2.22386 2.00006 2.5 2.00006L9.5 2.00006C9.77614 2.00006 10 2.22392 10 2.50006V4.00002H5.5C4.67158 4.00002 4 4.67159 4 5.50002V12.5C4 13.3284 4.67158 14 5.5 14H12.5C13.3284 14 14 13.3284 14 12.5V5.50002C14 4.67159 13.3284 4.00002 12.5 4.00002H11V2.50006C11 1.67163 10.3284 1.00006 9.5 1.00006H2.5C1.67157 1.00006 1 1.67163 1 2.50006V9.50006ZM5 5.50002C5 5.22388 5.22386 5.00002 5.5 5.00002H12.5C12.7761 5.00002 13 5.22388 13 5.50002V12.5C13 12.7762 12.7761 13 12.5 13H5.5C5.22386 13 5 12.7762 5 12.5V5.50002Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})})}),s.jsx(P,{variant:"ghost",size:"icon-sm",onClick:()=>{if(p.length<=1)return;const e=p.filter((e,s)=>s!==f);T(e),y(Math.min(f,e.length-1))},disabled:p.length<=1,children:s.jsx(u,{className:"h-4 w-4"})})]})]}),s.jsxs("div",{className:"grid gap-3",children:[p.map((e,a)=>s.jsx("div",{className:"border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors "+(f===a?"border-purple-500 ring-2 ring-purple-200":""),onClick:()=>y(a),children:s.jsxs("div",{className:"bg-gray-100 aspect-[4/3] rounded-sm flex items-center justify-center text-xs text-gray-500 relative",children:["Pág. ",a+1,e.cells.some(e=>e.elements.some(e=>"image"===e.type&&e.content))&&s.jsx("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1",children:Array.from({length:4}).map((a,t)=>{const l=e.cells[t],i=l?.elements.find(e=>"image"===e.type&&e.content);return s.jsx("div",{className:"bg-gray-200 rounded-sm overflow-hidden",children:i&&s.jsx("img",{src:i.content,alt:"",className:"w-full h-full object-cover"})},t)})})]})},e.id)),s.jsx(P,{variant:"outline",size:"sm",icon:s.jsx(x,{className:"h-4 w-4"}),onClick:()=>{const e=`page-${p.length+1}`,s=H(),a={id:e,layout:s.id,cells:Array.from({length:s.cells}).map((s,a)=>({id:`cell-${e}-${a+1}`,elements:[]}))},t=[...p,a];T(t),y(t.length-1)},children:"Añadir página"})]})]})})]})]})})}export{q as default};

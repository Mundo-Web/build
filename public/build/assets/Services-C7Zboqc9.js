var q=Object.defineProperty;var L=(l,i,n)=>i in l?q(l,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[i]=n;var j=(l,i,n)=>L(l,typeof i!="symbol"?i+"":i,n);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{B as O}from"./Base-DSZ3J1Re.js";import{S as T}from"./SwitchFormGroup-DXN0cwVk.js";import{T as z}from"./TextareaFormGroup-CliirJM1.js";import{r as o}from"./index-BOnQTV8N.js";import{c as H}from"./ReactAppend-QR5TrZfj.js";import{s as J}from"./server.browser-Bf4gQIc7.js";import{S as K}from"./ProductCard-D_AgkLlk.js";import{B as Q}from"./BasicRest-BML1C-ua.js";import{I as k}from"./ImageFormGroup-40MuGzez.js";import{M as U}from"./Modal-xDw9ufjg.js";import{T as W}from"./Table-bW0uinRR.js";import{D as B}from"./DxButton-DV0H-ZcL.js";import{C as X}from"./CreateReactScript-B_EwXk3P.js";import{R as w}from"./ReactAppend-Vm5G2nof.js";import{I}from"./InputFormGroup-iZIO11ZN.js";import{S as G}from"./SelectFormGroup-X8WqJHHl.js";import"./index-yBjzXJbu.js";import"./Global-CazroCzF.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DwXwpKCn.js";import"./index.esm-D6GvEWn_.js";import"./index-BQJyKPGC.js";import"./CanAccess-DwCGzUAc.js";import"./CardProductKatya-ncpmQ0JU.js";import"./BooleanLimit-D-OsQsek.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";class Y extends Q{constructor(){super(...arguments);j(this,"path","admin/services");j(this,"hasFiles",!0)}}const p=new Y,Z=({categories:l=[],subcategories:i=[]})=>{const n=o.useRef(),f=o.useRef(),d=o.useRef(),v=o.useRef(),h=o.useRef(),x=o.useRef(),b=o.useRef(),R=o.useRef(),c=o.useRef(),a=o.useRef(),[N,D]=o.useState(!1),[y,S]=o.useState(null),E=e=>{e!=null&&e.id?D(!0):D(!1),d.current.value=(e==null?void 0:e.id)??"",$(v.current).val((e==null?void 0:e.service_category_id)||"").trigger("change"),S((e==null?void 0:e.service_category_id)||null),setTimeout(()=>{$(h.current).val((e==null?void 0:e.service_subcategory_id)||"").trigger("change")},100),x.current.value=(e==null?void 0:e.name)??"",b.current.value=(e==null?void 0:e.description)??"",R.current.value=(e==null?void 0:e.path)??"",c.image.src=e!=null&&e.image?`/storage/images/service/${e.image}`:"",c.current.value=null,a.image.src=e!=null&&e.background_image?`/storage/images/service/${e.background_image}`:"",a.current.value=null,c.resetDeleteFlag&&c.resetDeleteFlag(),a.resetDeleteFlag&&a.resetDeleteFlag(),$(f.current).modal("show")},V=async e=>{e.preventDefault();const r={id:d.current.value||void 0,name:x.current.value,description:b.current.value},s=v.current.value;s&&s!==""&&s!=="null"&&(r.service_category_id=s);const m=h.current.value;m&&m!==""&&m!=="null"&&(r.service_subcategory_id=m);const F=R.current.value;F&&F!==""&&(r.path=F);const u=new FormData;for(const g in r)r[g]!==void 0&&r[g]!==null&&u.append(g,r[g]);const _=c.current.files[0];_&&u.append("image",_);const C=a.current.files[0];C&&u.append("background_image",C),c.getDeleteFlag&&c.getDeleteFlag()&&u.append("image_delete","DELETE"),a.getDeleteFlag&&a.getDeleteFlag()&&u.append("background_image_delete","DELETE"),await p.save(u)&&(c.resetDeleteFlag&&c.resetDeleteFlag(),a.resetDeleteFlag&&a.resetDeleteFlag(),$(n.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},M=async({id:e,value:r})=>{await p.boolean({id:e,field:"visible",value:r})&&$(n.current).dxDataGrid("instance").refresh()},P=async({id:e,value:r})=>{await p.boolean({id:e,field:"status",value:r})&&$(n.current).dxDataGrid("instance").refresh()},A=async e=>{const{isConfirmed:r}=await K.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!r||!await p.delete(e.id)||$(n.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(W,{gridRef:n,title:"Servicios",rest:p,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>E()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:r})=>{var s,m;e.html(J.renderToString(t.jsxs(t.Fragment,{children:[t.jsx("b",{className:"d-block",children:((s=r.category)==null?void 0:s.name)||"Sin categoría"}),t.jsx("small",{className:"text-muted",children:((m=r.subcategory)==null?void 0:m.name)||"Sin subcategoría"})]})))}},{dataField:"name",caption:"Servicio",width:"25%"},{dataField:"description",caption:"Descripción",width:"35%"},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{w(e,t.jsx("img",{src:`/storage/images/service/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),w(e,t.jsx(T,{checked:r.visible==1,onChange:()=>M({id:r.id,value:!r.visible})}))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),w(e,t.jsx(T,{checked:r.status==1,onChange:()=>P({id:r.id,value:!r.status})}))}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(B({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>E(r)})),e.append(B({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>A(r)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(U,{modalRef:f,title:N?"Editar servicio":"Agregar servicio",onSubmit:V,children:[t.jsx("input",{ref:d,type:"hidden"}),t.jsxs("div",{className:"row",id:"services-modal-container",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx(k,{eRef:c,name:"image",label:"Imagen del Servicio",col:"col-12",aspect:1}),t.jsx(k,{eRef:a,name:"background_image",label:"Imagen de Fondo",col:"col-12",aspect:16/9})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx(G,{eRef:v,label:"Categoría",dropdownParent:"#services-modal-container",onChange:e=>S(e.target.value),children:l.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(G,{eRef:h,label:"Subcategoría",dropdownParent:"#services-modal-container",children:i.filter(e=>!y||e.service_category_id===y).map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(I,{eRef:x,label:"Nombre del Servicio",required:!0}),t.jsx(I,{eRef:R,label:"Ruta (Path)",placeholder:"/casillero-virtual"}),t.jsx(z,{eRef:b,label:"Descripción",rows:3})]})]})]})]})};X((l,i)=>{H.createRoot(l).render(t.jsx(O,{...i,title:"Servicios",children:t.jsx(Z,{...i})}))});

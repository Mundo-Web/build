import{j as i}from"./AboutSimple-Cf8x2fCZ.js";import{r as s}from"./index-BOnQTV8N.js";import{c as le}from"./ReactAppend-QR5TrZfj.js";import{s as ne}from"./server.browser-Bf4gQIc7.js";import{L as oe,A as ce,G as de,M as pe}from"./esm-CTRYOAnL.js";import{S as ue}from"./StoresRest-Bb6TODpG.js";import{C as me,F as o}from"./CreateReactScript-DDkb82ME.js";import{B as fe}from"./Base-DYFgQtBT.js";import{T as he}from"./Table-BplAdTCi.js";import{M as xe}from"./Modal-xDw9ufjg.js";import{I as f}from"./InputFormGroup-iZIO11ZN.js";import{T as ge}from"./TextareaFormGroup-CliirJM1.js";import{I as be}from"./ImageFormGroup-40MuGzez.js";import{S as ve}from"./SwitchFormGroup-DXN0cwVk.js";import{S as H}from"./SelectFormGroup-X8WqJHHl.js";import{D as W}from"./DxButton-DV0H-ZcL.js";import{S as d}from"./ProductCard-D9l7c7at.js";import{G as je}from"./Global-CazroCzF.js";import{R as q}from"./ReactAppend-Vm5G2nof.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./index-pSueRYGM.js";import"./BasicRest-BML1C-ua.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CardProductKatya-ncpmQ0JU.js";import"./BooleanLimit-D-OsQsek.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";/* empty css               *//* empty css              */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";import"./CanAccess-DqqErOtT.js";import"./tippy-react.esm-DmkRJDEW.js";import"./Logout-BpuTJ_83.js";import"./MenuItemContainer-DcxtOi47.js";const ye=["places"],x=new ue,Ne=({ubigeos:y=[]})=>{const h=s.useRef(),S=s.useRef(),g=s.useRef(),w=s.useRef(),C=s.useRef(),k=s.useRef(),E=s.useRef(),F=s.useRef(),N=s.useRef(),p=s.useRef(),u=s.useRef(),c=s.useRef();s.useRef();const T=s.useRef(),_=s.useRef(),b=s.useRef(),D=s.useRef(),[z,B]=s.useState(!1),[Y,R]=s.useState({lat:-12.046374,lng:-77.042793}),[L,v]=s.useState(null),[G,K]=s.useState(null),[Q,I]=s.useState(""),[M,A]=s.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),O=e=>{if(e!=null&&e.id?B(!0):B(!1),g.current.value=(e==null?void 0:e.id)??"",w.current.value=(e==null?void 0:e.name)??"",C.current.value=(e==null?void 0:e.address)??"",k.current.value=(e==null?void 0:e.phone)??"",E.current.value=(e==null?void 0:e.email)??"",F.current.value=(e==null?void 0:e.description)??"",p.current.value=(e==null?void 0:e.latitude)??"",u.current.value=(e==null?void 0:e.longitude)??"",T.current.value=(e==null?void 0:e.manager)??"",_.current.value=(e==null?void 0:e.capacity)??"",D.current.value=(e==null?void 0:e.link)??"",o.has("stores","image")&&(c.resetDeleteFlag&&c.resetDeleteFlag(),c.current&&(c.image.src=e!=null&&e.image?`/storage/images/store/${e.image}`:"")),$(N.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),e!=null&&e.id?x.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(t=>{const r=$(b.current);t!=null&&t.data&&Array.isArray(t.data)&&t.data.length>0&&t.data.find(n=>n.id!==e.id)&&e.type!=="tienda_principal"?r.find('option[value="tienda_principal"]').prop("disabled",!0):r.find('option[value="tienda_principal"]').prop("disabled",!1),r.val((e==null?void 0:e.type)??"tienda").trigger("change")}).catch(t=>{console.error("Error al verificar tiendas principales:",t),$(b.current).val((e==null?void 0:e.type)??"tienda").trigger("change")}):x.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(t=>{const r=(t==null?void 0:t.data)&&Array.isArray(t.data)&&t.data.length>0,a=$(b.current);r?a.find('option[value="tienda_principal"]').prop("disabled",!0):a.find('option[value="tienda_principal"]').prop("disabled",!1),a.val((e==null?void 0:e.type)??"tienda").trigger("change")}).catch(t=>{console.error("Error al verificar tiendas principales:",t)}),e!=null&&e.business_hours)try{const t=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours;A(t)}catch(t){console.error("Error parsing business hours:",t)}else A([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);if(e!=null&&e.latitude&&(e!=null&&e.longitude)){const t=parseFloat(e.latitude),r=parseFloat(e.longitude);if(!isNaN(t)&&!isNaN(r)){const a={lat:t,lng:r};R(a),v(a)}}else R({lat:-12.046374,lng:-77.042793}),v(null);$(S.current).modal("show")},X=async e=>{if(e.preventDefault(),b.current.value==="tienda_principal")try{const m=g.current.value,j=await x.paginate({filter:JSON.stringify({type:"tienda_principal"})});if(j!=null&&j.data&&Array.isArray(j.data)&&j.data.length>0)if(m){if(j.data.find(se=>se.id!==m)){d.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});return}}else{d.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});return}}catch(m){console.error("Error al verificar tienda principal:",m),d.fire({title:"Error",text:"Error al verificar si existe una tienda principal",icon:"error"});return}const t=p.current.value.trim(),r=u.current.value.trim();let a=null,n=null;if(t){if(a=parseFloat(t),a<-18.5||a>-.1){d.fire({title:"Error de validación",text:"La latitud debe estar entre -18.5 y -0.1 para ubicaciones en Perú",icon:"error"});return}if(!J(a,10,8)){d.fire({title:"Error de validación",text:"La latitud excede el formato permitido (máximo 10 dígitos con 8 decimales)",icon:"error"});return}a=Math.round(a*1e8)/1e8}if(r){if(n=parseFloat(r),n<-81.5||n>-68.5){d.fire({title:"Error de validación",text:"La longitud debe estar entre -81.5 y -68.5 para ubicaciones en Perú",icon:"error"});return}if(!J(n,11,8)){d.fire({title:"Error de validación",text:"La longitud excede el formato permitido (máximo 11 dígitos con 8 decimales)",icon:"error"});return}n=Math.round(n*1e8)/1e8}y.find(m=>m.reniec==N.current.value);const l=new FormData;g.current.value,g.current.value&&l.append("id",g.current.value),l.append("name",w.current.value),l.append("address",C.current.value),l.append("phone",k.current.value),l.append("email",E.current.value),l.append("description",F.current.value),l.append("ubigeo",N.current.value),l.append("latitude",a!==null?a.toString():""),l.append("longitude",n!==null?n.toString():""),l.append("manager",T.current.value),l.append("capacity",_.current.value),l.append("type",b.current.value),l.append("link",D.current.value),l.append("business_hours",JSON.stringify(M)),o.has("stores","image")&&(c.current&&c.current.files[0]&&l.append("image",c.current.files[0]),c.getDeleteFlag&&c.getDeleteFlag()&&l.append("image_delete","DELETE"));for(let m of l.entries());await x.save(l)&&(o.has("stores","image")&&c.resetDeleteFlag&&c.resetDeleteFlag(),$(h.current).dxDataGrid("instance").refresh(),$(S.current).modal("hide"))},Z=async e=>{const{isConfirmed:t}=await d.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await x.delete(e)||$(h.current).dxDataGrid("instance").refresh()},P=(e,t,r)=>{const a=[...M];a[e][t]=r,A(a)},ee=e=>{const t=e.latLng.lat(),r=e.latLng.lng();v({lat:t,lng:r}),p.current&&(p.current.value=t.toFixed(8)),u.current&&(u.current.value=r.toFixed(8)),d.fire({title:"Ubicación seleccionada",text:`Coordenadas: ${t.toFixed(6)}, ${r.toFixed(6)}`,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})},ie=e=>{K(e),setTimeout(()=>{document.querySelectorAll(".pac-container").forEach(r=>{r.style.zIndex="9999"})},100)},te=()=>{if(G!==null){const e=G.getPlace();if(e.geometry&&e.geometry.location){const t=e.geometry.location.lat(),r=e.geometry.location.lng();R({lat:t,lng:r}),v({lat:t,lng:r}),p.current&&(p.current.value=t.toFixed(8)),u.current&&(u.current.value=r.toFixed(8)),I(e.formatted_address||e.name||""),d.fire({title:"Ubicación encontrada",text:e.formatted_address||e.name,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}}},V=()=>{var r,a;const e=parseFloat((r=p.current)==null?void 0:r.value),t=parseFloat((a=u.current)==null?void 0:a.value);if(!isNaN(e)&&!isNaN(t)){const n={lat:e,lng:t};R(n),v(n)}},J=(e,t,r)=>{if(e==null||isNaN(e))return!1;const n=Math.abs(e).toString().split("."),l=n[0];(n[1]||"").length>r;const m=t-r;return!(l.length>m)},U=e=>$(ne.renderToString(i.jsxs("span",{children:[i.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),i.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),re=async({id:e,value:t})=>{await x.boolean({id:e,field:"visible",value:t})&&$(h.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(he,{gridRef:h,title:"Tiendas / Sucursales",rest:x,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(h.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>O()}})},columns:[{dataField:"id",caption:"ID",visible:!1},o.has("stores","image")&&{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{q(e,i.jsx("img",{src:`/storage/images/store/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:r=>r.target.src="/api/cover/thumbnail/null"}))}},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:t})=>{const r={tienda_principal:"Tienda Principal",tienda:"Tienda",oficina:"Oficina",almacen:"Almacén",showroom:"Showroom",otro:"Otro"},a={tienda_principal:"danger",tienda:"success",oficina:"primary",almacen:"warning",showroom:"info",otro:"secondary"},n=r[t.type]||"No especificado",l=a[t.type]||"secondary";e.append(`<span class="badge bg-${l}">${n}</span>`)}},{dataField:"address",caption:"Dirección",width:"250px"},o.has("stores","phone")&&{dataField:"phone",caption:"Teléfono",width:"120px"},o.has("stores","email")&&{dataField:"email",caption:"Email",width:"180px"},o.has("stores","link")&&{dataField:"link",caption:"Enlace",cellTemplate:(e,{data:t})=>{t.link?e.html(`<a href="${t.link}" target="_blank" class="text-primary">
                                        ${t.link.length>30?t.link.substring(0,30)+"...":t.link}
                                    </a>`):e.text("Sin enlace")}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),q(e,i.jsx(ve,{checked:t.visible==1,onChange:()=>re({id:t.id,value:!t.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(W({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>O(t)})),e.append(W({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Z(t.id)}))},allowFiltering:!1,allowExporting:!1}].filter(Boolean)}),i.jsxs(xe,{modalRef:S,title:z?"Editar Tienda":"Agregar Tienda",onSubmit:X,size:"xl",children:[i.jsx("input",{ref:g,type:"hidden"}),i.jsxs("div",{id:"form-container",children:[i.jsxs("ul",{className:"nav nav-pills mb-4",id:"storeTabs",role:"tablist",style:{gap:"10px",flexWrap:"wrap",backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"8px"},children:[i.jsx("li",{className:"nav-item",role:"presentation",children:i.jsxs("button",{className:"nav-link active",id:"basic-info-tab","data-bs-toggle":"pill","data-bs-target":"#basic-info",type:"button",role:"tab","aria-controls":"basic-info","aria-selected":"true",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[i.jsx("i",{className:"fas fa-info-circle me-2"}),"Información Básica"]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:i.jsxs("button",{className:"nav-link",id:"location-tab","data-bs-toggle":"pill","data-bs-target":"#location",type:"button",role:"tab","aria-controls":"location","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[i.jsx("i",{className:"fas fa-map-marker-alt me-2"}),"Ubicación"]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:i.jsxs("button",{className:"nav-link",id:"contact-tab","data-bs-toggle":"pill","data-bs-target":"#contact",type:"button",role:"tab","aria-controls":"contact","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[i.jsx("i",{className:"fas fa-phone me-2"}),"Contacto"]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:i.jsxs("button",{className:"nav-link",id:"schedule-tab","data-bs-toggle":"pill","data-bs-target":"#schedule",type:"button",role:"tab","aria-controls":"schedule","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[i.jsx("i",{className:"fas fa-clock me-2"}),"Horarios"]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:i.jsxs("button",{className:"nav-link",id:"multimedia-tab","data-bs-toggle":"pill","data-bs-target":"#multimedia",type:"button",role:"tab","aria-controls":"multimedia","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[i.jsx("i",{className:"fas fa-images me-2"}),"Multimedia"]})})]}),i.jsxs("div",{className:"tab-content",style:{padding:"20px 0"},children:[i.jsx("div",{className:"tab-pane fade show active",id:"basic-info",role:"tabpanel","aria-labelledby":"basic-info-tab",children:i.jsxs("div",{className:"row g-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:w,label:"Nombre de la tienda",col:"col-12",required:!0})}),i.jsx("div",{className:"col-md-6",children:i.jsxs(H,{eRef:b,label:"Tipo de establecimiento",col:"col-12",required:!0,dropdownParent:"#form-container",children:[i.jsx("option",{value:"tienda_principal",children:"Tienda Principal"}),i.jsx("option",{value:"tienda",children:"Tienda"}),i.jsx("option",{value:"oficina",children:"Oficina"}),i.jsx("option",{value:"almacen",children:"Almacén"}),i.jsx("option",{value:"showroom",children:"Showroom"}),i.jsx("option",{value:"otro",children:"Otro"})]})}),o.has("stores","manager")&&i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:T,label:"Encargado",col:"col-12"})}),o.has("stores","capacity")&&i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:_,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),i.jsx("div",{className:"col-12",children:i.jsx(f,{eRef:C,label:"Dirección completa",col:"col-12",required:!0})}),i.jsx("div",{className:"col-12",children:i.jsx(H,{eRef:N,label:"Distrito/Ubigeo",col:"col-12",templateResult:U,templateSelection:U,dropdownParent:"#form-container",required:!0,children:y.map((e,t)=>i.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},t))})})]})}),i.jsx("div",{className:"tab-pane fade",id:"location",role:"tabpanel","aria-labelledby":"location-tab",children:i.jsx(oe,{googleMapsApiKey:je.GMAPS_API_KEY,libraries:ye,children:i.jsx("div",{className:"row g-3",children:i.jsxs("div",{className:"col-12",children:[i.jsxs("div",{className:"mb-3",children:[i.jsxs("label",{className:"form-label",children:[i.jsx("i",{className:"fas fa-search me-2"}),"Buscar ubicación"]}),i.jsx(ce,{onLoad:ie,onPlaceChanged:te,options:{componentRestrictions:{country:"pe"},fields:["formatted_address","geometry","name"],strictBounds:!1},children:i.jsx("input",{type:"text",className:"form-control",placeholder:"Busca la dirección o nombre del lugar...",value:Q,onChange:e=>I(e.target.value),style:{position:"relative",zIndex:1}})}),i.jsx("small",{className:"form-text text-muted",children:"Escribe el nombre o dirección de la tienda para centrar el mapa automáticamente."})]}),i.jsx("div",{className:"mb-3",children:i.jsx(de,{mapContainerStyle:{width:"100%",height:"400px",borderRadius:"8px"},center:Y,zoom:15,onClick:ee,options:{streetViewControl:!0,mapTypeControl:!0,fullscreenControl:!0},children:L&&i.jsx(pe,{position:L,title:"Ubicación de la tienda"})})}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:p,label:"Latitud",col:"col-12",type:"number",step:"0.00000001",min:"-18.5",max:"-0.1",placeholder:"Ej: -12.042626777544823",onChange:V})}),i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:u,label:"Longitud",col:"col-12",type:"number",step:"0.00000001",min:"-81.5",max:"-68.5",placeholder:"Ej: -77.04753389161506",onChange:V})})]}),i.jsx("div",{className:"row mt-3",children:i.jsx("div",{className:"col-12",children:i.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{v(null),p.current.value="",u.current.value=""},children:[i.jsx("i",{className:"fas fa-eraser me-1"}),"Limpiar Ubicación"]})})})]})})})}),i.jsx("div",{className:"tab-pane fade",id:"contact",role:"tabpanel","aria-labelledby":"contact-tab",children:i.jsxs("div",{className:"row g-3",children:[o.has("stores","phone")&&i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:k,label:"Teléfono",col:"col-12",type:"tel"})}),o.has("stores","email")&&i.jsx("div",{className:"col-md-6",children:i.jsx(f,{eRef:E,label:"Email",col:"col-12",type:"email"})}),o.has("stores","link")&&i.jsxs("div",{className:"col-12",children:[i.jsx(f,{eRef:D,label:"Enlace personalizado (opcional)",col:"col-12",type:"url",placeholder:"https://ejemplo.com"}),i.jsx("small",{className:"text-muted",children:"Si se especifica, al hacer clic en la tienda redirigirá a este enlace en lugar del perfil de la tienda."})]})]})}),i.jsx("div",{className:"tab-pane fade",id:"schedule",role:"tabpanel","aria-labelledby":"schedule-tab",children:o.has("stores","business_hours")&&i.jsx("div",{className:"row g-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx("label",{className:"form-label",children:"Horarios de atención"}),i.jsx("div",{className:"table-responsive",children:i.jsxs("table",{className:"table table-sm",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Día"}),i.jsx("th",{children:"Apertura"}),i.jsx("th",{children:"Cierre"}),i.jsx("th",{children:"Cerrado"})]})}),i.jsx("tbody",{children:M.map((e,t)=>i.jsxs("tr",{children:[i.jsx("td",{className:"align-middle",children:i.jsx("strong",{children:e.day})}),i.jsx("td",{children:i.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:r=>P(t,"open",r.target.value),disabled:e.closed})}),i.jsx("td",{children:i.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:r=>P(t,"close",r.target.value),disabled:e.closed})}),i.jsx("td",{children:i.jsxs("div",{className:"form-check",children:[i.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:r=>P(t,"closed",r.target.checked)}),i.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},t))})]})})]})})}),i.jsx("div",{className:"tab-pane fade",id:"multimedia",role:"tabpanel","aria-labelledby":"multimedia-tab",children:i.jsxs("div",{className:"row g-3",children:[o.has("stores","image")&&i.jsx("div",{className:"col-12",children:i.jsx(be,{eRef:c,name:"image",label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),o.has("stores","description")&&i.jsx("div",{className:"col-12",children:i.jsx(ge,{eRef:F,label:"Descripción",rows:3})})]})})]})]})]})]})};me((y,h)=>{le.createRoot(y).render(i.jsx(fe,{...h,title:"Tiendas / Sucursales",children:i.jsx(Ne,{...h})}))});

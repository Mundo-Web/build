import{r as e,j as a,i as t,R as s,c as n}from"./vendor-react-DD0uBW7s.js";import{C as l}from"./CreateReactScript-C92mMLGn.js";import{S as i}from"./SystemRest-CvOK_sd1.js";import{S as r}from"./SwitchFormGroup-Dk6WRclX.js";import{G as o}from"./Global-BAGAPG-V.js";import{S as c}from"./SortByAfterField-DzAI86wF.js";import{I as d}from"./InputFormGroup-DY-ZEW8l.js";import{T as m}from"./TextareaFormGroup-4KXpt4Nc.js";import{M as u}from"./Modal-CfnJHMl_.js";import{S as p}from"./SelectFormGroup-BpYEBv3v.js";import{S as h}from"./SetSelectValue-DCHQOIKz.js";import{M as f,a as x}from"./MenuItemContainer--0h9gV_W.js";import{C as g,S as j}from"./SettingsRest-CflN25QU.js";import{G as b}from"./GalleryRest-PaineapJ.js";import"./vendor-swiper-BQwfPLwm.js";import"./TippyButton-BXJTBPrK.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./Menu-Cmvatiox.js";import"./BooleanLimit-q2Ad9fGY.js";import"./BasicRest-BuuGWTMX.js";import"./GoogleSignInButton-BciphYP2.js";const v=(e="")=>{e=e.replace(/[^a-zA-Z0-9_{}]/g,"");const a=/{([^}]+)}/g,t=[];let s;for(;null!==(s=a.exec(e));)t.push(s[1]);return t},N=new i,y=s=>{const{id:n,name:l,path:i,extends_base:o=!1,menuable:c=!1,sitemapable:d=!1,setPages:m,onSEOClicked:u,onParamsClicked:p}=s,[h,f]=e.useState(!1),[x,g]=e.useState(!1),[j,b]=e.useState(!1),[y,w]=e.useState(!1),[k,C]=e.useState(!1),S=v(i);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"dropdown float-end",children:[a.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:a.jsx("i",{className:"mdi mdi-dots-vertical"})}),a.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[a.jsxs("button",{className:"dropdown-item",onClick:()=>u(s),children:[a.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),S.length>0&&a.jsxs("button",{className:"dropdown-item",onClick:()=>p(s),children:[a.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),a.jsx("div",{className:"dropdown-divider"}),a.jsxs("button",{className:"dropdown-item",onClick:()=>(async e=>{await N.deletePage(e.id)&&(m(a=>a.filter(a=>a.id!=e.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))})(s),children:[a.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),a.jsxs("div",{children:[h?a.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:l,onBlur:async e=>{if(l===e.target.value)return f(!1);N.savePage({id:n,name:e.target.value})&&(f(!1),m(a=>a.map(a=>a.id===n?{...a,name:e.target.value}:a)))},autoFocus:!0}):a.jsx(t,{content:"Editar nombre",placement:"left",children:a.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>f(!0),style:{minWidth:"200px",cursor:"pointer"},children:l||"Sin nombre"})}),x?a.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:i,style:{minHeight:27,fieldSizing:"content"},onBlur:async e=>{if(i===e.target.value)return g(!1);const a=e.target.value;let t=structuredClone(a);const l=s.using??{};for(const s of v(a))t=t.replace(`{${s}}`,"").replace(`{${s}?}`,""),l[s]=l[s]??{model:null};const r=((e,a)=>{const t=new RegExp(`[${a}]+$`,"g");return e.replace(t,"")})(t,"/");N.savePage({id:n,path:a,pseudo_path:r,using:Object.keys(l).length>0?l:void 0})&&(g(!1),m(a=>a.map(a=>a.id===n?{...a,path:e.target.value}:a)))},autoFocus:!0}):a.jsx(t,{content:"Editar ruta",placement:"left",children:a.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>g(!0),style:{minWidth:"200px",cursor:"pointer"},children:i||"Sin ruta"})})]}),a.jsxs("div",{className:"row",children:[a.jsx(r,{label:"Extiende de base",col:"col-lg-6 col-md-12 col-sm-6",checked:o,onChange:async e=>{b(!0);const a=e.target.checked,t=N.savePage({id:n,extends_base:a});b(!1),t&&m(e=>e.map(e=>e.id===n?{...e,extends_base:a}:e))},disabled:j}),a.jsx(r,{label:"Mostrar en menu",col:"col-lg-6 col-md-12 col-sm-6",checked:c,onChange:async e=>{w(!0);const a=e.target.checked,t=N.savePage({id:n,menuable:a});w(!1),t&&m(e=>e.map(e=>e.id===n?{...e,menuable:a}:e))},disabled:y}),a.jsx(r,{label:"Incluir en sitemap",col:"col-lg-6 col-md-12 col-sm-6",checked:d,onChange:async e=>{C(!0);const a=e.target.checked,t=N.savePage({id:n,sitemapable:a});C(!1),t&&m(e=>e.map(e=>e.id===n?{...e,sitemapable:a}:e))},disabled:k})]})]})},w=new i,k=[{value:"always",label:"Siempre"},{value:"hourly",label:"Cada hora"},{value:"daily",label:"Diario"},{value:"weekly",label:"Semanal"},{value:"monthly",label:"Mensual"},{value:"yearly",label:"Anual"},{value:"never",label:"Nunca"}],C=({dataLoaded:t,setDataLoaded:s,modalRef:n})=>{const l=e.useRef(null),i=e.useRef(null),r=e.useRef(null),c=e.useRef(null),f=e.useRef(null);return e.useEffect(()=>{l.current.value=`${t?.name} | ${o.APP_NAME}`,i.current.value=t?.description??"",h(r.current,t?.keywords??[]),c.current.value=t?.sitemap_priority??.8,h(f.current,t?.sitemap_frequency??"weekly")},[t]),a.jsx(u,{modalRef:n,title:`Editar SEO - ${t?.name}`,size:"md",onSubmit:async e=>{e.preventDefault();await w.savePage({id:t.id,description:i.current.value,keywords:$(r.current).val(),sitemap_priority:parseFloat(c.current.value)||.8,sitemap_frequency:$(f.current).val()||"weekly"})&&(s(null),$(n.current).modal("hide"))},children:a.jsxs("div",{id:"seo-container",children:[a.jsx(d,{eRef:l,label:"Título",disabled:!0}),a.jsx(m,{eRef:i,label:"Descripción",rows:2}),a.jsx(p,{eRef:r,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"}),a.jsx("hr",{className:"my-3"}),a.jsxs("h6",{className:"text-muted mb-3",children:[a.jsx("i",{className:"fas fa-sitemap me-1"}),"Configuración del Sitemap"]}),a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-6",children:a.jsx(d,{eRef:c,label:"Prioridad (0.0 - 1.0)",type:"number",step:"0.1",min:"0",max:"1"})}),a.jsx("div",{className:"col-6",children:a.jsx(p,{eRef:f,label:"Frecuencia de cambio",dropdownParent:"#seo-container",children:k.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})})]})]})})},S=({className:e,system:t,component:s,onComponentClicked:n,onDeleteClicked:l,onEditDataClicked:i})=>{const r=s?.options??[],o=r.find(e=>e.id==t.value);return a.jsxs("div",{className:`dropdown ${e}`,"data-id":t.id,children:[a.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${t.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[a.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),a.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[a.jsx("i",{className:"fa fa-ellipsis-v"}),a.jsx("i",{className:"fa fa-ellipsis-v"})]}),a.jsx("span",{className:"ms-1",children:t.name})]}),a.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${t.id}`,"data-popper-placement":"bottom-start","data-simplebar":!0,style:{maxHeight:"300px",width:"100%"},children:[r.length>1&&a.jsxs(a.Fragment,{children:[r.filter(e=>e.id!=t.value).map((e,l)=>a.jsxs("button",{className:"dropdown-item",onClick:()=>n({...t,name:`${s.name} - ${e.name}`,value:e.id}),children:[s.name," - ",e.name]},l)),a.jsx("div",{className:"dropdown-divider"})]}),(o?.using?.filters||o?.data)&&a.jsxs("button",{className:"dropdown-item",onClick:()=>i(t,o),children:[a.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),a.jsxs("button",{className:"dropdown-item",onClick:()=>l(t),children:[a.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},R=({col:t,label:s,eRef:n,placeholder:l,required:i=!1,rows:r=3,value:o,onChange:c=()=>{}})=>{const[d,m]=e.useState(o),u=e.useRef(),p=e.useRef(null),h=n||u;return e.useEffect(()=>(p.current&&(p.current.toTextArea(),p.current=null),p.current=CodeMirror.fromTextArea(h.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2}),p.current.setValue(o),setTimeout(()=>{p.current.refresh()},125),p.current.on("change",e=>{const a=e.getValue();m(a),c({target:{value:a}})}),()=>{p.current&&(p.current.toTextArea(),p.current=null)}),[h]),e.useEffect(()=>{d!==o&&(m(o),p.current&&(p.current.setValue(o),setTimeout(()=>{p.current.refresh()},125)))},[o]),a.jsxs("div",{className:`form-group ${t} mb-2`,children:[a.jsxs("label",{htmlFor:"",className:"mb-1",children:[s," ",i&&a.jsx("b",{className:"text-danger",children:"*"})]}),a.jsx("textarea",{ref:h,className:"form-control",placeholder:l,required:i,rows:r,defaultValue:o,onChange:e=>m(e.target.value)})]})},E=new i,P=({dataLoaded:t,setDataLoaded:n,setSystems:l,modalRef:i})=>{const[r,o]=e.useState(t?.data||{}),[c,h]=e.useState(t?.element_id||""),[f,x]=e.useState([]),g={};g.model=e.useRef(null),g.filters=e.useRef(null),g.filtersMethod=e.useRef(null);e.useEffect(()=>{const e={...t?.data||{}};t?.component?.data?.forEach&&t?.component?.data?.forEach(a=>{a in e||(e[a]="")}),o(e),h(t?.element_id||""),g.model.current.value=t?.component?.using?.model??"",$(g.filters.current).val(t?.filters??[]).trigger("change"),$(g.filtersMethod.current).val(t?.filtersMethod??[]).trigger("change");const a=t?.component?.using?.model,s=t?.component?.using?.["filters:method"];a&&s&&E.simpleGet(`/api/admin/system/related/${a}/${s}`).then(e=>{x(e)})},[t]);const j=(e,a)=>{o({...r,[e]:a})};return a.jsxs(u,{modalRef:i,title:t?.name,onSubmit:async e=>{e.preventDefault();const a={...t?.data||{},...r},s=await E.save({id:t.id,data:a,element_id:c,filters:$(g.filters.current).val(),filters_method:t?.component?.using?.["filters:method"],filters_method_values:$(g.filtersMethod.current).val()});s&&(n(null),$(i.current).modal("hide"),l(e=>e.map(e=>e.id==t.id?s:e)))},size:t?.component?.data?.some(e=>e.startsWith("code:"))?"lg":"md",children:[a.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[a.jsx("li",{className:"nav-item",children:a.jsx("a",{href:"#tab-general","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"General"})}),a.jsx("li",{className:"nav-item",hidden:!t?.component?.data?.length,children:a.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Información"})}),a.jsx("li",{className:"nav-item",hidden:!t?.component?.using?.filters&&!t?.component?.using?.["filters:method"],children:a.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),a.jsxs("div",{className:"tab-content",id:"data-modal-container",children:[a.jsxs("div",{className:"tab-pane active",id:"tab-general",children:[a.jsx(d,{label:"ID del elemento",value:c,onChange:e=>h(e.target.value),placeholder:"ej: contacto-principal, formulario-1"}),a.jsx("small",{className:"text-muted d-block mb-3",children:"Este ID se usa para anclas (#id), CSS personalizado y navegación. Se genera automáticamente pero puedes personalizarlo."})]}),a.jsx("div",{className:"tab-pane",id:"tab-info",hidden:!t?.component?.data?.length,children:t?.component?.data?.map((e,t)=>e.startsWith("code:")?a.jsx(R,{label:e.replace("code:",""),value:r[e]??"",rows:1,onChange:a=>o({...r,[e]:a.target.value})},t):a.jsx(s.Fragment,{children:e.startsWith("bool:")?a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:e.replace("bool:","")}),a.jsxs("div",{children:[a.jsxs("div",{className:"form-check form-check-inline",children:[a.jsx("input",{type:"radio",className:"form-check-input",id:`${e}-true`,name:e,value:"true",checked:!0===r[e],onChange:a=>j(e,"true"===a.target.value)}),a.jsx("label",{className:"form-check-label",htmlFor:`${e}-true`,children:"Sí"})]}),a.jsxs("div",{className:"form-check form-check-inline",children:[a.jsx("input",{type:"radio",className:"form-check-input",id:`${e}-false`,name:e,value:"false",checked:!1===r[e],onChange:a=>j(e,"true"===a.target.value)}),a.jsx("label",{className:"form-check-label",htmlFor:`${e}-false`,children:"No"})]})]})]}):a.jsx(m,{label:e,value:r[e]??"",rows:1,onChange:a=>o({...r,[e]:a.target.value})})},t))}),a.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[a.jsx(d,{eRef:g.model,label:"Modelo",disabled:!0}),a.jsx(p,{eRef:g.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!t?.component?.using?.filters,children:t?.component?.using?.filters?.map((e,t)=>a.jsx("option",{value:e,children:e},t))}),a.jsx("div",{hidden:!t?.component?.using?.["filters:method"],children:a.jsx(p,{eRef:g.filtersMethod,label:t?.component?.using?.["filters:method"]?.toTitleCase(),multiple:!0,dropdownParent:"#tab-db",changeWith:[f],children:f?.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})})]})]})]})},F=new i,_=({components:t,onClick:s})=>{const[n,l]=e.useState(""),i=t.filter(e=>e.options.length>0).filter(e=>{if(!n)return!0;const a=n.toLowerCase();return e.name.toLowerCase().includes(a)||e.options.some(e=>e.name.toLowerCase().includes(a))});return a.jsx("div",{className:"left-side-menu top-0 pt-2",children:a.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[a.jsx("div",{id:"sidebar-menu",className:"show",children:a.jsxs("ul",{id:"side-menu",children:[a.jsx("li",{className:"menu-title",children:"Lista de componentes"}),a.jsx("li",{className:"px-3 py-2",children:a.jsxs("div",{className:"position-relative",children:[a.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar componentes...",value:n,onChange:e=>l(e.target.value),style:{backgroundColor:"#ffffff",color:"#8391a2",paddingLeft:"35px"}}),a.jsx("i",{className:"mdi mdi-magnify position-absolute",style:{left:"10px",top:"50%",transform:"translateY(-50%)",color:"#8391a2",fontSize:"16px"}})]})}),i.map((e,t)=>a.jsx(f,{title:e.name,icon:e.icon,children:e.options.map((t,n)=>a.jsx(x,{name:t.name,icon:t.icon,onClick:()=>{const a=$(".tab-pane:visible .components-container > div").last().data("id");s({name:`${e.name} - ${t.name}`,component:e.id,value:t.id,after_component:a})},children:t.name},n))},t)),0===i.length&&n&&a.jsx("li",{className:"px-3 py-2",children:a.jsx("small",{className:"text-muted",children:"No se encontraron componentes"})}),"          ",a.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),a.jsx(x,{icon:"mdi mdi-cogs",rightBarToggle:!0,children:"Configuraciones"}),a.jsx(x,{icon:"mdi mdi-cloud-download",onClick:async()=>{const e=await F.exportBK(),a=new Blob([JSON.stringify(e)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="backup.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},children:"Exportar Backup"}),a.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async e=>{const a=e.target.files[0];if(e.target.value=null,a){const e=new FormData;e.append("backup",a);if(!(await F.importBK(e)))return;location.reload()}}}),a.jsx(x,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),a.jsx("div",{className:"clearfix"})]})})},L=({page:t,param:s,models:n,setUsing:l,setPages:i})=>{const r=e.useRef(),o=e.useRef(),c=e.useRef(),d=t?.using,[m,u]=e.useState(null);e.useEffect(()=>{$(r.current).val(d?.[s]?.model).trigger("change")},[s]),e.useEffect(()=>{l(e=>({...e,[s]:{...e[s],model:m?.name??null}})),$(o.current).val(d?.[s]?.field??null).trigger("change"),$(c.current).val(d?.[s]?.relations??[]).trigger("change")},[m]);const h=`${s}-container`;return a.jsxs("div",{id:h,className:"row",children:[a.jsxs("label",{className:"form-label",children:["Parámetro ",a.jsx("code",{children:s})]}),a.jsx(p,{eRef:r,label:"Modelo",col:"col-md-6",dropdownParent:`#${h}`,onChange:e=>{const a=r.current.value,t=n.find(e=>e.name==a)??null;u(t)},children:n.map((e,t)=>a.jsx("option",{value:e.name,children:e.name},t))}),a.jsx(p,{eRef:o,label:"Campo",col:"col-md-6",dropdownParent:`#${h}`,onChange:e=>{l(a=>({...a,[s]:{...a[s],field:e.target.value}}))},children:m?.fields?.map((e,t)=>a.jsx("option",{children:e},t))}),a.jsx("div",{hidden:0==(m?.relations?.length??0),children:a.jsx(p,{eRef:c,label:"Relaciones",multiple:!0,dropdownParent:`#${h}`,onChange:e=>{const a=$(e.target).val();l(e=>({...e,[s]:{...e[s],relations:a}}))},children:m?.relations?.map((e,t)=>a.jsx("option",{children:e},t))})})]})},B=new i,D=({dataLoaded:t,setDataLoaded:s,setPages:n,modalRef:l,models:i})=>{const r=v(t?.path??""),[o,c]=e.useState({});return e.useEffect(()=>{c(t?.using??{})},[t]),a.jsx(u,{modalRef:l,title:`Editar parámetros de URL - ${t?.name}`,onSubmit:async e=>{e.preventDefault();const a=await B.savePage({id:t.id,using:o});a&&(s(null),n(a),$(l.current).modal("hide"))},onClose:()=>s(null),children:r.map((e,s)=>a.jsx(L,{page:t,param:e,models:i,using:o,setUsing:c,setPages:n},s))})},z=new b,I=new g,M=new j,U=({colors:s,setColors:n,settings:l,setSettings:i})=>{const[r,o]=e.useState([{uuid:crypto.randomUUID(),col:"col-3",name:"Icon (1:1)",src:"icon.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-5",name:"Logo (13:4)",src:"logo.png",width:"100%",aspectRatio:3.25},{uuid:crypto.randomUUID(),col:"col-4",name:"Logo footer (1:1)",src:"logo-footer.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-12",name:"Loading (13:4)",src:"loading.png",width:"100%",aspectRatio:3.25}]),c=async e=>{const a=e.target.files?.[0]??null;if(!a)return;e.target.value=null;const t=e.target.name,s=new FormData;s.append("image",a),s.append("name",t);await z.save(s)&&o(e=>e.map(e=>(e.src==t&&(e.uuid=crypto.randomUUID()),e)))},d=async e=>{const a=e.target.getAttribute("data-color-id"),t=e.target.name,l=e.target.value;if(s.find(e=>e.id==a)[t]===l)return;const i=await I.save({id:a,[t]:l});i&&n(e=>e.map(e=>e.id==a?i.data:e))},m=async e=>{const a=e.target.getAttribute("data-id"),t=e.target.name;let s=e.target.value;"checkbox"==e.target.type&&(s=e.target.checked?"true":"false");if((l.find(e=>e.name==t)?.description??"")===s)return;const n=await M.save({name:t,value:s});n&&i(e=>e.map(e=>e.id==a?n.data:e))},u=e=>{const a=l.find(a=>a.name==e);return a?a.value:""};return a.jsx("div",{className:"right-bar",children:a.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[a.jsxs("div",{className:"rightbar-title",children:[a.jsx("a",{href:"#",className:"right-bar-toggle float-end",children:a.jsx("i",{className:"mdi mdi-close"})}),a.jsx("h4",{className:"font-16 m-0 text-white",children:"Configuraciones"})]}),a.jsxs("div",{className:"p-2",children:[a.jsx("h5",{children:"Imágenes principales"}),a.jsx("div",{className:"row",children:r.map((e,t)=>{const s="file-"+e.uuid;return a.jsxs("div",{className:e.col,children:[a.jsx("input",{id:s,name:e.src,type:"file",accept:"image/png",hidden:!0,onChange:c}),a.jsx("label",{htmlFor:s,className:"form-label d-block mb-1",style:{cursor:"pointer"},children:e.name}),a.jsx("label",{htmlFor:s,style:{cursor:"pointer"},className:"w-100",children:a.jsx("img",{className:"border",src:`/assets/resources/${e.src}?v=${e.uuid}`,alt:"",style:{height:e.height,width:e.width,objectFit:"contain",objectPosition:"center",backgroundColor:"#f5f5f5",borderRadius:"4px",aspectRatio:e.aspectRatio}})})]},t)})}),a.jsx("hr",{className:"my-2"}),a.jsx("h5",{children:"Fuentes del sistema"}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Titulos"}),a.jsx(t,{content:"Nombre de la fuente",children:a.jsx("input",{type:"text",className:"form-control form-control-sm mb-1",name:"title-font-name",defaultValue:u("title-font-name"),onBlur:m})}),a.jsx(t,{content:"Enlace de la fuente",children:a.jsx("textarea",{className:"form-control form-control-sm",rows:1,name:"title-font-url",defaultValue:u("title-font-url"),onBlur:m,style:{minHeight:27,fieldSizing:"content"}})}),a.jsx(t,{content:"Marcar si el archivo es un archivo de fuente (otf, woff, woff2, etc)",children:a.jsxs("div",{className:"form-check mt-1",children:[a.jsx("input",{type:"checkbox",className:"form-check-input",name:"title-font-source",id:"title-font-source",defaultChecked:"true"==u("title-font-source"),onBlur:m}),a.jsx("label",{className:"form-check-label",htmlFor:"title-font-source",children:"¿Es este un archivo de fuente?"})]})})]}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Parrafos"}),a.jsx(t,{content:"Nombre de la fuente",children:a.jsx("input",{type:"text",className:"form-control form-control-sm mb-1",name:"paragraph-font-name",defaultValue:u("paragraph-font-name"),onBlur:m})}),a.jsx(t,{content:"Enlace de la fuente",children:a.jsx("textarea",{className:"form-control form-control-sm",rows:1,name:"paragraph-font-url",defaultValue:u("paragraph-font-url"),onBlur:m,style:{minHeight:27,fieldSizing:"content"}})}),a.jsx(t,{content:"Marcar si el archivo es un archivo de fuente (otf, woff, woff2, etc)",children:a.jsxs("div",{className:"form-check mt-1",children:[a.jsx("input",{type:"checkbox",className:"form-check-input",name:"paragraph-font-source",id:"paragraph-font-source",defaultChecked:"true"==u("paragraph-font-source"),onBlur:m}),a.jsx("label",{className:"form-check-label",htmlFor:"paragraph-font-source",children:"¿Es este un archivo de fuente?"})]})})]}),a.jsx("hr",{className:"my-2"}),a.jsx("h5",{children:"Colores del sistema"}),a.jsx("div",{className:"d-flex flex-column gap-1",children:s.map((e,t)=>{const n=e.description?.startsWith("linear-gradient")||e.description?.startsWith("radial-gradient"),l="menu-admin"==e.name,i=s.find(e=>"primary"==e.name)?.description||"#6658dd";return a.jsxs("div",{children:[a.jsxs("div",{className:"input-group input-group-sm",children:[!n&&a.jsx("span",{className:"input-group-text px-1",children:a.jsx("input",{type:"color",name:"description","data-color-id":e.id,className:"p-0",style:{width:"20px",height:"20px",border:"1px solid #ced4da",borderRadius:"4px",cursor:"pointer"},defaultValue:e.description||i,onBlur:d})}),a.jsx("input",{type:"text",name:"name","data-color-id":e.id,className:"form-control form-control-sm",placeholder:"Color",defaultValue:e.name,onBlur:d,disabled:"primary"==e.name||l,style:{cursor:"primary"==e.name||l?"not-allowed":"text"}})]}),n?a.jsx("textarea",{name:"description","data-color-id":e.id,className:"form-control form-control-sm mt-1",placeholder:"Gradiente: linear-gradient(...)",defaultValue:e.description||"",onBlur:d,rows:2,style:{fontSize:"11px",minHeight:27,fieldSizing:"content"}}):a.jsx("input",{type:"text",name:"description","data-color-id":e.id,className:"form-control form-control-sm mt-1",placeholder:l?"Color del menú admin (por defecto: primary)":"Hex color",defaultValue:e.description||(l?i:""),onBlur:d,style:{fontSize:"11px"}})]},t)})})]})]})})},A=new i,V=({systems:s=[],pages:n=[],colors:l=[],components:i,models:r,settings:d=[]})=>{const m=e.useRef(null),p=e.useRef(null),h=e.useRef(null),f=e.useRef(null),[x,g]=e.useState(s),[j,b]=e.useState(n),[N,w]=e.useState(l),[k,R]=e.useState(d),[E,F]=e.useState(!1),[L,B]=e.useState(null),[z,I]=e.useState(null),[M,V]=e.useState(!1),[G,T]=e.useState(!1),[O,W]=e.useState(null),[H,q]=e.useState(!1),[Y,K]=e.useState(0),J=async e=>{const a=$(".tab-pane:visible").data("id")??null;e.page_id=a;const t=await A.save(e);if(!t)return;const s=t;g(e=>e.some(e=>e.id===s.id)?e.map(e=>e.id===s.id?s:e):[...e,s])},X=async e=>{await A.delete(e.id)&&g(a=>a.filter(a=>a.id!=e.id))},Z=e=>{const a=$(e.target).data("page-id"),t=$(e.target).data("page-path"),s=$(e.target).val();$(`#iframe-${a}`).removeAttr("src"),$(`#iframe-${a}`).attr("src",`${t}/${s}`)},Q=async e=>{B(e),$(m.current).modal("show")},ee=async e=>{B(e),$(p.current).modal("show")},ae=async(e,a)=>{I({...e,component:a}),$(f.current).modal("show")};e.useEffect(()=>{let e=null;return e=setInterval(async()=>{await(async()=>{if(H)return;if(M)return void clearInterval(e);const a=await A.hasRemoteChanges();a?(T(a.has_changes),W(a.last_commit),K(a.commits)):V(!0)})()},1e4),()=>clearInterval(e)},[M,H]),e.useEffect(()=>{const e=$("iframe:visible");e&&($(e).removeAttr("src"),$(e).attr("src",e.data("path")))},[x,N,k]),e.useEffect(()=>{[...$(".components-container")].forEach(e=>{try{$(e).hasClass("ui-sortable")&&$(e).sortable("destroy")}catch(a){}$(e).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(a,t){const s=[...$(e).children()],n={};if(s.forEach(e=>{const a=$(e).data("id"),t=$(e).prev().data("id")??null,s=x.find(e=>e.id==a);s?.after_component!==t&&(n[a]=t)}),Object.keys(n).length>0){if(!(await A.updateOrder(n)))return;g(e=>{const a=[...e];return Object.entries(n).forEach(([e,t])=>{const s=a.findIndex(a=>a.id==e);-1!==s&&(a[s]={...a[s],after_component:t})}),a})}}}).disableSelection()})},[j,x]),e.useEffect(()=>{document.title=`Sistema | ${o.APP_NAME}`},[]);const[te,se,ne]=O?.split("\n")??[];return a.jsxs(a.Fragment,{children:[a.jsxs("div",{id:"wrapper position-relative",children:[a.jsx(_,{components:i,onClick:J}),a.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:a.jsx("div",{className:"content mt-2",children:a.jsxs("div",{className:"container-fluid",children:[a.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),a.jsx("div",{className:"row",children:a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"card mb-0",children:a.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[a.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[a.jsx("li",{className:"nav-item",children:a.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),j.map((e,t)=>a.jsx("li",{className:"nav-item",children:a.jsxs("a",{href:`#page-${e.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[e.name,a.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:e.path})]})},t)),a.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:a.jsx(t,{content:"Agregar página",children:a.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:async()=>{F(!0);const e=await A.savePage();e&&(F(!1),b(e))},disabled:E,children:E?a.jsx("i",{className:"mdi mdi-loading mdi-spin"}):a.jsx("i",{className:"mdi mdi-plus"})})})})]}),a.jsxs("div",{className:"tab-content",children:[a.jsx("div",{className:"tab-pane active",id:"base-template",children:a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-4",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:a.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":null,children:c(x).filter(e=>null==e.page_id).map(e=>{i.find(a=>a.id==e.component);if("content"==e.component)return a.jsxs("button",{"data-id":e.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[a.jsx("i",{className:"fa fa-ellipsis-v"}),a.jsx("i",{className:"fa fa-ellipsis-v"}),a.jsx("span",{className:"ms-1",children:e.name})]},e.id);{const t=i.find(a=>a.id==e.component);return a.jsx(S,{className:"",system:e,component:t,onComponentClicked:J,onDeleteClicked:X,onEditDataClicked:ae},e.id)}})})}),a.jsx("div",{className:"col-md-8",children:a.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 200px)",borderRadius:"4px"}})})]})}),j.map((e,t)=>a.jsx("div",{className:"tab-pane",id:`page-${e.id}`,"data-id":e.id,children:a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-md-4",style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:[a.jsx(y,{...e,models:r,setPages:b,onSEOClicked:Q,onParamsClicked:ee}),a.jsx("hr",{className:"my-2"}),a.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":e.id,children:c(x).filter(a=>a.page_id==e.id).map(e=>{const t=i.find(a=>a.id==e.component);return a.jsx(S,{className:"",system:e,component:t,onComponentClicked:J,onDeleteClicked:X,onEditDataClicked:ae},e.id)})})]}),a.jsxs("div",{className:"col-md-8",children:[a.jsxs("div",{className:"input-group mb-2",children:[a.jsxs("span",{className:"input-group-text",children:[e?.pseudo_path||e.path,v(e?.path).length>0&&"/"]}),v(e?.path).length>0&&a.jsx("input",{type:"text",className:"form-control",placeholder:"Parametros","data-page-path":e.pseudo_path,"data-page-id":e.id,onChange:Z})]}),a.jsx("iframe",{id:`iframe-${e.id}`,src:e?.pseudo_path||e.path,"data-path":e?.pseudo_path||e.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 302px)",borderRadius:"4px"}})]})]})},t))]})]})})})})]})})}),G&&a.jsx(t,{content:`Tienes ${Y} cambios sin sincronizar`,children:a.jsxs("button",{className:"btn btn-dark p-0 position-absolute rounded-pill",style:{right:"20px",bottom:"20px",height:"40px",width:"40px"},onClick:()=>$(h.current).modal("show"),children:[a.jsx("small",{className:"position-absolute",style:{backgroundColor:"#ff5b5b",borderRadius:"50%",width:"18px",height:"18px",top:"-5px",left:"-5px"},children:Y}),a.jsx("i",{className:"mdi mdi-github mdi-24px"})]})})]}),a.jsx(u,{modalRef:h,title:"Cambios de Github",size:"sm",hideFooter:!0,children:a.jsxs("div",{className:"text-center",children:[a.jsx("i",{className:"mdi mdi-github mdi-48px"}),a.jsx("h5",{className:"mt-2",children:"Tienes cambios sin sincronizar"}),a.jsxs("div",{className:"mb-2 py-2",children:[a.jsx("b",{className:"d-block",children:te}),a.jsx("small",{className:"d-block text-muted",children:moment(se).fromNow()}),a.jsxs("span",{className:"d-block",children:["Commit: ",ne]})]}),a.jsx("button",{className:"btn btn-primary mb-2",type:"button",onClick:()=>(async()=>{q(!0);const e=await A.fetchRemoteChanges();q(!1),e&&location.reload()})(),disabled:H,children:H?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Sincronizando"]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"mdi mdi-cloud-download me-1"}),"Sincronizar"]})})]})}),a.jsx(U,{colors:N,setColors:w,settings:k,setSettings:R}),a.jsx(C,{dataLoaded:L,setDataLoaded:B,modalRef:m}),a.jsx(D,{dataLoaded:L,setDataLoaded:B,setPages:b,modalRef:p,models:r}),a.jsx(P,{dataLoaded:z,setDataLoaded:I,setSystems:g,modalRef:f})]})};l((e,t)=>{n.createRoot(e).render(a.jsx(V,{...t}))});

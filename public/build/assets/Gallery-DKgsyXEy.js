import{c as e,j as a,r as s}from"./vendor-react-DD0uBW7s.js";import{B as i}from"./Base-DQk4WKCZ.js";import{C as l}from"./CreateReactScript-C92mMLGn.js";import{G as r}from"./GalleryRest-PaineapJ.js";import{B as t}from"./BasicRest-BuuGWTMX.js";import{T as n,t as c}from"./GoogleSignInButton-BciphYP2.js";import"./vendor-swiper-BQwfPLwm.js";import"./Global-BAGAPG-V.js";import"./TippyButton-BXJTBPrK.js";import"./Logout-CJj-4dQc.js";import"./MenuItemContainer--0h9gV_W.js";import"./Menu-Cmvatiox.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";const o=new r,d=new class extends t{constructor(){super(),this.path="admin/gallery/config"}},m=({images:e=[],allImages:i=[],isDevelopment:l=!1,canEdit:r=!1,session:t={},hasRootRole:m=!1,imageVisibilityConfig:u={}})=>{const[p,x]=s.useState(e.map(e=>(e.uuid=crypto.randomUUID(),e))),[g,h]=s.useState(!1),[b,j]=s.useState({}),[f,v]=s.useState(!1),[N,y]=s.useState(!1),[w,C]=s.useState(null),[k,S]=s.useState({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),[E,I]=s.useState(!1),F=s.useRef(),R=s.useCallback(()=>{const e=t?.roles||t?.user?.roles;return m||(e?.some(e=>"Root"===e.name)??!1)},[m,t]),A=s.useMemo(()=>p,[p]),G=("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("local")||"8000"===window.location.port)&&(l||r);s.useEffect(()=>{$(".image-popup").magnificPopup({type:"image",closeOnContentClick:!0,mainClass:"mfp-fade",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]}})},[p]),s.useEffect(()=>{if(R()){const e={};i&&i.length>0&&i.forEach(a=>{if(a){const s=a.filename||a.src;e[s]=void 0===a.is_visible||a.is_visible}}),j(e)}},[i,R]);const z=async e=>{const a=e.target.files?.[0]??null;if(!a)return;e.target.value=null;const s=e.target.name;I(!0);try{const e=new FormData;e.append("image",a),e.append("name",s);if(!(await o.save(e)))return;x(e=>e.map(e=>(e.src==s&&(e.uuid=crypto.randomUUID()),e))),c.success("Imagen actualizada correctamente")}catch(i){c.error("Error al actualizar la imagen")}finally{I(!1)}};return a.jsxs("div",{className:"port",children:[a.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"mb-0",children:"Galería de Imágenes"}),a.jsx("small",{className:"text-muted",children:R()?"Administrador Root - Vista completa":"Vista de usuario"})]}),a.jsxs("div",{className:"d-flex gap-2",children:[R()&&a.jsxs("button",{type:"button",className:"btn btn-info",onClick:()=>h(!0),disabled:E,children:[a.jsx("i",{className:"mdi mdi-eye-settings me-1"}),"Gestionar Visibilidad"]}),G&&a.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>{S({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),C(null),y(!0)},disabled:E,children:[a.jsx("i",{className:"mdi mdi-plus me-1"}),"Agregar Nueva Imagen"]})]})]}),a.jsx("div",{className:"row portfolioContainer",children:A.map((e,s)=>{const i=e.name.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-");const l=!0===e.is_system;return a.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 natural personal",children:a.jsxs("div",{className:"gal-detail thumb",children:[l&&a.jsx("div",{style:{position:"absolute",top:"8px",left:"8px",zIndex:10,backgroundColor:"rgba(13, 110, 253, 0.9)",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"bold"},children:"SISTEMA"}),a.jsxs("div",{style:{position:"relative"},children:[a.jsx("img",{src:`/assets/resources/${e.src}?v=${e.uuid}`,className:"thumb-img img-fluid",alt:"work-thumbnail",onError:e=>e.target.src="/assets/resources/cover-404.svg",style:{aspectRatio:e.aspect,objectFit:"cover",objectPosition:"center",width:"100%"}}),a.jsxs("div",{className:"d-flex px-2 py-1 justify-content-center gap-1",style:{backgroundColor:"rgba(0, 0, 0, .25)",position:"absolute",bottom:0,width:"100%",borderRadius:"0 0 3px 3px"},children:[a.jsxs("a",{href:`/assets/resources/${e.src}`,className:"btn btn-xs btn-primary image-popup",title:e.name,children:[a.jsx("i",{className:"mdi mdi-eye me-1"}),"Abrir"]}),a.jsx("input",{type:"file",name:e.src,id:`image-${i}`,onChange:z,hidden:!0,accept:"image/*",disabled:E}),a.jsxs("label",{htmlFor:`image-${i}`,className:"btn btn-xs btn-dark "+(E?"disabled":""),children:[a.jsx("i",{className:"mdi mdi-image-edit me-1"}),"Cambiar"]}),G&&!l&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:"btn btn-xs btn-info",onClick:()=>((e,a)=>{S({title:e.name||e.title,filename:e.filename||e.src,description:e.description,src:e.src,fit:"cover",aspect:e.aspect,file:null}),C(a),y(!0)})(e,s),disabled:E,children:[a.jsx("i",{className:"mdi mdi-pencil me-1"}),"Editar"]}),a.jsxs("button",{type:"button",className:"btn btn-xs btn-danger",onClick:()=>(async e=>{if(p[e].is_system)c.error("No se pueden eliminar las imágenes del sistema");else if(confirm("¿Estás seguro de que quieres eliminar esta imagen?")){I(!0);try{const a=p.filter((a,s)=>s!==e),s=a.filter(e=>!e.is_system).map(e=>{const{uuid:a,is_system:s,...i}=e;return i});await d.save(s)&&(x(a),c.success("Imagen eliminada correctamente"))}catch(a){c.error("Error al eliminar la imagen")}finally{I(!1)}}})(s),disabled:E,children:[a.jsx("i",{className:"mdi mdi-delete me-1"}),"Eliminar"]})]}),G&&l&&a.jsxs("button",{type:"button",className:"btn btn-xs btn-secondary",title:"Imagen del sistema - Solo se puede cambiar el archivo",disabled:!0,children:[a.jsx("i",{className:"mdi mdi-information me-1"}),"Sistema"]})]})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("h4",{children:[e.name,l&&a.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"10px"},children:"SISTEMA"})]}),a.jsx("p",{className:"font-13 text-muted mb-2",children:e.description}),G&&a.jsxs("small",{className:"text-muted",children:["Aspect: ",e.aspect," | Archivo: ",e.filename||e.src,l&&a.jsx("span",{className:"text-primary",children:" | Imagen del sistema"})]})]})]})},s)})}),G&&N&&a.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:a.jsx("div",{className:"modal-dialog modal-lg",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h5",{className:"modal-title",children:null!==w?"Editar Imagen":"Agregar Nueva Imagen"}),a.jsx("button",{type:"button",className:"btn-close",onClick:()=>y(!1),disabled:E})]}),a.jsx("div",{className:"modal-body",children:a.jsxs("form",{children:[a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label",children:"Título de la imagen *"}),a.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Logo de login, Imagen de signup, etc.",value:k.title,onChange:e=>S({...k,title:e.target.value}),disabled:E}),a.jsx("small",{className:"text-muted",children:"Este es el nombre que se mostrará en el card"})]})}),a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label",children:"Nombre del archivo *"}),a.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: logo-login, bg-signup, header-email",value:k.filename,onChange:e=>S({...k,filename:e.target.value}),disabled:E}),a.jsx("small",{className:"text-muted",children:"Solo letras, números y guiones (sin espacios ni caracteres especiales)"})]})})]}),a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"form-label",children:["Seleccionar imagen ",null===w&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx("input",{type:"file",className:"form-control",accept:"image/*",onChange:e=>{const a=e.target.files?.[0]??null;if(a){if(!a.type.startsWith("image/"))return c.error("Por favor selecciona un archivo de imagen válido"),void(e.target.value=null);S(e=>({...e,file:a,src:a.name,filename:e.filename||a.name.split(".")[0]}))}},disabled:E}),a.jsx("small",{className:"text-muted",children:null===w?"Selecciona un archivo de imagen (JPG, PNG, GIF, SVG, etc.)":"Opcional: Selecciona una nueva imagen para reemplazar la actual"}),k.file&&a.jsx("div",{className:"mt-2",children:a.jsxs("small",{className:"text-success",children:[a.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Archivo seleccionado: ",k.file.name]})})]}),a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label",children:"Descripción"}),a.jsx("textarea",{className:"form-control",rows:"4",placeholder:"Descripción de dónde y cómo se usa esta imagen",value:k.description,onChange:e=>S({...k,description:e.target.value}),disabled:E})]})}),a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label",children:"Aspect Ratio"}),a.jsxs("select",{className:"form-select",value:k.aspect,onChange:e=>S({...k,aspect:e.target.value}),disabled:E,children:[a.jsx("optgroup",{label:"Cuadrados",children:a.jsx("option",{value:"1",children:"1:1 (Cuadrado)"})}),a.jsxs("optgroup",{label:"Horizontales (Landscape)",children:[a.jsx("option",{value:"4/3",children:"4:3 (Estándar)"}),a.jsx("option",{value:"16/9",children:"16:9 (Panorámico)"}),a.jsx("option",{value:"3/2",children:"3:2 (Fotografía)"}),a.jsx("option",{value:"21/9",children:"21:9 (Ultrawide)"}),a.jsx("option",{value:"5/3",children:"5:3 (Ancho)"}),a.jsx("option",{value:"2/1",children:"2:1 (Banner)"})]}),a.jsxs("optgroup",{label:"Verticales (Portrait)",children:[a.jsx("option",{value:"3/4",children:"3:4 (Vertical estándar)"}),a.jsx("option",{value:"9/16",children:"9:16 (Vertical móvil)"}),a.jsx("option",{value:"2/3",children:"2:3 (Fotografía vertical)"}),a.jsx("option",{value:"3/5",children:"3:5 (Vertical estrecho)"}),a.jsx("option",{value:"1/2",children:"1:2 (Vertical banner)"})]}),a.jsx("optgroup",{label:"Otros",children:a.jsx("option",{value:"auto",children:"Auto (Original)"})})]})]})})]})]})}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>y(!1),disabled:E,children:"Cancelar"}),a.jsx("button",{type:"button",className:"btn btn-primary",onClick:async()=>{if(k.title)if(k.filename)if(null!==w||k.file){I(!0);try{let e=k.src;if(k.file){const a=new FormData;a.append("image",k.file);const s=`${k.filename.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}.png`;a.append("name",s),a.append("convert_to_png","true");if(!(await o.save(a)))return void c.error("Error al subir la imagen");e=s}if(F.current?.getDeleteFlag&&F.current.getDeleteFlag()){const a=new FormData;a.append("image_delete","DELETE");if(!(await o.save(a)))return void c.error("Error al eliminar la imagen");e=null}const a=[...p],s={name:k.title,title:k.title,filename:k.filename,description:k.description,src:e,fit:"cover",aspect:k.aspect,uuid:crypto.randomUUID()};null!==w?a[w]=s:a.push(s);const i=a.filter(e=>!e.is_system).map(e=>{const{uuid:a,is_system:s,...i}=e;return i});await d.save(i)&&(x(a),y(!1),c.success(null!==w?"Imagen actualizada correctamente":"Nueva imagen agregada correctamente"))}catch(e){c.error("Error al guardar la configuración de la imagen")}finally{I(!1)}}else c.error("Por favor selecciona un archivo de imagen");else c.error("Por favor completa el nombre del archivo");else c.error("Por favor completa el título de la imagen")},disabled:E||!k.title||!k.filename||null===w&&!k.file,children:E?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Guardando..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"mdi mdi-content-save me-1"}),null!==w?"Actualizar":"Agregar"]})})]})]})})}),R()&&g&&a.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:a.jsx("div",{className:"modal-dialog modal-lg",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("h5",{className:"modal-title",children:[a.jsx("i",{className:"mdi mdi-eye-settings me-2"}),"Gestionar Visibilidad de Imágenes"]}),a.jsx("button",{type:"button",className:"btn-close",onClick:()=>h(!1),disabled:f})]}),a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"alert alert-info",children:[a.jsx("i",{className:"mdi mdi-information me-2"}),"Configura qué imágenes serán visibles para los usuarios que no tienen rol Root. Las imágenes desmarcadas solo serán visibles para administradores Root."]}),a.jsx("div",{className:"row",children:(i||p).map((e,s)=>{const i=e.filename||e.src,l=!0===e.is_system;return a.jsx("div",{className:"col-md-6 mb-3",children:a.jsx("div",{className:"card",children:a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsx("div",{className:"form-check form-switch me-3",children:a.jsx("input",{className:"form-check-input",type:"checkbox",id:`visibility-${i}`,checked:b[i]||!1,onChange:()=>(e=>{j(a=>({...a,[e]:!a[e]}))})(i),disabled:f})}),a.jsx("div",{className:"flex-grow-1",children:a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsx("img",{src:`/assets/resources/${e.src}?v=${e.uuid}`,alt:e.name,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px",marginRight:"10px"},onError:e=>e.target.src="/assets/resources/cover-404.svg"}),a.jsxs("div",{children:[a.jsxs("div",{className:"fw-bold",children:[e.name,l&&a.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"9px"},children:"SISTEMA"})]}),a.jsx("small",{className:"text-muted",children:e.filename||e.src})]})]})})]})})})},s)})})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>h(!1),disabled:f,children:"Cancelar"}),a.jsx("button",{type:"button",className:"btn btn-primary",onClick:async()=>{v(!0);try{if(0===Object.keys(b).length)return void c.error("No hay imágenes para actualizar");const e=await o.updateVisibility(b);e.success?(c.success("Configuración de visibilidad guardada correctamente"),h(!1),setTimeout(()=>{window.location.reload()},1e3)):c.error(e.message||"Error al guardar la configuración de visibilidad")}catch(e){c.error("Error al guardar la configuración de visibilidad: "+e.message)}finally{v(!1)}},disabled:f,children:f?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Guardando..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"mdi mdi-content-save me-1"}),"Guardar Configuración"]})})]})]})})}),a.jsx(n,{})]})};l((s,l)=>{e.createRoot(s).render(a.jsx(i,{...l,title:"Galeria",children:a.jsx(m,{...l})}))});

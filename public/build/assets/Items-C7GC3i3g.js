import{r as e,j as a,c as s,s as t}from"./vendor-react-CtPXetfm.js";import{B as r}from"./Base-B2hVq4yw.js";import{S as i}from"./SwitchFormGroup-CB0qoXn0.js";import{T as l}from"./TextareaFormGroup-DXMahSF1.js";import{S as n}from"./CartKuchara-Bi-J8T1O.js";import{I as c}from"./ItemsRest-DXSlb4uc.js";import{A as d}from"./AmenitiesRest-DrTcvXhd.js";import{A as o}from"./ApplicationsRest-DH7iaHgP.js";import{A as m}from"./AttributesRest-CHS98QVZ.js";import{M as p}from"./Modal-CUkY7A3F.js";import{T as u}from"./Table-CjNT5pP4.js";import{I as h}from"./ImageFormGroup-CyaCtphz.js";import{I as x}from"./InputFormGroup-CRGKsLQr.js";import{Q as f}from"./QuillFormGroup-Cfzk8gba.js";import{S as b}from"./SelectAPIFormGroup-BjT0ctnU.js";import{S as g}from"./SelectFormGroup-CgBsclqC.js";import{D as j}from"./DxButton-C6FT_beP.js";import{F as v,C as N}from"./CreateReactScript-Cjoo020C.js";import{C as y,N as w}from"./Number2Currency-BX4epFEo.js";import{R as k}from"./ReactAppend-RIOEhuYO.js";import{S as _}from"./SetSelectValue-DCHQOIKz.js";import{t as C}from"./OpenPayCardModal-CbSnHq7o.js";import{D as R}from"./DynamicField-o7RRwJxr.js";import{$ as S}from"./TopBarSimple-BsCVTNYS.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-coriRrmf.js";import"./TippyButton-Dqi9Vaf_.js";import"./Logout-DQyEsGXW.js";import"./MenuItemContainer-UDNHvqM7.js";import"./Menu-BjIZNCK0.js";import"./BasicRest-DtgqEuc9.js";import"./BooleanLimit-q2Ad9fGY.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";const D=new c,T=({gridRef:s,modalRef:t,excelTemplate:r})=>{const[i,l]=e.useState(null),[n,c]=e.useState(!1),[d,o]=e.useState(""),[m,p]=e.useState(!1),[u,h]=e.useState("reset");return a.jsxs("div",{className:"bg-white p-4",children:[a.jsx("div",{className:"mb-4 pb-3 border-bottom",children:a.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[a.jsx("h5",{className:"mb-0 text-dark fw-semibold",children:"Importar Productos"}),r&&a.jsxs("a",{href:`/cloud/${r}`,download:!0,className:"btn btn-sm btn-outline-secondary",children:[a.jsx("i",{className:"fas fa-download me-2"}),"Descargar Plantilla"]})]})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"form-label text-dark fw-semibold mb-3",children:"Modo de Importación"}),a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-md-6",children:a.jsx("div",{className:"card h-100 "+("reset"===u?"border-primary":"border"),style:{cursor:"pointer",transition:"all 0.2s ease",borderWidth:"reset"===u?"2px":"1px"},onClick:()=>h("reset"),children:a.jsx("div",{className:"card-body p-3",children:a.jsxs("div",{className:"d-flex align-items-start",children:[a.jsx("input",{className:"form-check-input mt-1 me-3 flex-shrink-0",type:"radio",name:"importMode",id:"modeReset",value:"reset",checked:"reset"===u,onChange:e=>h(e.target.value),style:{width:"20px",height:"20px",borderRadius:"50%"}}),a.jsxs("label",{className:"form-check-label flex-grow-1",htmlFor:"modeReset",style:{cursor:"pointer"},children:[a.jsxs("div",{className:"d-flex align-items-center mb-2",children:[a.jsx("div",{className:"d-flex align-items-center justify-content-center me-2",style:{width:"36px",height:"36px",borderRadius:"8px",background:"#6c757d",color:"white"},children:a.jsx("i",{className:"fas fa-redo-alt"})}),a.jsx("strong",{className:"text-dark",children:"Importar desde cero"})]}),a.jsx("small",{className:"text-muted",children:"Reemplaza todos los productos existentes con los del archivo Excel"})]})]})})})}),a.jsx("div",{className:"col-md-6",children:a.jsx("div",{className:"card h-100 "+("add_update"===u?"border-primary":"border"),style:{cursor:"pointer",transition:"all 0.2s ease",borderWidth:"add_update"===u?"2px":"1px"},onClick:()=>h("add_update"),children:a.jsx("div",{className:"card-body p-3",children:a.jsxs("div",{className:"d-flex align-items-start",children:[a.jsx("input",{className:"form-check-input mt-1 me-3 flex-shrink-0",type:"radio",name:"importMode",id:"modeAddUpdate",value:"add_update",checked:"add_update"===u,onChange:e=>h(e.target.value),style:{width:"20px",height:"20px",borderRadius:"50%"}}),a.jsxs("label",{className:"form-check-label flex-grow-1",htmlFor:"modeAddUpdate",style:{cursor:"pointer"},children:[a.jsxs("div",{className:"d-flex align-items-center mb-2",children:[a.jsx("div",{className:"d-flex align-items-center justify-content-center me-2",style:{width:"36px",height:"36px",borderRadius:"8px",background:"#0d6efd",color:"white"},children:a.jsx("i",{className:"fas fa-sync-alt"})}),a.jsx("strong",{className:"text-dark",children:"Agregar / Actualizar"})]}),a.jsx("small",{className:"text-muted",children:"Actualiza productos existentes (por SKU) o agrega nuevos sin eliminar"})]})]})})})})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"form-label text-dark fw-semibold mb-2",children:"Archivo Excel"}),a.jsx("input",{className:"form-control form-control-lg",type:"file",accept:".xlsx,.xls",onChange:e=>{l(e.target.files[0])}}),i&&a.jsxs("div",{className:"mt-2 p-2 bg-light rounded d-flex align-items-center",children:[a.jsx("i",{className:"fas fa-file-excel text-success me-2",style:{fontSize:"20px"}}),a.jsx("div",{className:"flex-grow-1",children:a.jsx("span",{className:"text-dark",children:i.name})}),a.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:()=>l(null),children:a.jsx("i",{className:"fas fa-times"})})]})]}),a.jsx("button",{onClick:async()=>{if(!i)return o("Por favor, selecciona un archivo."),void p(!0);const e=new FormData;e.append("file",i),e.append("mode",u),c(!0);try{const a=await D.importData(e);if(a.error){const e=Array.isArray(a.error)?a.error.join("\n"):a.error;o(`Error en la importación:\n${e}`),p(!0)}else o(a.message),p(!1),$(s.current).dxDataGrid("instance").refresh(),$(t.current).modal("hide"),C.success("Importacion completada con exito",{description:"Todos tus productos han sido importados correctamente.",duration:3e3,position:"bottom-center",richColors:!0})}catch(a){o("Error al importar: "+(a.response?.data?.error||a.message)),p(!0)}c(!1)},disabled:n||!i,className:"btn btn-primary btn-lg w-100",type:"button",children:n?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Procesando..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-upload me-2"}),"Importar Productos"]})}),d&&a.jsx("div",{className:`alert ${m?"alert-danger":"alert-success"} mt-3 mb-0`,role:"alert",children:a.jsxs("div",{className:"d-flex align-items-start",children:[a.jsx("i",{className:`fas ${m?"fa-exclamation-circle":"fa-check-circle"} me-2 mt-1`}),a.jsxs("div",{className:"flex-grow-1",children:[a.jsx("strong",{children:m?"Error":"Completado"}),a.jsx("div",{className:"mt-1",children:d})]})]})})]})},E=new c,A=new m,F=({isOpen:s,onClose:t,item:r,gridRef:i,onRefreshGrid:l})=>{const[c,d]=e.useState([]),[o,m]=e.useState(!1),[p,u]=e.useState([]),[h,f]=e.useState(!1),[b,j]=e.useState([]),[N,w]=e.useState(!1),[k,_]=e.useState(!1),[C,R]=e.useState([]),[D,T]=e.useState([]),[F,$]=e.useState([]),[I,P]=e.useState(null),[O,L]=e.useState([]),[M,G]=e.useState([]),[z,U]=e.useState(!0),[B,V]=e.useState([]),W={price:e.useRef(),sku:e.useRef()};e.useEffect(()=>{s&&K()},[s]);const K=async()=>{const e=await A.paginate({page:1,pageSize:1e3});e?.data&&$(e.data)};e.useEffect(()=>{s&&r?.agrupador&&J()},[s,r]),e.useEffect(()=>{N||S(".select2-container--open").remove()},[N]);const J=async()=>{if(r?.agrupador){m(!0);try{const e=await fetch(`/api/admin/items/variants/${r.agrupador}`),a=await e.json();d(a)}catch(e){}finally{m(!1)}}},q=async(e,a,s)=>{try{await fetch(`/api/admin/items/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":S('meta[name="csrf-token"]').attr("content")},body:JSON.stringify({[a]:s})})}catch(t){}},H=e.useMemo(()=>{if(!h||0===c.length)return c.map(e=>({...e,rowType:"variant"}));const e={};c.forEach(a=>{const s=(a.sku||"").trim(),t=s.lastIndexOf("-"),r=t>0?s.substring(0,t):"Varios";e[r]||(e[r]=[]),e[r].push(a)});const a=[];return Object.keys(e).sort().forEach(s=>{const t=b.includes(s);a.push({id:`header-${s}`,name:s,rowType:"header",count:e[s].length,isExpanded:t,allSelected:e[s].every(e=>p.includes(e.id))}),t&&e[s].forEach(e=>a.push({...e,rowType:"variant"}))}),a},[c,h,p,b]),X=()=>{const[s,t]=e.useState("main"),[r,i]=e.useState(null),[l,d]=e.useState([]),[o,m]=e.useState([]);return a.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.7)",zIndex:1085},children:a.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:a.jsxs("div",{className:"modal-content border-0 shadow-lg p-2",children:[a.jsxs("div",{className:"modal-header border-0 pb-0",children:[a.jsxs("h5",{className:"modal-title fw-bold",children:["Multimedia Masiva (",p.length,")"]}),a.jsx("button",{type:"button",className:"btn-close",onClick:()=>_(!1)})]}),a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"nav nav-tabs nav-tabs-custom nav-justified mb-3",children:[a.jsx("button",{className:"nav-link cursor-pointer border-0 "+("main"===s?"active":""),onClick:()=>t("main"),children:"Principal"}),a.jsx("button",{className:"nav-link cursor-pointer border-0 "+("gallery_add"===s?"active":""),onClick:()=>t("gallery_add"),children:"+ Galería"}),a.jsx("button",{className:"nav-link cursor-pointer border-0 "+("gallery_replace"===s?"active":""),onClick:()=>t("gallery_replace"),children:"Reemplazar Galería"}),a.jsx("button",{className:"nav-link cursor-pointer border-0 "+("gallery_clear"===s?"active text-danger":""),onClick:()=>t("gallery_clear"),children:"Vaciar Galería"})]}),a.jsxs("div",{className:"tab-content text-center py-2",children:["main"===s&&a.jsxs("label",{className:"btn btn-outline-primary d-block py-4 border-dashed cursor-pointer",children:[a.jsx("i",{className:"fas fa-image fa-2x mb-2 d-block"})," ","Seleccionar Imagen Principal",a.jsx("input",{type:"file",hidden:!0,onChange:e=>{const a=e.target.files[0];i(a),a&&m([URL.createObjectURL(a)])}}),r&&a.jsx("img",{src:o[0],className:"mt-3 rounded shadow-sm d-block mx-auto",style:{height:"80px"}})]}),("gallery_add"===s||"gallery_replace"===s)&&a.jsxs("label",{className:"btn btn-outline-primary d-block py-4 border-dashed cursor-pointer",children:[a.jsx("i",{className:"fas fa-images fa-2x mb-2 d-block"})," ","Seleccionar Fotos para Galería",a.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:e=>{const a=Array.from(e.target.files);d(a),m(a.map(e=>URL.createObjectURL(e)))}}),a.jsx("div",{className:"d-flex flex-wrap gap-1 justify-content-center mt-3",children:o.map((e,s)=>a.jsx("img",{src:e,className:"rounded border",style:{width:"40px",height:"40px",objectFit:"cover"}},s))})]}),"gallery_clear"===s&&a.jsx("div",{className:"alert alert-soft-danger m-0 py-4 text-center",children:"¿Estás seguro de eliminar las galerías?"})]})]}),a.jsxs("div",{className:"modal-footer border-0",children:[a.jsx("button",{className:"btn btn-light",onClick:()=>_(!1),children:"Cancelar"}),a.jsx("button",{className:"btn btn-primary px-4 fw-bold shadow",onClick:async()=>{if(0!==p.length){n.fire({title:"Actualizando...",allowOutsideClick:!1,didOpen:()=>n.showLoading()});try{for(const e of p){const a=c.find(a=>a.id===e),t=new FormData;t.append("id",e),"main"===s&&r?t.append("image",r):"gallery_add"===s&&l.length>0?l.forEach(e=>t.append("gallery[]",e)):"gallery_replace"===s?(a.images?.length>0&&a.images.forEach(e=>t.append("deleted_images[]",e.id)),l.length>0&&l.forEach(e=>t.append("gallery[]",e))):"gallery_clear"===s&&a.images?.length>0&&a.images.forEach(e=>t.append("deleted_images[]",e.id)),await fetch("/api/admin/items/media-update",{method:"POST",headers:{"X-CSRF-TOKEN":S('meta[name="csrf-token"]').attr("content")},body:t})}n.close(),_(!1),J()}catch(e){n.fire("Error","Error en actualización","error")}}},children:"Aplicar Cambios"})]})]})})})};return s?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:a.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",children:a.jsxs("div",{className:"modal-content border-0 shadow-lg overflow-hidden",style:{borderRadius:"16px"},children:[a.jsxs("div",{className:"modal-header bg-white border-bottom py-3",children:[a.jsxs("div",{className:"lh-1",children:[a.jsxs("h5",{className:"modal-title fw-bold text-dark d-flex align-items-center",children:[a.jsx("i",{className:"fas fa-tasks me-2 text-primary"})," ","Gestión de Variantes"]}),a.jsx("small",{className:"text-muted ms-4",children:r?.name})]}),a.jsx("button",{type:"button",className:"btn-close",onClick:t})]}),a.jsxs("div",{className:"modal-body p-0",children:[a.jsxs("div",{className:"bg-light p-3 border-bottom d-flex justify-content-between align-items-center sticky-top shadow-sm",style:{zIndex:1030,top:0,minHeight:"70px"},children:[a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[a.jsxs("button",{className:"btn btn-primary rounded-pill px-4 shadow-sm fw-bold",onClick:()=>{R([]),T([]),P(null),G([]),L([]),U(!!r?.image),V(r?.images?.map(e=>e.id)||[]),w(!0),setTimeout(()=>{W.price.current&&(W.price.current.value=r.price),W.sku.current&&(W.sku.current.value=r.sku)},100)},children:[a.jsx("i",{className:"fas fa-plus me-2"})," ","Generar Masivo"]}),a.jsxs("div",{className:"form-check form-switch bg-white rounded-pill border px-3 py-1 shadow-sm ms-2",children:[a.jsx("input",{className:"form-check-input ms-0 me-2",type:"checkbox",id:"skuGroupSwitch",checked:h,onChange:e=>f(e.target.checked)}),a.jsx("label",{className:"form-check-label small fw-bold text-dark cursor-pointer",htmlFor:"skuGroupSwitch",children:"Agrupar por SKU"})]})]}),a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[p.length>0&&a.jsxs("div",{className:"d-flex gap-2",children:[a.jsxs("button",{className:"btn btn-soft-info btn-sm rounded-pill px-3 fw-bold",onClick:()=>_(!0),children:[a.jsx("i",{className:"fas fa-photo-video me-1"})," ","Multimedia"]}),a.jsxs("button",{className:"btn btn-soft-danger btn-sm rounded-pill px-3 fw-bold",onClick:async()=>{if((await n.fire({title:"¿Borrar seleccionados?",icon:"warning",showCancelButton:!0})).isConfirmed){for(const e of p)await fetch(`/api/admin/items/variant/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":S('meta[name="csrf-token"]').attr("content")}});u([]),J(),l&&l()}},children:[a.jsx("i",{className:"fas fa-trash-alt me-1"})," ","Borrar"]})]}),a.jsx("button",{className:"btn btn-outline-secondary btn-sm rounded-circle shadow-sm",onClick:J,children:a.jsx("i",{className:"fas fa-sync-alt"})})]})]}),o?a.jsx("div",{className:"text-center py-5",children:a.jsx("div",{className:"spinner-border text-primary"})}):a.jsx("div",{children:a.jsxs("table",{className:"table table-hover align-middle mb-0",style:{borderCollapse:"separate",borderSpacing:0},children:[a.jsx("thead",{children:a.jsxs("tr",{className:"small text-muted text-uppercase",children:[a.jsx("th",{className:"ps-4 bg-white border-bottom",style:{width:"50px"},children:a.jsx("input",{type:"checkbox",className:"form-check-input",checked:p.length===c.length&&c.length>0,onChange:e=>u(e.target.checked?c.map(e=>e.id):[])})}),a.jsx("th",{className:"bg-white border-bottom",children:"Variante"}),v.has("items","is_attributes")&&a.jsx("th",{className:"bg-white border-bottom",style:{width:"150px"},children:"Atributos"}),v.has("items","price")&&a.jsx("th",{className:"bg-white border-bottom",style:{width:"150px"},children:"Precio"}),v.has("items","stock")&&a.jsx("th",{className:"bg-white border-bottom",style:{width:"120px"},children:"Stock"}),a.jsx("th",{className:"text-center bg-white border-bottom",children:"Acciones"})]})}),a.jsx("tbody",{children:0===c.length?a.jsx("tr",{children:a.jsx("td",{colSpan:v.has("items","is_attributes")+v.has("items","price")+v.has("items","stock")+3,className:"text-center py-5 text-muted small",children:"No hay variantes creadas para este item."})}):H.map(e=>"header"===e.rowType?a.jsxs("tr",{className:(e.isExpanded?"bg-soft-primary":"")+" cursor-pointer align-middle",onClick:()=>{return a=e.name,void j(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},children:[a.jsx("td",{className:"ps-4",onClick:e=>e.stopPropagation(),children:a.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.allSelected,onChange:a=>((e,a)=>{const s=c.filter(a=>{const s=(a.sku||"").trim(),t=s.lastIndexOf("-");return(t>0?s.substring(0,t):"Varios")===e}).map(e=>e.id);u(e=>a?Array.from(new Set([...e,...s])):e.filter(e=>!s.includes(e)))})(e.name,a.target.checked)})}),a.jsx("td",{colSpan:v.has("items","is_attributes")+v.has("items","price")+v.has("items","stock")+2,className:"fw-bold text-primary small",children:a.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[a.jsxs("span",{children:[a.jsx("i",{className:`fas ${e.isExpanded?"fa-folder-open":"fa-folder"} me-2`}),"GRUPO SKU:"," ",e.name," ","(",e.count,")"]}),a.jsx("i",{className:`fas ${e.isExpanded?"fa-chevron-up":"fa-chevron-down"} x-small text-black opacity-50`})]})})]},e.id):a.jsxs("tr",{className:p.includes(e.id)?"table-active":"",children:[a.jsx("td",{className:"ps-4",children:a.jsx("input",{type:"checkbox",className:"form-check-input",checked:p.includes(e.id),onChange:()=>u(a=>a.includes(e.id)?a.filter(a=>a!==e.id):[...a,e.id])})}),a.jsx("td",{children:a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsxs("div",{className:"position-relative",children:[a.jsx("img",{src:e.image?`/storage/images/item/${e.image}`:"/storage/utils/cover-404.svg",className:"rounded shadow-sm border",style:{width:"38px",height:"38px",objectFit:"cover"}}),e.images?.length>0&&a.jsx("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-info",style:{fontSize:"8px",transform:"translate(-50%, -50%)"},children:e.images.length})]}),a.jsxs("div",{className:"ms-3 lh-1",children:[a.jsx("div",{className:"fw-bold text-dark small",children:e.name}),v.has("items","sku")&&a.jsx("small",{className:"text-muted fw-bold x-small",children:e.sku})]})]})}),v.has("items","is_attributes")&&a.jsx("td",{children:a.jsx("div",{className:"d-flex flex-wrap gap-1",children:e.attributes?.map(e=>a.jsxs("span",{className:"badge bg-soft-secondary text-secondary x-small py-1 border",children:[e.name,":"," ",e.pivot?.value]},e.id))})}),v.has("items","price")&&a.jsx("td",{children:a.jsxs("div",{className:"input-group input-group-sm",children:[a.jsx("span",{className:"input-group-text bg-white",children:y()}),a.jsx("input",{type:"number",className:"form-control",defaultValue:e.price,onBlur:a=>q(e.id,"price",a.target.value)})]})}),v.has("items","stock")&&a.jsx("td",{children:a.jsx("input",{type:"number",className:"form-control form-control-sm",defaultValue:e.stock,onBlur:a=>q(e.id,"stock",a.target.value)})}),a.jsx("td",{className:"text-center",children:a.jsx("button",{className:"btn btn-sm text-danger",onClick:async()=>{(await n.fire({title:"¿Eliminar?",icon:"warning",showCancelButton:!0})).isConfirmed&&(await fetch(`/api/admin/items/variant/${e.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":S('meta[name="csrf-token"]').attr("content")}}),J(),l&&l())},children:a.jsx("i",{className:"fas fa-trash"})})})]},e.id))})]})})]})]})})}),N&&a.jsx("div",{id:"generatorModal",className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.6)",zIndex:1060},children:a.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable",children:a.jsxs("div",{className:"modal-content border-0 shadow-2xl rounded-4 overflow-hidden",children:[a.jsxs("div",{className:"modal-header bg-primary text-white py-3 border-0",children:[a.jsxs("h5",{className:"modal-title fw-bold",children:[a.jsx("i",{className:"fas fa-magic me-2"})," ","Generador de Variantes"]}),a.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>w(!1)})]}),a.jsx("div",{className:"modal-body p-4 bg-light",children:a.jsxs("div",{className:"row g-4",children:[a.jsx("div",{className:"col-md-5",children:a.jsxs("div",{className:"card border-0 shadow-sm rounded-3 h-100 p-3",children:[a.jsx("h6",{className:"text-primary fw-bold mb-3 border-bottom pb-2",children:"Configuración Base"}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{className:"form-label x-small fw-bold text-muted",children:"Nombre de Variantes (Automático)"}),a.jsx("input",{className:"form-control bg-light",value:r.name,disabled:!0})]}),a.jsxs("div",{className:"row g-2 mb-3",children:[v.has("items","price")&&a.jsx("div",{className:"col-6",children:a.jsx(x,{eRef:W.price,label:"Precio Base",type:"number"})}),v.has("items","sku")&&a.jsx("div",{className:"col-6",children:a.jsx(x,{eRef:W.sku,label:"Prefijo SKU"})})]}),a.jsx("h6",{className:"text-primary fw-bold mb-2 border-bottom pb-2",children:"Multimedia Compartida"}),a.jsxs("div",{className:"row g-2 mb-3",children:[a.jsx("div",{className:"col-4",children:a.jsxs("div",{className:"bg-white rounded border-dashed p-1 text-center position-relative overflow-hidden",style:{minHeight:"70px"},children:[I?a.jsx("img",{src:I,className:"img-fluid rounded"}):z&&r?.image?a.jsx("img",{src:`/storage/images/item/${r.image}`,className:"img-fluid rounded opacity-50"}):a.jsx("i",{className:"fas fa-image fa-2x mt-2 text-muted"}),a.jsx("input",{type:"file",hidden:!0,id:"gen-main-img",onChange:e=>{const a=e.target.files[0];a&&(P(URL.createObjectURL(a)),U(!1))}}),a.jsx("label",{htmlFor:"gen-main-img",className:"stretched-link cursor-pointer"})]})}),a.jsx("div",{className:"col-8",children:a.jsxs("div",{className:"bg-white rounded border p-2 d-flex flex-wrap gap-1",style:{minHeight:"70px"},children:[B.map(e=>a.jsxs("div",{className:"position-relative",children:[a.jsx("img",{src:`/storage/images/item/${r.images?.find(a=>a.id===e)?.url}`,style:{width:"28px",height:"28px",objectFit:"cover",opacity:.6},className:"rounded"}),a.jsx("button",{onClick:()=>V(a=>a.filter(a=>a!==e)),className:"btn btn-danger btn-xs position-absolute top-0 end-0 p-0",style:{width:"10px",height:"10px",fontSize:"6px"},children:"x"})]},e)),O.map((e,s)=>a.jsxs("div",{className:"position-relative",children:[a.jsx("img",{src:e,style:{width:"28px",height:"28px",objectFit:"cover"},className:"rounded border"}),a.jsx("button",{onClick:()=>{L(e=>e.filter((e,a)=>a!==s)),G(e=>e.filter((e,a)=>a!==s))},className:"btn btn-danger btn-xs position-absolute top-0 end-0 p-0",style:{width:"10px",height:"10px",fontSize:"6px"},children:"x"})]},s)),a.jsxs("label",{className:"btn btn-outline-dashed btn-xs d-flex align-items-center justify-content-center p-0 m-0",style:{width:"28px",height:"28px"},children:[a.jsx("i",{className:"fas fa-plus x-small"}),a.jsx("input",{type:"file",multiple:!0,hidden:!0,onChange:e=>{const a=Array.from(e.target.files);G(e=>[...e,...a]),L(e=>[...e,...a.map(e=>URL.createObjectURL(e))])}})]})]})})]}),v.has("items","is_attributes")&&a.jsxs(a.Fragment,{children:[a.jsx("h6",{className:"text-primary fw-bold mb-2 border-bottom pb-2",children:"Atributos"}),a.jsxs("select",{className:"form-select mb-2",onChange:e=>{const a=e.target.value;if(!a)return;const s=F.find(e=>e.id==a);s&&R(e=>[...e,{attribute_id:a,attribute:s,values:[]}]),e.target.value=""},children:[a.jsx("option",{value:"",children:"+ Añadir Atributo..."}),F.filter(e=>!C.find(a=>a.attribute_id==e.id)).map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),a.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:C.map((e,s)=>a.jsxs("div",{className:"bg-white border rounded p-2 mb-2",children:[a.jsxs("div",{className:"d-flex justify-content-between mb-1 small fw-bold",children:[e.attribute.name,a.jsx("button",{onClick:()=>R(e=>e.filter((e,a)=>a!==s)),className:"btn btn-xs text-danger p-0",children:"x"})]}),a.jsx(g,{multiple:!0,tags:!0,dropdownParent:"#generatorModal",onChange:e=>{const a=S(e.target).val();R(e=>{const t=[...e];return t[s].values=a||[],t})},children:e.attribute.options?.map((e,s)=>a.jsx("option",{value:e,children:e},s))})]},s))})]}),a.jsx("button",{className:"btn btn-primary w-100 mt-3 py-2 fw-bold",onClick:()=>{const e=C.filter(e=>e.values&&e.values.length>0);if(0===e.length)return void n.fire("Atención","Selecciona al menos un atributo y sus valores","warning");const a=(e,s,...t)=>s?a(((e,a)=>[].concat(...e.map(e=>a.map(a=>[].concat(e,a)))))(e,s),...t):e,s=e.map(e=>e.values.map(a=>({attribute_id:e.attribute_id,attribute_name:e.attribute.name,value:a}))),t=1===s.length?s[0].map(e=>[e]):a(...s),i=r.name,l=W.price.current?.value||r.price,d=W.sku.current?.value||r.sku||"SKU";let o=1;if(c&&c.length>0){const e=c.reduce((e,a)=>{const s=(a.sku||"").split("-"),t=parseInt(s[s.length-1]);return!isNaN(t)&&t>e?t:e},0);o=e+1}const m=t.map((e,a)=>{const s=e.map(e=>e.value).join(" - ");return{id:`new-${a}`,name:`${i} - ${s}`,price:l,stock:0,sku:`${d}-${o+a}`,attributes:e}});T(m)},disabled:0===C.length&&v.has("items","is_attributes"),children:"Generar Previsualización"})]})}),a.jsx("div",{className:"col-md-7",children:a.jsxs("div",{className:"card border-0 shadow-sm rounded-3 h-100 overflow-hidden",children:[a.jsxs("div",{className:"card-header bg-white py-2 fw-bold text-dark border-0",children:["Lista de Combinaciones (",D.length,")"]}),a.jsx("div",{className:"card-body p-0",children:a.jsx("div",{className:"table-responsive",style:{maxHeight:"550px"},children:a.jsxs("table",{className:"table table-sm table-hover mb-0",children:[a.jsx("thead",{className:"table-light sticky-top",children:a.jsxs("tr",{children:[a.jsx("th",{className:"ps-3 py-2",children:"#"}),a.jsx("th",{children:"Nombre"}),v.has("items","price")&&a.jsx("th",{style:{width:"90px"},children:"Precio"}),v.has("items","sku")&&a.jsx("th",{children:"SKU"})]})}),a.jsx("tbody",{children:0===D.length?a.jsx("tr",{children:a.jsx("td",{colSpan:v.has("items","price")+v.has("items","sku")+2,className:"text-center py-5 text-muted small",children:"Sin combinaciones"})}):D.map((e,s)=>a.jsxs("tr",{children:[a.jsx("td",{className:"ps-3 py-2 small text-muted",children:s+1}),a.jsxs("td",{children:[v.has("items","name")?a.jsx("input",{className:"form-control form-control-xs fw-bold border-0 bg-transparent",value:e.name,onChange:e=>{const a=[...D];a[s].name=e.target.value,T(a)}}):a.jsx("span",{className:"small fw-bold",children:e.name}),v.has("items","is_attributes")&&a.jsx("div",{className:"x-small text-muted ps-1",children:e.attributes.map(e=>`${e.attribute_name}:${e.value}`).join(", ")})]}),v.has("items","price")&&a.jsx("td",{children:a.jsx("input",{type:"number",className:"form-control form-control-xs border-0 bg-transparent",value:e.price,onChange:e=>{const a=[...D];a[s].price=e.target.value,T(a)}})}),v.has("items","sku")&&a.jsx("td",{children:a.jsx("input",{className:"form-control form-control-xs border-0 bg-transparent",value:e.sku,onChange:e=>{const a=[...D];a[s].sku=e.target.value,T(a)}})})]},e.id))})]})})})]})})]})}),a.jsxs("div",{className:"modal-footer bg-white border-0 py-3 px-4",children:[a.jsx("button",{className:"btn btn-link text-muted",onClick:()=>w(!1),children:"Cancelar"}),a.jsx("button",{className:"btn btn-success px-5 rounded-pill shadow-lg fw-bold",onClick:async()=>{try{n.fire({title:"Guardando...",allowOutsideClick:!1,didOpen:()=>n.showLoading()});const e=r.agrupador||crypto.randomUUID();for(const a of D){const s=new FormData;if(s.append("agrupador",e),s.append("name",a.name),s.append("price",a.price),s.append("stock",a.stock),s.append("sku",a.sku),s.append("is_master","0"),r.category_id&&s.append("category_id",r.category_id),r.subcategory_id&&s.append("subcategory_id",r.subcategory_id),r.brand_id&&s.append("brand_id",r.brand_id),I){const e=await fetch(I),a=await e.blob();s.append("image",a,"variant.jpg")}else z||s.append("skip_clone_image","1");M.length>0&&M.forEach(e=>s.append("gallery[]",e)),r.id&&(s.append("clone_images_from",r.id),B.length>0&&B.forEach(e=>s.append("clone_gallery_ids[]",e)));const t=a.attributes.map(e=>({id:e.attribute_id,value:e.value}));s.append("attributes",JSON.stringify(t)),await E.save(s)}n.fire("Éxito","Variantes creadas","success"),w(!1),J(),l&&l()}catch(e){n.fire("Error","Error al procesar","error")}},disabled:0===D.length,children:"Guardar Variantes"})]})]})})}),k&&a.jsx(X,{})]}):null},I=new c;new d;const P=new o,O=new m,L=({categories:s,brands:r,collections:c,stores:d,generals:o,attributes:m})=>{
//!FALTA EDIT AND DELETEDE GALERIA
const[N,C]=e.useState([]),S=e.useRef(),D=e.useRef(),E=e.useRef(),A=e.useRef(),L=e.useRef(),M=e.useRef(),G=e.useRef(),z=e.useRef(),U=e.useRef(),B=e.useRef(),V=e.useRef(),W=e.useRef(),K=e.useRef(),J=e.useRef(),q=e.useRef(),H=e.useRef(),X=e.useRef(),Q=e.useRef(),Y=e.useRef(),Z=e.useRef(),ee=e.useRef(),ae=e.useRef(),se=e.useRef([]),te=e.useRef([]),re=e.useRef(),ie=e.useRef(),le=e.useRef(),[ne,ce]=e.useState(!1),[de,oe]=e.useState(null),[me,pe]=e.useState(null),[ue,he]=e.useState(null),[xe,fe]=e.useState([]),be=e.useRef(),[ge,je]=e.useState([]),ve=e.useRef(),[Ne,ye]=e.useState([]),we=e.useRef(),[ke,_e]=e.useState([]),[Ce,Re]=e.useState([]),[Se,De]=e.useState(m||[]),[Te,Ee]=e.useState([]),[Ae,Fe]=e.useState(!1),[$e,Ie]=e.useState(null),[Pe,Oe]=e.useState(!1);e.useEffect(()=>{Le(),Me()},[]);const Le=async()=>{const e=await P.paginate({page:1,pageSize:1e3});e?.data&&Re(e.data)},Me=async()=>{const e=await O.paginate({page:1,pageSize:1e3});e?.data&&De(e.data)},[Ge,ze]=e.useState(null),Ue=()=>{ze(null)},Be=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[Ve,We]=e.useState(null),Ke=()=>{We(null)},Je=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[qe,He]=e.useState(null),Xe=()=>{He(null)},Qe=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},Ye=e=>{if(C(e||null),ce(!!e?.id),E.current&&(E.current.value=e?.id||""),Z.current&&(Z.current.value=e?.agrupador||""),$(A.current).val(e?.category_id||null).trigger("change"),$(L.current).val(e?.collection_id||null).trigger("change"),_(M.current,e?.subcategory?.id,e?.subcategory?.name),$(G.current).val(e?.brand_id||null).trigger("change"),$(ae.current).val(e?.store_id&&""!==e.store_id?e.store_id:"").trigger("change"),z.current&&(z.current.value=e?.name||""),Y.current&&(Y.current.value=e?.sku||""),Z.current&&(Z.current.value=e?.agrupador||""),U.current&&(U.current.value=e?.color||""),B.current&&(B.current.value=e?.size||""),V.current&&(V.current.value=e?.summary||""),W.current&&(W.current.value=e?.price||0),K.current&&(K.current.value=e?.discount||0),re.current&&(re.current.value=e?.weight||0),_(J.current,e?.tags??[],"id","name"),q.current&&(q.current.value=null),H.current&&(H.current.value=null),q.image&&(q.image.src=e?.banner?`/storage/images/item/${e.banner}`:""),H.image&&(H.image.src=e?.image?`/storage/images/item/${e.image}`:""),X.image&&(X.image.src=e?.texture?`/storage/images/item/${e.texture}`:""),Q.editor&&(Q.editor.root.innerHTML=e?.description??""),e?.pdf&&Array.isArray(e.pdf)){const a=e.pdf.map(e=>({url:e.url?`/storage/images/item/${e.url}`:e,name:e.name||"Documento.pdf",order:e.order||0}));je(a)}else je([]);if(e?.linkvideo&&Array.isArray(e.linkvideo)?ye(e.linkvideo.map(e=>({url:e.url||e,order:e.order||0}))):ye([]),e?.images){const a=e.images.map(e=>({id:e.id,url:`/storage/images/item/${e.url}`}));fe(a)}else fe([]);if(ta(e?.specifications?e.specifications.map(e=>({type:e.type,title:e.title,description:e.description,image:e.image||""})):[]),Fe(Boolean(e?.is_master)),aa(e?.features?.map(e=>"object"==typeof e?e:{feature:e})||[]),ee.current&&(ee.current.value=e?.stock??0),_(ie.current,e?.amenities??[],"id","name"),e?.applications&&Array.isArray(e.applications)){const a=e.applications.map(e=>e.id||e);_e(a),setTimeout(()=>{$(le.current).val(a).trigger("change")},100)}else _e([]),setTimeout(()=>{$(le.current).val([]).trigger("change")},100);if(e?.attributes&&Array.isArray(e.attributes)){const a=e.attributes.map(e=>({attribute_id:e.id,value:e.pivot?.value||"",attribute:e}));Ee(a)}else Ee([]);q.deleteRef&&(q.deleteRef.value=""),H.deleteRef&&(H.deleteRef.value=""),X.deleteRef&&(X.deleteRef.value=""),$(D.current).modal("show")},Ze=async({id:e,field:a,value:s})=>{await I.boolean({id:e,field:a,value:s})&&$(S.current).dxDataGrid("instance").refresh()},[ea,aa]=e.useState([]),[sa,ta]=e.useState([]),[ra,ia]=e.useState(!1),la=e.useRef();return a.jsxs(a.Fragment,{children:[a.jsx(u,{gridRef:S,title:"Items",rest:I,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(S.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>Ye()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>{$(la.current).modal("show")}}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"download",text:"Exportar Items",hint:"Exportar Items (Formato Excel)",onClick:()=>(async()=>{try{n.fire({title:"Exportando items...",text:"Por favor espere",allowOutsideClick:!1,didOpen:()=>{n.showLoading()}}),await I.exportData(),n.fire({icon:"success",title:"Exportación exitosa",text:"El archivo se ha descargado correctamente",timer:2e3})}catch(e){n.fire({icon:"error",title:"Error",text:e.message||"No se pudo exportar los items. Por favor intente nuevamente."})}})()}})},exportable:!0,exportableName:"Items",rowDragging:{allowReordering:!0,onReorder:async e=>{const a=e.toIndex;try{await I.reorder(e.itemData.id,a)&&$(S.current).dxDataGrid("instance").refresh()}catch(s){}},dropFeedbackMode:"push"},sorting:{mode:"single"},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"order_index",caption:"Orden",visible:!1,sortOrder:"asc",sortIndex:0},v.has("items","category_id")&&{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:s})=>{e.html(t.renderToString(a.jsxs(a.Fragment,{children:[a.jsx("b",{className:"d-block fst-italic text-muted",children:s.collection?.name}),a.jsx("b",{className:"d-block",children:s.category?.name}),a.jsx("small",{className:"text-muted",children:s.subcategory?.name})]})))}},v.has("items","subcategory_id")&&{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},v.has("items","brand_id")&&{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:s})=>{const r=((e,a)=>{if(!e)return"";const s=e.split(" ");return s.length>a?s.slice(0,a).join(" ")+"...":e})(s.summary,12);e.html(t.renderToString(a.jsxs(a.Fragment,{children:[a.jsx("b",{children:s.name}),a.jsx("br",{}),a.jsx("span",{children:r})]})))}},v.has("items","sku")&&{dataField:"sku",caption:"SKU",width:"120px"},v.has("items","final_price")&&{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:s})=>{e.html(t.renderToString(a.jsxs(a.Fragment,{children:[s.discount>0&&a.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:[y()," ",w(s.price)]}),a.jsxs("span",{children:[y()," ",w(s.discount>0?s.discount:s.price)]})]})))}},v.has("items","weight")&&{dataField:"weight",caption:"Peso",dataType:"number",width:"75px"},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:s})=>{k(e,a.jsx("img",{src:`/storage/images/item/${s.image}`,style:{width:"80px",height:"48px",objectFit:"contain",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},v.has("items","banner")&&{dataField:"banner",caption:"Imagen Banner",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:s})=>{k(e,a.jsx("img",{src:`/storage/images/item/${s.banner}`,style:{width:"80px",height:"48px",objectFit:"contain",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},v.has("items","is_new")&&{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const t=1===s.is_new||"1"===s.is_new||!0===s.is_new;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"is_new",value:e.target.checked?1:0})}))}},v.has("items","offering")&&{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const t=1===s.offering||"1"===s.offering||!0===s.offering;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"offering",value:e.target.checked?1:0})}))}},v.has("items","recommended")&&{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const t=1===s.recommended||"1"===s.recommended||!0===s.recommended;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"recommended",value:e.target.checked?1:0})}))}},v.has("items","featured")&&{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const t=1===s.featured||"1"===s.featured||!0===s.featured;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"featured",value:e.target.checked?1:0})}))}},v.has("items","views")&&{dataField:"views",caption:"Vistas",dataType:"number",width:"80px",cellTemplate:(e,{data:s})=>{const r=s.views||0;e.html(t.renderToString(a.jsxs("div",{className:"text-center",children:[a.jsx("i",{className:"fas fa-eye text-primary me-1"}),a.jsx("span",{className:"fw-bold",children:r.toLocaleString()})]})))}},v.has("items","most_view")&&{dataField:"most_view",caption:"Más visto",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const t=1===s.most_view||"1"===s.most_view||!0===s.most_view;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"most_view",value:e.target.checked?1:0})}))}},v.has("items","is_detail")&&{dataField:"is_detail",caption:"Con Detalle",dataType:"boolean",width:"90px",cellTemplate:(e,{data:s})=>{const t=1===s.is_detail||"1"===s.is_detail||!0===s.is_detail;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"is_detail",value:e.target.checked?1:0})}))}},v.has("items","sold_out")&&{dataField:"sold_out",caption:"Agotado",dataType:"boolean",width:"85px",cellTemplate:(e,{data:s})=>{const t=1===s.sold_out||"1"===s.sold_out||!0===s.sold_out;k(e,a.jsx(i,{checked:t,onChange:e=>Ze({id:s.id,field:"sold_out",value:e.target.checked?1:0})}))}},v.has("items","visible")&&{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{k(e,a.jsx(i,{checked:s.visible,onChange:e=>(async({id:e,value:a})=>{await I.boolean({id:e,field:"visible",value:a})&&$(S.current).dxDataGrid("instance").refresh()})({id:s.id,value:e.target.checked})}))}},v.has("items","is_master")&&{dataField:"is_master",caption:"Master",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{k(e,a.jsx(i,{checked:s.is_master,onChange:e=>Ze({id:s.id,field:"is_master",value:e.target.checked?1:0})}))}},v.has("items","agrupador")&&{dataField:"agrupador",caption:"Agrupador",width:"150px"},{caption:"Acciones",width:"130px",cellTemplate:(e,{data:a})=>{e.css("text-overflow","unset"),e.append(j({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>Ye(a)})),a.is_master&&v.has("items","is_master")&&e.append(j({className:"btn btn-xs btn-soft-warning",title:"Gestionar Variantes",icon:"fa fa-layer-group",onClick:()=>(Ie(a),void Oe(!0))})),e.append(j({className:"btn btn-xs btn-soft-info",title:"Clonar",icon:"fa fa-clone",onClick:()=>(e=>{const a={...e,id:null,name:e.name+" (Copia)",sku:e.sku?e.sku+"-COPY":"",clone_from_id:e.id,clone_image:e.image,clone_banner:e.banner,clone_texture:e.texture};Ye(a)})(a)})),e.append(j({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async e=>{const{isConfirmed:a}=await n.fire({title:"Eliminar item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!a)return;await I.delete(e)&&$(S.current).dxDataGrid("instance").refresh()})(a.id)}))},allowFiltering:!1,allowExporting:!1}]}),a.jsx(p,{modalRef:D,title:ne?"Editar item":"Agregar item",onSubmit:async e=>{e.preventDefault();const a=ea.filter(e=>"string"==typeof e?""!==e.trim():"object"==typeof e&&""!==e.feature?.trim()),s=sa.filter(e=>e.title&&""!==e.title.trim()||e.description&&""!==e.description.trim()),t={id:E.current?.value||void 0,category_id:A.current?.value,collection_id:L.current?.value||null,subcategory_id:M.current?.value,brand_id:G.current?.value,name:z.current?.value,sku:Y.current?.value,color:U.current?.value,size:B.current?.value,summary:V.current?.value,price:W.current?.value||0,discount:K.current?.value||0,tags:$(J.current).val(),description:Q.current?.value||Q.editor?.root?.innerHTML||"",stock:ee.current?.value||0,agrupador:Z.current?.value||null,features:a,specifications:s,weight:re.current?.value||0,store_id:ae.current?.value&&""!==ae.current?.value?ae.current?.value:null,amenities:$(ie.current).val()||[],applications:$(le.current).val()||[],attributes:Te.filter(e=>e.attribute_id&&e.value).map(e=>({id:e.attribute_id,value:e.value})),is_master:Ae,clone_from_id:N?.clone_from_id||null,clone_image:N?.clone_image||null,clone_banner:N?.clone_banner||null,clone_texture:N?.clone_texture||null},r=new FormData;for(const g in t)if("features"===g||"specifications"===g)r.append(g,JSON.stringify(t[g]));else if("tags"===g){const e=t[g];Array.isArray(e)?e.forEach((e,a)=>{r.append(`tags[${a}]`,e)}):e&&r.append("tags[0]",e)}else if("amenities"===g){const e=t[g];Array.isArray(e)&&e.length>0&&e.forEach((e,a)=>{r.append(`amenities[${a}]`,e)})}else if("applications"===g){const e=t[g];Array.isArray(e)&&e.length>0&&e.forEach((e,a)=>{r.append(`applications[${a}]`,e)})}else if("attributes"===g){const e=t[g];Array.isArray(e)&&e.length>0&&r.append("attributes",JSON.stringify(e))}else"variants_list"===g?t[g]&&r.append(g,JSON.stringify(t[g])):"is_master"===g?r.append(g,t[g]?1:0):"clone_from_id"===g||"clone_image"===g||"clone_banner"===g||"clone_texture"===g?t[g]&&null!==t[g]&&"null"!==t[g]&&r.append(g,t[g]):"id"===g?t[g]&&""!==t[g]&&"undefined"!==t[g]&&r.append(g,t[g]):r.append(g,t[g]);const i=H.current.files[0];i&&r.append("image",i);const l=X.current.files[0];l&&r.append("texture",l);const n=q.current.files[0];n&&r.append("banner",n);const c=ge.filter(e=>!e.toDelete);let d=0;c.forEach(e=>{e.file&&(r.append(`pdf[${d}]`,e.file),d++)});const o=c.map((e,a)=>({index:a,order:a+1,name:e.name||"Documento.pdf"}));o.length>0&&r.append("pdf_order",JSON.stringify(o));const m=ge.map((e,a)=>e.toDelete?a:null).filter(e=>null!==e);m.length>0&&r.append("deleted_pdfs",JSON.stringify(m));const p=Ne.filter(e=>!e.toDelete).map((e,a)=>({url:e.url,order:a+1}));p.length>0&&r.append("linkvideo",JSON.stringify(p));const u=Ne.map((e,a)=>e.toDelete?a:null).filter(e=>null!==e);u.length>0&&r.append("deleted_videos",JSON.stringify(u)),q.getDeleteFlag&&q.getDeleteFlag()&&r.append("banner_delete","DELETE"),H.getDeleteFlag&&H.getDeleteFlag()&&r.append("image_delete","DELETE"),X.getDeleteFlag&&X.getDeleteFlag()&&r.append("texture_delete","DELETE");let h=0,x=0;const f=[];xe.forEach((e,a)=>{e.toDelete||(e.file?(r.append(`gallery[${h}]`,e.file),f.push({type:"new",index:h}),h++):(r.append(`gallery_ids[${x}]`,e.id),f.push({type:"existing",id:e.id,index:x}),x++))}),f.length>0&&r.append("gallery_order",JSON.stringify(f));const b=xe.filter(e=>e.toDelete).map(e=>e.id);b.length>0&&b.forEach((e,a)=>{r.append(`deleted_images[${a}]`,e)});for(let[g,j]of r.entries());Ae&&(r.append("is_master",1),Ae&&r.append("is_master",1));await I.save(r)&&(q.resetDeleteFlag&&q.resetDeleteFlag(),H.resetDeleteFlag&&H.resetDeleteFlag(),X.resetDeleteFlag&&X.resetDeleteFlag(),$(S.current).dxDataGrid("instance").refresh(),$(D.current).modal("hide"),fe([]),je([]),ye([]))},size:"xl",children:a.jsxs("div",{id:"principal-container",children:[a.jsx("input",{ref:E,type:"hidden"}),a.jsxs("ul",{className:"nav nav-pills nav-justified mb-4",role:"tablist",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",padding:"4px",border:"1px solid #e9ecef"},children:[a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link active",id:"basic-info-tab","data-bs-toggle":"pill","data-bs-target":"#basic-info",type:"button",role:"tab","aria-controls":"basic-info","aria-selected":"true",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[a.jsx("i",{className:"fas fa-info-circle me-2"}),"Información Básica"]})}),(v.has("items","price")||v.has("items","stock"))&&a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"pricing-tab","data-bs-toggle":"pill","data-bs-target":"#pricing",type:"button",role:"tab","aria-controls":"pricing","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[a.jsx("i",{className:"fas fa-dollar-sign me-2"}),"Precios y Stock"]})})," ",a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"multimedia-tab","data-bs-toggle":"pill","data-bs-target":"#multimedia",type:"button",role:"tab","aria-controls":"multimedia","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[a.jsx("i",{className:"fas fa-images me-2"}),"Multimedia"]})}),a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"features-tab","data-bs-toggle":"pill","data-bs-target":"#features",type:"button",role:"tab","aria-controls":"features","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[a.jsx("i",{className:"fas fa-list-ul me-2"}),"Características"]})})]}),a.jsxs("div",{className:"tab-content",children:[a.jsx("div",{className:"tab-pane fade show active",id:"basic-info",role:"tabpanel","aria-labelledby":"basic-info-tab",children:a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-tag me-2"}),"Identificación"]})}),a.jsxs("div",{className:"card-body",children:[v.has("items","is_master")&&a.jsxs("div",{className:"mb-3",children:[a.jsx(i,{label:"Tiene Variantes",checked:Ae,onChange:e=>Fe(e.target.checked)}),a.jsx("small",{className:"text-muted d-block mt-1",children:"Activa esta opción para generar múltiples variantes (talla, color, etc.) de este producto."})]}),a.jsx(x,{eRef:Y,label:"SKU",required:!0,hidden:!v.has("items","sku")}),a.jsx(x,{eRef:Z,label:"Código Agrupador",placeholder:"UUID para agrupar variantes",hidden:!v.has("items","agrupador")}),a.jsx(x,{eRef:z,label:"Nombre del Producto",required:!0,hidden:!v.has("items","name")}),a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-6",children:a.jsx(x,{eRef:U,label:"Color",required:!0,hidden:!v.has("items","color")})}),a.jsx("div",{className:"col-md-6",children:a.jsx(x,{eRef:B,label:"Talla",required:!0,hidden:!v.has("items","size")})}),a.jsx("div",{className:"col-md-6",children:a.jsx(x,{eRef:re,label:"Peso",hidden:!v.has("items","weight")})})]})]})]})}),a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-sitemap me-2"}),"Categorización"]})}),a.jsxs("div",{className:"card-body",children:[a.jsx(g,{eRef:A,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>oe(e.target.value),hidden:!v.has("items","category_id"),children:s.map((e,s)=>a.jsx("option",{value:e.id,children:e.name},s))}),a.jsx(g,{eRef:L,label:"Colección",dropdownParent:"#principal-container",onChange:e=>pe(e.target.value),hidden:!v.has("items","collection_id"),children:c.map((e,s)=>a.jsx("option",{value:e.id,children:e.name},s))}),a.jsx(b,{eRef:M,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",de],dropdownParent:"#principal-container",hidden:!v.has("items","subcategory_id")}),a.jsx(g,{eRef:G,label:"Marca",dropdownParent:"#principal-container",hidden:!v.has("items","brand_id"),children:r.map((e,s)=>a.jsx("option",{value:e.id,children:e.name},s))})]})]})}),a.jsxs("div",{className:"col-12",children:[a.jsxs("div",{className:"card border-0 shadow-sm",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-align-left me-2"}),"Descripción"]})}),a.jsxs("div",{className:"card-body",children:[a.jsx(l,{eRef:V,label:"Resumen",rows:3,hidden:!v.has("items","summary")}),a.jsxs(g,{eRef:ae,label:"Tienda",dropdownParent:"#principal-container",onChange:e=>he(e.target.value),hidden:!v.has("items","store_id"),children:[a.jsx("option",{value:"",children:"Seleccionar tienda (opcional)"}),d.map((e,s)=>a.jsx("option",{value:e.id,children:e.name},s))]}),a.jsx(b,{id:"tags",eRef:J,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",hidden:!v.has("items","is_tags"),dropdownParent:"#principal-container",tags:!0,multiple:!0})]})]}),a.jsx("div",{className:"col-12",children:a.jsxs("div",{className:"card border-0 shadow-sm",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-edit me-2"}),"Descripción Detallada"]})}),a.jsx("div",{className:"card-body",children:a.jsx(f,{eRef:Q,label:"Descripción Completa"})})]})})]})]})}),a.jsx("div",{className:"tab-pane fade",id:"pricing",role:"tabpanel","aria-labelledby":"pricing-tab",children:a.jsxs("div",{className:"row g-3",children:[v.has("items","price")&&a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-dollar-sign me-2"}),"Precios"]})}),a.jsxs("div",{className:"card-body",children:[a.jsx(x,{eRef:W,label:"Precio Regular",type:"number",step:"0.01",required:!0}),a.jsx(x,{eRef:K,label:"Precio con Descuento",type:"number",step:"0.01"})]})]})}),v.has("items","stock")&&a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-boxes me-2"}),"Inventario"]})}),a.jsx("div",{className:"card-body",children:a.jsx(x,{label:"Stock Disponible",eRef:ee,type:"number",required:!0})})]})})," "]})}),a.jsx("div",{className:"tab-pane fade",id:"multimedia",role:"tabpanel","aria-labelledby":"multimedia-tab",children:a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-image me-2"}),"Imágenes Principales"]})}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"row",children:[a.jsx(h,{eRef:q,name:"banner",label:"Banner",aspect:2,col:"col-12",hidden:!v.has("items","banner")}),a.jsx(h,{eRef:H,name:"image",label:"Imagen Principal",aspect:1,col:"col-md-6",hidden:!v.has("items","image")}),a.jsx(h,{eRef:X,name:"texture",label:"Textura",aspect:1,col:"col-md-6",hidden:!v.has("items","texture")})]})})]})}),a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-photo-video me-2"}),"Galería y Multimedia"]})}),a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"form-label fw-semibold text-dark mb-3",children:[a.jsx("i",{className:"fas fa-images me-2 text-primary"}),"Galería de Imágenes",xe.filter(e=>!e.toDelete).length>0&&a.jsx("span",{className:"badge bg-primary ms-2",children:xe.filter(e=>!e.toDelete).length})]}),a.jsx("input",{id:"input-item-gallery",ref:be,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:e=>{const a=Array.from(e.target.files).map(e=>({file:e,url:URL.createObjectURL(e)}));fe(e=>[...e,...a])}}),a.jsxs("div",{className:"gallery-container",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"16px",padding:"16px",backgroundColor:"#f8f9fa",borderRadius:"12px",border:"2px dashed #dee2e6",minHeight:"160px"},children:[xe.filter(e=>!e.toDelete).map((e,s)=>{const t=xe.findIndex(a=>a===e),r=s+1;return a.jsxs("div",{className:"gallery-item position-relative",draggable:!0,onDragStart:e=>((e,a)=>{ze(a),e.dataTransfer.effectAllowed="move"})(e,t),onDragEnd:Ue,onDragOver:Be,onDrop:e=>((e,a)=>{if(e.preventDefault(),null===Ge||Ge===a)return;const s=[...xe],t=s[Ge];s.splice(Ge,1),s.splice(a,0,t),fe(s),ze(null)})(e,t),style:{aspectRatio:"1",borderRadius:"12px",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease",cursor:"grab",transform:Ge===t?"scale(1.05)":"scale(1)",opacity:Ge===t?.8:1,border:"3px solid transparent",background:"white"},onMouseEnter:e=>{null===Ge&&(e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 6px 20px rgba(0,0,0,0.15)")},onMouseLeave:e=>{null===Ge&&(e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)")},children:[a.jsx("div",{className:"position-absolute top-0 start-0 m-2",children:a.jsx("span",{className:"badge bg-primary rounded-circle d-flex align-items-center justify-content-center",style:{width:"24px",height:"24px",fontSize:"11px",fontWeight:"bold"},children:r})}),a.jsx("img",{src:e.url,alt:`Imagen ${r}`,className:"w-100 h-100",style:{objectFit:"cover",pointerEvents:"none"}}),a.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{background:"rgba(0,0,0,0.7)",opacity:0,transition:"opacity 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.opacity=1,onMouseLeave:e=>e.currentTarget.style.opacity=0,children:a.jsxs("div",{className:"d-flex gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-light btn-sm rounded-circle d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px"},title:"Mover imagen",children:a.jsx("i",{className:"fas fa-arrows-alt text-dark"})}),a.jsx("button",{type:"button",className:"btn btn-danger btn-sm rounded-circle d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px"},onClick:e=>((e,a)=>{e.preventDefault(),xe[a].id?fe(e=>e.map((e,s)=>s===a?{...e,toDelete:!0}:e)):fe(e=>e.filter((e,s)=>s!==a))})(e,t),title:"Eliminar imagen",children:a.jsx("i",{className:"fas fa-trash text-white"})})]})})]},t)}),a.jsx("div",{className:"gallery-add-button d-flex flex-column align-items-center justify-content-center",style:{aspectRatio:"1",border:"3px dashed #71b6f9",borderRadius:"12px",backgroundColor:"rgba(13, 110, 253, 0.05)",cursor:"pointer",transition:"all 0.3s ease",minHeight:"120px"},onClick:()=>be.current.click(),onDrop:e=>{e.preventDefault();const a=Array.from(e.dataTransfer.files).map(e=>({file:e,url:URL.createObjectURL(e)}));fe(e=>[...e,...a])},onDragOver:e=>{e.preventDefault()},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(13, 110, 253, 0.1)",e.currentTarget.style.borderColor="#0056b3",e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(13, 110, 253, 0.05)",e.currentTarget.style.borderColor="#0d6efd",e.currentTarget.style.transform="scale(1)"},children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mb-2 bg-primary",style:{width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto"},children:a.jsx("i",{className:"fas fa-plus text-white fa-lg"})}),a.jsx("p",{className:"mb-0 text-primary fw-semibold",style:{fontSize:"12px"},children:"Agregar Imagen"}),a.jsx("small",{className:"text-muted",style:{fontSize:"10px"},children:"Arrastra o haz clic (Máx 10MB)"})]})})]}),0===xe.filter(e=>!e.toDelete).length&&a.jsxs("div",{className:"text-center py-4 text-muted",children:[a.jsx("i",{className:"fas fa-images fa-3x mb-3 opacity-50"}),a.jsx("p",{className:"mb-1",children:"No hay imágenes en la galería"}),a.jsx("small",{children:'Arrastra archivos aquí o haz clic en "Agregar Imagen"'})]})]}),a.jsxs("div",{className:"mb-4",hidden:!v.has("items","pdf"),children:[a.jsxs("label",{className:"form-label fw-semibold text-dark mb-3",children:[a.jsx("i",{className:"fas fa-file-pdf me-2 text-danger"}),"Archivos PDF (Manuales / Catálogos)",ge.filter(e=>!e.toDelete).length>0&&a.jsx("span",{className:"badge bg-danger ms-2",children:ge.filter(e=>!e.toDelete).length})]}),a.jsx("input",{ref:ve,type:"file",multiple:!0,accept:".pdf",hidden:!0,onChange:e=>{const a=Array.from(e.target.files).map(e=>({file:e,name:e.name,url:URL.createObjectURL(e)}));je(e=>[...e,...a])}}),a.jsx("div",{className:"list-group mb-3",children:ge.filter(e=>!e.toDelete).map((e,s)=>{const t=ge.findIndex(a=>a===e);return a.jsxs("div",{draggable:!0,onDragStart:e=>((e,a)=>{We(a),e.dataTransfer.effectAllowed="move"})(e,t),onDragEnd:Ke,onDragOver:Je,onDrop:e=>((e,a)=>{if(e.preventDefault(),null===Ve||Ve===a)return;const s=[...ge],t=s[Ve];s.splice(Ve,1),s.splice(a,0,t),je(s),We(null)})(e,t),className:"list-group-item d-flex align-items-center justify-content-between",style:{cursor:"grab",opacity:Ve===t?.5:1,backgroundColor:Ve===t?"#f8f9fa":"white",transition:"all 0.2s ease"},children:[a.jsxs("div",{className:"d-flex align-items-center flex-grow-1",style:{minWidth:0},children:[a.jsx("span",{className:"badge bg-danger me-3",style:{minWidth:"28px"},children:s+1}),a.jsx("i",{className:"fas fa-grip-vertical text-muted me-3"}),a.jsx("i",{className:"fas fa-file-pdf text-danger me-2"}),a.jsx("span",{className:"text-truncate",style:{maxWidth:"250px"},children:e.name})]}),a.jsxs("div",{className:"d-flex gap-2 flex-shrink-0",children:[!e.file&&a.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline-primary",children:a.jsx("i",{className:"fas fa-eye"})}),a.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:e=>((e,a)=>{e.preventDefault();const s=ge[a];s.url&&!s.file?je(e=>e.map((e,s)=>s===a?{...e,toDelete:!0}:e)):je(e=>e.filter((e,s)=>s!==a))})(e,t),children:a.jsx("i",{className:"fas fa-trash"})})]})]},t)})}),a.jsxs("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>ve.current.click(),children:[a.jsx("i",{className:"fas fa-plus me-2"}),"Agregar PDFs"]})]}),a.jsxs("div",{className:"mb-3",hidden:!v.has("items","linkvideo"),children:[a.jsxs("label",{className:"form-label fw-semibold text-dark mb-3",children:[a.jsx("i",{className:"fas fa-video me-2 text-success"}),"Links de Videos",Ne.filter(e=>!e.toDelete).length>0&&a.jsx("span",{className:"badge bg-success ms-2",children:Ne.filter(e=>!e.toDelete).length})]}),a.jsx("div",{className:"list-group mb-3",children:Ne.filter(e=>!e.toDelete).map((e,s)=>{const t=Ne.findIndex(a=>a===e);return a.jsxs("div",{draggable:!0,onDragStart:e=>((e,a)=>{He(a),e.dataTransfer.effectAllowed="move"})(e,t),onDragEnd:Xe,onDragOver:Qe,onDrop:e=>((e,a)=>{if(e.preventDefault(),null===qe||qe===a)return;const s=[...Ne],t=s[qe];s.splice(qe,1),s.splice(a,0,t),ye(s),He(null)})(e,t),className:"list-group-item d-flex align-items-center justify-content-between",style:{cursor:"grab",opacity:qe===t?.5:1,backgroundColor:qe===t?"#f8f9fa":"white",transition:"all 0.2s ease"},children:[a.jsxs("div",{className:"d-flex align-items-center flex-grow-1",style:{minWidth:0,overflow:"hidden"},children:[a.jsx("span",{className:"badge bg-success me-3 flex-shrink-0",style:{minWidth:"28px"},children:s+1}),a.jsx("i",{className:"fas fa-grip-vertical text-muted me-3 flex-shrink-0"}),a.jsx("i",{className:"fas fa-video text-success me-2 flex-shrink-0"}),a.jsx("span",{className:"small",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},title:e.url,children:e.url})]}),a.jsxs("div",{className:"d-flex gap-2 flex-shrink-0 ms-2",children:[a.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline-primary",children:a.jsx("i",{className:"fas fa-external-link-alt"})}),a.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:e=>((e,a)=>{e.preventDefault();const s=Ne[a];s.order&&!s.new?ye(e=>e.map((e,s)=>s===a?{...e,toDelete:!0}:e)):ye(e=>e.filter((e,s)=>s!==a))})(e,t),children:a.jsx("i",{className:"fas fa-trash"})})]})]},t)})}),a.jsxs("div",{className:"input-group",children:[a.jsx("input",{ref:we,type:"url",className:"form-control",placeholder:"https://youtube.com/watch?v=..."}),a.jsxs("button",{type:"button",className:"btn btn-success",onClick:e=>{e.preventDefault();const a=we.current.value.trim();a&&(ye(e=>[...e,{url:a,order:e.length+1}]),we.current.value="")},children:[a.jsx("i",{className:"fas fa-plus me-2"}),"Agregar"]})]})]})]})]})})]})}),a.jsx("div",{className:"tab-pane fade",id:"features",role:"tabpanel","aria-labelledby":"features-tab",children:a.jsxs("div",{className:"row g-3",children:[v.has("items","is_features")&&a.jsx("div",{className:""+(v.has("items","is_specifications")?"col-md-6":"col-12"),children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-list-ul me-2"}),"Características"]})}),a.jsx("div",{className:"card-body",children:a.jsx(R,{ref:se,label:"Lista de Características",structure:"",value:ea,onChange:aa})})]})}),v.has("items","is_specifications")&&a.jsx("div",{className:""+(v.has("items","is_features")?"col-md-6":"col-12"),children:a.jsxs("div",{className:"card border-0 shadow-sm h-100",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-cogs me-2"}),"Especificaciones"]})}),a.jsx("div",{className:"card-body",children:a.jsx(R,{ref:te,label:"Especificaciones Técnicas",structure:{type:"",title:"",description:""},value:sa,onChange:ta,typeOptions:["Principal","General"]})})]})}),v.has("items","is_amenities")&&a.jsx("div",{className:"col-12",children:a.jsxs("div",{className:"card border-0 shadow-sm",children:[a.jsx("div",{className:"card-header bg-light",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-star-circle me-2 text-warning"}),"Cualidades"]})}),a.jsxs("div",{className:"card-body",children:[a.jsx(b,{eRef:ie,searchAPI:"/api/admin/amenities/paginate",searchBy:"name",label:"Seleccionar Cualidades",dropdownParent:"#principal-container",multiple:!0}),a.jsxs("small",{className:"text-muted",children:[a.jsx("i",{className:"fas fa-info-circle me-1"}),"Selecciona las cualidades o atributos que destacan este producto"]})]})]})}),v.has("items","is_applications")&&a.jsx("div",{className:"col-12",children:a.jsxs("div",{className:"card border-0 shadow-sm",children:[a.jsx("div",{className:"card-header",children:a.jsxs("h6",{className:"mb-0",children:[a.jsx("i",{className:"fas fa-th-large me-2 text-info"}),"Aplicaciones / Usos"]})}),a.jsxs("div",{className:"card-body",children:[a.jsx(g,{eRef:le,label:"Seleccionar Aplicaciones",dropdownParent:"#principal-container",multiple:!0,children:Ce.map(e=>a.jsx("option",{value:e.id,"data-image":e.image,"data-icon":e.icon,children:e.name},e.id))}),a.jsxs("small",{className:"text-muted",children:[a.jsx("i",{className:"fas fa-info-circle me-1"}),"Selecciona las industrias o usos donde se aplica este producto"]})]})]})}),v.has("items","is_attributes")&&Se.length>0&&a.jsx("div",{className:"col-12",children:a.jsxs("div",{className:"card border-0 shadow-sm overflow-hidden",children:[a.jsx("div",{className:"card-header bg-gradient",children:a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsx("div",{className:"",style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx("i",{className:"fas fa-sliders-h text-primarye"})}),a.jsxs("div",{children:[a.jsx("h6",{className:"mb-0  fw-bold",children:"Atributos Técnicos"}),a.jsx("small",{className:"",children:"Especificaciones del producto"})]})]}),a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[Te.length>0&&a.jsxs("span",{className:"badge bg-white text-primary fw-bold px-3 py-2",style:{fontSize:"0.85rem"},children:[Te.length," ",1===Te.length?"atributo":"atributos"]}),a.jsxs("button",{type:"button",className:"btn btn-light btn-sm fw-semibold d-flex align-items-center gap-2",onClick:()=>{Ee([...Te,{attribute_id:"",value:"",attribute:null}])},style:{borderRadius:"20px",padding:"8px 16px"},children:[a.jsx("i",{className:"fas fa-plus"}),a.jsx("span",{children:"Agregar"})]})]})]})}),a.jsx("div",{className:"card-body p-4",style:{backgroundColor:"#f8f9ff"},children:0===Te.length?a.jsxs("div",{className:"text-center py-5",children:[a.jsx("div",{className:"mb-4",children:a.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",background:"linear-gradient(135deg, #667eea20 0%, #764ba220 100%)",border:"2px dashed #667eea50"},children:a.jsx("i",{className:"fas fa-layer-group fa-2x",style:{color:"#667eea"}})})}),a.jsx("h6",{className:"text-muted mb-2",children:"Sin atributos configurados"}),a.jsx("p",{className:"text-muted small mb-4",style:{maxWidth:"300px",margin:"0 auto"},children:"Agrega atributos técnicos como dimensiones, peso, material y más para detallar tu producto."}),a.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm px-4",onClick:()=>{Ee([...Te,{attribute_id:"",value:"",attribute:null}])},style:{borderRadius:"20px"},children:[a.jsx("i",{className:"fas fa-plus me-2"}),"Agregar primer atributo"]})]}):a.jsxs("div",{className:"attributes-list",children:[Te.map((e,s)=>{const t=Se.find(a=>a.id===e.attribute_id),r={text:"#3b82f6",number:"#10b981",select:"#f59e0b",color:"#ec4899"};return a.jsx("div",{className:"attribute-item mb-3 p-3 bg-white rounded-3 border",style:{borderColor:t?r[t.type]+"40":"#e5e7eb",borderLeftWidth:"4px",borderLeftColor:t?r[t.type]:"#e5e7eb",transition:"all 0.2s ease",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:a.jsxs("div",{className:"row g-3 align-items-center",children:[a.jsx("div",{className:"col-auto",children:a.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center fw-bold",style:{width:"32px",height:"32px",backgroundColor:t?r[t.type]+"15":"#f3f4f6",color:t?r[t.type]:"#9ca3af",fontSize:"0.85rem"},children:s+1})}),a.jsxs("div",{className:"col-md-4",children:[a.jsxs("label",{className:"form-label small text-muted mb-1 d-flex align-items-center gap-2",children:[a.jsx("i",{className:"fas fa-tag",style:{fontSize:"0.7rem"}}),"Atributo"]}),a.jsxs("select",{className:"form-select",value:e.attribute_id,onChange:e=>{const a=[...Te],t=Se.find(a=>a.id===e.target.value);a[s]={...a[s],attribute_id:e.target.value,attribute:t,value:""},Ee(a)},style:{borderRadius:"8px"},children:[a.jsx("option",{value:"",children:"Seleccionar..."}),Se.filter(e=>!Te.some((a,t)=>t!==s&&a.attribute_id===e.id)).map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{className:"col",children:[a.jsxs("label",{className:"form-label small text-muted mb-1 d-flex align-items-center gap-2",children:[t&&a.jsx("i",{className:`fas ${{text:"fa-font",number:"fa-hashtag",select:"fa-list-ul",color:"fa-palette"}[t.type]}`,style:{fontSize:"0.7rem",color:r[t.type]}}),"Valor",t?.unit&&a.jsx("span",{className:"badge ms-1",style:{backgroundColor:r[t.type]+"20",color:r[t.type],fontSize:"0.7rem",fontWeight:"600"},children:t.unit})]}),"select"===t?.type&&t?.options?a.jsxs("select",{className:"form-select",value:e.value,onChange:e=>{const a=[...Te];a[s].value=e.target.value,Ee(a)},style:{borderRadius:"8px"},children:[a.jsx("option",{value:"",children:"Seleccionar opción..."}),t.options.map((e,s)=>a.jsx("option",{value:e,children:e},s))]}):"color"===t?.type?a.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[a.jsx("input",{type:"color",className:"form-control form-control-color p-1",value:e.value||"#6366f1",onChange:e=>{const a=[...Te];a[s].value=e.target.value,Ee(a)},style:{width:"50px",height:"38px",borderRadius:"8px",cursor:"pointer"}}),a.jsx("input",{type:"text",className:"form-control",value:e.value||"#6366f1",onChange:e=>{const a=[...Te];a[s].value=e.target.value,Ee(a)},placeholder:"#000000",style:{borderRadius:"8px",fontFamily:"monospace"}})]}):a.jsx("input",{type:"number"===t?.type?"number":"text",className:"form-control",placeholder:t?`Ingresa ${t.name.toLowerCase()}${t?.unit?` en ${t.unit}`:""}`:"Selecciona un atributo primero",value:e.value,disabled:!t,onChange:e=>{const a=[...Te];a[s].value=e.target.value,Ee(a)},style:{borderRadius:"8px"}})]}),a.jsx("div",{className:"col-auto",children:a.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm d-flex align-items-center justify-content-center",onClick:()=>{Ee(Te.filter((e,a)=>a!==s))},title:"Eliminar atributo",style:{width:"38px",height:"38px",borderRadius:"8px",marginTop:"24px"},children:a.jsx("i",{className:"fas fa-trash-alt"})})})]})},s)}),a.jsxs("div",{className:"add-more-btn text-center py-3 rounded-3 mt-2",style:{border:"2px dashed #667eea50",backgroundColor:"#667eea08",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>{Ee([...Te,{attribute_id:"",value:"",attribute:null}])},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#667eea15",e.currentTarget.style.borderColor="#667eea"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#667eea08",e.currentTarget.style.borderColor="#667eea50"},children:[a.jsx("i",{className:"fas fa-plus me-2",style:{color:"#667eea"}}),a.jsx("span",{style:{color:"#667eea",fontWeight:"500"},children:"Agregar otro atributo"})]})]})})]})})]})})]})]})}),a.jsx(p,{modalRef:la,title:"Importar Datos",size:"lg",children:a.jsx(T,{gridRef:S,modalRef:la,excelTemplate:Array.isArray(o)?o.find(e=>"excel_import_template"===e.correlative)?.description:null})}),Pe&&a.jsx(F,{isOpen:Pe,onClose:()=>Oe(!1),item:$e,gridRef:S,onRefreshGrid:()=>{try{if(S.current){const e=window.$||window.jQuery||$;e&&"function"==typeof e(S.current).dxDataGrid&&e(S.current).dxDataGrid("instance").refresh()}}catch(e){}}})]})};N((e,t)=>{s.createRoot(e).render(a.jsx(r,{...t,title:"Items",children:a.jsx(L,{...t})}))});

import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BOnQTV8N.js";import{N as S}from"./Number2Currency-e57Tgsuk.js";import{D as Le,C as tt,B as Ce,a as Re,P as st,b as at,A as ot,O as nt,I as rt,c as it}from"./OptionCard-BufIo9kk.js";import{m as ct}from"./main-DKOTUah5.js";import{G as pe}from"./Global-ErywZRdd.js";import{t as X}from"./index-DRg3WPTA.js";import{I as ne}from"./InputForm-Dmyom2PO.js";import{S as lt}from"./SelectForm-BvZde-dr.js";import{S as dt}from"./store-DCbpAdsr.js";import{l as mt}from"./ShippingStep-DrbxoqQN.js";import{c as Ue}from"./createLucideIcon-DfjclApS.js";import{C as ue}from"./circle-x-5vreeYph.js";import{m as ce}from"./proxy-yQpHkKD-.js";import"./ProductNavigation-Ch9gAwXA.js";import"./ProductCard-Lp5WfZrB.js";/* empty css              */import"./BlogCarousel-x7cPG0b1.js";/* empty css               */import"./BlogCarrusel-BEReD9tm.js";import{R as pt}from"./PolicyModal-CPFjYZfq.js";import{H as ut}from"./HtmlContent-ghmllTyl.js";import{X as xt}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./sparkles-DvmvZ6mJ.js";import"./CartItemRow-CiD11yvl.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";import"./index-fNjTmf9T.js";import"./trash-2-DU7LB6-f.js";import"./plus-CTIomuuF.js";import"./index-Dq7h7Pqt.js";import"./useStateManager-7e1e8489.esm-B-bo6CQF.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./floating-ui.dom-BPWAutIm.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./check-D5vaIe6v.js";import"./ItemsRest-9bICvOQx.js";import"./BasicRest-BCYKfs4R.js";import"./HeaderSearch-BvA9RYGN.js";import"./index-BcIiOZSt.js";import"./eye-ScgfreHn.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=Ue("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=Ue("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]);function ft({data:f,cart:v,setCart:j,onContinue:L,subTotal:_,envio:q,igv:$,totalFinal:N,openModal:h,automaticDiscounts:u,setAutomaticDiscounts:l,automaticDiscountTotal:a,setAutomaticDiscountTotal:o,totalWithoutDiscounts:n}){const[E,O]=c.useState(u||[]),[I,R]=c.useState(a||0),[D,te]=c.useState(!1),[le,J]=c.useState([]),[Z,K]=c.useState([]),[W,Y]=c.useState(!1),[se,re]=c.useState(null),[H,de]=c.useState(null),Q=v.length===0;c.useEffect(()=>{if(v.length>0&&_>0)ie();else{const x=[];O(x),R(0),J([]),K([]),l&&l(x),o&&o(0)}},[v,_]);const ie=async()=>{te(!0);try{const x=v.reduce((w,P)=>w+(P.quantity||0),0);console.log("üõí CartStep applying discounts:",{cart:v,subTotal:_,totalWithoutDiscounts:n,totalQuantity:x,cartLength:v.length,cartItems:v.map(w=>({id:w.id||w.item_id,name:w.name,quantity:w.quantity,price:w.price||w.final_price,category_id:w.category_id}))});const d=await Le.applyToCart(v,n);if(console.log("üì• Server response:",{success:d.success,data:d.data,error:d.error,fullResult:d}),d.success&&d.data){console.log("‚úÖ Discounts found:",d.data.applied_discounts);const w=Le.formatDiscounts(d.data.applied_discounts),P=d.data.total_discount||0,G=Le.getFreeItems(d.data.applied_discounts),ae=[];d.data.applied_discounts.forEach(A=>{A.suggested_items&&Array.isArray(A.suggested_items)&&ae.push(...A.suggested_items)}),O(w),R(P),J(G),K(ae),l&&l(w),o&&o(P)}else{console.error("‚ùå Discount application failed:",{error:d.error,success:d.success,data:d.data,fullResult:d});const w=[],P=0;O(w),R(P),J([]),K([]),l&&l(w),o&&o(P)}}catch(x){console.error("Error applying discount rules:",x);const d=[],w=0;O(d),R(w),J([]),K([]),l&&l(d),o&&o(w)}finally{te(!1)}},xe=x=>Z.some(d=>d.item_id===x||d.triggering_item_id===x),he=x=>Z.find(d=>d.item_id===x||d.triggering_item_id===x),y=x=>{const d=he(x.id);d&&(re(d),de(x),Y(!0))},V=async x=>{try{console.log("CartStep - handleAddPromotionalItem received:",x),console.log("CartStep - current cart:",v),j(d=>{console.log("CartStep - old cart before update:",d);const w=d.findIndex(P=>(P.item_id||P.id)===x.item_id);if(console.log("CartStep - existingItemIndex:",w),w!==-1){const P=[...d],G=x.quantity||x.suggested_quantity||1;return console.log("CartStep - adding quantity:",G),P[w].quantity+=G,console.log("CartStep - updated cart:",P),P}else{console.log("CartStep - item not found, creating new product");const P={id:x.item_id,name:x.item_name,quantity:x.quantity||x.suggested_quantity||1,price:x.value||0,final_price:x.value||0,image:x.item_image||"default.jpg",brand:{name:x.item_brand||"N/A"},sku:x.item_sku||"PROMO",stock:999};return[...d,P]}}),setTimeout(()=>{ie()},100)}catch(d){console.error("Error adding promotional item:",d)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:Q?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito est√° vac√≠o"}),e.jsx("p",{className:"text-gray-500",children:"¬°Explora nuestros productos y encuentra algo especial!"})]}):v.map((x,d)=>e.jsx(tt,{...x,setCart:j,hasPromotion:xe(x.id),onPromotionClick:y},d))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",S(_)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",S($)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",S(q)]})]}),D&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!D&&E.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6  customtext-neutral-dark mb-2",children:"üéâ Descuentos aplicados:"}),E.map((x,d)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[x.name,x.description&&e.jsx("span",{className:"text-xs font-semibold block",children:x.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",S(x.amount)]})]},d)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",S(I)]})]})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",S(N)]})]}),I>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:["S/ ",S(n||N+I)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras S/ ",S(I)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(Ce,{onClick:L,disabled:Q,className:`w-full ${(f==null?void 0:f.class_button)||"text-white"}`,children:Q?"Carrito Vac√≠o":"Continuar Compra"}),e.jsx(Re,{href:"/",className:"w-full",children:Q?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{href:"#",onClick:()=>h(1),className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{href:"#",onClick:()=>h(0),className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]}),e.jsx(st,{isOpen:W,onClose:()=>Y(!1),suggestion:se,onAddToCart:V,productName:(H==null?void 0:H.name)||""})]})}function gt(){let f="";for(let v=0;v<12;v++){const j=Math.floor(Math.random()*10);f+=j}return f}const yt=f=>new Promise((v,j)=>{var L;try{if(console.log("üîÑ Iniciando proceso de pago con Culqi...",f),typeof window.Culqi>"u"){console.error("‚ùå Error: Culqi no est√° definido. Verifique que el script de Culqi est√© cargado."),j("Error en la integraci√≥n con Culqi: Script no cargado");return}if(!pe.CULQI_PUBLIC_KEY){console.error("‚ùå Error: CULQI_PUBLIC_KEY no est√° configurado"),j("Error de configuraci√≥n: Clave p√∫blica de Culqi no encontrada");return}const _=gt(f.email);console.log("üìù N√∫mero de orden generado:",_);let q=!1;try{window.Culqi.publicKey=pe.CULQI_PUBLIC_KEY,console.log("‚úÖ Clave p√∫blica configurada exitosamente")}catch(l){console.error("‚ùå Error al configurar la clave p√∫blica:",l),j("Error en la integraci√≥n con Culqi: No se pudo configurar la clave p√∫blica");return}const $=parseFloat(f.amount.toFixed(2)),N=Math.round($*100);console.log("üí∞ Configurando Culqi:"),console.log("   - Monto original:",f.amount),console.log("   - Monto redondeado (soles):",$),console.log("   - Monto en c√©ntimos:",N),console.log("   - Email:",f.email),window.Culqi.settings({title:pe.APP_NAME,email:f.email,currency:"PEN",amount:N,order:`${_}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:pe.APP_URL+"/assets/resources/logo.png",bannerColor:pe.APP_COLOR_PRIMARY,buttonBackground:pe.APP_COLOR_PRIMARY}});const h=(L=window.Culqi)==null?void 0:L.close;h&&(window.Culqi.close=function(){return!window.Culqi.token&&!q&&(console.log("üö´ Modal de Culqi cerrado sin completar el pago"),j("Pago cancelado por el usuario")),h.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){j("No se obtuvo un token de Culqi");return}q=!0;const l=window.Culqi.token.id;console.log("‚úÖ Token generado:",l),f={...f,token:l,orderNumber:_},console.log("_request actualizado",f);const{status:a,result:o}=await ct.Fetch("./api/pago",{method:"POST",body:JSON.stringify(f)});a||console.log((o==null?void 0:o.message)||"Error en el pago"),window.Culqi.close(),X.success("¬°Pago exitoso!",{description:"Tu pago se proces√≥ correctamente. Pronto recibir√°s la confirmaci√≥n de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),v(o)}catch(l){X.error("¬°Error en el Pago!",{description:l.message,duration:3e3,position:"top-right",richColors:!0}),j(l.message||"Error en el pago")}},window.addEventListener("message",function(l){l.data==="culqi_closed"&&j("Pago cancelado por el usuario")});const u=l=>{l.key==="Escape"&&!q&&(console.log("üö´ Modal de Culqi cerrado con Escape"),j("Pago cancelado por el usuario"))};document.addEventListener("keydown",u),setTimeout(()=>{document.removeEventListener("keydown",u)},3e5),document.addEventListener("culqi.error",function(l){var a,o;X.error("¬°Error en Culqi!",{description:((a=l.detail)==null?void 0:a.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),j(((o=l.detail)==null?void 0:o.message)||"Error desconocido")})}catch(_){X.error("¬°Error en la integraci√≥n con Culqi!",{description:_.message,duration:3e3,position:"top-right",richColors:!0}),j("Error en la integraci√≥n con Culqi")}}),bt=({ubigeoCode:f,onStoreSelect:v,selectedStore:j=null,className:L=""})=>{const[_,q]=c.useState([]),[$,N]=c.useState(!1),[h,u]=c.useState(null);c.useEffect(()=>{f&&l()},[f]);const l=async()=>{N(!0),u(null);try{const n=await(await fetch("/api/stores")).json();q(n.data||[])}catch{q([])}finally{N(!1)}},a=o=>{v(o)};return $?e.jsxs("div",{className:`text-center p-6 ${L}`,children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary/10 rounded-full mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark mb-2",children:"Cargando tiendas..."}),e.jsx("p",{className:"customtext-neutral-light text-sm",children:"Buscando tiendas disponibles en tu ubicaci√≥n"})]}):h?e.jsxs("div",{className:`bg-red-50 border border-red-200 rounded-xl p-4 md:p-6 ${L}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 text-center mb-2",children:"Error al cargar tiendas"}),e.jsx("p",{className:"text-red-600 text-center text-sm",children:h})]}):_.length===0?e.jsxs("div",{className:`bg-secondary/30 border border-secondary rounded-xl p-4 md:p-6 ${L}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-secondary rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 customtext-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark text-center mb-2",children:"Sin tiendas disponibles"}),e.jsx("p",{className:"customtext-neutral-light text-center text-sm",children:"No hay tiendas disponibles para retiro en esta ubicaci√≥n. Por favor, selecciona otra opci√≥n de env√≠o."})]}):e.jsxs("div",{className:L,children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold customtext-neutral-dark mb-2",children:"Selecciona una tienda para retiro"}),e.jsx("p",{className:"customtext-neutral-light text-sm md:text-base",children:"Elige la tienda m√°s conveniente para retirar tu pedido"})]}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:_.map(o=>e.jsxs("div",{className:`relative border-2 rounded-xl p-3 md:p-4 cursor-pointer transition-all duration-200 hover:shadow-lg ${(j==null?void 0:j.id)===o.id?"border-primary bg-primary/5 shadow-md":"border-secondary bg-white hover:border-primary/50 hover:shadow-md"}`,onClick:()=>a(o),children:[e.jsx("div",{className:"absolute top-3 md:top-4 right-3 md:right-4",children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${(j==null?void 0:j.id)===o.id?"border-primary bg-primary":"border-secondary bg-white"}`,children:(j==null?void 0:j.id)===o.id&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4 pr-8",children:[e.jsx("div",{className:"flex-shrink-0 hidden lg:block md:mx-0",children:o.image?e.jsx("img",{src:`/storage/images/store/${o.image}`,alt:o.name,className:"w-16 h-16 md:w-20 md:h-20 object-cover rounded-lg border border-secondary"}):e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-secondary rounded-lg border border-secondary flex items-center justify-center",children:e.jsx(dt,{className:"customtext-primary"})})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left md:text-left",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold customtext-neutral-dark text-base md:text-lg truncate",children:o.name}),e.jsx("span",{className:`hidden lg:block px-2 py-1 rounded-full text-xs font-medium ${o.type==="tienda"?"bg-primary/10 customtext-primary":o.type==="oficina"||o.type==="almacen"?"bg-secondary customtext-neutral-dark":o.type==="showroom"?"bg-primary/10 customtext-primary":"bg-secondary customtext-neutral-dark"}`,children:o.type==="tienda"?"Tienda":o.type==="oficina"?"Oficina":o.type==="almacen"?"Almac√©n":o.type==="showroom"?"Showroom":o.type||"Otro"})]}),e.jsx("p",{className:"text-sm customtext-neutral-light mb-3 line-clamp-3",children:o.address}),e.jsxs("div",{className:"flex flex-col md:flex-row md:flex-wrap gap-2 md:gap-4 text-sm customtext-neutral-light mb-3",children:[o.phone&&e.jsxs("div",{className:"flex items-center justify-start md:justify-start gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{children:o.phone})]}),o.manager&&e.jsxs("div",{className:"flex items-center justify-start md:justify-start gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{className:"text-center md:text-left",children:["Encargado: ",o.manager]})]})]}),o.business_hours&&e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mt-3",children:[e.jsx("div",{className:"text-xs font-medium customtext-neutral-dark mb-2",children:"Horarios de atenci√≥n:"}),e.jsx("div",{className:"text-xs customtext-neutral-light",children:(()=>{try{const n=typeof o.business_hours=="string"?JSON.parse(o.business_hours):o.business_hours,E=new Date().toLocaleDateString("es-PE",{weekday:"long"}),I={lunes:"Lunes",martes:"Martes",mi√©rcoles:"Mi√©rcoles",jueves:"Jueves",viernes:"Viernes",s√°bado:"S√°bado",domingo:"Domingo"}[E.toLowerCase()]||E,R=n.find(D=>D.day.toLowerCase()===I.toLowerCase());if(R){const D=R.closed?"Hoy: Cerrado":`Hoy: ${R.open} - ${R.close}`,te=!R.closed&&(()=>{const le=new Date,J=le.getHours()*60+le.getMinutes(),[Z,K]=R.open.split(":").map(Number),[W,Y]=R.close.split(":").map(Number),se=Z*60+K,re=W*60+Y;return J>=se&&J<=re})();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:D}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${te?"bg-primary/10 customtext-primary":"bg-red-100 text-red-800"}`,children:te?"Abierto":"Cerrado"})]})}return"Horarios disponibles"}catch{return"Horarios disponibles"}})()})]}),o.description&&e.jsx("div",{className:"hidden lg:block mt-3 pt-3 border-t border-secondary",children:e.jsx("p",{className:"text-sm customtext-neutral-light text-center md:text-left",children:o.description})})]})]})]},o.id))})]})};function jt({data:f,cart:v,setSale:j,setCode:L,setDelivery:_,setCart:q,onContinue:$,noContinue:N,subTotal:h,igv:u,totalFinal:l,user:a,setEnvio:o,envio:n,ubigeos:E=[],openModal:O,setCouponDiscount:I,setCouponCode:R,automaticDiscounts:D=[],automaticDiscountTotal:te=0,totalWithoutDiscounts:le,conversionScripts:J,setConversionScripts:Z,onPurchaseComplete:K}){var Be;const[W,Y]=c.useState(null),[se,re]=c.useState(null),[H,de]=c.useState([]),[Q,ie]=c.useState(0);H.reduce((t,s)=>s.free_items&&Array.isArray(s.free_items)?[...t,...s.free_items]:t,[]);const xe=(t,s)=>{var b;let g=[],k=0;for(const r of s)switch(r.type){case"buy_x_get_y":{t.forEach(m=>{var p;if((p=r.product_ids)!=null&&p.includes(m.id)){const i=Math.floor(m.quantity/(r.buy+r.get));if(i>0&&r.get>0){const M=i*r.get,oe=M*m.final_price;g.push({name:r.name,amount:oe,description:r.description,free_items:[{...m,quantity:M}]}),k+=oe}}});break}case"quantity_discount":{t.forEach(m=>{var p;if((p=r.product_ids)!=null&&p.includes(m.id)){const i=Math.floor(m.quantity/r.buy);if(i>0&&r.pay<r.buy){const M=i*(r.buy-r.pay)*m.final_price;g.push({name:r.name,amount:M,description:r.description}),k+=M}}});break}case"tiered_discount":{t.forEach(m=>{var p;if((p=r.product_ids)!=null&&p.includes(m.id)){const i=Math.floor(m.quantity/r.tier);if(i>0&&r.free>0){const M=i*r.free,oe=M*m.final_price;g.push({name:r.name,amount:oe,description:r.description,free_items:[{...m,quantity:M}]}),k+=oe}}});break}case"category_discount":{t.forEach(m=>{var p;if((p=r.category_ids)!=null&&p.includes(m.category_id)){const i=m.final_price*m.quantity*(r.percent/100);i>0&&(g.push({name:r.name,amount:i,description:r.description}),k+=i)}});break}case"cart_discount":{const m=t.reduce((p,i)=>p+i.final_price*i.quantity,0);if(m>=(r.min_total||0)){const p=r.percent?m*(r.percent/100):r.amount||0;p>0&&(g.push({name:r.name,amount:p,description:r.description}),k+=p)}break}case"bundle_discount":{((b=r.product_ids)==null?void 0:b.every(p=>t.some(i=>i.id===p)))&&r.amount>0&&(g.push({name:r.name,amount:r.amount,description:r.description}),k+=r.amount);break}}return{discounts:g,totalDiscount:k}};c.useEffect(()=>{if(D&&Array.isArray(D)&&D.length>0){const{discounts:t,totalDiscount:s}=xe(v,D);de(t),ie(s)}else de([]),ie(0)},[v,D]);const he=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[y,V]=c.useState({name:(a==null?void 0:a.name)||"",lastname:(a==null?void 0:a.lastname)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",documentType:((Be=a==null?void 0:a.document_type)==null?void 0:Be.toLowerCase())||"",document:(a==null?void 0:a.document_number)||"",department:(a==null?void 0:a.department)||"",province:(a==null?void 0:a.province)||"",district:(a==null?void 0:a.district)||"",address:(a==null?void 0:a.address)||"",number:(a==null?void 0:a.number)||"",comment:"",reference:(a==null?void 0:a.reference)||"",ubigeo:(a==null?void 0:a.ubigeo)||null});c.useEffect(()=>{if(a!=null&&a.ubigeo&&(a!=null&&a.district)&&(a!=null&&a.province)&&(a!=null&&a.department)){const t={value:a.ubigeo,label:`${a.district}, ${a.province}, ${a.department}`,data:{reniec:a.ubigeo,departamento:a.department,provincia:a.province,distrito:a.district}};re(t),Y(t),De(t)}},[a]),c.useEffect(()=>{a&&V(t=>{var s;return{...t,name:a.name||t.name,lastname:a.lastname||t.lastname,email:a.email||t.email,phone:a.phone||t.phone,documentType:((s=a.document_type)==null?void 0:s.toLowerCase())||t.documentType,document:a.document_number||t.document,department:a.department||t.department,province:a.province||t.province,district:a.district||t.district,address:a.address||t.address,number:a.number||t.number,reference:a.reference||t.reference,ubigeo:a.ubigeo||t.ubigeo}})},[a]);const[x,d]=c.useState(!1),[w,P]=c.useState(!1),[G,ae]=c.useState([]),[A,z]=c.useState(null),[ee,Se]=c.useState(null),[C,B]=c.useState({}),[_e,ye]=c.useState(""),[be,je]=c.useState(!1),[me,Ie]=c.useState(""),[T,Oe]=c.useState(null),[Ee,qe]=c.useState(0),[ve,Ae]=c.useState(!1),[Pe,fe]=c.useState(""),[Ne,Te]=c.useState(null),[He,Fe]=c.useState(!1),[Ge,Me]=c.useState(!1),Xe=t=>{Te(t),B(s=>({...s,store:""}))},Ke=t=>{var g,k,b;const s=["name","lastname","documentType","document","email","phone","ubigeo","address","shipping"];for(const r of s)if(t[r]){let m=null,p=!1;if(r==="ubigeo"?m=((k=(g=document.querySelector('[name="ubigeo"]'))==null?void 0:g.parentElement)==null?void 0:k.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):r==="shipping"?m=((b=document.querySelector('input[name="shipping"]'))==null?void 0:b.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(m=document.querySelector(`[name="${r}"]`),p=!0),m){m.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),p&&setTimeout(()=>{try{m.focus(),m.tagName==="INPUT"&&m.type==="text"&&m.select()}catch(i){console.warn("No se pudo enfocar el elemento:",i)}},600),We(m);break}}},We=t=>{if(!t)return;const s=document.createElement("div");if(s.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const k=document.createElement("style");k.id="error-highlight-styles",k.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(k)}const g=t.style.position;(!g||g==="static")&&(t.style.position="relative"),t.appendChild(s),setTimeout(()=>{s.parentNode&&(s.parentNode.removeChild(s),(!g||g==="static")&&(t.style.position=g))},1200)},De=async t=>{var g,k,b,r,m;if(!t)return;B(p=>({...p,ubigeo:""}));const{data:s}=t;V(p=>({...p,department:s.departamento,province:s.provincia,district:s.distrito,ubigeo:s.reniec})),d(!0);try{const p=v.reduce((U,ke)=>U+ke.final_price*ke.quantity,0);console.log("üõí ShippingStep - Cart total calculado:",p),console.log("üõí ShippingStep - Cart items:",v.map(U=>({name:U.name,price:U.final_price,quantity:U.quantity,total:U.final_price*U.quantity}))),console.log("üí∞ ShippingStep - Comparaci√≥n de totales:"),console.log("   - Cart total (solo productos):",p),console.log("   - SubTotal prop:",h),console.log("   - IGV prop:",u),console.log("   - Total con IGV:",h+u),console.log("   - Total final prop:",l);const i=await at.getShippingCost({ubigeo:s.reniec,cart_total:p});console.log("üì¶ ShippingStep - Respuesta del backend:",i.data),console.log("‚úÖ ShippingStep - Califica para env√≠o gratis?",i.data.qualifies_free_shipping),console.log("üí∞ ShippingStep - Umbral requerido:",i.data.free_shipping_threshold),console.log("üîç ShippingStep - is_free:",i.data.is_free),console.log("üîç ShippingStep - Descripci√≥n standard:",(g=i.data.standard)==null?void 0:g.description),console.log("üîç ShippingStep - Tipo standard:",(k=i.data.standard)==null?void 0:k.type);const M=[];let oe=!1;if(i.data.is_free&&i.data.qualifies_free_shipping&&(console.log("‚úÖ ShippingStep - Es zona is_free=true Y califica por monto - Agregando env√≠o GRATIS"),M.push({type:"free",price:0,description:i.data.standard.description,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics})),i.data.standard&&(!i.data.is_free||i.data.is_free&&!i.data.qualifies_free_shipping)){console.log("üì¶ ShippingStep - Agregando env√≠o NORMAL");let U=i.data.standard.description;i.data.is_free||(U=U.replace(/env√≠o gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),U||(U="Delivery a domicilio")),M.push({type:"standard",price:i.data.standard.price,description:U,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics})}i.data.express&&i.data.express.price>0&&(console.log("‚ö° ShippingStep - Agregando env√≠o EXPRESS"),M.push({type:"express",price:i.data.express.price,description:i.data.express.description,deliveryType:i.data.express.type,characteristics:i.data.express.characteristics})),i.data.is_agency&&i.data.agency&&(console.log("üè¢ ShippingStep - Agregando env√≠o por AGENCIA"),M.push({type:"agency",price:i.data.agency.price||0,description:i.data.agency.description,deliveryType:i.data.agency.type,characteristics:i.data.agency.characteristics})),i.data.is_store_pickup&&(console.log("üè™ ShippingStep - Retiro en tienda disponible"),oe=!0),oe||i.data.is_store_pickup?(M.some(ke=>ke.type==="store_pickup")||(i.data.store_pickup?M.push({type:"store_pickup",price:i.data.store_pickup.price,description:i.data.store_pickup.description,deliveryType:i.data.store_pickup.type,characteristics:i.data.store_pickup.characteristics}):M.push({type:"store_pickup",price:0,description:"Retira tu pedido en una de nuestras tiendas",deliveryType:"Retiro en Tienda",characteristics:["Sin costo de env√≠o","Horarios flexibles","Atenci√≥n personalizada"]})),Fe(!0)):(Fe(!1),Te(null)),ae(M),z(((b=M[0])==null?void 0:b.type)||null),o(((r=M[0])==null?void 0:r.price)||0),je(!1),console.log("üìã ShippingStep - Opciones finales de env√≠o:",M),console.log("üöö ShippingStep - Precio de env√≠o seleccionado:",((m=M[0])==null?void 0:m.price)||0)}catch{X.error("Sin cobertura",{description:"No realizamos env√≠os a esta ubicaci√≥n.",icon:e.jsx($e,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),ae([]),z(null),o(0),je(!1)}d(!1)},Ve=async t=>{var b,r;if(t.preventDefault(),w)return;if(!a){Me(!0);return}const s={},g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,k=/^[0-9]{9}$/;if(y.name.trim()||(s.name="Nombre es requerido"),y.lastname.trim()||(s.lastname="Apellido es requerido"),y.documentType.trim()||(s.documentType="Tipo de documento es requerido"),y.document.trim()||(s.document="N√∫mero de documento es requerido"),y.email.trim()?g.test(y.email)||(s.email="Email inv√°lido"):s.email="Email es requerido",y.phone.trim()?k.test(y.phone.trim())||(s.phone="Tel√©fono debe tener exactamente 9 d√≠gitos"):s.phone="Tel√©fono es requerido",y.ubigeo||(s.ubigeo="Ubicaci√≥n es requerida"),y.address||(s.address="Direcci√≥n es requerida"),A||(s.shipping="Seleccione un m√©todo de env√≠o"),Object.keys(s).length>0){B(s);const m=Object.keys(s)[0],p={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",documentType:"Por favor seleccione el tipo de documento",document:"Por favor ingrese su n√∫mero de documento",email:(b=s.email)!=null&&b.includes("inv√°lido")?"Por favor ingrese un correo electr√≥nico v√°lido":"Por favor ingrese su correo electr√≥nico",phone:(r=s.phone)!=null&&r.includes("9 d√≠gitos")?"El tel√©fono debe tener exactamente 9 d√≠gitos":"Por favor ingrese su n√∫mero de tel√©fono",ubigeo:"Por favor seleccione su ubicaci√≥n de entrega",address:"Por favor ingrese su direcci√≥n de entrega",shipping:"Por favor seleccione un m√©todo de env√≠o"};X.error("Complete el campo requerido",{description:p[m],icon:e.jsx(ue,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),Ke(s);return}P(!0);try{const m={user_id:a.id,...y,fullname:`${y.name} ${y.lastname}`,country:"Per√∫",document_type:y.documentType,amount:F(we),delivery:F(n),delivery_type:A,store_id:A==="store_pickup"?Ne==null?void 0:Ne.id:null,cart:v,coupon_id:(T==null?void 0:T.id)||null,coupon_code:(T==null?void 0:T.code)||null,coupon_discount:F(Ee||0),applied_promotions:D||[],promotion_discount:F(te||0)};console.log("üì¶ Request completo a enviar:",m),console.log("üí∞ Monto final con cup√≥n:",we),console.log("üéüÔ∏è Descuento del cup√≥n:",Ee),console.log("üöö Costo de env√≠o:",n);const p=await yt(m);if(console.log("üìã Respuesta completa del procesamiento:",p),p.status){if(console.log("‚úÖ Pago exitoso, procesando respuesta..."),j(p.sale),_(p.delivery),L(p.code),p.conversion_scripts&&(console.log("Scripts de conversi√≥n recibidos:",p.conversion_scripts),Z(p.conversion_scripts),K)){console.log("üéØ Ejecutando callback onPurchaseComplete...");try{await K(p.sale_id,p.conversion_scripts),console.log("‚úÖ Callback onPurchaseComplete ejecutado exitosamente")}catch(i){console.error("‚ùå Error en callback onPurchaseComplete:",i)}}console.log("üõí Limpiando carrito y continuando..."),q([]),$()}else console.log("‚ùå Pago rechazado:",p),X.error("Error en el pago",{description:p.message||"Pago rechazado",icon:e.jsx($e,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(m){console.error("üí• Error completo en handlePayment:",m),console.error("üí• Stack trace:",m.stack),console.error("üí• Error name:",m.name),console.error("üí• Error message:",m.message),X.error("Lo sentimos, no puede continuar con la compra",{description:`Ocurri√≥ un error al procesar el pedido: ${m.message}`,icon:e.jsx($e,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{P(!1)}},Ye=c.useCallback(mt.debounce((t,s)=>{if(t.length<3){s([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(t)}`).then(g=>{if(!g.ok)throw new Error("Error en la respuesta");return g.json()}).then(g=>{const k=g.map(b=>({value:b.reniec,label:`${b.distrito}, ${b.provincia}, ${b.departamento}`,data:{inei:b.inei,reniec:b.reniec,departamento:b.departamento,provincia:b.provincia,distrito:b.distrito}}));s(k)}).catch(g=>{s([])})},300),[]);c.useEffect(()=>{B(t=>{const s={...t};return y.name.trim()&&delete s.name,y.lastname.trim()&&delete s.lastname,y.documentType.trim()&&delete s.documentType,y.document.trim()&&delete s.document,y.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y.email)&&delete s.email,y.phone.trim()&&/^[0-9]{9}$/.test(y.phone.trim())&&delete s.phone,y.address.trim()&&delete s.address,y.ubigeo&&delete s.ubigeo,A&&delete s.shipping,s})},[y,A]);const Qe=t=>({control:s=>({...s,border:`1px solid ${t?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:t?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:s=>({...s,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:s=>({...s,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),Je=async()=>{var t;if(!me.trim()){fe("Ingrese un c√≥digo de cup√≥n");return}Ae(!0),fe("");try{const s=[...new Set(v.map(r=>r.category_id).filter(Boolean))],g=v.map(r=>r.id);console.log("Validando cup√≥n:",{code:me.trim(),cart_total:h,category_ids:s,product_ids:g});const k=await it.validateCoupon({code:me.trim(),cart_total:h,category_ids:s,product_ids:g});console.log("Respuesta del cup√≥n:",k);const b=k.data||k;if(b&&b.valid){Oe(b.coupon);const r=Math.round(b.discount*100)/100;qe(r),I&&I(r),R&&R(((t=b.coupon)==null?void 0:t.code)||me.trim()),X.success("Cup√≥n aplicado",{description:b.message||"Cup√≥n aplicado correctamente",duration:3e3,position:"top-center"})}else{const r=(b==null?void 0:b.message)||"Cup√≥n no v√°lido";fe(r),X.error("Cup√≥n no v√°lido",{description:r,icon:e.jsx(ue,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(s){console.error("Error al validar cup√≥n:",s),fe("Error al validar el cup√≥n"),X.error("Error",{description:s.message||"No se pudo validar el cup√≥n. Intente nuevamente.",icon:e.jsx(ue,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{Ae(!1)}},Ze=()=>{Oe(null),qe(0),Ie(""),fe(""),I&&I(0),R&&R(""),X.success("Cup√≥n removido",{description:"El cup√≥n ha sido removido de su pedido",duration:2e3,position:"top-center"})},F=t=>{const s=typeof t=="string"?parseFloat(t):t;return parseFloat(s.toFixed(2))},ze=F(h)+F(u)+F(n)-F(Q);let ge=0;T&&(T.type==="percentage"||T.type==="percent"?ge=ze*Number(T.value)/100:T.type==="fixed"&&(ge=Number(T.value))),c.useEffect(()=>{qe(F(ge)),I&&I(F(ge))},[T,h,u,n,Q]);const we=Math.max(0,F(ze-ge)),et=()=>{if(!Ge)return null;const t=s=>{s.target===s.currentTarget&&Me(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-2xl transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4",children:e.jsx(ht,{className:"h-8 w-8 customtext-primary"})}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-3",children:"Acceso requerido"}),e.jsx("p",{className:"customtext-neutral-light text-sm leading-relaxed",children:"Para continuar con su compra necesita iniciar sesi√≥n o crear una cuenta nueva."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{window.location.href="/iniciar-sesion"},className:"w-full py-3 px-6 bg-primary text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Iniciar sesi√≥n"}),e.jsx("button",{onClick:()=>{window.location.href="/crear-cuenta"},className:"w-full py-3 px-6 bg-accent text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Crear cuenta nueva"}),e.jsx("button",{onClick:()=>Me(!1),className:"w-full py-3 px-6 customtext-neutral-light hover:customtext-neutral-dark border border-secondary rounded-lg hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200",children:"Cancelar"})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx(et,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:Ve,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{name:"name",label:"Nombres",value:y.name,error:C.name,onChange:t=>{V(s=>({...s,name:t.target.value})),t.target.value.trim()&&C.name&&B(s=>({...s,name:""}))},required:!0,className:`border-gray-200 ${C.name?"border-red-500 bg-red-50":""}`}),e.jsx(ne,{name:"lastname",label:"Apellidos",value:y.lastname,error:C.lastname,onChange:t=>{V(s=>({...s,lastname:t.target.value})),t.target.value.trim()&&C.lastname&&B(s=>({...s,lastname:""}))},required:!0,className:`border-gray-200 ${C.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(lt,{label:"Tipo de documento",options:he,placeholder:"Selecciona tu documento",labelClass:"block text-sm 2xl:!text-base mb-1 customtext-neutral-dark",value:y.documentType,error:C.documentType,onChange:t=>{V(s=>({...s,documentType:t})),t&&C.documentType&&B(s=>({...s,documentType:""}))},required:!0})}),e.jsx(ne,{name:"document",label:"N√∫mero de documento",value:y.document,error:C.document,onChange:t=>{V(s=>({...s,document:t.target.value})),t.target.value.trim()&&C.document&&B(s=>({...s,document:""}))},placeholder:"Ej: 12345678",required:!0,className:`border-gray-200 ${C.document?"border-red-500 bg-red-50":""}`})]}),e.jsx(ne,{name:"email",label:"Correo electr√≥nico",type:"email",value:y.email,error:C.email,onChange:t=>{V(s=>({...s,email:t.target.value})),t.target.value.trim()&&C.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.target.value)&&B(g=>({...g,email:""}))},required:!0,className:`border-gray-200 ${C.email?"border-red-500 bg-red-50":""}`}),e.jsx(ne,{name:"phone",label:"Tel√©fono",type:"tel",value:y.phone,error:C.phone,onChange:t=>{const s=t.target.value.replace(/\D/g,"");V(g=>({...g,phone:s})),s.length===9&&C.phone&&B(g=>({...g,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${C.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (Ubicaci√≥n de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(ot,{name:"ubigeo",cacheOptions:!0,value:W,loadOptions:Ye,onChange:t=>{Y(t),De(t),ye("")},inputValue:_e,onInputChange:(t,{action:s})=>{s==="input-change"&&ye(t)},onFocus:()=>{Y(null),ye("")},onMenuOpen:()=>{W&&(Y(null),ye(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:t})=>t.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:x,styles:Qe(!!C.ubigeo),formatOptionLabel:({data:t})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:t.distrito}),e.jsxs("div",{className:"text-gray-500",children:[t.provincia,", ",t.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),C.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:C.ubigeo})]}),e.jsx(ne,{name:"address",label:"Direcci√≥n ",value:y.address,error:C.address,onChange:t=>{V(s=>({...s,address:t.target.value})),t.target.value.trim()&&C.address&&B(s=>({...s,address:""}))},required:!0,className:`border-gray-200 ${C.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"N√∫mero",value:y.number,onChange:t=>V(s=>({...s,number:t.target.value})),className:"border-gray-200"}),e.jsx(ne,{label:"Referencia",value:y.reference,onChange:t=>V(s=>({...s,reference:t.target.value})),className:"border-gray-200"})]}),G.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"M√©todo de env√≠o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:G.map(t=>e.jsx(nt,{title:t.deliveryType,price:t.price,description:t.description,selected:A===t.type,onSelect:()=>{z(t.type),o(t.price),B(s=>({...s,shipping:"",store:""})),je(!1),t.type!=="store_pickup"&&Te(null)}},t.type))}),A&&G.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(()=>{var k;const t=((k=G.find(b=>b.type===A))==null?void 0:k.characteristics)||[],s=t.length>1,g=s&&!be?t.slice(0,1):t;return e.jsxs(e.Fragment,{children:[g.map((b,r)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(rt,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:b})})]},`char-${r}`)),s&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{type:"button",onClick:()=>je(!be),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium customtext-primary hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:be?"Ver menos informaci√≥n":`Ver m√°s informaci√≥n (${t.length-1} m√°s)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${be?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})})()})]}),A==="store_pickup"&&He&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(bt,{ubigeoCode:y.ubigeo,onStoreSelect:Xe,selectedStore:Ne,className:"border border-gray-200 rounded-xl p-4"}),C.store&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),C.store]})]}),!N&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(Re,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(Ce,{type:"submit",loading:x,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:v.map(t=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/storage/images/item/${t.image}`,alt:t.name,className:"w-16 h-16 object-cover rounded-lg",onError:s=>s.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",t.quantity]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["S/ ",S(t.final_price)]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",S(F(h))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",S(F(u))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Env√≠o:"}),e.jsxs("span",{children:["S/ ",S(F(n))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"¬øTienes un cup√≥n de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu c√≥digo de cup√≥n",value:me,onChange:t=>Ie(t.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${Pe?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":T?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!T||ve}),ve&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),T?e.jsx("button",{type:"button",onClick:Ze,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cup√≥n",children:e.jsx(ue,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:Je,disabled:ve||!me.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:ve?"Validando...":"Aplicar"})]}),Pe&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ue,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:Pe})]}),T&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",T.type==="percentage"?`${T.value}%`:`S/${S(T.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:T.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-S/ ",S(F(Ee))]})})]})})]})}),H&&H.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"üéâ Descuentos autom√°ticos aplicados:"}),H.map((t,s)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:t.name}),t.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:t.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-S/ ",S(t.amount)]})})]})},s)),Q>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos autom√°ticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-S/ ",S(Q)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",S(F(we))]})]})}),e.jsx(Ce,{onClick:Ve,disabled:w,loading:w,className:`w-full mt-6 ${(f==null?void 0:f.class_button)||"text-white"}`,children:w?"Procesando...":`Pagar S/ ${S(F(we))}`}),e.jsx(Re,{onClick:N,className:"w-full mt-3",disabled:w,children:"Regresar al carrito"}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{href:"#",onClick:()=>O(1),className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{href:"#",onClick:()=>O(0),className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})]})]})]})]})}function vt({cart:f,code:v,delivery:j,couponDiscount:L=0,couponCode:_=null,conversionScripts:q=null,automaticDiscounts:$=[],automaticDiscountTotal:N=0}){const h=f.reduce((n,E)=>{const O=E.final_price;return n+O*E.quantity},0),u=parseFloat((h/1.18).toFixed(2)),l=parseFloat((h-u).toFixed(2)),o=parseFloat(u)+parseFloat(l)+parseFloat(j)-L-N;return c.useEffect(()=>{if(q){console.log("Executing conversion scripts...");try{if(q.head){const n=document.createElement("script");n.innerHTML=q.head,document.head.appendChild(n)}if(q.body){const n=document.createElement("script");n.innerHTML=q.body,document.body.appendChild(n)}console.log("Conversion scripts executed successfully")}catch(n){console.error("Error executing conversion scripts:",n)}}},[q]),e.jsx(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(ce.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(ce.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"‚úì"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"¬°Gracias por tu compra! üéâ"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(ce.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"C√≥digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${v}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:f.map((n,E)=>e.jsx(ce.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:E*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${n.image}`,alt:n.name,className:"w-24 h-24 object-cover rounded-lg",onError:O=>O.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-xl lg:w-8/12 line-clamp-3",children:n.name}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:["S/ ",S(n.final_price*n.quantity)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:n.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:n.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:n.sku})]})]})]})]})},E))}),e.jsxs(ce.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[[{label:"Subtotal",value:u},{label:"IGV",value:l},{label:"Env√≠o",value:j}].map((n,E)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:n.label}),e.jsxs("span",{className:"font-semibold",children:["S/ ",S(n.value)]})]},E)),L>0&&_&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark text-start",children:["Cup√≥n: ",e.jsx("br",{className:"lg:hidden"}),e.jsxs("span",{className:"font-semibold text-xs lg:text-base",children:["(",_,")"]})]}),e.jsxs("span",{className:"font-semibold",children:["-S/ ",S(L)]})]}),N>0&&$.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 customtext-neutral-dark mb-2",children:"üéâ Descuentos aplicados:"}),$.map((n,E)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[n.name,n.description&&e.jsx("span",{className:"text-xs font-semibold block",children:n.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",S(n.amount)]})]},E)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",S(N)]})]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",S(o)]})]})})]}),e.jsx(ce.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(Ce,{href:"/catalogo",className:"w-full mx-auto md:w-auto",children:"Seguir Comprando"})})]})]})})})}const Nt=()=>{const f=c.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),v=(h,u={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[h],content_type:"product",content_name:u.name||"",value:u.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:u.price||0,items:[{item_id:h,item_name:u.name||"",category:u.category||"",price:u.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:h,content_type:"product",content_name:u.name||"",value:u.price||0,currency:"PEN"}),console.log("‚úÖ ProductView tracked for product:",h))},j=async(h,u=1,l={})=>{var a;if(!(typeof window>"u"))try{const n=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||""},body:JSON.stringify({product_id:h,quantity:u,...l})})).json();n.success&&n.tracking_scripts&&($(n.tracking_scripts),console.log("‚úÖ AddToCart tracked successfully"))}catch(o){console.error("‚ùå Error tracking AddToCart:",o)}},L=async(h,u)=>{var l;if(!(typeof window>"u"||f.current.hasTrackedInitiateCheckout))try{f.current.hasTrackedInitiateCheckout=!0;const o=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content)||""},body:JSON.stringify({cart_items:h.map(n=>({product_id:n.id,name:n.name,price:n.final_price||n.price,quantity:n.quantity,subtotal:(n.final_price||n.price)*n.quantity}))})})).json();o.success&&o.tracking_scripts&&($(o.tracking_scripts),console.log("‚úÖ InitiateCheckout tracked successfully"))}catch(a){console.error("‚ùå Error tracking InitiateCheckout:",a),f.current.hasTrackedInitiateCheckout=!1}},_=(h,u)=>{if(!(typeof window>"u")){console.log("üéØ Iniciando tracking de compra:",{orderId:h,conversionScripts:u});try{u?(console.log("üìä Usando scripts de conversi√≥n del servidor"),$(u)):(console.log("üîÑ Obteniendo scripts de conversi√≥n del API"),fetch(`/api/tracking/purchase/${h}`).then(l=>l.text()).then(l=>{l&&($(l),console.log("‚úÖ Purchase tracked successfully"))}).catch(l=>{console.error("‚ùå Error tracking Purchase:",l)}))}catch(l){console.error("‚ùå Error general en trackPurchase:",l)}}},q=(h,u=[])=>{if(typeof window>"u"||f.current.hasTrackedPageView)return;f.current.hasTrackedPageView=!0;const l=u.reduce((a,o)=>a+(o.final_price||o.price)*o.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),h===1&&u.length>0&&window.fbq("track","AddToCart",{content_ids:u.map(a=>a.id),content_type:"product",value:l,currency:"PEN",num_items:u.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${h}`,page_location:window.location.href}),h===1&&u.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:l,items:u.map(a=>{var o;return{item_id:a.id,item_name:a.name,category:((o=a.category)==null?void 0:o.name)||"Sin categor√≠a",quantity:a.quantity,price:a.final_price||a.price}})})),console.log(`‚úÖ Checkout PageView tracked - Step ${h}`)},$=h=>{if(typeof window>"u"||!h)return;console.log("üéØ Ejecutando scripts de tracking:",h);const u=document.createElement("div");u.innerHTML=h,u.querySelectorAll("script").forEach((a,o)=>{try{const n=document.createElement("script");n.textContent=a.textContent,console.log(`üìä Ejecutando script de tracking ${o+1}:`,a.textContent.trim()),document.head.appendChild(n),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},100),console.log(`‚úÖ Script de tracking ${o+1} ejecutado exitosamente`)}catch(n){console.error(`‚ùå Error ejecutando script de tracking ${o+1}:`,n),console.error("Script content:",a.textContent)}}),console.log("üéØ Todos los scripts de tracking procesados")};return{trackProductView:v,trackAddToCart:j,trackInitiateCheckout:L,trackPurchase:_,trackCheckoutPageView:q,resetTracking:()=>{f.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};function hs({cart:f,setCart:v,user:j,ubigeos:L=[],items:_,generals:q,data:$}){const[N,h]=c.useState(1),u=f.reduce((z,ee)=>z+ee.final_price*ee.quantity,0),{trackCheckoutPageView:l,trackInitiateCheckout:a,trackPurchase:o,resetTracking:n}=Nt(),E=parseFloat((u/1.18).toFixed(2)),O=parseFloat((u-E).toFixed(2)),[I,R]=c.useState(0),[D,te]=c.useState(0),[le,J]=c.useState(null),[Z,K]=c.useState([]),[W,Y]=c.useState(0),se=E+O+parseFloat(I),re=D+W,H=Math.max(0,se-re),[de,Q]=c.useState([]),[ie,xe]=c.useState([]),[he,y]=c.useState([]),[V,x]=c.useState(null);c.useEffect(()=>(l(N,f),()=>n()),[]),c.useEffect(()=>{l(N,f),N===2&&a(f,H)},[N]);const d=z=>{h(z),window.scrollTo({top:0,behavior:"smooth"})},w={privacy_policy:"Pol√≠ticas de privacidad",terms_conditions:"T√©rminos y condiciones",saleback_policy:"Pol√≠ticas de devolucion y cambio"},[P,G]=c.useState(null),ae=z=>G(z),A=()=>G(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${N===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:N>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${N>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${N>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Env√≠o"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:N>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${N===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${N===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmaci√≥n"})]})]})}),N===1&&e.jsx(ft,{data:$,cart:f,setCart:v,onContinue:()=>d(2),subTotal:E,envio:I,igv:O,totalFinal:H,openModal:ae,automaticDiscounts:Z,setAutomaticDiscounts:K,automaticDiscountTotal:W,setAutomaticDiscountTotal:Y,totalWithoutDiscounts:se}),N===2&&e.jsx(jt,{data:$,items:_,setCode:xe,setDelivery:y,cart:f,setSale:Q,setCart:v,onContinue:()=>d(3),noContinue:()=>d(1),subTotal:E,envio:I,setEnvio:R,igv:O,totalFinal:H,user:j,ubigeos:L,openModal:ae,setCouponDiscount:te,setCouponCode:J,automaticDiscounts:Z,automaticDiscountTotal:W,totalWithoutDiscounts:se,conversionScripts:V,setConversionScripts:x,onPurchaseComplete:(z,ee)=>{o(z,ee)}}),N===3&&e.jsx(vt,{code:ie,delivery:he,cart:de,subTotal:E,envio:I,igv:O,totalFinal:H,couponDiscount:D,couponCode:le,automaticDiscounts:Z,automaticDiscountTotal:W,totalWithoutDiscounts:se,conversionScripts:V,setConversionScripts:x,onPurchaseComplete:(z,ee)=>{o(z,ee)}})]}),Object.keys(w).map((z,ee)=>{var B;const Se=w[z],C=((B=q.find(_e=>_e.correlative==z))==null?void 0:B.description)??"";return e.jsx(pt,{isOpen:P===ee,onRequestClose:A,contentLabel:Se,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:Se}),e.jsx("button",{onClick:A,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(xt,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(ut,{html:C})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:A,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},ee)})]})}export{hs as default};

import{j as e,r as t}from"./System-Bybt2Brn.js";import{D as a,U as l,R as n,I as s,T as i,S as o,Z as r,F as c,C as d,a as u,b as m,c as g,H as p,d as x,e as h,f,g as v,h as y,u as b,i as j,j as w,k as N,l as C,m as k,n as S,o as E,p as $}from"./FileSaver.min-7qIKnSDm.js";import{C as M}from"./chevron-left-DoRUFD_L.js";import{E as A}from"./eye-DJ5vw54Z.js";import{c as D}from"./createLucideIcon-oahCLV50.js";import{H as P}from"./heart-CyPg-ZZw.js";import{L as z,P as T}from"./palette-DuJbwA7w.js";import{T as R}from"./trash-2-CDXts6on.js";import{U as L}from"./upload-Dg6XfAsq.js";import{P as F}from"./plus-4JHYG4O1.js";import"./vendor-BiOv2i5T.js";import"./index-DnFyAGLw.js";
/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=D("Blend",[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]]),I=D("SlidersVertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),U=D("Triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]);
/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function O({children:t,onClick:a,className:l="",variant:n="default",size:s="default",disabled:i=!1,icon:o=null}){return e.jsxs("button",{className:`inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background ${{default:"bg-purple-600 text-white hover:bg-purple-700",outline:"border border-input hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",secondary:"bg-gray-100 text-gray-800 hover:bg-gray-200"}[n]} ${{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md text-sm",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10","icon-sm":"h-8 w-8"}[s]} ${l} gap-2`,onClick:a,disabled:i,children:[o&&e.jsx("span",{className:"w-4 h-4",children:o}),t]})}function B({onExport:t,onPreviewToggle:l,previewMode:n}){return e.jsxs("header",{className:"border-b bg-white p-4 flex items-center justify-between shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(O,{variant:"ghost",size:"sm",children:[e.jsx(M,{className:"h-5 w-5 mr-1"}),"Regresar"]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editor de Fotos Profesional"}),e.jsx("h2",{className:"text-lg text-gray-600",children:"Crea collages y diseños impresionantes"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"secondary",onClick:l,icon:e.jsx(A,{className:"h-4 w-4"}),children:n?"Editar":"Vista previa"}),e.jsx(O,{className:"bg-purple-600 hover:bg-purple-700",icon:e.jsx(a,{className:"h-4 w-4"}),onClick:t,children:"Exportar"})]})]})}function H({onUndo:t,onRedo:a,onAddImage:o,onAddText:r,onDeleteElement:c,canUndo:d,canRedo:u,hasSelectedElement:m}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 flex items-center gap-4",children:[e.jsx(O,{variant:"ghost",size:"icon",onClick:t,disabled:!d,children:e.jsx(l,{className:"h-5 w-5"})}),e.jsx(O,{variant:"ghost",size:"icon",onClick:a,disabled:!u,children:e.jsx(n,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-6 border-l"}),e.jsx(O,{variant:"ghost",size:"icon",onClick:o,children:e.jsx(s,{className:"h-5 w-5"})}),e.jsx(O,{variant:"ghost",size:"icon",onClick:r,children:e.jsx(i,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-6 border-l"}),e.jsx(O,{variant:"ghost",size:"icon",onClick:c,disabled:!m,children:e.jsx(R,{className:"h-5 w-5"})})]})}const q=[{id:"layout-1",name:"Cuatro fotos",template:"grid-cols-2 grid-rows-2 gap-4",cells:4,maskCategories:[{name:"Básicas",masks:["none","circle","rounded","square","rounded-sm","rounded-lg","rounded-full","rounded-rect"]},{name:"Formas",masks:["heart","star","hexagon","triangle","diamond","badge","speech","burst"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave","diagonal","bevel","poster","inner-frame"]},{name:"Creativas",masks:["leaf","cloud","flower","ornate","blob1","blob2","blob3"]}]}];function J({selectedLayout:t,onSelect:a}){return e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Layouts"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:q.map((l=>e.jsxs("div",{className:"border rounded-md p-1 cursor-pointer hover:border-purple-500 "+(t===l.id?"border-purple-500 ring-1 ring-purple-200":""),onClick:()=>a(l.id),children:[e.jsx("div",{className:`grid ${l.template} gap-1 h-20`,children:Array.from({length:l.cells}).map(((t,a)=>e.jsx("div",{className:"bg-gray-100 rounded-sm flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:a+1})},a)))}),e.jsx("p",{className:"text-xs text-center mt-1 truncate",children:l.name})]},l.id)))})]})}function W({onAddImage:t,onAddText:a}){return e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Añadir"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(O,{variant:"outline",size:"sm",icon:e.jsx(s,{className:"h-4 w-4"}),onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{e.target.files&&e.target.files[0]&&t(e.target.files[0])},e.click()},children:"Imagen"}),e.jsx(O,{variant:"outline",size:"sm",icon:e.jsx(i,{className:"h-4 w-4"}),onClick:a,children:"Texto"})]})]})}function X({tabs:t,activeTab:a,onChange:l}){return e.jsx("div",{className:"flex border-b pb-4",children:t.map((t=>e.jsx("button",{className:"flex-1 py-2 text-sm font-medium "+(a===t.id?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>l(t.id),children:t.label},t.id)))})}function Y({value:a=[50],min:l=0,max:n=100,step:s=1,onValueChange:i,label:o,unit:r="%"}){const[c,d]=t.useState(a[0]);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:o}),e.jsxs("span",{className:"text-sm text-gray-500",children:[c,r]})]}),e.jsx("div",{className:"relative flex w-full touch-none select-none items-center",children:e.jsx("input",{type:"range",min:l,max:n,step:s,value:c,onChange:e=>{const t=Number.parseInt(e.target.value);d(t),i&&i([t])},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})})]})}const _=[{id:"none",name:"Sin máscara",class:"",category:"Básicas",icon:"square"},{id:"circle",name:"Círculo",class:"rounded-full",category:"Básicas",icon:"circle"},{id:"rounded",name:"Redondeado",class:"rounded-xl",category:"Básicas",icon:"square-rounded"},{id:"square",name:"Cuadrado",class:"",category:"Básicas",icon:"square"},{id:"heart",name:"Corazón",class:"mask-heart",category:"Formas",icon:"heart"},{id:"star",name:"Estrella",class:"mask-star-2",category:"Formas",icon:"star"},{id:"hexagon",name:"Hexágono",class:"mask-hexagon",category:"Formas",icon:"hexagon"},{id:"triangle",name:"Triángulo",class:"mask-triangle",category:"Formas",icon:"triangle"},{id:"diamond",name:"Diamante",class:"mask-diamond",category:"Formas",icon:"diamond"},{id:"polaroid",name:"Polaroid",class:"mask-polaroid",category:"Fotográficos",icon:"film"},{id:"vintage",name:"Vintage",class:"mask-vintage",category:"Fotográficos",icon:"feather"},{id:"wave",name:"Onda",class:"mask-wave",category:"Fotográficos",icon:"zap"},{id:"leaf",name:"Hoja",class:"mask-leaf",category:"Creativas",icon:"leaf"},{id:"cloud",name:"Nube",class:"mask-cloud",category:"Creativas",icon:"cloud"},{id:"flower",name:"Flor",class:"mask-flower",category:"Creativas",icon:"flower"}],G=({name:t,className:a=""})=>{const l={square:o,circle:h,heart:P,star:x,hexagon:p,triangle:U,diamond:g,film:m,feather:u,cloud:d,flower:c,zap:r,"square-rounded":o}[t]||o;return e.jsx(l,{className:`${a} ${"square-rounded"===t?"rounded-md":""}`})};function Z({selectedMask:a,onSelect:l,availableMasks:n=[]}){var s;const[i,o]=t.useState("Básicas"),r={};return _.forEach((e=>{r[e.category]||(r[e.category]=[]),(n.includes(e.id)||"none"===e.id)&&r[e.category].push(e)})),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Máscaras de imagen"}),e.jsx("div",{className:"flex overflow-x-auto pb-2",children:Object.keys(r).map((t=>r[t].length>0&&e.jsx("button",{className:"px-3 py-1 text-sm whitespace-nowrap "+(i===t?"border-b-2 border-purple-500 font-medium text-purple-600":"text-gray-600 hover:text-gray-900"),onClick:()=>o(t),children:t},t)))}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:null==(s=r[i])?void 0:s.map((t=>e.jsxs("div",{className:"border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors "+(a===t.id?"border-purple-500 ring-2 ring-purple-200":""),onClick:()=>l(t.id),children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-2",children:e.jsx("div",{className:`w-16 h-16 bg-purple-300 ${t.class} flex items-center justify-center`,children:e.jsx(G,{name:t.icon,className:"h-8 w-8 text-purple-600"})})}),e.jsx("p",{className:"text-center text-sm",children:t.name})]},t.id)))})]})}const K=[{name:"Normal",filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0}},{name:"Vintage",filters:{brightness:90,contrast:110,saturation:80,tint:20,hue:10,blur:1}},{name:"Blanco y negro",filters:{brightness:100,contrast:120,saturation:0,tint:0,hue:0,blur:0}},{name:"Brillante",filters:{brightness:120,contrast:90,saturation:120,tint:0,hue:0,blur:0}},{name:"Oscuro",filters:{brightness:80,contrast:120,saturation:90,tint:10,hue:0,blur:1}},{name:"Sepia",filters:{brightness:90,contrast:100,saturation:50,tint:80,hue:0,blur:0}},{name:"Cálido",filters:{brightness:100,contrast:100,saturation:110,tint:15,hue:20,blur:0}},{name:"Frío",filters:{brightness:100,contrast:100,saturation:110,tint:0,hue:200,blur:0}}],Q=[{value:"normal",label:"Normal"},{value:"multiply",label:"Multiplicar"},{value:"screen",label:"Pantalla"},{value:"overlay",label:"Superponer"},{value:"darken",label:"Oscurecer"},{value:"lighten",label:"Aclarar"},{value:"color-dodge",label:"Sobreexposición de color"},{value:"color-burn",label:"Subexposición de color"},{value:"hard-light",label:"Luz fuerte"},{value:"soft-light",label:"Luz suave"},{value:"difference",label:"Diferencia"},{value:"exclusion",label:"Exclusión"},{value:"hue",label:"Tono"},{value:"saturation",label:"Saturación"},{value:"color",label:"Color"},{value:"luminosity",label:"Luminosidad"}];function ee({element:t,filterTab:a,onFilterTabChange:l,onFilterChange:n,availableMasks:s=[]}){var i,o,r,c,d,u,m,g,p,x,h,b;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{tabs:[{id:"basic",label:"Básicos",icon:e.jsx(I,{size:16})},{id:"transform",label:"Transformar",icon:e.jsx(f,{size:16})},{id:"advanced",label:"Avanzados",icon:e.jsx(z,{size:16})}],activeTab:a,onChange:l}),"basic"===a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Filtros predefinidos"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:K.map((a=>e.jsx(O,{variant:"outline",size:"sm",onClick:()=>(e=>{n({filters:{...t.filters,...e}})})(a.filters),children:a.name},a.name)))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Ajustes básicos"}),e.jsx(Y,{label:"Brillo",value:[(null==(i=t.filters)?void 0:i.brightness)||100],min:0,max:200,onValueChange:e=>n({filters:{...t.filters,brightness:e[0]}})}),e.jsx(Y,{label:"Contraste",value:[(null==(o=t.filters)?void 0:o.contrast)||100],min:0,max:200,onValueChange:e=>n({filters:{...t.filters,contrast:e[0]}})}),e.jsx(Y,{label:"Saturación",value:[(null==(r=t.filters)?void 0:r.saturation)||100],min:0,max:200,onValueChange:e=>n({filters:{...t.filters,saturation:e[0]}})}),e.jsx(Y,{label:"Tono",value:[(null==(c=t.filters)?void 0:c.hue)||0],min:0,max:360,unit:"°",onValueChange:e=>n({filters:{...t.filters,hue:e[0]}})}),e.jsx(Y,{label:"Sepia",value:[(null==(d=t.filters)?void 0:d.tint)||0],min:0,max:100,onValueChange:e=>n({filters:{...t.filters,tint:e[0]}})}),e.jsx(Y,{label:"Desenfoque",value:[(null==(u=t.filters)?void 0:u.blur)||0],min:0,max:20,unit:"px",onValueChange:e=>n({filters:{...t.filters,blur:e[0]}})})]})]}),"transform"===a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Transformación"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(O,{variant:(null==(m=t.filters)?void 0:m.flipHorizontal)?"secondary":"outline",size:"sm",icon:e.jsx(v,{className:"h-4 w-4"}),onClick:()=>{var e;return n({filters:{...t.filters,flipHorizontal:!(null==(e=t.filters)?void 0:e.flipHorizontal)}})},children:"Voltear H"}),e.jsx(O,{variant:(null==(g=t.filters)?void 0:g.flipVertical)?"secondary":"outline",size:"sm",icon:e.jsx(y,{className:"h-4 w-4"}),onClick:()=>{var e;return n({filters:{...t.filters,flipVertical:!(null==(e=t.filters)?void 0:e.flipVertical)}})},children:"Voltear V"})]}),e.jsx(Y,{label:"Rotación",value:[(null==(p=t.filters)?void 0:p.rotate)||0],min:0,max:360,unit:"°",onValueChange:e=>n({filters:{...t.filters,rotate:e[0]}})}),e.jsx(Y,{label:"Escala",value:[100*((null==(x=t.filters)?void 0:x.scale)||1)],min:10,max:200,onValueChange:e=>n({filters:{...t.filters,scale:e[0]/100}})})]}),"advanced"===a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Ajustes avanzados"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modo de mezcla"}),e.jsx("select",{className:"w-full border rounded-md p-2 text-sm",value:(null==(h=t.filters)?void 0:h.blendMode)||"normal",onChange:e=>n({filters:{...t.filters,blendMode:e.target.value}}),children:Q.map((t=>e.jsx("option",{value:t.value,children:t.label},t.value)))})]}),e.jsx(Y,{label:"Opacidad",value:[(null==(b=t.filters)?void 0:b.opacity)||100],min:0,max:100,onValueChange:e=>n({filters:{...t.filters,opacity:e[0]}})})]}),"image"===t.type&&e.jsx(Z,{selectedMask:t.mask||"none",onSelect:e=>n({mask:e}),availableMasks:s})]})}function te({activeTab:a,onTabChange:l,selectedLayout:n,onLayoutChange:s,onAddImage:i,onAddText:o,selectedElement:r,onFilterChange:c,getSelectedElement:d,getCurrentLayout:u}){const[m,g]=t.useState("basic");return e.jsx("aside",{className:"w-64 border-r bg-white p-4 overflow-y-auto shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{tabs:[{id:"elements",label:"Elementos"},{id:"filters",label:"Filtros"}],activeTab:a,onChange:l}),"elements"===a?e.jsxs(e.Fragment,{children:[e.jsx(J,{selectedLayout:n,onSelect:s}),e.jsx(W,{onAddImage:i,onAddText:o})]}):r?e.jsx(ee,{element:d(),filterTab:m,onFilterTabChange:g,onFilterChange:c,availableMasks:u().maskCategories.flatMap((e=>e.masks))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Selecciona un elemento para editar sus filtros"})]})})}function ae({page:t,layout:a}){return e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-lg page-preview",children:e.jsx("div",{className:`grid ${a.template} gap-6 aspect-[4/3]`,children:t.cells.map((t=>e.jsx("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden",children:t.elements.map((t=>"image"===t.type?e.jsx(le,{element:t},t.id):e.jsx(ne,{element:t},t.id)))},t.id)))})})}function le({element:t}){var a,l,n,s,i,o,r,c,d,u,m,g;const p=imageMasks.find((e=>e.id===t.mask))||imageMasks[0];return e.jsx("div",{className:`absolute ${p.class}`,style:{left:`${t.position.x}px`,top:`${t.position.y}px`,width:"100%",height:"100%"},children:e.jsx("img",{src:t.content,alt:"",className:"w-full h-full object-cover",style:{filter:`\n              brightness(${((null==(a=t.filters)?void 0:a.brightness)||100)/100})\n              contrast(${((null==(l=t.filters)?void 0:l.contrast)||100)/100})\n              saturate(${((null==(n=t.filters)?void 0:n.saturation)||100)/100})\n              sepia(${((null==(s=t.filters)?void 0:s.tint)||0)/100})\n              hue-rotate(${3.6*((null==(i=t.filters)?void 0:i.hue)||0)}deg)\n              blur(${(null==(o=t.filters)?void 0:o.blur)||0}px)\n            `,transform:`scale(${(null==(r=t.filters)?void 0:r.scale)||1}) rotate(${(null==(c=t.filters)?void 0:c.rotate)||0}deg) ${(null==(d=t.filters)?void 0:d.flipHorizontal)?"scaleX(-1)":""} ${(null==(u=t.filters)?void 0:u.flipVertical)?"scaleY(-1)":""}`,mixBlendMode:(null==(m=t.filters)?void 0:m.blendMode)||"normal",opacity:((null==(g=t.filters)?void 0:g.opacity)||100)/100}})})}function ne({element:t}){var a,l,n,s,i,o,r,c,d,u,m,g;return e.jsx("div",{className:"absolute",style:{left:`${t.position.x}px`,top:`${t.position.y}px`,fontFamily:null==(a=t.style)?void 0:a.fontFamily,fontSize:null==(l=t.style)?void 0:l.fontSize,fontWeight:null==(n=t.style)?void 0:n.fontWeight,fontStyle:null==(s=t.style)?void 0:s.fontStyle,textDecoration:null==(i=t.style)?void 0:i.textDecoration,color:null==(o=t.style)?void 0:o.color,textAlign:null==(r=t.style)?void 0:r.textAlign,backgroundColor:(null==(c=t.style)?void 0:c.backgroundColor)||"transparent",padding:(null==(d=t.style)?void 0:d.padding)||"8px",borderRadius:(null==(u=t.style)?void 0:u.borderRadius)||"0px",border:(null==(m=t.style)?void 0:m.border)||"none",opacity:(null==(g=t.style)?void 0:g.opacity)||1},children:t.content})}function se({items:a}){const[l,n]=t.useState(null);return e.jsx("div",{onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),n({x:e.clientX,y:e.clientY})},children:l&&e.jsx("div",{className:"fixed bg-white shadow-lg rounded-md z-50 py-1 w-48",style:{left:`${l.x}px`,top:`${l.y}px`},onClick:e=>e.stopPropagation(),children:a.map(((t,a)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{t.action(),n(null)},children:[t.icon,t.label]},a)))})})}function ie({element:a,isSelected:l,onSelect:n,onUpdate:s,onDelete:i,availableMasks:o=[]}){var r,c,d,u,m,g,p,x,h,v,y,C;const[{isDragging:k},S]=b((()=>({type:"IMAGE_ELEMENT",item:{id:a.id},collect:e=>({isDragging:!!e.isDragging()})}))),E=t.useRef(null),[$,M]=t.useState(!1),[A,D]=t.useState({x:0,y:0}),P={filter:`\n      brightness(${((null==(r=a.filters)?void 0:r.brightness)||100)/100})\n      contrast(${((null==(c=a.filters)?void 0:c.contrast)||100)/100})\n      saturate(${((null==(d=a.filters)?void 0:d.saturation)||100)/100})\n      sepia(${((null==(u=a.filters)?void 0:u.tint)||0)/100})\n      hue-rotate(${3.6*((null==(m=a.filters)?void 0:m.hue)||0)}deg)\n      blur(${(null==(g=a.filters)?void 0:g.blur)||0}px)\n    `,transform:`scale(${(null==(p=a.filters)?void 0:p.scale)||1}) rotate(${(null==(x=a.filters)?void 0:x.rotate)||0}deg) ${(null==(h=a.filters)?void 0:h.flipHorizontal)?"scaleX(-1)":""} ${(null==(v=a.filters)?void 0:v.flipVertical)?"scaleY(-1)":""}`,mixBlendMode:(null==(y=a.filters)?void 0:y.blendMode)||"normal",opacity:((null==(C=a.filters)?void 0:C.opacity)||100)/100},z=_.find((e=>e.id===a.mask))||_[0],T=e=>{if($&&E.current){const t=E.current.parentElement.getBoundingClientRect(),a=e.clientX-A.x,l=e.clientY-A.y,n=t.width-E.current.offsetWidth,i=t.height-E.current.offsetHeight,o=Math.max(0,Math.min(a,n)),r=Math.max(0,Math.min(l,i));s({position:{x:o,y:r}})}},L=()=>{M(!1)};t.useEffect((()=>($&&(window.addEventListener("mousemove",T),window.addEventListener("mouseup",L)),()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",L)})),[$,A]);const F=t.useCallback((e=>{E.current=e,S(e)}),[S]),V=[{label:"Reemplazar imagen",icon:e.jsx(j,{className:"h-4 w-4"}),action:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const t=new FileReader;t.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&s({content:e.target.result})},t.readAsDataURL(e.target.files[0])}},e.click()}},{label:"Duplicar",icon:e.jsx(w,{className:"h-4 w-4"}),action:()=>{const e={...JSON.parse(JSON.stringify(a)),id:`img-${Date.now()}`,position:{x:a.position.x+20,y:a.position.y+20}};s(e,!0)}},{label:"Reducir opacidad",icon:e.jsx(N,{className:"h-4 w-4"}),action:()=>{var e;return s({filters:{...a.filters,opacity:Math.max(0,((null==(e=a.filters)?void 0:e.opacity)||100)-10)}})}},{label:"Eliminar",icon:e.jsx(R,{className:"h-4 w-4"}),action:i}];return e.jsxs("div",{ref:F,className:`absolute ${z.class} ${l?"ring-2 ring-purple-500":""} ${k?"opacity-50":"opacity-100"}`,style:{left:`${a.position.x}px`,top:`${a.position.y}px`,width:"100%",height:"100%",cursor:l?"move":"pointer"},onClick:e=>{e.stopPropagation(),n()},onMouseDown:e=>{l&&(e.stopPropagation(),M(!0),D({x:e.clientX-a.position.x,y:e.clientY-a.position.y}))},children:[e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:a.content,alt:"Imagen cargada",className:"w-full h-full object-cover",style:P})}),l&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:e=>{var t;e.stopPropagation(),s({filters:{...a.filters,rotate:((null==(t=a.filters)?void 0:t.rotate)||0)+90}})},children:e.jsx(f,{className:"h-4 w-4 text-gray-700"})}),e.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:e=>{e.stopPropagation(),i()},children:e.jsx(R,{className:"h-4 w-4 text-gray-700"})})]}),e.jsx(se,{items:V})]})}function oe({element:a,isSelected:l,onSelect:n,onUpdate:s,onDelete:o}){var r,c,d,u,m,g,p,x,h,f,v,y,j,C,k;const[S,E]=t.useState(!1),$=t.useRef(null),M=t.useRef(null),[{isDragging:A},D]=b((()=>({type:"TEXT_ELEMENT",item:{id:a.id},collect:e=>({isDragging:!!e.isDragging()})}))),[P,z]=t.useState(!1),[T,L]=t.useState({x:0,y:0}),F=e=>{if(P&&M.current){const t=M.current.parentElement.getBoundingClientRect(),a=e.clientX-T.x,l=e.clientY-T.y,n=t.width-M.current.offsetWidth,i=t.height-M.current.offsetHeight,o=Math.max(0,Math.min(a,n)),r=Math.max(0,Math.min(l,i));s({position:{x:o,y:r}})}},V=()=>{z(!1)};t.useEffect((()=>(P&&(window.addEventListener("mousemove",F),window.addEventListener("mouseup",V)),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",V)})),[P,T]);const I=t.useCallback((e=>{M.current=e,D(e)}),[D]),U=(null==(r=a.style)?void 0:r.textShadow)?`${a.style.textShadowX||0}px ${a.style.textShadowY||0}px ${a.style.textShadowBlur||0}px ${a.style.textShadowColor||"rgba(0,0,0,0.5)"}`:"none",O={...a.style,position:"absolute",left:`${a.position.x}px`,top:`${a.position.y}px`,cursor:l&&!S?"move":"pointer",textShadow:U,zIndex:10},B=[{label:"Editar texto",icon:e.jsx(i,{className:"h-4 w-4"}),action:()=>E(!0)},{label:"Duplicar",icon:e.jsx(w,{className:"h-4 w-4"}),action:()=>{const e={...JSON.parse(JSON.stringify(a)),id:`text-${Date.now()}`,position:{x:a.position.x+10,y:a.position.y+10}};s(e,!0)}},{label:"Reducir opacidad",icon:e.jsx(N,{className:"h-4 w-4"}),action:()=>{var e;return s({style:{...a.style,opacity:Math.max(0,((null==(e=a.style)?void 0:e.opacity)||1)-.1)}})}},{label:"Eliminar",icon:e.jsx(R,{className:"h-4 w-4"}),action:o}];return e.jsxs("div",{ref:I,className:`${l?"ring-2 ring-purple-500":""} ${A?"opacity-50":"opacity-100"}`,style:O,onClick:e=>{e.stopPropagation(),n()},onDoubleClick:()=>{E(!0),setTimeout((()=>{$.current&&($.current.focus(),$.current.select())}),0)},onMouseDown:e=>{l&&!S&&(e.stopPropagation(),z(!0),L({x:e.clientX-a.position.x,y:e.clientY-a.position.y}))},children:[S?e.jsx("input",{ref:$,type:"text",value:a.content,onChange:e=>{s({content:e.target.value})},onBlur:()=>{E(!1)},onKeyDown:e=>{"Enter"===e.key&&E(!1)},className:"w-full p-1 border border-gray-300 rounded bg-white",style:{fontFamily:null==(c=a.style)?void 0:c.fontFamily,fontSize:null==(d=a.style)?void 0:d.fontSize,fontWeight:null==(u=a.style)?void 0:u.fontWeight,fontStyle:null==(m=a.style)?void 0:m.fontStyle,textDecoration:null==(g=a.style)?void 0:g.textDecoration,color:null==(p=a.style)?void 0:p.color,textAlign:null==(x=a.style)?void 0:x.textAlign,minWidth:"100px"},autoFocus:!0}):e.jsx("div",{className:"p-2 rounded",style:{backgroundColor:(null==(h=a.style)?void 0:h.backgroundColor)||"transparent",padding:(null==(f=a.style)?void 0:f.padding)||"8px",borderRadius:(null==(v=a.style)?void 0:v.borderRadius)||"0px",border:(null==(y=a.style)?void 0:y.border)||"none"},children:a.content||"Editar texto"}),l&&e.jsxs("div",{className:"absolute top-0 right-0 transform translate-y-[-100%] flex gap-1 bg-white rounded-t-md p-1 shadow-sm",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{var t;e.stopPropagation(),s({style:{...a.style,fontWeight:"bold"===(null==(t=a.style)?void 0:t.fontWeight)?"normal":"bold"}})},children:e.jsx("span",{className:"text-xs "+("bold"===(null==(j=a.style)?void 0:j.fontWeight)?"font-bold":""),children:"B"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{var t;e.stopPropagation(),s({style:{...a.style,fontStyle:"italic"===(null==(t=a.style)?void 0:t.fontStyle)?"normal":"italic"}})},children:e.jsx("span",{className:"text-xs "+("italic"===(null==(C=a.style)?void 0:C.fontStyle)?"italic":""),children:"I"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{var t;e.stopPropagation(),s({style:{...a.style,textDecoration:"underline"===(null==(t=a.style)?void 0:t.textDecoration)?"none":"underline"}})},children:e.jsx("span",{className:"text-xs "+("underline"===(null==(k=a.style)?void 0:k.textDecoration)?"underline":""),children:"U"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:e=>{e.stopPropagation(),o()},children:e.jsx(R,{className:"h-3 w-3 text-gray-700"})})]}),e.jsx(se,{items:B})]})}function re({id:t,elements:a=[],selectedElement:l,onSelectElement:n,onAddElement:s,availableMasks:i=[]}){const[{isOver:o},r]=C((()=>({accept:["IMAGE_FILE","TEXT_ELEMENT","IMAGE_ELEMENT"],drop:e=>{if(e.files){const t=new FileReader;t.onload=e=>{var t;if(null==(t=e.target)?void 0:t.result){const t={id:`img-${Date.now()}`,type:"image",content:e.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};s(t)}},t.readAsDataURL(e.files[0])}},collect:e=>({isOver:!!e.isOver({shallow:!0})})})));return e.jsx("div",{ref:r,className:"relative aspect-square bg-gray-50 rounded-lg overflow-hidden "+(o?"ring-2 ring-purple-500 bg-purple-50":""),onClick:()=>n(null),children:0===a.length?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{if(e.target.files&&e.target.files[0]){const t=new FileReader;t.onload=e=>{var t;if(null==(t=e.target)?void 0:t.result){const t={id:`img-${Date.now()}`,type:"image",content:e.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};s(t)}},t.readAsDataURL(e.target.files[0])}},e.click()},children:[e.jsx(L,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Haz clic o arrastra una imagen"})]}):a.map((t=>e.jsx("div",{className:"absolute inset-0",children:"image"===t.type?e.jsx(ie,{element:t,isSelected:l===t.id,onSelect:()=>n(t.id),availableMasks:i}):e.jsx(oe,{element:t,isSelected:l===t.id,onSelect:()=>n(t.id)})},t.id)))})}function ce({page:t,layout:a,selectedElement:l,selectedCell:n,onSelectElement:s,onSelectCell:i,onAddElement:o,onUpdateElement:r,onDeleteElement:c,onUndo:d,onRedo:u,canUndo:m,canRedo:g,onAddImage:p,onAddText:x}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{onUndo:d,onRedo:u,onAddImage:p,onAddText:x,onDeleteElement:()=>{l&&n&&c(n,l)},canUndo:m,canRedo:g,hasSelectedElement:!!l}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden page-preview "+(a.cells<=4?"aspect-[4/3]":""),children:e.jsx("div",{className:`grid ${a.template} gap-4 h-full p-4`,children:t.cells.map((t=>e.jsx(re,{id:t.id,elements:t.elements,selectedElement:n===t.id?l:null,onSelectElement:e=>{s(e),i(t.id)},onAddElement:o,onUpdateElement:(e,a,l)=>{r(t.id,e,a,l)},onDeleteElement:e=>{c(t.id,e)},availableMasks:a.maskCategories.flatMap((e=>e.masks))},t.id)))})})]})}function de({currentPage:t,pages:a,selectedElement:l,selectedCell:n,onSelectElement:s,onSelectCell:i,onAddElement:o,onUpdateElement:r,onDeleteElement:c,getCurrentLayout:d,previewMode:u}){return e.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:u?e.jsx(ae,{page:a[t],layout:d()}):e.jsx(ce,{page:a[t],layout:d(),selectedElement:l,selectedCell:n,onSelectElement:s,onSelectCell:i,onAddElement:o,onUpdateElement:r,onDeleteElement:c})})})}function ue({pages:t,currentPage:a,onPageChange:l,onAddPage:n,onDuplicatePage:s,onDeletePage:i}){return e.jsx("aside",{className:"w-56 border-l bg-white p-4 overflow-y-auto shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium",children:"Páginas"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(O,{variant:"ghost",size:"icon-sm",onClick:s,children:e.jsx(w,{})}),e.jsx(O,{variant:"ghost",size:"icon-sm",onClick:i,disabled:t.length<=1,children:e.jsx(R,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid gap-3",children:[t.map(((t,n)=>e.jsx(me,{page:t,index:n,isActive:a===n,onClick:()=>l(n)},t.id))),e.jsx(O,{variant:"outline",size:"sm",icon:e.jsx(F,{className:"h-4 w-4"}),onClick:n,children:"Añadir página"})]})]})})}function me({page:t,index:a,isActive:l,onClick:n}){return e.jsx("div",{className:"border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors "+(l?"border-purple-500 ring-2 ring-purple-200":""),onClick:n,children:e.jsxs("div",{className:"bg-gray-100 aspect-[4/3] rounded-sm flex items-center justify-center text-xs text-gray-500 relative",children:["Pág. ",a+1,t.cells.some((e=>e.elements.some((e=>"image"===e.type&&e.content))))&&e.jsx("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1",children:Array.from({length:4}).map(((a,l)=>{const n=t.cells[l],s=null==n?void 0:n.elements.find((e=>"image"===e.type&&e.content));return e.jsx("div",{className:"bg-gray-200 rounded-sm overflow-hidden",children:s&&e.jsx("img",{src:s.content,alt:"",className:"w-full h-full object-cover"})},l)}))})]})})}var ge,pe=new Uint8Array(16);function xe(){if(!ge&&!(ge="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ge(pe)}const he=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var fe=[],ve=0;ve<256;++ve)fe.push((ve+256).toString(16).substr(1));function ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=(fe[e[t+0]]+fe[e[t+1]]+fe[e[t+2]]+fe[e[t+3]]+"-"+fe[e[t+4]]+fe[e[t+5]]+"-"+fe[e[t+6]]+fe[e[t+7]]+"-"+fe[e[t+8]]+fe[e[t+9]]+"-"+fe[e[t+10]]+fe[e[t+11]]+fe[e[t+12]]+fe[e[t+13]]+fe[e[t+14]]+fe[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&he.test(e)}(a))throw TypeError("Stringified UUID is invalid");return a}function be(e,t,a){var l=(e=e||{}).random||(e.rng||xe)();return l[6]=15&l[6]|64,l[8]=63&l[8]|128,ye(l)}function je(){const{pages:a,currentPageIndex:l,setCurrentPageIndex:n,addPage:s,duplicatePage:i,deletePage:o,changeLayout:r,currentPage:c,getCurrentLayout:d}=function(e=[]){const a=t.useCallback(((e=q[0].id)=>{const t=q.find((t=>t.id===e))||q[0];return{id:be(),layout:t.id,cells:Array.from({length:t.cells}).map((()=>({id:be(),elements:[]})))}}),[]),[l,n]=t.useState(e.length?e:[a()]),[s,i]=t.useState(0),o=t.useCallback((e=>{const t=a(e);return n((e=>[...e,t])),i((e=>e+1)),t}),[a]),r=t.useCallback((e=>{const t=l[e],a={...JSON.parse(JSON.stringify(t)),id:be(),cells:t.cells.map((e=>({...e,id:be(),elements:e.elements.map((e=>({...e,id:be()})))})))};return n((e=>[...e,a])),i(l.length),a}),[l]),c=t.useCallback((e=>{l.length<=1||(n((t=>t.filter(((t,a)=>a!==e)))),i((e=>Math.min(e,l.length-2))))}),[l.length]),d=t.useCallback(((e,t)=>{const a=q.find((e=>e.id===t));a&&n((l=>l.map(((l,n)=>n!==e?l:{...l,layout:t,cells:Array.from({length:a.cells}).map(((e,t)=>l.cells[t]||{id:be(),elements:[]}))}))))}),[]),u=t.useCallback((()=>q.find((e=>{var t;return e.id===(null==(t=l[s])?void 0:t.layout)}))||q[0]),[s,l]);return{pages:l,currentPageIndex:s,setCurrentPageIndex:i,addPage:o,duplicatePage:r,deletePage:c,changeLayout:d,currentPage:l[s],getCurrentLayout:u}}(),{elements:u,selectedElement:m,selectedCell:g,setSelectedElement:p,setSelectedCell:x,addElement:h,deleteElement:f}=function(e=[]){const[a,l]=t.useState(e),[n,s]=t.useState(null),[i,o]=t.useState(null),r=e=>({id:be(),type:"image",content:"",position:e,filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal",flipHorizontal:!1,flipVertical:!1},mask:"none"}),c=e=>({id:be(),type:"text",content:"Haz clic para editar",position:e,style:{fontSize:"16px",fontFamily:"Arial, sans-serif",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1,textShadow:"none",textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"rgba(0,0,0,0.5)"}});return{elements:a,selectedElement:n,selectedCell:i,setSelectedElement:s,setSelectedCell:o,addElement:(e,t={x:10,y:10})=>{const n="image"===e?r(t):c(t);return l([...a,n]),s(n.id),n},updateElement:(e,t)=>{l(a.map((a=>a.id===e?{...a,...t}:a)))},deleteElement:e=>{l(a.filter((t=>t.id!==e))),n===e&&s(null)},duplicateElement:e=>{const t=a.find((t=>t.id===e));if(!t)return;const n={...JSON.parse(JSON.stringify(t)),id:be(),position:{x:t.position.x+10,y:t.position.y+10}};return l([...a,n]),s(n.id),n}}}(),{addToHistory:v}=function(e){const[a,l]=t.useState([JSON.stringify(e)]),[n,s]=t.useState(0),i=n>0,o=n<a.length-1;return{currentState:JSON.parse(a[n]),addToHistory:e=>{const t=[...a.slice(0,n+1),JSON.stringify(e)];l(t),s(t.length-1)},undo:()=>n>0?(s(n-1),JSON.parse(a[n-1])):null,redo:()=>n<a.length-1?(s(n+1),JSON.parse(a[n+1])):null,canUndo:i,canRedo:o}}(a),[y,b]=t.useState(!1),[j,w]=t.useState("elements"),[N,C]=t.useState("basic"),M=t.useCallback((()=>{(async(e,t="diseño-pagina")=>{const a=document.getElementById(e);if(!a)return;const l=document.createElement("canvas"),n=a.offsetWidth,s=a.offsetHeight;l.width=2*n,l.height=2*s;const i=l.getContext("2d");i.scale(2,2),i.fillStyle="white",i.fillRect(0,0,n,s);try{(await k(a,{scale:2,backgroundColor:null,canvas:l,logging:!1,useCORS:!0})).toBlob((e=>{S.saveAs(e,`${t}.png`)}))}catch(o){}})("page-preview",`diseño-pagina-${l+1}`)}),[l]),A=t.useCallback((()=>{b((e=>!e))}),[]),D=t.useCallback(((e,t,n)=>{const s=a.map(((a,s)=>s!==l?a:{...a,cells:a.cells.map((a=>a.id!==e?a:{...a,elements:a.elements.map((e=>e.id!==t?e:{...e,...n}))}))}));setPages(s),v(s)}),[a,l,v]);return e.jsx(E,{backend:$,children:e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 mx-auto max-w-7xl",children:[e.jsx(B,{onExport:M,onPreviewToggle:A,previewMode:y}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(te,{activeTab:j,onTabChange:w,selectedLayout:c.layout,onLayoutChange:e=>{r(l,e),v(a)},onAddImage:e=>{const t=new FileReader;t.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&h("image",{content:e.target.result})},t.readAsDataURL(e)},onAddText:()=>{h("text")},selectedElement:m,onFilterChange:D,getSelectedElement:()=>u.find((e=>e.id===m)),getCurrentLayout:d}),e.jsx(de,{currentPage:l,pages:a,selectedElement:m,selectedCell:g,onSelectElement:p,onSelectCell:x,onAddElement:h,onUpdateElement:D,onDeleteElement:f,getCurrentLayout:d,previewMode:y}),e.jsx(ue,{pages:a,currentPage:l,onPageChange:n,onAddPage:()=>{s(),v(a)},onDuplicatePage:()=>{i(l),v(a)},onDeletePage:()=>{o(l),v(a)}})]})]})})}export{je as default};

import{r as e,j as t}from"./System-Bybt2Brn.js";import{M as n,u as s,P as o,a as r,b as i,L as c}from"./proxy-BmPRG09w.js";class u extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function l({children:s,isPresent:o}){const r=e.useId(),i=e.useRef(null),c=e.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=e.useContext(n);return e.useInsertionEffect((()=>{const{width:e,height:t,top:n,left:s}=c.current;if(o||!i.current||!e||!t)return;i.current.dataset.motionPopId=r;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${r}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${n}px !important;\n            left: ${s}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}}),[o]),t.jsx(u,{isPresent:o,childRef:i,sizeRef:c,children:e.cloneElement(s,{ref:i})})}const a=({children:n,initial:r,isPresent:i,onExitComplete:c,custom:u,presenceAffectsLayout:a,mode:d})=>{const f=s(p),h=e.useId(),m=e.useCallback((e=>{f.set(e,!0);for(const t of f.values())if(!t)return;c&&c()}),[f,c]),x=e.useMemo((()=>({id:h,initial:r,isPresent:i,custom:u,onExitComplete:m,register:e=>(f.set(e,!1),()=>f.delete(e))})),a?[Math.random(),m]:[i,m]);return e.useMemo((()=>{f.forEach(((e,t)=>f.set(t,!1)))}),[i]),e.useEffect((()=>{!i&&!f.size&&c&&c()}),[i]),"popLayout"===d&&(n=t.jsx(l,{isPresent:i,children:n})),t.jsx(o.Provider,{value:x,children:n})};function p(){return new Map}const d=e=>e.key||"";function f(t){const n=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&n.push(t)})),n}const h=({children:n,custom:o,initial:u=!0,onExitComplete:l,presenceAffectsLayout:p=!0,mode:h="sync",propagate:m=!1})=>{const[x,g]=r(m),E=e.useMemo((()=>f(n)),[n]),C=m&&!x?[]:E.map(d),P=e.useRef(!0),R=e.useRef(E),j=s((()=>new Map)),[y,v]=e.useState(E),[w,M]=e.useState(E);i((()=>{P.current=!1,R.current=E;for(let e=0;e<w.length;e++){const t=d(w[e]);C.includes(t)?j.delete(t):!0!==j.get(t)&&j.set(t,!1)}}),[w,C.length,C.join("-")]);const L=[];if(E!==y){let e=[...E];for(let t=0;t<w.length;t++){const n=w[t],s=d(n);C.includes(s)||(e.splice(t,0,n),L.push(n))}return"wait"===h&&L.length&&(e=L),M(f(e)),void v(E)}const{forceRender:$}=e.useContext(c);return t.jsx(t.Fragment,{children:w.map((e=>{const n=d(e),s=!(m&&!x)&&(E===w||C.includes(n));return t.jsx(a,{isPresent:s,initial:!(P.current&&!u)&&void 0,custom:s?void 0:o,presenceAffectsLayout:p,mode:h,onExitComplete:s?void 0:()=>{if(!j.has(n))return;j.set(n,!0);let e=!0;j.forEach((t=>{t||(e=!1)})),e&&(null==$||$(),M(R.current),m&&(null==g||g()),l&&l())},children:e},n)}))})};export{h as A};

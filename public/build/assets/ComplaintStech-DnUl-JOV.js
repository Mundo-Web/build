import{r as e,j as t,n as a,o as s,p as r}from"./vendor-react-DB2gWWlz.js";import"./GoogleSignInButton-Bo5d3xNo.js";import"./vendor-swiper-Cr_RrIb_.js";const n=e.forwardRef(({onVerify:n,error:o},l)=>{const[i,c]=e.useState(""),[d,u]=e.useState(""),[m,x]=e.useState(!1),[g,p]=e.useState(""),[h,f]=e.useState(!1),[y,j]=e.useState(""),[v,b]=e.useState(5),[w,N]=e.useState(Date.now()),k=e.useRef(!1),C=async()=>{f(!0),j(""),u(""),x(!1),b(5),n(!1,null);try{const e=await r.post("/api/captcha/generate"),{token:t,image:a}=e.data;p(t),c(a),N(Date.now())}catch(e){429===e.response?.status?j("Demasiados intentos. Por favor, espera un momento e intenta nuevamente."):j(e.response?.data?.error||"Error al cargar CAPTCHA. Intenta nuevamente.")}finally{f(!1)}};e.useImperativeHandle(l,()=>({reset:C})),e.useEffect(()=>{k.current||(k.current=!0,C())},[]);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark mb-2",children:"Verificación de seguridad"}),t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"relative min-w-[300px]",children:h&&!i?t.jsx("div",{className:"bg-gray-100 border-2 border-gray-300 rounded-lg px-6 py-4 h-[100px] flex items-center justify-center",children:t.jsx(a,{className:"w-8 h-8 animate-spin text-gray-400"})}):t.jsx("img",{src:i,alt:"CAPTCHA",className:"border-2 border-gray-300 rounded-lg select-none pointer-events-none",draggable:"false",onContextMenu:e=>e.preventDefault()})}),t.jsx("button",{type:"button",onClick:C,disabled:h,className:"flex items-center justify-center p-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",title:"Generar nuevo código",children:t.jsx(s,{className:"w-5 h-5 text-gray-600 group-hover:rotate-180 transition-transform duration-300 "+(h?"animate-spin":"")})})]}),t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"relative w-full",children:[t.jsx("input",{type:"text",value:d,onChange:async e=>{const t=e.target.value;if(u(t),j(""),6===t.length){f(!0);try{(await r.post("/api/captcha/verify",{token:g,answer:t})).data.success?(x(!0),n(!0,g)):(x(!1),n(!1,null))}catch(a){const e=a.response?.data;x(!1),n(!1,null),void 0!==e?.attempts_remaining&&b(e.attempts_remaining),j(e?.error||"Error al verificar CAPTCHA"),400===a.response?.status&&e?.error?.includes("expirado")&&setTimeout(()=>C(),2e3)}finally{f(!1)}}else x(!1),n(!1,null)},disabled:h,placeholder:"Ingresa el código de 6 caracteres",maxLength:6,className:"w-full px-4 py-3 border rounded-xl font-mono text-lg tracking-wider focus:ring-2 focus:outline-none transition-all duration-300 uppercase disabled:bg-gray-50 disabled:cursor-not-allowed "+(m?"border-primary customtext-primary":o||y?"border-red-500 bg-red-50 focus:ring-red-200":"border-gray-300 focus:ring-blue-200")}),t.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:h&&6===d.length?t.jsx(a,{className:"w-6 h-6 animate-spin text-gray-400"}):m?t.jsx("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}):null})]}),(o||y)&&t.jsxs("div",{className:"mt-2 space-y-1",children:[t.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),o||y]}),v<5&&v>0&&t.jsxs("p",{className:"text-orange-600 text-xs",children:["Intentos restantes: ",v]})]})]})]}),t.jsx("p",{className:"text-xs customtext-neutral-light",children:"Ingresa exactamente el código que aparece en la imagen. No distingue entre mayúsculas y minúsculas."})]})});export{n as C};

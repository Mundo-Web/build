import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as Te}from"./Base-BNMLY1YZ.js";import{S as _}from"./SwitchFormGroup-B-vmnVqk.js";import{T as _e}from"./TextareaFormGroup-CliirJM1.js";import{r as t}from"./index-BOnQTV8N.js";import{c as $e}from"./ReactAppend-DTVVXReZ.js";import{s as W}from"./server.browser-Bf4gQIc7.js";import{S as Ae}from"./ProductCard-Lp5WfZrB.js";import{I as he}from"./ItemsRest-C_YH-lNL.js";import{M as ae}from"./Modal-BYL-UsqM.js";import{T as Ee}from"./Table-D-Ew_tbt.js";import{I as X}from"./ImageFormGroup-Brimgjsn.js";import{I as w}from"./InputFormGroup-iZIO11ZN.js";import{Q as Pe}from"./QuillFormGroup-ShbNmC_h.js";import{S as me}from"./SelectAPIFormGroup-1XgklNMJ.js";import{S as H}from"./SelectFormGroup-D63EMIiA.js";import{D as ue}from"./DxButton-DV0H-ZcL.js";import{C as Ge,F as p}from"./CreateReactScript-Dt4tYlBy.js";import{N as pe}from"./Number2Currency-e57Tgsuk.js";import{R as I}from"./ReactAppend-D7S498fx.js";import{S as de}from"./SetSelectValue-UxyCmHse.js";import"./main-DKOTUah5.js";import{t as Be}from"./index-DRg3WPTA.js";import"./index-yBjzXJbu.js";import"./Global-DWbVqTT_.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-W0zm0J8x.js";import"./MenuItemContainer-CEON2wjZ.js";import"./index.esm-BNsoPXs8.js";import"./index-NIGUFBhG.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CanAccess-BY08P6cn.js";import"./BasicRest-BCYKfs4R.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const fe=({label:N,structure:x,value:y=[],onChange:j,typeOptions:F=[]})=>{const[d,h]=t.useState([]),f=typeof x=="object"&&!Array.isArray(x);t.useEffect(()=>{h(f?y.map(o=>{var a,m;return{...o,type:((a=o.type)==null?void 0:a.charAt(0).toUpperCase())+((m=o.type)==null?void 0:m.slice(1).toLowerCase())}}):y.map(o=>typeof o=="object"?o.feature||"":o))},[y]);const C=()=>{const o=f?{...x}:"",a=[...d,o];h(a),j(a)},b=o=>{const a=d.filter((m,c)=>c!==o);h(a),j(a)},v=(o,a,m)=>{const c=[...d];f?c[o][a]=a==="type"?m.charAt(0).toUpperCase()+m.slice(1).toLowerCase():m:c[o]=m,h(c),j(c)},S=(o,a)=>o==="title"&&a==="Icono"?"Url de icono":o;return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:N}),d.map((o,a)=>r.jsx("div",{className:"row g-2 mb-2",children:f?r.jsxs(r.Fragment,{children:[Object.keys(x).map(m=>r.jsx("div",{className:"col",children:m==="type"?r.jsxs("select",{className:"form-select",value:o[m]||"",onChange:c=>v(a,m,c.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),F.map(c=>r.jsx("option",{value:c,children:c},c))]}):r.jsx("input",{type:"text",className:"form-control",value:o[m]||"",onChange:c=>v(a,m,c.target.value),placeholder:S(m,o.type)})},m)),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>b(a),children:"X"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"col",children:r.jsx("input",{type:"text",className:"form-control",value:o,onChange:m=>v(a,null,m.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>b(a),children:"X"})})]})},a)),r.jsx("button",{type:"button",className:"btn btn-primary mt-2",onClick:C,children:"+ Agregar"})]})},Me=new he,Oe=({gridRef:N,modalRef:x})=>{const[y,j]=t.useState(null),[F,d]=t.useState(!1),[h,f]=t.useState(""),[C,b]=t.useState(!1),v=o=>{j(o.target.files[0])},S=async()=>{var a,m;if(!y){f("Por favor, selecciona un archivo."),b(!0);return}const o=new FormData;o.append("file",y),d(!0);try{const c=await Me.importData(o);if(console.log(c),c.error){const D=Array.isArray(c.error)?c.error.join(`
`):c.error;f(`Error en la importación:
${D}`),b(!0)}else f(c.message),b(!1),$(N.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),Be.success("Importacion completada con exito",{description:"Todos tus productos han sido importados correctamente.",duration:3e3,position:"bottom-center",richColors:!0})}catch(c){f("Error al importar: "+(((m=(a=c.response)==null?void 0:a.data)==null?void 0:m.error)||c.message)),b(!0)}d(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{className:"mb-1",children:r.jsx("a",{href:"/assets/img/salafabulosa/formato_import_products.xlsx",download:!0,children:"Descargar formato .xlsx"})}),r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:v})}),r.jsx("button",{onClick:S,disabled:F,className:"btn btn-primary mt-2",type:"button",children:F?"Subiendo...":"Subir Archivo"}),h&&r.jsx("div",{className:`alert ${C?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:h})})]})})},A=new he,qe=({categories:N,brands:x,collections:y})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[j,F]=t.useState([]),d=t.useRef(),h=t.useRef(),f=t.useRef(),C=t.useRef(),b=t.useRef(),v=t.useRef(),S=t.useRef(),o=t.useRef(),a=t.useRef(),m=t.useRef(),c=t.useRef(),D=t.useRef(),M=t.useRef(),O=t.useRef(),E=t.useRef(),P=t.useRef(),q=t.useRef(),L=t.useRef(),U=t.useRef(),K=t.useRef(),V=t.useRef(),z=t.useRef(),ge=t.useRef([]),xe=t.useRef([]),[be,Y]=t.useState(!1),[je,ve]=t.useState(null),[Le,ye]=t.useState(null),[Z,ee]=t.useState(""),[G,R]=t.useState([]),re=t.useRef(),Re=e=>{const l=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i)}));R(i=>[...i,...l])},we=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(i=>({file:i,url:URL.createObjectURL(i)}));R(i=>[...i,...l])},Ne=e=>{e.preventDefault()},Ce=(e,s)=>{e.preventDefault(),G[s].id?R(i=>i.map((n,g)=>g===s?{...n,toDelete:!0}:n)):R(i=>i.filter((n,g)=>g!==s))};t.useEffect(()=>{if(j&&j.images){const e=j.images.map(s=>({id:s.id,url:`/storage/images/item/${s.url}`}));R(e)}},[j]);const se=e=>{var s,l,i;if(F(e||null),e!=null&&e.id?Y(!0):Y(!1),ee(e!=null&&e.pdf?`/storage/images/item/${e.pdf}`:""),f.current.value=(e==null?void 0:e.id)||"",$(C.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(b.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),de(v.current,(s=e==null?void 0:e.subcategory)==null?void 0:s.id,(l=e==null?void 0:e.subcategory)==null?void 0:l.name),$(S.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),o.current.value=(e==null?void 0:e.name)||"",U.current.value=(e==null?void 0:e.sku)||"",a.current.value=(e==null?void 0:e.color)||"",m.current.value=(e==null?void 0:e.size)||"",c.current.value=(e==null?void 0:e.summary)||"",z.current.value=(e==null?void 0:e.linkvideo)||"",D.current.value=(e==null?void 0:e.price)||0,M.current.value=(e==null?void 0:e.discount)||0,de(O.current,(e==null?void 0:e.tags)??[],"id","name"),E.current.value=null,P.current.value=null,E.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,P.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,q.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,ee(e!=null&&e.pdf?`/storage/images/item/${e==null?void 0:e.pdf}`:""),L.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const n=e.images.map(g=>({id:g.id,url:`/storage/images/item/${g.url}`}));R(n)}else R([]);e!=null&&e.specifications?J(e.specifications.map(n=>({type:n.type,title:n.title,description:n.description,image:n.image||""}))):J([]),ie(((i=e==null?void 0:e.features)==null?void 0:i.map(n=>typeof n=="object"?n:{feature:n}))||[]),V.current.value=e==null?void 0:e.stock,$(h.current).modal("show")},Se=async e=>{e.preventDefault();const s=te.filter(u=>{var T;return typeof u=="string"?u.trim()!=="":typeof u=="object"?((T=u.feature)==null?void 0:T.trim())!=="":!1}),l=ne.filter(u=>u.title&&u.title.trim()!==""||u.description&&u.description.trim()!==""),i={id:f.current.value||void 0,category_id:C.current.value,collection_id:b.current.value||null,subcategory_id:v.current.value,brand_id:S.current.value,name:o.current.value,sku:U.current.value,color:a.current.value,size:m.current.value,summary:c.current.value,price:D.current.value,discount:M.current.value,tags:$(O.current).val(),description:L.current.value,stock:V.current.value||0,features:s,specifications:l,linkvideo:z.current.value},n=new FormData;for(const u in i)u==="features"||u==="specifications"?n.append(u,JSON.stringify(i[u])):n.append(u,i[u]);const g=P.current.files[0];g&&n.append("image",g);const k=q.current.files[0];k&&n.append("texture",k);const oe=E.current.files[0];oe&&n.append("banner",oe);const le=K.current.files[0];le&&n.append("pdf",le),G.forEach((u,T)=>{u.toDelete||(u.file?n.append(`gallery[${T}]`,u.file):n.append(`gallery_ids[${T}]`,u.id))});const ce=G.filter(u=>u.toDelete).map(u=>parseInt(u.id,10));ce.length>0&&n.append("deleted_images",JSON.stringify(ce)),console.log(n),await A.save(n)&&($(d.current).dxDataGrid("instance").refresh(),$(h.current).modal("hide"),R([]))},Fe=async({id:e,value:s})=>{await A.boolean({id:e,field:"visible",value:s})&&$(d.current).dxDataGrid("instance").refresh()},B=async({id:e,field:s,value:l})=>{await A.boolean({id:e,field:s,value:l})&&$(d.current).dxDataGrid("instance").refresh()},Ie=async e=>{const{isConfirmed:s}=await Ae.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await A.delete(e)||$(d.current).dxDataGrid("instance").refresh()},[te,ie]=t.useState([]),[ne,J]=t.useState([]),De=["Principal","General","Icono"],[Ue,Ve]=t.useState(!1),Q=t.useRef(),ke=()=>{$(Q.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Ee,{gridRef:d,title:"Items",rest:A,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>se()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>ke()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},p.has("items","category_id")&&{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:s})=>{var l,i,n;e.html(W.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(l=s.collection)==null?void 0:l.name}),r.jsx("b",{className:"d-block",children:(i=s.category)==null?void 0:i.name}),r.jsx("small",{className:"text-muted",children:(n=s.subcategory)==null?void 0:n.name})]})))}},p.has("items","subcategory_id")&&{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},p.has("items","brand_id")&&{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:s})=>{const i=((n,g)=>{if(!n)return"";const k=n.split(" ");return k.length>g?k.slice(0,g).join(" ")+"...":n})(s.summary,12);e.html(W.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:s.name}),r.jsx("br",{}),r.jsx("span",{children:i})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:s})=>{e.html(W.renderToString(r.jsxs(r.Fragment,{children:[s.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",pe(s.price)]}),r.jsxs("span",{children:["S/.",pe(s.discount>0?s.discount:s.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:s})=>{I(e,r.jsx("img",{src:`/storage/images/item/${s.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},p.has("items","is_new")&&{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const l=s.is_new===1||s.is_new==="1"||s.is_new===!0;I(e,r.jsx(_,{checked:l,onChange:i=>B({id:s.id,field:"is_new",value:i.target.checked?1:0})}))}},p.has("items","offering")&&{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const l=s.offering===1||s.offering==="1"||s.offering===!0;I(e,r.jsx(_,{checked:l,onChange:i=>B({id:s.id,field:"offering",value:i.target.checked?1:0})}))}},p.has("items","recommended")&&{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const l=s.recommended===1||s.recommended==="1"||s.recommended===!0;I(e,r.jsx(_,{checked:l,onChange:i=>B({id:s.id,field:"recommended",value:i.target.checked?1:0})}))}},p.has("items","featured")&&{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{const l=s.featured===1||s.featured==="1"||s.featured===!0;I(e,r.jsx(_,{checked:l,onChange:i=>B({id:s.id,field:"featured",value:i.target.checked?1:0})}))}},p.has("items","visible")&&{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{I(e,r.jsx(_,{checked:s.visible,onChange:l=>Fe({id:s.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(ue({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>se(s)})),e.append(ue({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Ie(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(ae,{modalRef:h,title:be?"Editar curso":"Agregar curso",onSubmit:Se,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:f,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(w,{eRef:U,label:"SKU",required:!0,hidden:!p.has("items","sku")}),r.jsx(H,{eRef:C,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>ve(e.target.value),hidden:!p.has("items","category_id"),children:N.map((e,s)=>r.jsx("option",{value:e.id,children:e.name},s))}),r.jsx(H,{eRef:b,label:"Colección",dropdownParent:"#principal-container",onChange:e=>ye(e.target.value),hidden:!p.has("items","collection_id"),children:y.map((e,s)=>r.jsx("option",{value:e.id,children:e.name},s))}),r.jsx(me,{eRef:v,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",je],dropdownParent:"#principal-container",hidden:!p.has("items","subcategory_id")}),r.jsx(H,{eRef:S,label:"Marca",dropdownParent:"#principal-container",hidden:!p.has("items","brand_id"),children:x.map((e,s)=>r.jsx("option",{value:e.id,children:e.name},s))}),r.jsx(w,{label:"Stock",eRef:V,type:"number",required:!0,hidden:!p.has("items","stock")}),r.jsx(w,{eRef:D,label:"Precio",type:"number",step:"0.01",required:!0,hidden:!p.has("items","price")}),r.jsx(w,{eRef:M,label:"Descuento",type:"number",step:"0.01"}),r.jsx(me,{id:"tags",eRef:O,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-5",children:[r.jsx(w,{eRef:o,label:"Nombre",required:!0,hidden:!p.has("items","name")}),r.jsx(w,{eRef:a,label:"Color",required:!0,hidden:!p.has("items","color")}),r.jsx(w,{eRef:m,label:"Talla",required:!0,hidden:!p.has("items","size")}),r.jsxs("div",{className:"col-12",hidden:!p.has("items","pdf"),children:[r.jsx("label",{className:"form-label",children:"Archivo PDF"}),r.jsx("input",{ref:K,type:"file",className:"form-control",accept:".pdf"}),r.jsx("small",{className:"text-muted",children:"Subir documento PDF relacionado al producto"})]}),Z&&r.jsx("div",{className:"my-2",children:r.jsxs("a",{href:Z,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline-primary",children:[r.jsx("i",{className:"fas fa-file-pdf me-1"})," Ver PDF actual"]})}),r.jsx(w,{eRef:z,label:"Link de video",hidden:!p.has("items","linkvideo")}),r.jsx(X,{eRef:q,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6",hidden:!p.has("items","texture")}),r.jsx(_e,{eRef:c,label:"Resumen",rows:3,hidden:!p.has("items","summary")}),r.jsx(fe,{ref:ge,label:"Características",structure:"",value:te,onChange:ie}),r.jsx(fe,{ref:xe,label:"Especificaciones",structure:{type:"",title:"",description:""},value:ne,onChange:J,typeOptions:De})]}),r.jsx("div",{className:"col-md-4",children:r.jsxs("div",{className:"row",children:[r.jsx(X,{eRef:E,label:"Banner",aspect:2/1,col:"col-12",hidden:!p.has("items","banner")}),r.jsx(X,{eRef:P,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6",hidden:!p.has("items","image")}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:re,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Re}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>re.current.click(),onDrop:we,onDragOver:Ne,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:G.map((e,s)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>Ce(l,s),children:"×"})]},s))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Pe,{eRef:L,label:"Descripcion"})]}),r.jsx(ae,{modalRef:Q,title:"Importar Datos",size:"sm",children:r.jsx(Oe,{gridRef:d,modalRef:Q})})]})};Ge((N,x)=>{$e.createRoot(N).render(r.jsx(Te,{...x,title:"Items",children:r.jsx(qe,{...x})}))});

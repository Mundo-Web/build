import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as l}from"./index-BOnQTV8N.js";import{c as Ce}from"./ReactAppend-QR5TrZfj.js";import{C as ke}from"./CreateReactScript-C-lKJ7Gs.js";import{i as I}from"./tippy-react.esm-DmkRJDEW.js";import{S as se}from"./SystemRest-DVRjGh0L.js";import{S as fe}from"./SwitchFormGroup-DXN0cwVk.js";import{G as Ne}from"./Global-Bz6gVLc5.js";import{S as xe}from"./SortByAfterField-2AndDudn.js";import{I as pe}from"./InputFormGroup-iZIO11ZN.js";import{T as we}from"./TextareaFormGroup-CliirJM1.js";import{M as ue}from"./Modal-xDw9ufjg.js";import{S as K}from"./SelectFormGroup-X8WqJHHl.js";import{S as be}from"./SetSelectValue-UxyCmHse.js";import{M as Se,a as me}from"./MenuItemContainer-DcxtOi47.js";import{C as Re,S as $e}from"./SettingsRest-B0EGzuRs.js";import{G as Ee}from"./GalleryRest-Crk-WQDr.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./main-B6F2O9-U.js";/* empty css               *//* empty css              */import"./General-CE1RDd44.js";import"./LaravelSession-Dz9cpV3l.js";import"./CanAccess-UkN68hbD.js";import"./BooleanLimit-D-OsQsek.js";import"./index-pSueRYGM.js";import"./BasicRest-BML1C-ua.js";import"./CardProductKatya-ncpmQ0JU.js";const re=(s="")=>{s=s.replace(/[^a-zA-Z0-9_{}]/g,"");const r=/{([^}]+)}/g,d=[];let b;for(;(b=r.exec(s))!==null;)d.push(b[1]);return d},Pe=(s,r)=>{const d=new RegExp(`[${r}]+$`,"g");return s.replace(d,"")},L=new se,Fe=s=>{const{id:r,name:d,path:b,extends_base:j=!1,menuable:u=!1,sitemapable:o=!1,setPages:c,onSEOClicked:i,onParamsClicked:a}=s,[n,m]=l.useState(!1),[x,g]=l.useState(!1),[R,y]=l.useState(!1),[f,p]=l.useState(!1),[S,D]=l.useState(!1),U=async C=>{if(d===C.target.value)return m(!1);L.savePage({id:r,name:C.target.value})&&(m(!1),c(P=>P.map(N=>N.id===r?{...N,name:C.target.value}:N)))},_=async C=>{if(b===C.target.value)return g(!1);const k=C.target.value;let P=structuredClone(k);const N=s.using??{};for(const h of re(k))P=P.replace(`{${h}}`,"").replace(`{${h}?}`,""),N[h]=N[h]??{model:null};const E=Pe(P,"/");L.savePage({id:r,path:k,pseudo_path:E,using:Object.keys(N).length>0?N:void 0})&&(g(!1),c(h=>h.map(F=>F.id===r?{...F,path:C.target.value}:F)))},J=async C=>{y(!0);const k=C.target.checked,P=L.savePage({id:r,extends_base:k});y(!1),P&&c(N=>N.map(E=>E.id===r?{...E,extends_base:k}:E))},G=async C=>{p(!0);const k=C.target.checked,P=L.savePage({id:r,menuable:k});p(!1),P&&c(N=>N.map(E=>E.id===r?{...E,menuable:k}:E))},O=async C=>{D(!0);const k=C.target.checked,P=L.savePage({id:r,sitemapable:k});D(!1),P&&c(N=>N.map(E=>E.id===r?{...E,sitemapable:k}:E))},Q=async C=>{await L.deletePage(C.id)&&(c(P=>P.filter(N=>N.id!=C.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))},X=re(b);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>i(s),children:[e.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),X.length>0&&e.jsxs("button",{className:"dropdown-item",onClick:()=>a(s),children:[e.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item",onClick:()=>Q(s),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),e.jsxs("div",{children:[n?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:d,onBlur:U,autoFocus:!0}):e.jsx(I,{content:"Editar nombre",placement:"left",children:e.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>m(!0),style:{minWidth:"200px",cursor:"pointer"},children:d||"Sin nombre"})}),x?e.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:b,style:{minHeight:27,fieldSizing:"content"},onBlur:_,autoFocus:!0}):e.jsx(I,{content:"Editar ruta",placement:"left",children:e.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>g(!0),style:{minWidth:"200px",cursor:"pointer"},children:b||"Sin ruta"})})]}),e.jsxs("div",{className:"row",children:[e.jsx(fe,{label:"Extiende de base",col:"col-lg-6 col-md-12 col-sm-6",checked:j,onChange:J,disabled:R}),e.jsx(fe,{label:"Mostrar en menu",col:"col-lg-6 col-md-12 col-sm-6",checked:u,onChange:G,disabled:f}),e.jsx(fe,{label:"Incluir en sitemap",col:"col-lg-6 col-md-12 col-sm-6",checked:o,onChange:O,disabled:S})]})]})},Me=new se,Be=[{value:"always",label:"Siempre"},{value:"hourly",label:"Cada hora"},{value:"daily",label:"Diario"},{value:"weekly",label:"Semanal"},{value:"monthly",label:"Mensual"},{value:"yearly",label:"Anual"},{value:"never",label:"Nunca"}],De=({dataLoaded:s,setDataLoaded:r,modalRef:d})=>{const b=l.useRef(null),j=l.useRef(null),u=l.useRef(null),o=l.useRef(null),c=l.useRef(null),i=async a=>{a.preventDefault(),await Me.savePage({id:s.id,description:j.current.value,keywords:$(u.current).val(),sitemap_priority:parseFloat(o.current.value)||.8,sitemap_frequency:$(c.current).val()||"weekly"})&&(r(null),$(d.current).modal("hide"))};return l.useEffect(()=>{b.current.value=`${s==null?void 0:s.name} | ${Ne.APP_NAME}`,j.current.value=(s==null?void 0:s.description)??"",be(u.current,(s==null?void 0:s.keywords)??[]),o.current.value=(s==null?void 0:s.sitemap_priority)??.8,be(c.current,(s==null?void 0:s.sitemap_frequency)??"weekly")},[s]),e.jsx(ue,{modalRef:d,title:`Editar SEO - ${s==null?void 0:s.name}`,size:"md",onSubmit:i,children:e.jsxs("div",{id:"seo-container",children:[e.jsx(pe,{eRef:b,label:"Título",disabled:!0}),e.jsx(we,{eRef:j,label:"Descripción",rows:2}),e.jsx(K,{eRef:u,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"}),e.jsx("hr",{className:"my-3"}),e.jsxs("h6",{className:"text-muted mb-3",children:[e.jsx("i",{className:"fas fa-sitemap me-1"}),"Configuración del Sitemap"]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-6",children:e.jsx(pe,{eRef:o,label:"Prioridad (0.0 - 1.0)",type:"number",step:"0.1",min:"0",max:"1"})}),e.jsx("div",{className:"col-6",children:e.jsx(K,{eRef:c,label:"Frecuencia de cambio",dropdownParent:"#seo-container",children:Be.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})})]})]})})},ge=({className:s,system:r,component:d,onComponentClicked:b,onDeleteClicked:j,onEditDataClicked:u})=>{var i;const o=(d==null?void 0:d.options)??[],c=o.find(a=>a.id==r.value);return e.jsxs("div",{className:`dropdown ${s}`,"data-id":r.id,children:[e.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${r.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[e.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),e.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"})]}),e.jsx("span",{className:"ms-1",children:r.name})]}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${r.id}`,"data-popper-placement":"bottom-start","data-simplebar":!0,style:{maxHeight:"300px",width:"100%"},children:[o.length>1&&e.jsxs(e.Fragment,{children:[o.filter(a=>a.id!=r.value).map((a,n)=>e.jsxs("button",{className:"dropdown-item",onClick:()=>b({...r,name:`${d.name} - ${a.name}`,value:a.id}),children:[d.name," - ",a.name]},n)),e.jsx("div",{className:"dropdown-divider"})]}),(((i=c==null?void 0:c.using)==null?void 0:i.filters)||(c==null?void 0:c.data))&&e.jsxs("button",{className:"dropdown-item",onClick:()=>u(r,c),children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>j(r),children:[e.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},Ie=({col:s,label:r,eRef:d,placeholder:b,required:j=!1,rows:u=3,value:o,onChange:c=()=>{}})=>{const[i,a]=l.useState(o),n=l.useRef(),m=l.useRef(null),x=d||n;return l.useEffect(()=>(m.current&&(m.current.toTextArea(),m.current=null),m.current=CodeMirror.fromTextArea(x.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2}),m.current.setValue(o),setTimeout(()=>{m.current.refresh()},125),m.current.on("change",g=>{const R=g.getValue();a(R),c({target:{value:R}})}),()=>{m.current&&(m.current.toTextArea(),m.current=null)}),[x]),l.useEffect(()=>{i!==o&&(a(o),m.current&&(m.current.setValue(o),setTimeout(()=>{m.current.refresh()},125)))},[o]),e.jsxs("div",{className:`form-group ${s} mb-2`,children:[e.jsxs("label",{htmlFor:"",className:"mb-1",children:[r," ",j&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:x,className:"form-control",placeholder:b,required:j,rows:u,defaultValue:o,onChange:g=>a(g.target.value)})]})},je=new se,_e=({dataLoaded:s,setDataLoaded:r,setSystems:d,modalRef:b})=>{var m,x,g,R,y,f,p,S,D,U,_,J,G,O,Q,X,C,k,P,N,E,Z;const[j,u]=l.useState((s==null?void 0:s.data)||{}),[o,c]=l.useState([]),i={};i.model=l.useRef(null),i.filters=l.useRef(null),i.filtersMethod=l.useRef(null);const a=async h=>{var z,H;h.preventDefault();const F={...(s==null?void 0:s.data)||{},...j},M=await je.save({id:s.id,data:F,filters:$(i.filters.current).val(),filters_method:(H=(z=s==null?void 0:s.component)==null?void 0:z.using)==null?void 0:H["filters:method"],filters_method_values:$(i.filtersMethod.current).val()});M&&(r(null),$(b.current).modal("hide"),d(q=>q.map(W=>W.id==s.id?M:W)))};l.useEffect(()=>{var H,q,W,le,te,ie,ae,ce,t,w;const F={...(s==null?void 0:s.data)||{}};(q=(H=s==null?void 0:s.component)==null?void 0:H.data)!=null&&q.forEach&&((le=(W=s==null?void 0:s.component)==null?void 0:W.data)==null||le.forEach(v=>{v in F||(F[v]="")})),u(F),i.model.current.value=((ie=(te=s==null?void 0:s.component)==null?void 0:te.using)==null?void 0:ie.model)??"",$(i.filters.current).val((s==null?void 0:s.filters)??[]).trigger("change"),$(i.filtersMethod.current).val((s==null?void 0:s.filtersMethod)??[]).trigger("change");const M=(ce=(ae=s==null?void 0:s.component)==null?void 0:ae.using)==null?void 0:ce.model,z=(w=(t=s==null?void 0:s.component)==null?void 0:t.using)==null?void 0:w["filters:method"];!M||!z||je.simpleGet(`/api/admin/system/related/${M}/${z}`).then(v=>{c(v)})},[s]);const n=(h,F)=>{u({...j,[h]:F})};return e.jsxs(ue,{modalRef:b,title:s==null?void 0:s.name,onSubmit:a,size:(x=(m=s==null?void 0:s.component)==null?void 0:m.data)!=null&&x.some(h=>h.startsWith("code:"))?"lg":"md",children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[e.jsx("li",{className:"nav-item",hidden:!((R=(g=s==null?void 0:s.component)==null?void 0:g.data)!=null&&R.length),children:e.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"Información"})}),e.jsx("li",{className:"nav-item",hidden:!((f=(y=s==null?void 0:s.component)==null?void 0:y.using)!=null&&f.filters)&&!((S=(p=s==null?void 0:s.component)==null?void 0:p.using)!=null&&S["filters:method"]),children:e.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),e.jsxs("div",{className:"tab-content",id:"data-modal-container",children:[e.jsx("div",{className:"tab-pane active",id:"tab-info",hidden:!((U=(D=s==null?void 0:s.component)==null?void 0:D.data)!=null&&U.length),children:(J=(_=s==null?void 0:s.component)==null?void 0:_.data)==null?void 0:J.map((h,F)=>h.startsWith("code:")?e.jsx(Ie,{label:h.replace("code:",""),value:j[h]??"",rows:1,onChange:M=>u({...j,[h]:M.target.value})},F):e.jsx(e.Fragment,{children:h.startsWith("bool:")?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:h.replace("bool:","")}),e.jsxs("div",{children:[e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:`${h}-true`,name:h,value:"true",checked:j[h]===!0,onChange:M=>n(h,M.target.value==="true")}),e.jsx("label",{className:"form-check-label",htmlFor:`${h}-true`,children:"Sí"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:`${h}-false`,name:h,value:"false",checked:j[h]===!1,onChange:M=>n(h,M.target.value==="true")}),e.jsx("label",{className:"form-check-label",htmlFor:`${h}-false`,children:"No"})]})]})]}):e.jsx(we,{label:h,value:j[h]??"",rows:1,onChange:M=>u({...j,[h]:M.target.value})},F)}))}),e.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[e.jsx(pe,{eRef:i.model,label:"Modelo",disabled:!0}),e.jsx(K,{eRef:i.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!((O=(G=s==null?void 0:s.component)==null?void 0:G.using)!=null&&O.filters),children:(C=(X=(Q=s==null?void 0:s.component)==null?void 0:Q.using)==null?void 0:X.filters)==null?void 0:C.map((h,F)=>e.jsx("option",{value:h,children:h},F))}),e.jsx("div",{hidden:!((P=(k=s==null?void 0:s.component)==null?void 0:k.using)!=null&&P["filters:method"]),children:e.jsx(K,{eRef:i.filtersMethod,label:(Z=(E=(N=s==null?void 0:s.component)==null?void 0:N.using)==null?void 0:E["filters:method"])==null?void 0:Z.toTitleCase(),multiple:!0,dropdownParent:"#tab-db",changeWith:[o],children:o==null?void 0:o.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))})})]})]})]})},ve=new se,Ae=({components:s,onClick:r})=>{const[d,b]=l.useState(""),j=s.filter(u=>u.options.length>0).filter(u=>{if(!d)return!0;const o=d.toLowerCase();return u.name.toLowerCase().includes(o)||u.options.some(c=>c.name.toLowerCase().includes(o))});return e.jsx("div",{className:"left-side-menu top-0 pt-2",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsx("div",{id:"sidebar-menu",className:"show",children:e.jsxs("ul",{id:"side-menu",children:[e.jsx("li",{className:"menu-title",children:"Lista de componentes"}),e.jsx("li",{className:"px-3 py-2",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar componentes...",value:d,onChange:u=>b(u.target.value),style:{backgroundColor:"#ffffff",color:"#8391a2",paddingLeft:"35px"}}),e.jsx("i",{className:"mdi mdi-magnify position-absolute",style:{left:"10px",top:"50%",transform:"translateY(-50%)",color:"#8391a2",fontSize:"16px"}})]})}),j.map((u,o)=>e.jsx(Se,{title:u.name,icon:u.icon,children:u.options.map((c,i)=>e.jsx(me,{name:c.name,icon:c.icon,onClick:()=>{const a=$(".tab-pane:visible .components-container > div").last().data("id");r({name:`${u.name} - ${c.name}`,component:u.id,value:c.id,after_component:a})},children:c.name},i))},o)),j.length===0&&d&&e.jsx("li",{className:"px-3 py-2",children:e.jsx("small",{className:"text-muted",children:"No se encontraron componentes"})}),"          ",e.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),e.jsx(me,{icon:"mdi mdi-cogs",rightBarToggle:!0,children:"Configuraciones"}),e.jsx(me,{icon:"mdi mdi-cloud-download",onClick:async()=>{const u=await ve.exportBK(),o=new Blob([JSON.stringify(u)],{type:"application/json"}),c=URL.createObjectURL(o),i=document.createElement("a");i.href=c,i.download="backup.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c)},children:"Exportar Backup"}),e.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async u=>{const o=u.target.files[0];if(u.target.value=null,o){const c=new FormData;if(c.append("backup",o),!await ve.importBK(c))return;location.reload()}}}),e.jsx(me,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),e.jsx("div",{className:"clearfix"})]})})},ze=({page:s,param:r,models:d,setUsing:b,setPages:j})=>{var g,R,y;const u=l.useRef(),o=l.useRef(),c=l.useRef(),i=s==null?void 0:s.using,[a,n]=l.useState(null),m=f=>{const p=u.current.value,S=d.find(D=>D.name==p)??null;n(S)};l.useEffect(()=>{var f;$(u.current).val((f=i==null?void 0:i[r])==null?void 0:f.model).trigger("change")},[r]),l.useEffect(()=>{var f,p;b(S=>({...S,[r]:{...S[r],model:(a==null?void 0:a.name)??null}})),$(o.current).val(((f=i==null?void 0:i[r])==null?void 0:f.field)??null).trigger("change"),$(c.current).val(((p=i==null?void 0:i[r])==null?void 0:p.relations)??[]).trigger("change")},[a]);const x=`${r}-container`;return e.jsxs("div",{id:x,className:"row",children:[e.jsxs("label",{className:"form-label",children:["Parámetro ",e.jsx("code",{children:r})]}),e.jsx(K,{eRef:u,label:"Modelo",col:"col-md-6",dropdownParent:`#${x}`,onChange:m,children:d.map((f,p)=>e.jsx("option",{value:f.name,children:f.name},p))}),e.jsx(K,{eRef:o,label:"Campo",col:"col-md-6",dropdownParent:`#${x}`,onChange:f=>{b(p=>({...p,[r]:{...p[r],field:f.target.value}}))},children:(g=a==null?void 0:a.fields)==null?void 0:g.map((f,p)=>e.jsx("option",{children:f},p))}),e.jsx("div",{hidden:(((R=a==null?void 0:a.relations)==null?void 0:R.length)??0)==0,children:e.jsx(K,{eRef:c,label:"Relaciones",multiple:!0,dropdownParent:`#${x}`,onChange:f=>{const p=$(f.target).val();b(S=>({...S,[r]:{...S[r],relations:p}}))},children:(y=a==null?void 0:a.relations)==null?void 0:y.map((f,p)=>e.jsx("option",{children:f},p))})})]})},Ve=new se,Te=({dataLoaded:s,setDataLoaded:r,setPages:d,modalRef:b,models:j})=>{const u=re((s==null?void 0:s.path)??""),[o,c]=l.useState({}),i=async a=>{a.preventDefault();const n=await Ve.savePage({id:s.id,using:o});n&&(r(null),d(n),$(b.current).modal("hide"))};return l.useEffect(()=>{c((s==null?void 0:s.using)??{})},[s]),e.jsx(ue,{modalRef:b,title:`Editar parámetros de URL - ${s==null?void 0:s.name}`,onSubmit:i,onClose:()=>r(null),children:u.map((a,n)=>e.jsx(ze,{page:s,param:a,models:j,using:o,setUsing:c,setPages:d},n))})},Ue=new Ee,Ge=new Re,Oe=new $e,He=({colors:s,setColors:r,settings:d,setSettings:b})=>{const[j,u]=l.useState([{uuid:crypto.randomUUID(),col:"col-3",name:"Icon (1:1)",src:"icon.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-5",name:"Logo (13:4)",src:"logo.png",width:"100%",aspectRatio:3.25},{uuid:crypto.randomUUID(),col:"col-4",name:"Logo footer (1:1)",src:"logo-footer.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-12",name:"Loading (13:4)",src:"loading.png",width:"100%",aspectRatio:3.25}]),o=async n=>{var y;const m=((y=n.target.files)==null?void 0:y[0])??null;if(!m)return;n.target.value=null;const x=n.target.name,g=new FormData;g.append("image",m),g.append("name",x),await Ue.save(g)&&u(f=>f.map(p=>(p.src==x&&(p.uuid=crypto.randomUUID()),p)))},c=async n=>{const m=n.target.getAttribute("data-color-id"),x=n.target.name,g=n.target.value;if(s.find(f=>f.id==m)[x]===g)return;const y=await Ge.save({id:m,[x]:g});y&&r(f=>f.map(p=>p.id==m?y.data:p))},i=async n=>{var f;const m=n.target.getAttribute("data-id"),x=n.target.name;let g=n.target.value;if(n.target.type=="checkbox"&&(g=n.target.checked?"true":"false"),(((f=d.find(p=>p.name==x))==null?void 0:f.description)??"")===g)return;const y=await Oe.save({name:x,value:g});y&&b(p=>p.map(S=>S.id==m?y.data:S))},a=n=>{const m=d.find(x=>x.name==n);return m?m.value:""};return e.jsx("div",{className:"right-bar",children:e.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[e.jsxs("div",{className:"rightbar-title",children:[e.jsx("a",{href:"#",className:"right-bar-toggle float-end",children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h4",{className:"font-16 m-0 text-white",children:"Configuraciones"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("h5",{children:"Imágenes principales"}),e.jsx("div",{className:"row",children:j.map((n,m)=>{const x="file-"+n.uuid;return e.jsxs("div",{className:n.col,children:[e.jsx("input",{id:x,name:n.src,type:"file",accept:"image/png",hidden:!0,onChange:o}),e.jsx("label",{htmlFor:x,className:"form-label d-block mb-1",style:{cursor:"pointer"},children:n.name}),e.jsx("label",{htmlFor:x,style:{cursor:"pointer"},className:"w-100",children:e.jsx("img",{className:"border",src:`/assets/resources/${n.src}?v=${n.uuid}`,alt:"",style:{height:n.height,width:n.width,objectFit:"contain",objectPosition:"center",backgroundColor:"#f5f5f5",borderRadius:"4px",aspectRatio:n.aspectRatio}})})]},m)})}),e.jsx("hr",{className:"my-2"}),e.jsx("h5",{children:"Fuentes del sistema"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Titulos"}),e.jsx(I,{content:"Nombre de la fuente",children:e.jsx("input",{type:"text",className:"form-control form-control-sm mb-1",name:"title-font-name",defaultValue:a("title-font-name"),onBlur:i})}),e.jsx(I,{content:"Enlace de la fuente",children:e.jsx("textarea",{className:"form-control form-control-sm",rows:1,name:"title-font-url",defaultValue:a("title-font-url"),onBlur:i,style:{minHeight:27,fieldSizing:"content"}})}),e.jsx(I,{content:"Marcar si el archivo es un archivo de fuente (otf, woff, woff2, etc)",children:e.jsxs("div",{className:"form-check mt-1",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",name:"title-font-source",id:"title-font-source",defaultChecked:a("title-font-source")=="true",onBlur:i}),e.jsx("label",{className:"form-check-label",htmlFor:"title-font-source",children:"¿Es este un archivo de fuente?"})]})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Parrafos"}),e.jsx(I,{content:"Nombre de la fuente",children:e.jsx("input",{type:"text",className:"form-control form-control-sm mb-1",name:"paragraph-font-name",defaultValue:a("paragraph-font-name"),onBlur:i})}),e.jsx(I,{content:"Enlace de la fuente",children:e.jsx("textarea",{className:"form-control form-control-sm",rows:1,name:"paragraph-font-url",defaultValue:a("paragraph-font-url"),onBlur:i,style:{minHeight:27,fieldSizing:"content"}})}),e.jsx(I,{content:"Marcar si el archivo es un archivo de fuente (otf, woff, woff2, etc)",children:e.jsxs("div",{className:"form-check mt-1",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",name:"paragraph-font-source",id:"paragraph-font-source",defaultChecked:a("paragraph-font-source")=="true",onBlur:i}),e.jsx("label",{className:"form-check-label",htmlFor:"paragraph-font-source",children:"¿Es este un archivo de fuente?"})]})})]}),e.jsx("hr",{className:"my-2"}),e.jsx("h5",{children:"Colores del sistema"}),e.jsx("div",{className:"d-flex flex-column gap-1",children:s.map((n,m)=>{var y,f,p;const x=((y=n.description)==null?void 0:y.startsWith("linear-gradient"))||((f=n.description)==null?void 0:f.startsWith("radial-gradient")),g=n.name=="menu-admin",R=((p=s.find(S=>S.name=="primary"))==null?void 0:p.description)||"#6658dd";return e.jsxs("div",{children:[e.jsxs("div",{className:"input-group input-group-sm",children:[!x&&e.jsx("span",{className:"input-group-text px-1",children:e.jsx("input",{type:"color",name:"description","data-color-id":n.id,className:"p-0",style:{width:"20px",height:"20px",border:"1px solid #ced4da",borderRadius:"4px",cursor:"pointer"},defaultValue:n.description||R,onBlur:c})}),e.jsx("input",{type:"text",name:"name","data-color-id":n.id,className:"form-control form-control-sm",placeholder:"Color",defaultValue:n.name,onBlur:c,disabled:n.name=="primary"||g,style:{cursor:n.name=="primary"||g?"not-allowed":"text"}})]}),x?e.jsx("textarea",{name:"description","data-color-id":n.id,className:"form-control form-control-sm mt-1",placeholder:"Gradiente: linear-gradient(...)",defaultValue:n.description||"",onBlur:c,rows:2,style:{fontSize:"11px",minHeight:27,fieldSizing:"content"}}):e.jsx("input",{type:"text",name:"description","data-color-id":n.id,className:"form-control form-control-sm mt-1",placeholder:g?"Color del menú admin (por defecto: primary)":"Hex color",defaultValue:n.description||(g?R:""),onBlur:c,style:{fontSize:"11px"}})]},m)})})]})]})})},ee=new se,We=({systems:s=[],pages:r=[],colors:d=[],components:b,models:j,settings:u=[]})=>{const o=l.useRef(null),c=l.useRef(null),i=l.useRef(null),a=l.useRef(null),[n,m]=l.useState(s),[x,g]=l.useState(r),[R,y]=l.useState(d),[f,p]=l.useState(u),[S,D]=l.useState(!1),[U,_]=l.useState(null),[J,G]=l.useState(null),[O,Q]=l.useState(!1),[X,C]=l.useState(!1),[k,P]=l.useState(null),[N,E]=l.useState(!1),[Z,h]=l.useState(0),F=async()=>{D(!0);const t=await ee.savePage();t&&(D(!1),g(t))},M=async t=>{const v=$(".tab-pane:visible").data("id")??null;t.page_id=v;const B=await ee.save(t);if(!B)return;const V=B;m(T=>T.some(A=>A.id===V.id)?T.map(A=>A.id===V.id?V:A):[...T,V])},z=async t=>{await ee.delete(t.id)&&m(v=>v.filter(B=>B.id!=t.id))},H=async()=>{E(!0);const t=await ee.fetchRemoteChanges();E(!1),t&&location.reload()},q=t=>{const w=$(t.target).data("page-id"),v=$(t.target).data("page-path"),B=$(t.target).val();$(`#iframe-${w}`).removeAttr("src"),$(`#iframe-${w}`).attr("src",`${v}/${B}`)},W=async t=>{_(t),$(o.current).modal("show")},le=async t=>{_(t),$(c.current).modal("show")},te=async(t,w)=>{G({...t,component:w}),$(a.current).modal("show")};l.useEffect(()=>{let t=null;const w=async()=>{if(N)return;if(O){clearInterval(t);return}const v=await ee.hasRemoteChanges();if(!v){Q(!0);return}C(v.has_changes),P(v.last_commit),h(v.commits)};return t=setInterval(async()=>{await w()},1e4),()=>clearInterval(t)},[O,N]),l.useEffect(()=>{const t=$("iframe:visible");t&&($(t).removeAttr("src"),$(t).attr("src",t.data("path")))},[n,R,f]),l.useEffect(()=>{[...$(".components-container")].forEach(w=>{try{$(w).hasClass("ui-sortable")&&$(w).sortable("destroy")}catch{}$(w).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(v,B){const V=[...$(w).children()],T={};if(V.forEach(oe=>{const A=$(oe).data("id"),Y=$(oe).prev().data("id")??null,ne=n.find(he=>he.id==A);(ne==null?void 0:ne.after_component)!==Y&&(T[A]=Y)}),Object.keys(T).length>0){if(!await ee.updateOrder(T))return;m(A=>{const Y=[...A];return Object.entries(T).forEach(([ne,he])=>{const de=Y.findIndex(ye=>ye.id==ne);de!==-1&&(Y[de]={...Y[de],after_component:he})}),Y})}}}).disableSelection()})},[x,n]),l.useEffect(()=>{document.title=`Sistema | ${Ne.APP_NAME}`},[]);const[ie,ae,ce]=(k==null?void 0:k.split(`
`))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"wrapper position-relative",children:[e.jsx(Ae,{components:b,onClick:M}),e.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:e.jsx("div",{className:"content mt-2",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card mb-0",children:e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[e.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),x.map((t,w)=>e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#page-${t.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[t.name,e.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:t.path})]})},w)),e.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:e.jsx(I,{content:"Agregar página",children:e.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:F,disabled:S,children:S?e.jsx("i",{className:"mdi mdi-loading mdi-spin"}):e.jsx("i",{className:"mdi mdi-plus"})})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"base-template",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":null,children:xe(n).filter(t=>t.page_id==null).map(t=>{const w=b.find(v=>v.id==t.component);if(w==null||w.options,t.component=="content")return e.jsxs("button",{"data-id":t.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("i",{className:"fa fa-ellipsis-v"}),e.jsx("span",{className:"ms-1",children:t.name})]},t.id);{const v=b.find(B=>B.id==t.component);return e.jsx(ge,{className:"",system:t,component:v,onComponentClicked:M,onDeleteClicked:z,onEditDataClicked:te},t.id)}})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 200px)",borderRadius:"4px"}})})]})}),x.map((t,w)=>e.jsx("div",{className:"tab-pane",id:`page-${t.id}`,"data-id":t.id,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(Fe,{...t,models:j,setPages:g,onSEOClicked:W,onParamsClicked:le}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":t.id,children:xe(n).filter(v=>v.page_id==t.id).map(v=>{const B=b.find(V=>V.id==v.component);return e.jsx(ge,{className:"",system:v,component:B,onComponentClicked:M,onDeleteClicked:z,onEditDataClicked:te},v.id)})})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"input-group mb-2",children:[e.jsxs("span",{className:"input-group-text",children:[(t==null?void 0:t.pseudo_path)||t.path,re(t==null?void 0:t.path).length>0&&"/"]}),re(t==null?void 0:t.path).length>0&&e.jsx("input",{type:"text",className:"form-control",placeholder:"Parametros","data-page-path":t.pseudo_path,"data-page-id":t.id,onChange:q})]}),e.jsx("iframe",{id:`iframe-${t.id}`,src:(t==null?void 0:t.pseudo_path)||t.path,"data-path":(t==null?void 0:t.pseudo_path)||t.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 302px)",borderRadius:"4px"}})]})]})},w))]})]})})})})]})})}),X&&e.jsx(I,{content:`Tienes ${Z} cambios sin sincronizar`,children:e.jsxs("button",{className:"btn btn-dark p-0 position-absolute rounded-pill",style:{right:"20px",bottom:"20px",height:"40px",width:"40px"},onClick:()=>$(i.current).modal("show"),children:[e.jsx("small",{className:"position-absolute",style:{backgroundColor:"#ff5b5b",borderRadius:"50%",width:"18px",height:"18px",top:"-5px",left:"-5px"},children:Z}),e.jsx("i",{className:"mdi mdi-github mdi-24px"})]})})]}),e.jsx(ue,{modalRef:i,title:"Cambios de Github",size:"sm",hideFooter:!0,children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"mdi mdi-github mdi-48px"}),e.jsx("h5",{className:"mt-2",children:"Tienes cambios sin sincronizar"}),e.jsxs("div",{className:"mb-2 py-2",children:[e.jsx("b",{className:"d-block",children:ie}),e.jsx("small",{className:"d-block text-muted",children:moment(ae).fromNow()}),e.jsxs("span",{className:"d-block",children:["Commit: ",ce]})]}),e.jsx("button",{className:"btn btn-primary mb-2",type:"button",onClick:()=>H(),disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Sincronizando"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-cloud-download me-1"}),"Sincronizar"]})})]})}),e.jsx(He,{colors:R,setColors:y,settings:f,setSettings:p}),e.jsx(De,{dataLoaded:U,setDataLoaded:_,modalRef:o}),e.jsx(Te,{dataLoaded:U,setDataLoaded:_,setPages:g,modalRef:c,models:j}),e.jsx(_e,{dataLoaded:J,setDataLoaded:G,setSystems:m,modalRef:a})]})};ke((s,r)=>{Ce.createRoot(s).render(e.jsx(We,{...r}))});

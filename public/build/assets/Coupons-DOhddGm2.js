import{m as e,c as t,j as r,r as a,s}from"./vendor-react-SBvaUJTK.js";import{B as i}from"./Base-BQaY-qII.js";import{S as n}from"./SwitchFormGroup-DGsB37aq.js";import{T as o}from"./TextareaFormGroup-B0EP8gtW.js";import{S as c}from"./CartKuchara-8a8jAeu-.js";import{B as l}from"./BasicRest-Cgj77E-j.js";import{t as d}from"./OpenPayCardModal-C0HhlOHJ.js";import{M as u}from"./Modal-ClgvT3ku.js";import{T as m}from"./Table-Bf8C5yZH.js";import{I as p}from"./InputFormGroup-DuKrUAYJ.js";import{S as h}from"./SelectFormGroup-DX2Z_QEH.js";import{D as x}from"./DxButton-C6FT_beP.js";import{C as f}from"./CreateReactScript-BZ6xEkMS.js";import{C as g,N as j}from"./Number2Currency-BX4epFEo.js";import{R as b}from"./ReactAppend-Ix4YwdVY.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-BligNWSa.js";import"./TippyButton-C4KoE0lc.js";import"./Logout-BgttE_VN.js";import"./MenuItemContainer-CwLbZhxp.js";import"./Menu-CqnWUuE2.js";import"./BooleanLimit-q2Ad9fGY.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";const v=new class extends l{constructor(){super(),this.path="admin/coupons"}async validate(t,r={}){try{const{status:a,result:s}=await e.Fetch(`/api/${this.path}/validate`,{method:"POST",body:JSON.stringify({code:t,cart_total:r.total||0,category_ids:r.category_ids||[],product_ids:r.product_ids||[]}),headers:{"Content-Type":"application/json"}});return s.valid?(d.success("¡Excelente!",{description:s.message,duration:3e3,position:"bottom-center",richColors:!0}),s):(d.error("¡Error!",{description:s.message,duration:3e3,position:"bottom-center",richColors:!0}),null)}catch(a){return d.error("¡Error!",{description:a.message||"Error al validar el cupón",duration:3e3,position:"bottom-center",richColors:!0}),null}}async generateCode(){try{const{status:t,result:r}=await e.Fetch(`/api/${this.path}/generate-code`);return t?r.data?.code||r.code:null}catch(t){return d.error("¡Error!",{description:"Error al generar código",duration:3e3,position:"bottom-center",richColors:!0}),null}}},y=({categories:e,products:t})=>{const[i,l]=a.useState(!1),d=a.useRef(),f=a.useRef(),y=a.useRef(),_=a.useRef(),w=a.useRef(),N=a.useRef(),R=a.useRef(),C=a.useRef(),T=a.useRef(),S=a.useRef(),F=a.useRef(),E=a.useRef(),k=a.useRef(),D=a.useRef(),M=a.useRef(),[B,G]=a.useState(!1),q=e=>{l(!!e?.id),$(f.current).modal("show"),setTimeout(()=>{y.current&&(y.current.value=e?.id??""),_.current&&(_.current.value=e?.code??""),w.current&&(w.current.value=e?.name??""),N.current&&(N.current.value=e?.description??""),C.current&&(C.current.value=e?.value??""),T.current&&(T.current.value=e?.minimum_amount??""),S.current&&(S.current.value=e?.usage_limit??""),F.current&&(F.current.value=e?.usage_limit_per_user??1),D.current&&(D.current.value=e?.maximum_discount??""),E.current&&(E.current.value=e?.starts_at?O(new Date(e.starts_at)):""),k.current&&(k.current.value=e?.expires_at?O(new Date(e.expires_at)):""),M.current&&(M.current.checked=e?.first_purchase_only??!1);const t=e?.type||"percentage";R.current&&($(R.current).val(t).trigger("change"),G("percentage"===t))},100)},O=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;return r.jsxs(r.Fragment,{children:[r.jsx(m,{gridRef:d,title:"Cupones",rest:v,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar cupón",onClick:()=>q()}})},exportable:!0,exportableName:"Cupones",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Código",width:"120px",cellTemplate:(e,{data:t})=>{var a;e.html(s.renderToString(r.jsxs("div",{children:[r.jsx("strong",{className:"font-monospace",children:t.code}),r.jsx("br",{}),r.jsx("span",{className:`badge ${a=t.status,{active:"badge-success",expired:"badge-danger",pending:"badge-warning",exhausted:"badge-secondary",inactive:"badge-dark"}[a]||"badge-secondary"} badge-sm`,children:t.status_text})]})))}},{dataField:"name",caption:"Nombre",minWidth:"200px",cellTemplate:(e,{data:t})=>{e.html(s.renderToString(r.jsxs("div",{children:[r.jsx("strong",{children:t.name}),t.description&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),r.jsx("small",{className:"text-muted",children:t.description.length>50?t.description.substring(0,50)+"...":t.description})]})]})))}},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:t})=>{const a="percentage"===t.type?"Porcentaje":"Monto Fijo",i="percentage"===t.type?"badge-info":"badge-primary";e.html(s.renderToString(r.jsx("span",{className:`badge ${i}`,children:a})))}},{dataField:"value",caption:"Valor",width:"100px",cellTemplate:(e,{data:t})=>{const a="percentage"===t.type?`${t.value}%`:`${g()} ${j(t.value)}`;e.html(s.renderToString(r.jsx("strong",{children:a})))}},{dataField:"minimum_amount",caption:"Mín. Compra",width:"110px",cellTemplate:(e,{data:t})=>{e.html(s.renderToString(r.jsxs("span",{children:[g()," ",j(t.minimum_amount)]})))}},{dataField:"usage_limit",caption:"Usos",width:"80px",cellTemplate:(e,{data:t})=>{const a=t.usage_limit?`${t.used_count}/${t.usage_limit}`:`${t.used_count}/∞`;e.html(s.renderToString(r.jsx("span",{children:a})))}},{dataField:"starts_at",caption:"Inicio",dataType:"datetime",width:"110px",format:"dd/MM/yyyy"},{dataField:"expires_at",caption:"Expiración",dataType:"datetime",width:"110px",format:"dd/MM/yyyy"},{dataField:"active",caption:"Activo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{b(e,r.jsx(n,{checked:t.active,onChange:e=>(async({id:e,value:t})=>{await v.boolean({id:e,field:"active",value:t})&&$(d.current).dxDataGrid("instance").refresh()})({id:t.id,value:e.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(x({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>q(t)})),e.append(x({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async e=>{const{isConfirmed:t}=await c.fire({title:"Eliminar cupón",text:"¿Estás seguro de eliminar este cupón?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!t)return;await v.delete(e)&&$(d.current).dxDataGrid("instance").refresh()})(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(u,{modalRef:f,title:i?"Editar cupón":"Agregar cupón",onSubmit:async e=>{e.preventDefault();const t={id:y.current.value||void 0,code:_.current.value,name:w.current.value,description:N.current.value,type:R.current.value,value:C.current.value,minimum_amount:T.current.value||0,usage_limit:S.current.value||null,usage_limit_per_user:F.current.value,starts_at:E.current.value,expires_at:k.current.value,maximum_discount:D.current.value||null,first_purchase_only:M.current.checked?1:0};await v.save(t)&&($(d.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},size:"xl",children:r.jsxs("div",{className:"row",id:"coupons-form",children:[r.jsx("input",{ref:y,type:"hidden"}),r.jsxs("div",{className:"col-md-6",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-8",children:r.jsx(p,{eRef:_,label:"Código del cupón",required:!0,placeholder:"Ej: DESCUENTO20"})}),r.jsxs("div",{className:"col-md-4",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary d-block",onClick:async()=>{const e=await v.generateCode();e&&_.current&&(_.current.value=e)},children:"Generar"})]})]}),r.jsx(p,{eRef:w,label:"Nombre",required:!0,placeholder:"Nombre descriptivo del cupón"}),r.jsx(o,{eRef:N,label:"Descripción",rows:3,placeholder:"Descripción del cupón"}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsxs(h,{eRef:R,label:"Tipo de descuento",required:!0,onChange:e=>{G("percentage"===e.target.value)},dropdownParent:"#coupons-form",children:[r.jsx("option",{value:"percentage",children:"Porcentaje"}),r.jsx("option",{value:"fixed",children:"Monto fijo"})]})}),r.jsx("div",{className:"col-md-6",children:r.jsx(p,{eRef:C,label:"Valor",type:"number",step:"0.01",min:"0",required:!0,placeholder:"Ej: 20 o 50.00"})})]}),r.jsx(p,{eRef:D,label:`Descuento máximo (${g()})`,type:"number",step:"0.01",min:"0",placeholder:"Opcional - límite máximo de descuento"}),r.jsx(p,{eRef:T,label:`Monto mínimo de compra (${g()})`,type:"number",step:"0.01",min:"0",placeholder:"0.00"})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(p,{eRef:S,label:"Límite de usos",type:"number",min:"1",placeholder:"Dejar vacío para ilimitado"})}),r.jsx("div",{className:"col-md-6",children:r.jsx(p,{eRef:F,label:"Usos por usuario",type:"number",min:"1",defaultValue:"1",required:!0})})]}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(p,{eRef:E,label:"Fecha de inicio",type:"datetime-local",required:!0})}),r.jsx("div",{className:"col-md-6",children:r.jsx(p,{eRef:k,label:"Fecha de expiración",type:"datetime-local",required:!0})})]}),r.jsxs("div",{className:"form-check mb-3",children:[r.jsx("input",{ref:M,className:"form-check-input",type:"checkbox",id:"firstPurchaseOnly"}),r.jsx("label",{className:"form-check-label",htmlFor:"firstPurchaseOnly",children:"Solo primera compra"})]})]})]})})]})};f((e,a)=>{t.createRoot(e).render(r.jsx(i,{...a,title:"Cupones",children:r.jsx(y,{...a})}))});

var e=Object.defineProperty,a=(a,t,i)=>((a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i)(a,"symbol"!=typeof t?t+"":t,i);import{c as t,j as i,r as s}from"./vendor-react-CtPXetfm.js";import{C as r,F as o}from"./CreateReactScript-Cjoo020C.js";import{B as n}from"./Base-B2hVq4yw.js";import{T as l}from"./Table-BOsx9621.js";import{M as c}from"./Modal-CUkY7A3F.js";import{D as d}from"./DxButton-C6FT_beP.js";import{S as p}from"./SwitchFormGroup-CB0qoXn0.js";import{R as m}from"./ReactAppend-RIOEhuYO.js";import{S as u}from"./CartKuchara-Bi-J8T1O.js";import{B as f}from"./BasicRest-DtgqEuc9.js";import{I as b}from"./InputFormGroup-CRGKsLQr.js";import{T as j}from"./TextareaFormGroup-DXMahSF1.js";import{P as h}from"./ProvidersRest-DOYu8UfI.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-coriRrmf.js";import"./TippyButton-Dqi9Vaf_.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./Menu-BjIZNCK0.js";import"./BooleanLimit-q2Ad9fGY.js";import"./Logout-DQyEsGXW.js";import"./MenuItemContainer-UDNHvqM7.js";import"./OpenPayCardModal-CbSnHq7o.js";const v=new class extends f{constructor(){super(...arguments),a(this,"path","admin/job-applications"),a(this,"hasFiles",!0)}},x=new h,w=()=>{const e=s.useRef(),a=s.useRef(),t=s.useRef(),r=s.useRef(),n=s.useRef(),f=s.useRef(),h=s.useRef(),w=s.useRef(),y=s.useRef(),g=s.useRef(),[C,N]=s.useState(!1),[R,F]=s.useState(null),[T,D]=s.useState(!1),S=(e,i=!1)=>{D(i),N(!!e?.id),t.current.value=e?.id??"",r.current.value=e?.name??"",n.current.value=e?.email??"",f.current.value=e?.phone??"",h.current&&o.has("job_applications","position")&&(h.current.value=e?.position??""),w.current.value=e?.message??"",y.current.value=e?.type??"job",g.current&&o.has("job_applications","cv")&&(g.current.value=null),F(e?.cv??null),$(a.current).modal("show")},B=e=>{e&&window.open(`/api/job-applications/media/${e}`,"_blank")};return i.jsxs(i.Fragment,{children:[i.jsx(l,{gridRef:e,title:"Solicitudes de Trabajo",rest:v,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar solicitud",hint:"Agregar solicitud",onClick:()=>S()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"20%"},{dataField:"email",caption:"Email",width:"18%"},{dataField:"phone",caption:"Teléfono",width:"12%"},o.has("job_applications","position")&&{dataField:"position",caption:"Posición / Empresa",width:"15%"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:a})=>{const t="provider"===a.type;e.append(`<span class="badge ${t?"bg-primary":"bg-info"}">${t?"Proveedor":"Trabajo"}</span>`)}},{dataField:"message",caption:"Mensaje",width:"20%",cellTemplate:(e,{data:a})=>{const t=a.message||"",i=t.length>50?t.substring(0,50)+"...":t;e.text(i),t.length>50&&e.attr("title",t)}},{dataField:"cv",caption:"CV",width:"80px",allowFiltering:!1,cellTemplate:(e,{data:a})=>{a.cv?e.append(d({className:"btn btn-xs btn-soft-info",title:"Descargar CV",icon:"fa fa-download",onClick:()=>B(a.cv)})):e.text("Sin CV")}},{dataField:"reviewed",caption:"Revisado",dataType:"boolean",width:"100px",cellTemplate:(a,{data:t})=>{$(a).empty(),m(a,i.jsx(p,{checked:1==t.reviewed,onChange:()=>(async({id:a,value:t})=>{await v.boolean({id:a,field:"reviewed",value:t})&&$(e.current).dxDataGrid("instance").refresh()})({id:t.id,value:!t.reviewed})}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",width:"120px",format:"dd/MM/yyyy"},{caption:"Acciones",width:"10%",cellTemplate:(a,{data:t})=>{a.css("text-overflow","unset"),a.append(d({className:"btn btn-xs btn-soft-info",title:"Ver detalles",icon:"fa fa-eye",onClick:()=>S(t,!0)})),"provider"===t.type&&a.append(d({className:"btn btn-xs btn-soft-primary",title:"Invitar como proveedor",icon:"fa fa-user-plus",onClick:()=>(async e=>{const{isConfirmed:a}=await u.fire({title:"¿Invitar como proveedor?",text:`Se enviará una invitación a ${e.email}`,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, enviar invitación"});if(!a)return;if(!e.id)return void u.fire("Error","No se pudo obtener el ID de la solicitud.","error");await x.invite({email:e.email,job_application_id:e.id})&&u.fire("¡Enviado!","La invitación ha sido enviada.","success")})(t)})),a.append(d({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async a=>{const{isConfirmed:t}=await u.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminarlo",cancelButtonText:"Cancelar"});if(!t)return;await v.delete(a.id)&&$(e.current).dxDataGrid("instance").refresh()})(t)}))},allowFiltering:!1,allowExporting:!1}]}),i.jsxs(c,{modalRef:a,title:T?"Ver solicitud":C?"Editar solicitud":"Agregar solicitud",onSubmit:async i=>{i.preventDefault();const s={id:t.current.value||void 0,name:r.current.value,email:n.current.value,phone:f.current.value,message:w.current.value,type:y.current.value};h.current&&o.has("job_applications","position")&&(s.position=h.current.value);const l=new FormData;for(const e in s)void 0!==s[e]&&null!==s[e]&&l.append(e,s[e]);if(g.current&&o.has("job_applications","cv")){const e=g.current.files[0];e&&l.append("cv",e)}await v.save(l)&&($(e.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},hideFooter:T,children:[i.jsx("input",{ref:t,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(b,{eRef:r,label:"Nombre completo",required:!0,disabled:T})}),i.jsx("div",{className:"col-md-6",children:i.jsx(b,{eRef:n,label:"Email",type:"email",required:!0,disabled:T})}),i.jsx("div",{className:"col-md-6",children:i.jsx(b,{eRef:f,label:"Teléfono",type:"tel",disabled:T})}),o.has("job_applications","position")&&i.jsx("div",{className:"col-md-6",children:i.jsx(b,{eRef:h,label:"Posición / Empresa",disabled:T})}),i.jsx("div",{className:"col-md-6",children:i.jsx(b,{eRef:y,label:"Tipo de Solicitud",disabled:!0})}),i.jsx("div",{className:"col-md-12",children:i.jsx(j,{eRef:w,label:"Mensaje",rows:3,disabled:T})}),!T&&o.has("job_applications","cv")&&i.jsx("div",{className:"col-md-12",children:i.jsxs("div",{className:"mb-3",children:[i.jsxs("label",{className:"form-label",children:["CV (PDF, DOC, DOCX)",R&&i.jsxs("span",{className:"text-muted ms-2",children:["(Actual: ",R,")"]})]}),i.jsx("input",{ref:g,type:"file",className:"form-control",accept:".pdf,.doc,.docx"})]})}),T&&R&&o.has("job_applications","cv")&&i.jsx("div",{className:"col-md-12",children:i.jsxs("div",{className:"mb-3",children:[i.jsxs("label",{className:"form-label d-flex justify-content-between align-items-center",children:[i.jsx("span",{children:"Curriculum Vitae"}),i.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>B(R),children:[i.jsx("i",{className:"fa fa-download me-2"}),"Descargar CV"]})]}),i.jsx("div",{className:"border rounded",style:{height:"600px"},children:i.jsx("iframe",{src:`/api/job-applications/media/${R}`,className:"w-100 h-100",style:{border:"none"},title:"Vista previa del CV"})})]})}),T&&i.jsx("div",{className:"col-md-12 text-end",children:i.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>$(a.current).modal("hide"),children:"Cerrar"})})]})]})]})};r((e,a)=>{t.createRoot(e).render(i.jsx(n,{...a,title:"Solicitudes de Trabajo",children:i.jsx(w,{...a})}))});

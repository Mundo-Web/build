import{r as e,j as i,i as a,m as s,c as t}from"./vendor-react-CZUvQwNQ.js";/* empty css                   */import{S as r}from"./CartKuchara-C7vqSevl.js";import{G as o}from"./Footer-DAm0kDL9.js";import{M as n}from"./Modal-MmI0jF6v.js";import{I as l}from"./InputFormGroup-BuXn3s3l.js";import{R as c}from"./RepositoryRest-ClsTcz1z.js";import{C as d}from"./CreateReactScript-CQzKJRc_.js";import{B as m}from"./Base-DiYyKRe5.js";import"./vendor-swiper-Cr_RrIb_.js";import"./BasicRest-BMJgRso_.js";import"./OpenPayCardModal-BHkRoVZ6.js";import"./BooleanLimit-q2Ad9fGY.js";import"./TippyButton-Gia9IjJq.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./Menu-EkCXeLHq.js";import"./Logout-D6byb_Ua.js";import"./MenuItemContainer-BaCqn8PU.js";const p=new c,u=e=>{if(0===e)return"0 Bytes";const i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(2))+" "+["Bytes","KB","MB","GB"][i]},f=({files:t,height:c="calc(100vh - 240px)",selectable:d,multiple:m=!0,selectedFiles:f=[],setSelectedFiles:x=()=>{}})=>{const h=e.useRef(),j=e.useRef(),g=e.useRef(),v=e.useRef(),b=e.useRef(),[y,N]=e.useState(!1),[w,C]=e.useState(!1),[R,k]=e.useState(t||[]),B=e=>{e.preventDefault(),e.stopPropagation(),N(!0)},M=async e=>{C(!0);for(const a of e){if(a.size>104857600){s.Notify.add({title:"Error",type:"danger",body:`El archivo ${a.name} excede el límite de 40MB`,icon:"/assets/img/icon.svg"});continue}const e=new FormData;e.append("name",a.name),e.append("file",a);try{const i=await p.save(e),t=i;i&&(k(e=>[...e,t]),s.Notify.add({title:"Operación correcta",body:`Archivo ${a.name} subido correctamente`,icon:"/assets/img/icon.svg"}))}catch(i){s.Notify.add({title:"Error",type:"danger",body:`Error al subir ${a.name}`,icon:"/assets/img/icon.svg"})}}C(!1)},S=({name:e,file:i,relative:a=!1})=>{const t=a?`/repository/${i}`:`${o.APP_URL}/cloud/${i}`;s.Clipboard.copy(t,()=>{s.Notify.add({title:"Enlace copiado",body:`${a?"La ruta":"El enlace"} al archivo ${e} ha sido copiado al portapapeles`,icon:"/assets/img/icon.svg"})})};e.useEffect(()=>{0==R.length&&(async()=>{const e=await p.paginate({isLoadingAll:!0});e&&k(e.data)})()},[]);return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:""+(y?"dragging":""),onDragEnter:B,onDragOver:B,onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),N(!1)},onDrop:async e=>{e.preventDefault(),e.stopPropagation(),N(!1);const i=Array.from(e.dataTransfer.files);M(i)},children:[i.jsxs("div",{className:"mb-2",children:[i.jsx("input",{type:"file",ref:j,className:"d-none",multiple:!0,onChange:e=>{const i=Array.from(e.target.files);M(i),j.current.value=null}}),i.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>j.current.click(),disabled:w,type:"button",children:w?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Subiendo..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"mdi mdi-upload me-1"}),"Subir archivos"]})})]}),i.jsx("div",{className:"repository-dropzone",style:{height:c,userSelect:"none"},children:y?i.jsxs("div",{className:"drop-overlay",children:[i.jsx("i",{className:"mdi mdi-cloud-upload mdi-48px mb-2"}),i.jsx("h4",{children:"Suelta los archivos aquí"})]}):R.length>0?i.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-2",children:R.map((e,s)=>{const t=f.find(i=>i.id===e.id);return i.jsxs("div",{className:"card my-0",style:{width:"140px",height:"max-content",boxShadow:"5px 5px 10px rgba(0, 0, 0, 0.2)"},children:[i.jsxs("label",{href:`${o.APP_URL}/cloud/${e.file}`,className:"rounded position-relative w-100 bg-dark d-flex align-items-center justify-content-center text-white cursor-pointer",style:{aspectRatio:5/3},onClick:()=>{if(!d){const i=document.createElement("a");i.href=`${o.APP_URL}/cloud/${e.file}`,i.target="_blank",i.click(),i.remove()}},children:[d&&i.jsx("input",{name:"input-file-selectable",type:m?"checkbox":"radio",className:"position-absolute form-check-input m-0",style:{top:"6px",left:"6px"},checked:!!t,onChange:i=>((e,i)=>{const a=e.target.checked;if(!m)return x([i]);x(a?e=>[...e,i]:e=>e.filter(e=>e.id!==i.id))})(i,e)}),e.file_mimetype.startsWith("image/")&&"image/svg+xml"!==e.file_mimetype?i.jsx("img",{className:"rounded img-fluid w-100 h-100",src:`/cloud/${e.file}`,alt:e.name,style:{objectFit:"cover",objectPosition:"center",aspectRatio:5/3}}):i.jsx("i",{className:`mdi ${n=e.file_mimetype,n.startsWith("image/")?"mdi-image":n.startsWith("video/")?"mdi-video":n.startsWith("audio/")?"mdi-music":n.includes("pdf")?"mdi-file-pdf":n.includes("word")?"mdi-file-word":n.includes("sheet")?"mdi-file-excel":"mdi-file"} mdi-36px`})]}),i.jsxs("div",{className:"card-body p-1",children:[i.jsx("small",{className:"d-block text-truncate w-100 my-0",title:e.name,children:i.jsx("b",{children:e.name})}),i.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center",children:[i.jsx("small",{className:"card-text",children:u(e.file_size)}),!d&&i.jsxs("div",{className:"d-flex gap-1",children:[i.jsxs("div",{className:"dropdown d-inline",children:[i.jsx(a,{content:"Copiar enlace",children:i.jsx("i",{className:"mdi mdi-link cursor-pointer","data-bs-toggle":"dropdown"})}),i.jsxs("ul",{className:"dropdown-menu",children:[i.jsx("li",{children:i.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>S(e),children:[i.jsx("i",{className:"mdi mdi-link-variant me-1"}),"Copiar enlace"]})}),i.jsx("li",{children:i.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>S({...e,relative:!0}),children:[i.jsx("i",{className:"mdi mdi-folder-outline me-1"}),"Copiar ruta relativa"]})})]})]}),i.jsx(a,{content:"Cambiar nombre",children:i.jsx("i",{className:"mdi mdi-pencil cursor-pointer",onClick:()=>(e=>{g.current.value=e.id,b.current.value=e.name,v.current.value=e.name,$(h.current).modal("show")})(e)})}),i.jsx(a,{content:"Eliminar",children:i.jsx("i",{className:"mdi mdi-delete cursor-pointer text-danger",onClick:()=>(async e=>{const{isConfirmed:i}=await r.fire({title:"¿Estás seguro?",text:"¿Estás seguro de que deseas eliminar este archivo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!i)return;await p.delete(e)&&k(i=>i.filter(i=>i.id!==e))})(e.id)})})]})]})]})]},s);var n})}):i.jsxs("div",{className:"text-center p-5",children:[i.jsx("i",{className:"mdi mdi-folder-multiple-outline mdi-48px mb-2"}),i.jsx("h4",{children:"Arrastra archivos aquí o usa el botón de subir"}),i.jsx("small",{className:"text-muted",children:"Tamaño máximo por archivo: 40MB"})]})})]}),i.jsxs(n,{modalRef:h,title:"Modificar nombre",onSubmit:async e=>{e.preventDefault();const i=new FormData;i.append("id",g.current.value),i.append("name",v.current.value);const a=await p.save(i);if(!a)return;const s=a.data;k(e=>e.map(e=>e.id===s.id?s:e)),$(h.current).modal("hide")},zIndex:1070,children:[i.jsx("input",{ref:g,type:"hidden"}),i.jsx(l,{eRef:b,label:"Nombre anterior",disabled:!0}),i.jsx(l,{eRef:v,label:"Nombre nuevo",required:!0})]})]})},x=({files:e})=>i.jsx(i.Fragment,{children:i.jsx("div",{className:"repository-container",children:i.jsx(f,{files:e})})});d((e,a)=>{t.createRoot(e).render(i.jsx(m,{...a,title:"Repositorio",children:i.jsx(x,{...a})}))});

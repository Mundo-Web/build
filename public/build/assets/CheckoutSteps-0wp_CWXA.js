import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BOnQTV8N.js";import{N as k}from"./Number2Currency-e57Tgsuk.js";import{D as qe,C as et,B as Ce,a as Le,P as tt,b as st,A as at,O as ot,I as De,c as rt}from"./OptionCard-CCDvEDC7.js";import{m as nt}from"./main-DKOTUah5.js";import{G as R}from"./Global-DWbVqTT_.js";import{t as z}from"./index-DRg3WPTA.js";import{I as ne}from"./InputForm-Dmyom2PO.js";import{S as it}from"./SelectForm-BvZde-dr.js";import{S as lt}from"./store-DCbpAdsr.js";import{l as ct}from"./ShippingStep-DrbxoqQN.js";import{c as Ve}from"./createLucideIcon-DfjclApS.js";import{C as se}from"./circle-x-5vreeYph.js";import{m as le}from"./proxy-BXHfTAg0.js";import"./ProductNavigation-3GVnrkEx.js";import"./ProductCard-Lp5WfZrB.js";/* empty css              */import"./BlogCarousel-Bde9hmkj.js";/* empty css               */import"./BlogCarrusel-D7F5uf-O.js";import{R as dt}from"./PolicyModal-CPFjYZfq.js";import{H as mt}from"./HtmlContent-ghmllTyl.js";import{X as pt}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./sparkles-DvmvZ6mJ.js";import"./CartItemRow-DKi2w-Pb.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";import"./index-fNjTmf9T.js";import"./trash-2-DU7LB6-f.js";import"./plus-CTIomuuF.js";import"./index-NIGUFBhG.js";import"./useStateManager-7e1e8489.esm-BASof734.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./floating-ui.dom-BPWAutIm.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./check-D5vaIe6v.js";import"./ItemsRest-9bICvOQx.js";import"./BasicRest-BCYKfs4R.js";import"./HeaderSearch-1DAGusQ3.js";import"./index-d5793iyH.js";import"./eye-ScgfreHn.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=Ve("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=Ve("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]);function xt({data:u,cart:b,setCart:g,onContinue:M,subTotal:_,envio:q,igv:$,totalFinal:L,openModal:n,categorias:d,automaticDiscounts:m,setAutomaticDiscounts:t,automaticDiscountTotal:r,setAutomaticDiscountTotal:o,totalWithoutDiscounts:S}){const[A,B]=i.useState(m||[]),[w,F]=i.useState(r||0),[D,H]=i.useState(!1),[ce,Z]=i.useState([]),[ee,Y]=i.useState([]),[X,W]=i.useState(!1),[K,ae]=i.useState(null),[te,ge]=i.useState(null),oe=b.length===0;i.useEffect(()=>{if(b.length>0&&_>0)x();else{const c=[];B(c),F(0),Z([]),Y([]),t&&t(c),o&&o(0)}},[b,_]);const x=async()=>{H(!0);try{const c=b.reduce((j,v)=>j+(v.quantity||0),0);console.log("üõí CartStep applying discounts:",{cart:b,subTotal:_,totalWithoutDiscounts:S,totalQuantity:c,cartLength:b.length,cartItems:b.map(j=>({id:j.id||j.item_id,name:j.name,quantity:j.quantity,price:j.price||j.final_price,category_id:j.category_id}))});const l=await qe.applyToCart(b,S);if(console.log("üì• Server response:",{success:l.success,data:l.data,error:l.error,fullResult:l}),l.success&&l.data){console.log("‚úÖ Discounts found:",l.data.applied_discounts);const j=qe.formatDiscounts(l.data.applied_discounts),v=l.data.total_discount||0,G=qe.getFreeItems(l.data.applied_discounts),pe=[];l.data.applied_discounts.forEach(re=>{re.suggested_items&&Array.isArray(re.suggested_items)&&pe.push(...re.suggested_items)}),B(j),F(v),Z(G),Y(pe),t&&t(j),o&&o(v)}else{console.error("‚ùå Discount application failed:",{error:l.error,success:l.success,data:l.data,fullResult:l});const j=[],v=0;B(j),F(v),Z([]),Y([]),t&&t(j),o&&o(v)}}catch(c){console.error("Error applying discount rules:",c);const l=[],j=0;B(l),F(j),Z([]),Y([]),t&&t(l),o&&o(j)}finally{H(!1)}},U=c=>ee.some(l=>l.item_id===c||l.triggering_item_id===c),de=c=>ee.find(l=>l.item_id===c||l.triggering_item_id===c),me=c=>{const l=de(c.id);l&&(ae(l),ge(c),W(!0))},J=async c=>{try{console.log("CartStep - handleAddPromotionalItem received:",c),console.log("CartStep - current cart:",b),g(l=>{console.log("CartStep - old cart before update:",l);const j=l.findIndex(v=>(v.item_id||v.id)===c.item_id);if(console.log("CartStep - existingItemIndex:",j),j!==-1){const v=[...l],G=c.quantity||c.suggested_quantity||1;return console.log("CartStep - adding quantity:",G),v[j].quantity+=G,console.log("CartStep - updated cart:",v),v}else{console.log("CartStep - item not found, creating new product");const v={id:c.item_id,name:c.item_name,quantity:c.quantity||c.suggested_quantity||1,price:c.value||0,final_price:c.value||0,image:c.item_image||"default.jpg",brand:{name:c.item_brand||"N/A"},sku:c.item_sku||"PROMO",stock:999};return[...l,v]}}),setTimeout(()=>{x()},100)}catch(l){console.error("Error adding promotional item:",l)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:oe?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito est√° vac√≠o"}),e.jsx("p",{className:"text-gray-500",children:"¬°Explora nuestros productos y encuentra algo especial!"})]}):b.map((c,l)=>e.jsx(et,{...c,setCart:g,categorias:d,hasPromotion:U(c.id),onPromotionClick:me},l))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(_)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k($)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(q)]})]}),D&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!D&&A.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6  customtext-neutral-dark mb-2",children:"üéâ Descuentos aplicados:"}),A.map((c,l)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[c.name,c.description&&e.jsx("span",{className:"text-xs font-semibold block",children:c.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",k(c.amount)]})]},l)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",k(w)]})]})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(L)]})]}),w>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:["S/ ",k(S||L+w)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras S/ ",k(w)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(Ce,{onClick:M,disabled:oe,className:`w-full ${(u==null?void 0:u.class_button)||"text-white"}`,children:oe?"Carrito Vac√≠o":"Continuar Compra"}),e.jsx(Le,{href:"/",className:"w-full",children:oe?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{href:"#",onClick:()=>n(1),className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{href:"#",onClick:()=>n(0),className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]}),e.jsx(tt,{isOpen:X,onClose:()=>W(!1),suggestion:K,onAddToCart:J,productName:(te==null?void 0:te.name)||""})]})}function ht(){let u="";for(let b=0;b<12;b++){const g=Math.floor(Math.random()*10);u+=g}return u}const gt=u=>new Promise((b,g)=>{var M;try{if(console.log("üîÑ Iniciando proceso de pago con Culqi...",u),!R.CULQI_ENABLED){console.error("‚ùå Error: Culqi no est√° habilitado en la configuraci√≥n"),g("M√©todo de pago no disponible: Culqi est√° deshabilitado");return}if(typeof window.Culqi>"u"){console.error("‚ùå Error: Culqi no est√° definido. Verifique que el script de Culqi est√© cargado."),g("Error en la integraci√≥n con Culqi: Script no cargado");return}if(!R.CULQI_PUBLIC_KEY){console.error("‚ùå Error: CULQI_PUBLIC_KEY no est√° configurado"),g("Error de configuraci√≥n: Clave p√∫blica de Culqi no encontrada");return}const _=ht(u.email);console.log("üìù N√∫mero de orden generado:",_);let q=!1;try{window.Culqi.publicKey=R.CULQI_PUBLIC_KEY,console.log("‚úÖ Clave p√∫blica configurada exitosamente")}catch(m){console.error("‚ùå Error al configurar la clave p√∫blica:",m),g("Error en la integraci√≥n con Culqi: No se pudo configurar la clave p√∫blica");return}const $=parseFloat(u.amount.toFixed(2)),L=Math.round($*100);console.log("üí∞ Configurando Culqi:"),console.log("   - Monto original:",u.amount),console.log("   - Monto redondeado (soles):",$),console.log("   - Monto en c√©ntimos:",L),console.log("   - Email:",u.email),window.Culqi.settings({title:R.CULQI_NAME||R.APP_NAME,email:u.email,currency:"PEN",amount:L,order:`${_}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:R.APP_URL+`/assets/resources/icon.png?v=${crypto.randomUUID()}`,bannerColor:R.APP_COLOR_PRIMARY,buttonBackground:R.APP_COLOR_PRIMARY}});const n=(M=window.Culqi)==null?void 0:M.close;n&&(window.Culqi.close=function(){return!window.Culqi.token&&!q&&(console.log("üö´ Modal de Culqi cerrado sin completar el pago"),g("Pago cancelado por el usuario")),n.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){g("No se obtuvo un token de Culqi");return}q=!0;const m=window.Culqi.token.id;console.log("‚úÖ Token generado:",m),u={...u,token:m,orderNumber:_},console.log("_request actualizado",u);const{status:t,result:r}=await nt.Fetch("./api/pago",{method:"POST",body:JSON.stringify(u)});t||console.log((r==null?void 0:r.message)||"Error en el pago"),window.Culqi.close(),z.success("¬°Pago exitoso!",{description:"Tu pago se proces√≥ correctamente. Pronto recibir√°s la confirmaci√≥n de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),b(r)}catch(m){z.error("¬°Error en el Pago!",{description:m.message,duration:3e3,position:"top-right",richColors:!0}),g(m.message||"Error en el pago")}},window.addEventListener("message",function(m){m.data==="culqi_closed"&&g("Pago cancelado por el usuario")});const d=m=>{m.key==="Escape"&&!q&&(console.log("üö´ Modal de Culqi cerrado con Escape"),g("Pago cancelado por el usuario"))};document.addEventListener("keydown",d),setTimeout(()=>{document.removeEventListener("keydown",d)},3e5),document.addEventListener("culqi.error",function(m){var t,r;z.error("¬°Error en Culqi!",{description:((t=m.detail)==null?void 0:t.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),g(((r=m.detail)==null?void 0:r.message)||"Error desconocido")})}catch(_){z.error("¬°Error en la integraci√≥n con Culqi!",{description:_.message,duration:3e3,position:"top-right",richColors:!0}),g("Error en la integraci√≥n con Culqi")}}),ft=({ubigeoCode:u,onStoreSelect:b,selectedStore:g=null,className:M=""})=>{const[_,q]=i.useState([]),[$,L]=i.useState(!1),[n,d]=i.useState(null);i.useEffect(()=>{u&&m()},[u]);const m=async()=>{L(!0),d(null);try{const o=await(await fetch("/api/stores")).json();q(o.data||[])}catch{q([])}finally{L(!1)}},t=r=>{b(r)};return $?e.jsxs("div",{className:`text-center p-6 ${M}`,children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary/10 rounded-full mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark mb-2",children:"Cargando tiendas..."}),e.jsx("p",{className:"customtext-neutral-light text-sm",children:"Buscando tiendas disponibles en tu ubicaci√≥n"})]}):n?e.jsxs("div",{className:`bg-red-50 border border-red-200 rounded-xl p-4 md:p-6 ${M}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 text-center mb-2",children:"Error al cargar tiendas"}),e.jsx("p",{className:"text-red-600 text-center text-sm",children:n})]}):_.length===0?e.jsxs("div",{className:`bg-secondary/30 border border-secondary rounded-xl p-4 md:p-6 ${M}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-secondary rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 customtext-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark text-center mb-2",children:"Sin tiendas disponibles"}),e.jsx("p",{className:"customtext-neutral-light text-center text-sm",children:"No hay tiendas disponibles para retiro en esta ubicaci√≥n. Por favor, selecciona otra opci√≥n de env√≠o."})]}):e.jsxs("div",{className:M,children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold customtext-neutral-dark mb-2",children:"Selecciona una tienda para retiro"}),e.jsx("p",{className:"customtext-neutral-light text-sm md:text-base",children:"Elige la tienda m√°s conveniente para retirar tu pedido"})]}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:_.map(r=>e.jsxs("div",{className:`relative border-2 rounded-xl p-3 md:p-4 cursor-pointer transition-all duration-200 hover:shadow-lg ${(g==null?void 0:g.id)===r.id?"border-primary bg-primary/5 shadow-md":"border-secondary bg-white hover:border-primary/50 hover:shadow-md"}`,onClick:()=>t(r),children:[e.jsx("div",{className:"absolute top-3 md:top-4 right-3 md:right-4",children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${(g==null?void 0:g.id)===r.id?"border-primary bg-primary":"border-secondary bg-white"}`,children:(g==null?void 0:g.id)===r.id&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4 pr-8",children:[e.jsx("div",{className:"flex-shrink-0 hidden lg:block md:mx-0",children:r.image?e.jsx("img",{src:`/storage/images/store/${r.image}`,alt:r.name,className:"w-16 h-16 md:w-20 md:h-20 object-cover rounded-lg border border-secondary"}):e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-secondary rounded-lg border border-secondary flex items-center justify-center",children:e.jsx(lt,{className:"customtext-primary"})})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left md:text-left",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold customtext-neutral-dark text-base md:text-lg truncate",children:r.name}),e.jsx("span",{className:`hidden lg:block px-2 py-1 rounded-full text-xs font-medium ${r.type==="tienda"?"bg-primary/10 customtext-primary":r.type==="oficina"||r.type==="almacen"?"bg-secondary customtext-neutral-dark":r.type==="showroom"?"bg-primary/10 customtext-primary":"bg-secondary customtext-neutral-dark"}`,children:r.type==="tienda"?"Tienda":r.type==="oficina"?"Oficina":r.type==="almacen"?"Almac√©n":r.type==="showroom"?"Showroom":r.type||"Otro"})]}),e.jsx("p",{className:"text-sm customtext-neutral-light mb-3 line-clamp-3",children:r.address}),e.jsxs("div",{className:"flex flex-col md:flex-row md:flex-wrap gap-2 md:gap-4 text-sm customtext-neutral-light mb-3",children:[r.phone&&e.jsxs("div",{className:"flex items-center justify-start md:justify-start gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{children:r.phone})]}),r.manager&&e.jsxs("div",{className:"flex items-center justify-start md:justify-start gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{className:"text-center md:text-left",children:["Encargado: ",r.manager]})]})]}),r.business_hours&&e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mt-3",children:[e.jsx("div",{className:"text-xs font-medium customtext-neutral-dark mb-2",children:"Horarios de atenci√≥n:"}),e.jsx("div",{className:"text-xs customtext-neutral-light",children:(()=>{try{const o=typeof r.business_hours=="string"?JSON.parse(r.business_hours):r.business_hours,S=new Date().toLocaleDateString("es-PE",{weekday:"long"}),B={lunes:"Lunes",martes:"Martes",mi√©rcoles:"Mi√©rcoles",jueves:"Jueves",viernes:"Viernes",s√°bado:"S√°bado",domingo:"Domingo"}[S.toLowerCase()]||S,w=o.find(F=>F.day.toLowerCase()===B.toLowerCase());if(w){const F=w.closed?"Hoy: Cerrado":`Hoy: ${w.open} - ${w.close}`,D=!w.closed&&(()=>{const H=new Date,ce=H.getHours()*60+H.getMinutes(),[Z,ee]=w.open.split(":").map(Number),[Y,X]=w.close.split(":").map(Number),W=Z*60+ee,K=Y*60+X;return ce>=W&&ce<=K})();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:F}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D?"bg-primary/10 customtext-primary":"bg-red-100 text-red-800"}`,children:D?"Abierto":"Cerrado"})]})}return"Horarios disponibles"}catch{return"Horarios disponibles"}})()})]}),r.description&&e.jsx("div",{className:"hidden lg:block mt-3 pt-3 border-t border-secondary",children:e.jsx("p",{className:"text-sm customtext-neutral-light text-center md:text-left",children:r.description})})]})]})]},r.id))})]})};function yt({data:u,cart:b,setSale:g,setCode:M,setDelivery:_,setCart:q,onContinue:$,noContinue:L,subTotal:n,igv:d,totalFinal:m,user:t,setEnvio:r,envio:o,ubigeos:S=[],openModal:A,categorias:B,setCouponDiscount:w,setCouponCode:F,automaticDiscounts:D=[],automaticDiscountTotal:H=0,setAutomaticDiscounts:ce,setAutomaticDiscountTotal:Z,totalWithoutDiscounts:ee,conversionScripts:Y,setConversionScripts:X,onPurchaseComplete:W}){var Ue;const[K,ae]=i.useState(null),[te,ge]=i.useState(null);D.reduce((s,a)=>a.free_items&&Array.isArray(a.free_items)?[...s,...a.free_items]:s,[]);const oe=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[x,U]=i.useState({name:(t==null?void 0:t.name)||"",lastname:(t==null?void 0:t.lastname)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",documentType:((Ue=t==null?void 0:t.document_type)==null?void 0:Ue.toLowerCase())||"",document:(t==null?void 0:t.document_number)||"",department:(t==null?void 0:t.department)||"",province:(t==null?void 0:t.province)||"",district:(t==null?void 0:t.district)||"",address:(t==null?void 0:t.address)||"",number:(t==null?void 0:t.number)||"",comment:"",reference:(t==null?void 0:t.reference)||"",ubigeo:(t==null?void 0:t.ubigeo)||null});i.useEffect(()=>{if(t!=null&&t.ubigeo&&(t!=null&&t.district)&&(t!=null&&t.province)&&(t!=null&&t.department)){const s={value:t.ubigeo,label:`${t.district}, ${t.province}, ${t.department}`,data:{reniec:t.ubigeo,departamento:t.department,provincia:t.province,distrito:t.district}};ge(s),ae(s),Ae(s)}},[t]),i.useEffect(()=>{t&&U(s=>{var a;return{...s,name:t.name||s.name,lastname:t.lastname||s.lastname,email:t.email||s.email,phone:t.phone||s.phone,documentType:((a=t.document_type)==null?void 0:a.toLowerCase())||s.documentType,document:t.document_number||s.document,department:t.department||s.department,province:t.province||s.province,district:t.district||s.district,address:t.address||s.address,number:t.number||s.number,reference:t.reference||s.reference,ubigeo:t.ubigeo||s.ubigeo}})},[t]);const[de,me]=i.useState(!1),[J,c]=i.useState(!1),[l,j]=i.useState([]),[v,G]=i.useState(null),[pe,re]=i.useState(null),[h,E]=i.useState({}),[be,ue]=i.useState(""),[ie,xe]=i.useState(!1),[he,Ie]=i.useState(""),[T,Me]=i.useState(null),[ke,Se]=i.useState(0),[je,$e]=i.useState(!1),[_e,fe]=i.useState(""),[ve,Ee]=i.useState(null),[ze,Re]=i.useState(!1),[He,Pe]=i.useState(!1),Qe=s=>{Ee(s),E(a=>({...a,store:""}))},Ke=s=>{var f,I,y;const a=["name","lastname","documentType","document","email","phone","ubigeo","address","shipping"];for(const P of a)if(s[P]){let C=null,N=!1;if(P==="ubigeo"?C=((I=(f=document.querySelector('[name="ubigeo"]'))==null?void 0:f.parentElement)==null?void 0:I.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):P==="shipping"?C=((y=document.querySelector('input[name="shipping"]'))==null?void 0:y.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(C=document.querySelector(`[name="${P}"]`),N=!0),C){C.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),N&&setTimeout(()=>{try{C.focus(),C.tagName==="INPUT"&&C.type==="text"&&C.select()}catch(p){console.warn("No se pudo enfocar el elemento:",p)}},600),Ge(C);break}}},Ge=s=>{if(!s)return;const a=document.createElement("div");if(a.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const I=document.createElement("style");I.id="error-highlight-styles",I.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(I)}const f=s.style.position;(!f||f==="static")&&(s.style.position="relative"),s.appendChild(a),setTimeout(()=>{a.parentNode&&(a.parentNode.removeChild(a),(!f||f==="static")&&(s.style.position=f))},1200)},Ae=async s=>{var f,I,y,P,C;if(!s)return;E(N=>({...N,ubigeo:""}));const{data:a}=s;U(N=>({...N,department:a.departamento,province:a.provincia,district:a.distrito,ubigeo:a.reniec})),me(!0);try{const N=b.reduce((V,we)=>V+we.final_price*we.quantity,0);console.log("üõí ShippingStep - Cart total calculado:",N),console.log("üõí ShippingStep - Cart items:",b.map(V=>({name:V.name,price:V.final_price,quantity:V.quantity,total:V.final_price*V.quantity}))),console.log("üí∞ ShippingStep - Comparaci√≥n de totales:"),console.log("   - Cart total (solo productos):",N),console.log("   - SubTotal prop:",n),console.log("   - IGV prop:",d),console.log("   - Total con IGV:",n+d),console.log("   - Total final prop:",m);const p=await st.getShippingCost({ubigeo:a.reniec,cart_total:N});console.log("üì¶ ShippingStep - Respuesta del backend:",p.data),console.log("‚úÖ ShippingStep - Califica para env√≠o gratis?",p.data.qualifies_free_shipping),console.log("üí∞ ShippingStep - Umbral requerido:",p.data.free_shipping_threshold),console.log("üîç ShippingStep - is_free:",p.data.is_free),console.log("üîç ShippingStep - Descripci√≥n standard:",(f=p.data.standard)==null?void 0:f.description),console.log("üîç ShippingStep - Tipo standard:",(I=p.data.standard)==null?void 0:I.type);const Q=[];let Be=!1;if(p.data.is_free&&p.data.qualifies_free_shipping&&(console.log("‚úÖ ShippingStep - Es zona is_free=true Y califica por monto - Agregando env√≠o GRATIS"),Q.push({type:"free",price:0,description:p.data.standard.description,deliveryType:p.data.standard.type,characteristics:p.data.standard.characteristics})),p.data.standard&&(!p.data.is_free||p.data.is_free&&!p.data.qualifies_free_shipping)){console.log("üì¶ ShippingStep - Agregando env√≠o NORMAL");let V=p.data.standard.description;p.data.is_free||(V=V.replace(/env√≠o gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),V||(V="Delivery a domicilio")),Q.push({type:"standard",price:p.data.standard.price,description:V,deliveryType:p.data.standard.type,characteristics:p.data.standard.characteristics})}p.data.express&&p.data.express.price>0&&(console.log("‚ö° ShippingStep - Agregando env√≠o EXPRESS"),Q.push({type:"express",price:p.data.express.price,description:p.data.express.description,deliveryType:p.data.express.type,characteristics:p.data.express.characteristics})),p.data.is_agency&&p.data.agency&&(console.log("üè¢ ShippingStep - Agregando env√≠o por AGENCIA"),Q.push({type:"agency",price:p.data.agency.price||0,description:p.data.agency.description,deliveryType:p.data.agency.type,characteristics:p.data.agency.characteristics})),p.data.is_store_pickup&&(console.log("üè™ ShippingStep - Retiro en tienda disponible"),Be=!0),Be||p.data.is_store_pickup?(Q.some(we=>we.type==="store_pickup")||(p.data.store_pickup?Q.push({type:"store_pickup",price:p.data.store_pickup.price,description:p.data.store_pickup.description,deliveryType:p.data.store_pickup.type,characteristics:p.data.store_pickup.characteristics}):Q.push({type:"store_pickup",price:0,description:"Retira tu pedido en una de nuestras tiendas",deliveryType:"Retiro en Tienda",characteristics:["Sin costo de env√≠o","Horarios flexibles","Atenci√≥n personalizada"]})),Re(!0)):(Re(!1),Ee(null)),j(Q),G(((y=Q[0])==null?void 0:y.type)||null),r(((P=Q[0])==null?void 0:P.price)||0),xe(!1),console.log("üìã ShippingStep - Opciones finales de env√≠o:",Q),console.log("üöö ShippingStep - Precio de env√≠o seleccionado:",((C=Q[0])==null?void 0:C.price)||0)}catch{z.error("Sin cobertura",{description:"No realizamos env√≠os a esta ubicaci√≥n.",icon:e.jsx(Te,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),j([]),G(null),r(0),xe(!1)}me(!1)},Oe=async s=>{var y,P;if(s.preventDefault(),J)return;if(!t){Pe(!0);return}const a={},f=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,I=/^[0-9]{9}$/;if(x.name.trim()||(a.name="Nombre es requerido"),x.lastname.trim()||(a.lastname="Apellido es requerido"),x.documentType.trim()||(a.documentType="Tipo de documento es requerido"),x.document.trim()||(a.document="N√∫mero de documento es requerido"),x.email.trim()?f.test(x.email)||(a.email="Email inv√°lido"):a.email="Email es requerido",x.phone.trim()?I.test(x.phone.trim())||(a.phone="Tel√©fono debe tener exactamente 9 d√≠gitos"):a.phone="Tel√©fono es requerido",x.ubigeo||(a.ubigeo="Ubicaci√≥n es requerida"),x.address||(a.address="Direcci√≥n es requerida"),v||(a.shipping="Seleccione un m√©todo de env√≠o"),Object.keys(a).length>0){E(a);const C=Object.keys(a)[0],N={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",documentType:"Por favor seleccione el tipo de documento",document:"Por favor ingrese su n√∫mero de documento",email:(y=a.email)!=null&&y.includes("inv√°lido")?"Por favor ingrese un correo electr√≥nico v√°lido":"Por favor ingrese su correo electr√≥nico",phone:(P=a.phone)!=null&&P.includes("9 d√≠gitos")?"El tel√©fono debe tener exactamente 9 d√≠gitos":"Por favor ingrese su n√∫mero de tel√©fono",ubigeo:"Por favor seleccione su ubicaci√≥n de entrega",address:"Por favor ingrese su direcci√≥n de entrega",shipping:"Por favor seleccione un m√©todo de env√≠o"};z.error("Complete el campo requerido",{description:N[C],icon:e.jsx(se,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),Ke(a);return}c(!0);try{if(!R.CULQI_ENABLED){z.error("M√©todo de pago no disponible",{description:"El procesamiento de pagos con tarjeta est√° temporalmente deshabilitado",icon:e.jsx(se,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),c(!1);return}if(!R.CULQI_PUBLIC_KEY){z.error("Error de configuraci√≥n",{description:"El sistema de pagos no est√° configurado correctamente",icon:e.jsx(se,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),c(!1);return}const C={user_id:t.id,...x,fullname:`${x.name} ${x.lastname}`,country:"Per√∫",document_type:x.documentType,amount:O(Ne),delivery:O(o),delivery_type:v,store_id:v==="store_pickup"?ve==null?void 0:ve.id:null,cart:b,coupon_id:(T==null?void 0:T.id)||null,coupon_code:(T==null?void 0:T.code)||null,coupon_discount:O(ke||0),applied_promotions:D||[],promotion_discount:O(H||0)};console.log("üì¶ Request completo a enviar:",C),console.log("üí∞ Monto final con cup√≥n:",Ne),console.log("üéüÔ∏è Descuento del cup√≥n:",ke),console.log("üöö Costo de env√≠o:",o);const N=await gt(C);if(console.log("üìã Respuesta completa del procesamiento:",N),N.status){if(console.log("‚úÖ Pago exitoso, procesando respuesta..."),g(N.sale),_(N.delivery),M(N.code),N.conversion_scripts&&(console.log("Scripts de conversi√≥n recibidos:",N.conversion_scripts),X(N.conversion_scripts),W)){console.log("üéØ Ejecutando callback onPurchaseComplete...");try{await W(N.sale_id,N.conversion_scripts),console.log("‚úÖ Callback onPurchaseComplete ejecutado exitosamente")}catch(p){console.error("‚ùå Error en callback onPurchaseComplete:",p)}}console.log("üõí Limpiando carrito y continuando..."),q([]),$()}else console.log("‚ùå Pago rechazado:",N),z.error("Error en el pago",{description:N.message||"Pago rechazado",icon:e.jsx(Te,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(C){console.error("üí• Error completo en handlePayment:",C),console.error("üí• Stack trace:",C.stack),console.error("üí• Error name:",C.name),console.error("üí• Error message:",C.message),z.error("Lo sentimos, no puede continuar con la compra",{description:`Ocurri√≥ un error al procesar el pedido: ${C.message}`,icon:e.jsx(Te,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{c(!1)}},Ye=i.useCallback(ct.debounce((s,a)=>{if(s.length<3){a([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(s)}`).then(f=>{if(!f.ok)throw new Error("Error en la respuesta");return f.json()}).then(f=>{const I=f.map(y=>({value:y.reniec,label:`${y.distrito}, ${y.provincia}, ${y.departamento}`,data:{inei:y.inei,reniec:y.reniec,departamento:y.departamento,provincia:y.provincia,distrito:y.distrito}}));a(I)}).catch(f=>{a([])})},300),[]);i.useEffect(()=>{E(s=>{const a={...s};return x.name.trim()&&delete a.name,x.lastname.trim()&&delete a.lastname,x.documentType.trim()&&delete a.documentType,x.document.trim()&&delete a.document,x.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)&&delete a.email,x.phone.trim()&&/^[0-9]{9}$/.test(x.phone.trim())&&delete a.phone,x.address.trim()&&delete a.address,x.ubigeo&&delete a.ubigeo,v&&delete a.shipping,a})},[x,v]);const Xe=s=>({control:a=>({...a,border:`1px solid ${s?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:s?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:a=>({...a,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:a=>({...a,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),We=async()=>{var s;if(!he.trim()){fe("Ingrese un c√≥digo de cup√≥n");return}$e(!0),fe("");try{const a=[...new Set(b.map(P=>P.category_id).filter(Boolean))],f=b.map(P=>P.id);console.log("Validando cup√≥n:",{code:he.trim(),cart_total:n,category_ids:a,product_ids:f});const I=await rt.validateCoupon({code:he.trim(),cart_total:n,category_ids:a,product_ids:f});console.log("Respuesta del cup√≥n:",I);const y=I.data||I;if(y&&y.valid){Me(y.coupon);const P=Math.round(y.discount*100)/100;Se(P),w&&w(P),F&&F(((s=y.coupon)==null?void 0:s.code)||he.trim()),z.success("Cup√≥n aplicado",{description:y.message||"Cup√≥n aplicado correctamente",duration:3e3,position:"top-center"})}else{const P=(y==null?void 0:y.message)||"Cup√≥n no v√°lido";fe(P),z.error("Cup√≥n no v√°lido",{description:P,icon:e.jsx(se,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(a){console.error("Error al validar cup√≥n:",a),fe("Error al validar el cup√≥n"),z.error("Error",{description:a.message||"No se pudo validar el cup√≥n. Intente nuevamente.",icon:e.jsx(se,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{$e(!1)}},Je=()=>{Me(null),Se(0),Ie(""),fe(""),w&&w(0),F&&F(""),z.success("Cup√≥n removido",{description:"El cup√≥n ha sido removido de su pedido",duration:2e3,position:"top-center"})},O=s=>{const a=typeof s=="string"?parseFloat(s):s;return parseFloat(a.toFixed(2))},Fe=O(n)+O(d)+O(o)-O(H);let ye=0;T&&(T.type==="percentage"||T.type==="percent"?ye=Fe*Number(T.value)/100:T.type==="fixed"&&(ye=Number(T.value))),i.useEffect(()=>{Se(O(ye)),w&&w(O(ye))},[T,n,d,o,H]);const Ne=Math.max(0,O(Fe-ye)),Ze=()=>{if(!He)return null;const s=a=>{a.target===a.currentTarget&&Pe(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:s,children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-2xl transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4",children:e.jsx(ut,{className:"h-8 w-8 customtext-primary"})}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-3",children:"Acceso requerido"}),e.jsx("p",{className:"customtext-neutral-light text-sm leading-relaxed",children:"Para continuar con su compra necesita iniciar sesi√≥n o crear una cuenta nueva."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{window.location.href="/iniciar-sesion"},className:"w-full py-3 px-6 bg-primary text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Iniciar sesi√≥n"}),e.jsx("button",{onClick:()=>{window.location.href="/crear-cuenta"},className:"w-full py-3 px-6 bg-accent text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Crear cuenta nueva"}),e.jsx("button",{onClick:()=>Pe(!1),className:"w-full py-3 px-6 customtext-neutral-light hover:customtext-neutral-dark border border-secondary rounded-lg hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200",children:"Cancelar"})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:Oe,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{name:"name",label:"Nombres",value:x.name,error:h.name,onChange:s=>{U(a=>({...a,name:s.target.value})),s.target.value.trim()&&h.name&&E(a=>({...a,name:""}))},required:!0,className:`border-gray-200 ${h.name?"border-red-500 bg-red-50":""}`}),e.jsx(ne,{name:"lastname",label:"Apellidos",value:x.lastname,error:h.lastname,onChange:s=>{U(a=>({...a,lastname:s.target.value})),s.target.value.trim()&&h.lastname&&E(a=>({...a,lastname:""}))},required:!0,className:`border-gray-200 ${h.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(it,{label:"Tipo de documento",options:oe,placeholder:"Selecciona tu documento",labelClass:"block text-sm 2xl:!text-base mb-1 customtext-neutral-dark",value:x.documentType,error:h.documentType,onChange:s=>{U(a=>({...a,documentType:s})),s&&h.documentType&&E(a=>({...a,documentType:""}))},required:!0})}),e.jsx(ne,{name:"document",label:"N√∫mero de documento",value:x.document,error:h.document,onChange:s=>{U(a=>({...a,document:s.target.value})),s.target.value.trim()&&h.document&&E(a=>({...a,document:""}))},placeholder:"Ej: 12345678",required:!0,className:`border-gray-200 ${h.document?"border-red-500 bg-red-50":""}`})]}),e.jsx(ne,{name:"email",label:"Correo electr√≥nico",type:"email",value:x.email,error:h.email,onChange:s=>{U(a=>({...a,email:s.target.value})),s.target.value.trim()&&h.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.target.value)&&E(f=>({...f,email:""}))},required:!0,className:`border-gray-200 ${h.email?"border-red-500 bg-red-50":""}`}),e.jsx(ne,{name:"phone",label:"Tel√©fono",type:"tel",value:x.phone,error:h.phone,onChange:s=>{const a=s.target.value.replace(/\D/g,"");U(f=>({...f,phone:a})),a.length===9&&h.phone&&E(f=>({...f,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${h.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (Ubicaci√≥n de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(at,{name:"ubigeo",cacheOptions:!0,value:K,loadOptions:Ye,onChange:s=>{ae(s),Ae(s),ue("")},inputValue:be,onInputChange:(s,{action:a})=>{a==="input-change"&&ue(s)},onFocus:()=>{ae(null),ue("")},onMenuOpen:()=>{K&&(ae(null),ue(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:s})=>s.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:de,styles:Xe(!!h.ubigeo),formatOptionLabel:({data:s})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:s.distrito}),e.jsxs("div",{className:"text-gray-500",children:[s.provincia,", ",s.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),h.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:h.ubigeo})]}),e.jsx(ne,{name:"address",label:"Direcci√≥n ",value:x.address,error:h.address,onChange:s=>{U(a=>({...a,address:s.target.value})),s.target.value.trim()&&h.address&&E(a=>({...a,address:""}))},required:!0,className:`border-gray-200 ${h.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"N√∫mero",value:x.number,onChange:s=>U(a=>({...a,number:s.target.value})),className:"border-gray-200"}),e.jsx(ne,{label:"Referencia",value:x.reference,onChange:s=>U(a=>({...a,reference:s.target.value})),className:"border-gray-200"})]}),l.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"M√©todo de env√≠o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.map(s=>e.jsx(ot,{title:s.deliveryType,price:s.price,description:s.description,selected:v===s.type,onSelect:()=>{G(s.type),r(s.price),E(a=>({...a,shipping:"",store:""})),xe(!1),s.type!=="store_pickup"&&Ee(null)}},s.type))}),v&&l.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(()=>{var I;const s=((I=l.find(y=>y.type===v))==null?void 0:I.characteristics)||[],a=s.length>1,f=a&&!ie?s.slice(0,1):s;return e.jsxs(e.Fragment,{children:[f.map((y,P)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(De,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:y})})]},`char-${P}`)),a&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{type:"button",onClick:()=>xe(!ie),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium customtext-primary hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:ie?"Ver menos informaci√≥n":`Ver m√°s informaci√≥n (${s.length-1} m√°s)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${ie?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})})()})]}),v==="store_pickup"&&ze&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(ft,{ubigeoCode:x.ubigeo,onStoreSelect:Qe,selectedStore:ve,className:"border border-gray-200 rounded-xl p-4"}),h.store&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),h.store]})]}),!L&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(Le,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(Ce,{type:"submit",loading:de,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:b.map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/storage/images/item/${s.image}`,alt:s.name,className:"w-16 h-16 object-cover rounded-lg",onError:a=>a.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",s.quantity]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["S/ ",k(s.final_price)]})]})]},s.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",k(O(n))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",k(O(d))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Env√≠o:"}),e.jsxs("span",{children:["S/ ",k(O(o))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"¬øTienes un cup√≥n de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu c√≥digo de cup√≥n",value:he,onChange:s=>Ie(s.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${_e?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":T?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!T||je}),je&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),T?e.jsx("button",{type:"button",onClick:Je,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cup√≥n",children:e.jsx(se,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:We,disabled:je||!he.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:je?"Validando...":"Aplicar"})]}),_e&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(se,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:_e})]}),T&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",T.type==="percentage"?`${T.value}%`:`S/${k(T.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:T.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-S/ ",k(O(ke))]})})]})})]})}),D&&D.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"üéâ Descuentos autom√°ticos aplicados:"}),D.map((s,a)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:s.name}),s.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:s.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-S/ ",k(s.amount)]})})]})},a)),H>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos autom√°ticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-S/ ",k(H)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",k(O(Ne))]})]})}),!R.CULQI_ENABLED&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"El procesamiento de pagos con tarjeta est√° temporalmente deshabilitado"})]})}),R.CULQI_ENABLED&&!R.CULQI_PUBLIC_KEY&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:"Error de configuraci√≥n: Sistema de pagos no configurado"})]})}),e.jsx(Ce,{onClick:Oe,disabled:J||!R.CULQI_ENABLED||!R.CULQI_PUBLIC_KEY,loading:J,className:`w-full mt-6 ${(u==null?void 0:u.class_button)||"text-white"} ${!R.CULQI_ENABLED||!R.CULQI_PUBLIC_KEY?"opacity-50 cursor-not-allowed":""}`,children:J?"Procesando...":R.CULQI_ENABLED?R.CULQI_PUBLIC_KEY?`Pagar S/ ${k(O(Ne))}`:"Configuraci√≥n pendiente":"Pago no disponible"}),e.jsx(Le,{onClick:L,className:"w-full mt-3",disabled:J,children:"Regresar al carrito"}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{href:"#",onClick:()=>A(1),className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{href:"#",onClick:()=>A(0),className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})]})]})]})]})}function bt({cart:u,code:b,delivery:g,couponDiscount:M=0,couponCode:_=null,conversionScripts:q=null,automaticDiscounts:$=[],automaticDiscountTotal:L=0}){const n=u.reduce((o,S)=>{const A=S==null?void 0:S.final_price;return o+A*(S==null?void 0:S.quantity)},0),d=parseFloat((n/1.18).toFixed(2)),m=parseFloat((n-d).toFixed(2)),r=parseFloat(d)+parseFloat(m)+parseFloat(g)-M-L;return i.useEffect(()=>{if(q){console.log("Executing conversion scripts...");try{if(q.head){const o=document.createElement("script");o.innerHTML=q.head,document.head.appendChild(o)}if(q.body){const o=document.createElement("script");o.innerHTML=q.body,document.body.appendChild(o)}console.log("Conversion scripts executed successfully")}catch(o){console.error("Error executing conversion scripts:",o)}}},[q]),e.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(le.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(le.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"‚úì"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"¬°Gracias por tu compra! üéâ"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(le.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"C√≥digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${b}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:u.map((o,S)=>{var A;return e.jsx(le.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:S*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${o==null?void 0:o.image}`,alt:o==null?void 0:o.name,className:"w-24 h-24 object-cover rounded-lg",onError:B=>B.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-xl lg:w-8/12 line-clamp-3",children:o==null?void 0:o.name}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:["S/ ",k((o==null?void 0:o.final_price)*(o==null?void 0:o.quantity))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:(A=o==null?void 0:o.brand)==null?void 0:A.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:o==null?void 0:o.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:o==null?void 0:o.sku})]})]})]})]})},S)})}),e.jsxs(le.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[[{label:"Subtotal",value:d},{label:"IGV",value:m},{label:"Env√≠o",value:g}].map((o,S)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:o==null?void 0:o.label}),e.jsxs("span",{className:"font-semibold",children:["S/ ",k(o==null?void 0:o.value)]})]},S)),M>0&&_&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark text-start",children:["Cup√≥n: ",e.jsx("br",{className:"lg:hidden"}),e.jsxs("span",{className:"font-semibold text-xs lg:text-base",children:["(",_,")"]})]}),e.jsxs("span",{className:"font-semibold",children:["-S/ ",k(M)]})]}),L>0&&$.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 customtext-neutral-dark mb-2",children:"üéâ Descuentos aplicados:"}),$.map((o,S)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[o.name,o.description&&e.jsx("span",{className:"text-xs font-semibold block",children:o.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",k(o.amount)]})]},S)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",k(L)]})]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",k(r)]})]})})]}),e.jsx(le.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(Ce,{href:"/catalogo",className:"w-full mx-auto md:w-auto text-white",children:"Seguir Comprando"})})]})]})})})}const jt=()=>{const u=i.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),b=(n,d={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[n],content_type:"product",content_name:d.name||"",value:d.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:d.price||0,items:[{item_id:n,item_name:d.name||"",category:d.category||"",price:d.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:n,content_type:"product",content_name:d.name||"",value:d.price||0,currency:"PEN"}),console.log("‚úÖ ProductView tracked for product:",n))},g=async(n,d=1,m={})=>{var t;if(!(typeof window>"u"))try{const o=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},body:JSON.stringify({product_id:n,quantity:d,...m})})).json();o.success&&o.tracking_scripts&&($(o.tracking_scripts),console.log("‚úÖ AddToCart tracked successfully"))}catch(r){console.error("‚ùå Error tracking AddToCart:",r)}},M=async(n,d)=>{var m;if(!(typeof window>"u"||u.current.hasTrackedInitiateCheckout))try{u.current.hasTrackedInitiateCheckout=!0;const r=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.content)||""},body:JSON.stringify({cart_items:n.map(o=>({product_id:o.id,name:o.name,price:o.final_price||o.price,quantity:o.quantity,subtotal:(o.final_price||o.price)*o.quantity}))})})).json();r.success&&r.tracking_scripts&&($(r.tracking_scripts),console.log("‚úÖ InitiateCheckout tracked successfully"))}catch(t){console.error("‚ùå Error tracking InitiateCheckout:",t),u.current.hasTrackedInitiateCheckout=!1}},_=(n,d)=>{if(!(typeof window>"u")){console.log("üéØ Iniciando tracking de compra:",{orderId:n,conversionScripts:d});try{d?(console.log("üìä Usando scripts de conversi√≥n del servidor"),$(d)):(console.log("üîÑ Obteniendo scripts de conversi√≥n del API"),fetch(`/api/tracking/purchase/${n}`).then(m=>m.text()).then(m=>{m&&($(m),console.log("‚úÖ Purchase tracked successfully"))}).catch(m=>{console.error("‚ùå Error tracking Purchase:",m)}))}catch(m){console.error("‚ùå Error general en trackPurchase:",m)}}},q=(n,d=[])=>{if(typeof window>"u"||u.current.hasTrackedPageView)return;u.current.hasTrackedPageView=!0;const m=d.reduce((t,r)=>t+(r.final_price||r.price)*r.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),n===1&&d.length>0&&window.fbq("track","AddToCart",{content_ids:d.map(t=>t.id),content_type:"product",value:m,currency:"PEN",num_items:d.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${n}`,page_location:window.location.href}),n===1&&d.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:m,items:d.map(t=>{var r;return{item_id:t.id,item_name:t.name,category:((r=t.category)==null?void 0:r.name)||"Sin categor√≠a",quantity:t.quantity,price:t.final_price||t.price}})})),console.log(`‚úÖ Checkout PageView tracked - Step ${n}`)},$=n=>{if(typeof window>"u"||!n)return;console.log("üéØ Ejecutando scripts de tracking:",n);const d=document.createElement("div");d.innerHTML=n,d.querySelectorAll("script").forEach((t,r)=>{try{const o=document.createElement("script");o.textContent=t.textContent,console.log(`üìä Ejecutando script de tracking ${r+1}:`,t.textContent.trim()),document.head.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},100),console.log(`‚úÖ Script de tracking ${r+1} ejecutado exitosamente`)}catch(o){console.error(`‚ùå Error ejecutando script de tracking ${r+1}:`,o),console.error("Script content:",t.textContent)}}),console.log("üéØ Todos los scripts de tracking procesados")};return{trackProductView:b,trackAddToCart:g,trackInitiateCheckout:M,trackPurchase:_,trackCheckoutPageView:q,resetTracking:()=>{u.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};function us({cart:u,setCart:b,user:g,ubigeos:M=[],items:_,generals:q,data:$,categorias:L}){const[n,d]=i.useState(1),m=u.reduce((h,E)=>h+E.final_price*E.quantity,0);console.log(L,"eeeeeeeeeeee");const{trackCheckoutPageView:t,trackInitiateCheckout:r,trackPurchase:o,resetTracking:S}=jt(),A=parseFloat((m/1.18).toFixed(2)),B=parseFloat((m-A).toFixed(2)),[w,F]=i.useState(0),[D,H]=i.useState(0),[ce,Z]=i.useState(null),[ee,Y]=i.useState([]),[X,W]=i.useState(0),K=A+B+parseFloat(w),ae=D+X,te=Math.max(0,K-ae),[ge,oe]=i.useState([]),[x,U]=i.useState([]),[de,me]=i.useState([]),[J,c]=i.useState(null);i.useEffect(()=>(t(n,u),()=>S()),[]),i.useEffect(()=>{t(n,u),n===2&&r(u,te)},[n]);const l=h=>{d(h),window.scrollTo({top:0,behavior:"smooth"})},j={privacy_policy:"Pol√≠ticas de privacidad",terms_conditions:"T√©rminos y condiciones",saleback_policy:"Pol√≠ticas de devolucion y cambio"},[v,G]=i.useState(null),pe=h=>G(h),re=()=>G(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${n===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:n>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${n>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${n>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Env√≠o"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:n>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${n===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${n===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmaci√≥n"})]})]})}),n===1&&e.jsx(xt,{data:$,cart:u,setCart:b,onContinue:()=>l(2),subTotal:A,envio:w,igv:B,totalFinal:te,openModal:pe,categorias:L,automaticDiscounts:ee,setAutomaticDiscounts:Y,automaticDiscountTotal:X,setAutomaticDiscountTotal:W,totalWithoutDiscounts:K}),n===2&&e.jsx(yt,{data:$,items:_,setCode:U,setDelivery:me,cart:u,setSale:oe,setCart:b,onContinue:()=>l(3),noContinue:()=>l(1),subTotal:A,envio:w,setEnvio:F,igv:B,totalFinal:te,user:g,ubigeos:M,categorias:L,openModal:pe,setCouponDiscount:H,setCouponCode:Z,automaticDiscounts:ee,setAutomaticDiscounts:Y,automaticDiscountTotal:X,setAutomaticDiscountTotal:W,totalWithoutDiscounts:K,conversionScripts:J,setConversionScripts:c,onPurchaseComplete:(h,E)=>{o(h,E)}}),n===3&&e.jsx(bt,{code:x,delivery:de,cart:ge,subTotal:A,envio:w,igv:B,totalFinal:te,couponDiscount:D,couponCode:ce,automaticDiscounts:ee,automaticDiscountTotal:X,totalWithoutDiscounts:K,conversionScripts:J,setConversionScripts:c,onPurchaseComplete:(h,E)=>{o(h,E)}})]}),Object.keys(j).map((h,E)=>{var ie;const be=j[h],ue=((ie=q.find(xe=>xe.correlative==h))==null?void 0:ie.description)??"";return e.jsx(dt,{isOpen:v===E,onRequestClose:re,contentLabel:be,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:be}),e.jsx("button",{onClick:re,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(pt,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(mt,{html:ue})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:re,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},E)})]})}export{us as default};

var Se=Object.defineProperty;var Ee=(h,n,i)=>n in h?Se(h,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[n]=i;var pe=(h,n,i)=>Ee(h,typeof n!="symbol"?n+"":n,i);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as x}from"./index-BOnQTV8N.js";import{c as Be}from"./ReactAppend-QR5TrZfj.js";import{s as _e}from"./server.browser-Bf4gQIc7.js";import{B as Re}from"./Base-ZNWmhL1i.js";import{B as Te}from"./BasicRest-BML1C-ua.js";import{m as fe}from"./main-B6F2O9-U.js";import{T as $e}from"./Table-CH4t8fjK.js";import{D as je}from"./DxButton-DV0H-ZcL.js";import{M as Ae}from"./Modal-xDw9ufjg.js";import{S as Fe}from"./SelectFormGroup-X8WqJHHl.js";import{C as De}from"./CreateReactScript-Uc5dYj9m.js";import{R as j}from"./ReactAppend-Vm5G2nof.js";import{S as o}from"./CartKuchara-D9l7c7at.js";import{G as Ne}from"./Global-Bz6gVLc5.js";import{C,N as w}from"./Number2Currency-jIsa99f9.js";import{i as He}from"./tippy-react.esm-DmkRJDEW.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CanAccess-VF1adbOh.js";import"./CardProductKatya-ncpmQ0JU.js";import"./index-pSueRYGM.js";import"./BooleanLimit-D-OsQsek.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";class Ie extends Te{constructor(){super(...arguments);pe(this,"path","admin/bookings")}async confirm(i){return await this.postRequest(`/api/admin/bookings/${i}/confirm`)}async complete(i){return await this.postRequest(`/api/admin/bookings/${i}/complete`)}async cancel(i,d){return await this.postRequest(`/api/admin/bookings/${i}/cancel`,d)}async noShow(i){return await this.postRequest(`/api/admin/bookings/${i}/no-show`)}async updateSaleStatus(i,d){return await this.postRequest(`/api/admin/bookings/${i}/update-sale-status`,d)}async postRequest(i,d={}){try{const c=await fetch(i,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(fe.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify(d)});if(!c.ok){const p=await c.json().catch(()=>({}));throw new Error((p==null?void 0:p.message)||`Error ${c.status}: ${c.statusText}`)}return await c.json()}catch(c){throw console.error("Error en petición POST:",c),c}}async getSaleStatusHistory(i){try{const d=await fetch(`/api/admin/bookings/${i}/sale-status-history`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(fe.Cookies.get("XSRF-TOKEN"))}});if(!d.ok)throw new Error(`Error ${d.status}: ${d.statusText}`);return(await d.json()).data||[]}catch(d){return console.error("Error al obtener historial de estados:",d),[]}}}const f=new Ie,Me=({statuses:h=[]})=>{var I,M,P,z,O,G,Y,q,V,X,W,J,K,U,Q,Z,k,L,ee,te,se,ae,re,le,ce,ne,ie,oe,de,me,he,ue;const n=x.useRef(),i=x.useRef(),d=x.useRef(),[c,p]=x.useState("all"),[t,g]=x.useState(null),[y,S]=x.useState([]),[R,T]=x.useState([]),[E,A]=x.useState(!1);x.useEffect(()=>{const s=document.createElement("style");return s.textContent=`
      .select2-container--default .select2-results__option {
        padding: 4px !important;
        background: white !important;
      }
      .select2-container--default .select2-results__option--highlighted[aria-selected] {
        background-color: #f8f9fa !important;
      }
      .select2-container--default .select2-results__option:hover {
        background-color: #f8f9fa !important;
      }
      .select2-container--default .select2-selection--single {
        border: 1px solid #e3ebf0 !important;
      }
    `,document.head.appendChild(s),()=>{document.head.removeChild(s)}},[]);const b=s=>{if(!s)return"N/A";const a=new Date(s),r=String(a.getDate()).padStart(2,"0"),l=String(a.getMonth()+1).padStart(2,"0"),m=a.getFullYear();return`${r}/${l}/${m}`},B=s=>{if(!s)return"N/A";const a=new Date(s);return moment(a).format("YYYY-MM-DD HH:mm")},F=()=>c==="all"?[]:["status","=",c];x.useEffect(()=>{if(n.current){const s=$(n.current).dxDataGrid("instance");s&&(s.option("filterValue",F()),s.refresh())}},[c]);const N=async s=>{try{const a=await f.get(s);a&&a.data?(g(a.data),S(a.all_bookings||[])):a?(g(a),S([])):o.fire("Error","No se pudo cargar la reserva","error")}catch(a){console.error("Error al cargar reserva:",a),o.fire("Error","No se pudo cargar la reserva","error")}},ye=async s=>{const{isConfirmed:a}=await o.fire({title:"Eliminar reserva",text:"¿Estás seguro de eliminar esta reserva? Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!a||!await f.delete(s)||$(n.current).dxDataGrid("instance").refresh()};x.useEffect(()=>{t&&i.current&&($(i.current).modal("show"),D())},[t]);const D=async()=>{if(t!=null&&t.id)try{const s=await f.getSaleStatusHistory(t.id);T(s||[])}catch(s){console.error("Error al cargar historial de estados:",s),T([])}},be=async s=>{var m,xe;const a=s.target.value,r=(m=t==null?void 0:t.sale)==null?void 0:m.status_id;if(!a||a==r||E)return;const l=h.find(u=>u.id==a);if(l){if(l.reversible==0){const{isConfirmed:u}=await o.fire({title:"Cambiar estado",text:`¿Estás seguro de cambiar el estado a ${l.name}?
Esta acción no se puede revertir`,icon:"warning",showCancelButton:!0});if(!u)return}A(!0);try{const u=await f.updateSaleStatus(t.id,{status_id:l.id,notify_client:((xe=d.current)==null?void 0:xe.checked)||!1});u!=null&&u.status&&(g(u.data),S(u.all_bookings||[]),await D(),$(n.current).dxDataGrid("instance").refresh())}catch(u){console.error("Error al cambiar estado:",u),o.fire("Error","No se pudo cambiar el estado","error")}A(!1)}},ve=async s=>{if((await o.fire({title:"Confirmar Reserva",text:"¿Estás seguro de confirmar esta reserva?",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, confirmar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await f.confirm(s)).status&&(o.fire({icon:"success",title:"¡Confirmada!",text:"La reserva ha sido confirmada correctamente",timer:2e3,showConfirmButton:!1}),await N(s),$(n.current).dxDataGrid("instance").refresh())}catch{o.fire({icon:"error",title:"Error",text:"Error al confirmar la reserva"})}},Ce=async s=>{if((await o.fire({title:"Completar Reserva",text:"¿El huésped ya ha hecho el check-out?",icon:"question",showCancelButton:!0,confirmButtonColor:"#17a2b8",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, completar",cancelButtonText:"Cancelar"})).isConfirmed)try{(await f.complete(s)).status&&(o.fire({icon:"success",title:"¡Completada!",text:"La reserva ha sido marcada como completada",timer:2e3,showConfirmButton:!1}),await N(s),$(n.current).dxDataGrid("instance").refresh())}catch{o.fire({icon:"error",title:"Error",text:"Error al completar la reserva"})}},we=async s=>{const{value:a}=await o.fire({title:"Cancelar Reserva",input:"textarea",inputLabel:"Razón de la cancelación",inputPlaceholder:"Ingresa la razón de la cancelación...",inputAttributes:{"aria-label":"Razón de cancelación"},showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, cancelar reserva",cancelButtonText:"No cancelar",inputValidator:r=>{if(!r)return"Debes ingresar una razón para la cancelación"}});if(a)try{(await f.cancel(s,{reason:a})).status&&(o.fire({icon:"success",title:"¡Cancelada!",text:"La reserva ha sido cancelada correctamente",timer:2e3,showConfirmButton:!1}),await N(s),$(n.current).dxDataGrid("instance").refresh())}catch{o.fire({icon:"error",title:"Error",text:"Error al cancelar la reserva"})}},ge=async s=>{if((await o.fire({title:"Marcar como No Show",text:"¿El huésped no se presentó?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#6c757d",cancelButtonColor:"#17a2b8",confirmButtonText:"Sí, marcar No Show",cancelButtonText:"Cancelar"})).isConfirmed)try{(await f.noShow(s)).status&&(o.fire({icon:"info",title:"Marcada como No Show",text:"La reserva ha sido marcada como no show",timer:2e3,showConfirmButton:!1}),await N(s),$(n.current).dxDataGrid("instance").refresh())}catch{o.fire({icon:"error",title:"Error",text:"Error al marcar como no show"})}},v=s=>({pending:{badge:"badge-warning",label:"Pendiente",color:"#f1b44c"},confirmed:{badge:"badge-success",label:"Confirmada",color:"#28a745"},cancelled:{badge:"badge-danger",label:"Cancelada",color:"#dc3545"},completed:{badge:"badge-info",label:"Completada",color:"#17a2b8"},no_show:{badge:"badge-secondary",label:"No Show",color:"#6c757d"}})[s]||{badge:"badge-secondary",label:s,color:"#6c757d"},H=s=>{const a=$(s.element).data("status");if(!s.id)return;const r=(a==null?void 0:a.color)||"#333";return $(_e.renderToString(e.jsxs("span",{title:(a==null?void 0:a.description)||"",className:"d-flex align-items-center",style:{color:r,padding:"4px 8px",fontSize:"14px",fontWeight:"500"},children:[e.jsx("i",{className:`${(a==null?void 0:a.icon)||"mdi mdi-circle"} me-2`,style:{color:r,fontSize:"12px"}}),s.text]})))},_=y.length===0&&t?{totalRooms:1,totalNights:t.nights||0,totalAmount:Number(t.total_price||0)}:y.reduce((s,a)=>({totalRooms:s.totalRooms+1,totalNights:s.totalNights+(a.nights||0),totalAmount:s.totalAmount+Number(a.total_price||0)}),{totalRooms:0,totalNights:0,totalAmount:0});return e.jsxs(e.Fragment,{children:[e.jsx($e,{gridRef:n,title:"Reservas de Hotel",rest:f,filterValue:F(),withRelations:"item,sale,sale.status",toolBar:s=>{s.unshift({widget:"dxButton",location:"before",options:{text:"Todas",type:c==="all"?"default":"normal",stylingMode:c==="all"?"contained":"outlined",onClick:()=>p("all")}},{widget:"dxButton",location:"before",options:{text:"Pendientes",type:c==="pending"?"default":"normal",stylingMode:c==="pending"?"contained":"outlined",onClick:()=>p("pending")}},{widget:"dxButton",location:"before",options:{text:"Confirmadas",type:c==="confirmed"?"default":"normal",stylingMode:c==="confirmed"?"contained":"outlined",onClick:()=>p("confirmed")}},{widget:"dxButton",location:"before",options:{text:"Completadas",type:c==="completed"?"default":"normal",stylingMode:c==="completed"?"contained":"outlined",onClick:()=>p("completed")}},{widget:"dxButton",location:"before",options:{text:"Canceladas",type:c==="cancelled"?"default":"normal",stylingMode:c==="cancelled"?"contained":"outlined",onClick:()=>p("cancelled")}}),s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"sale.code",caption:"Orden",width:"250px",cellTemplate:(s,{data:a})=>{var r,l,m;s.css("cursor","pointer"),s.on("click",()=>{N(a.id)}),j(s,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsx("b",{className:"d-block",children:((r=a.sale)==null?void 0:r.fullname)||((l=a.sale)==null?void 0:l.name)||"N/A"}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",Ne.APP_CORRELATIVE,"-",((m=a.sale)==null?void 0:m.code)||"N/A"]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(s,{data:a})=>{s.text(moment(a.created_at).subtract(5,"hours").format("LLL"))}},{dataField:"item.name",caption:"Habitación",cellTemplate:(s,{data:a})=>{var r,l;j(s,e.jsxs("div",{children:[e.jsx("strong",{children:((r=a.item)==null?void 0:r.name)||"N/A"}),e.jsx("div",{className:"small text-muted text-capitalize",children:((l=a.item)==null?void 0:l.room_type)||""})]}))}},{dataField:"check_in",caption:"Check In / Out",cellTemplate:(s,{data:a})=>{j(s,e.jsxs("div",{children:[e.jsxs("div",{className:"small",children:[e.jsx("i",{className:"mdi mdi-calendar-arrow-right text-success mr-1"}),b(a.check_in)]}),e.jsxs("div",{className:"small",children:[e.jsx("i",{className:"mdi mdi-calendar-arrow-left text-danger mr-1"}),b(a.check_out)]}),e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"mdi mdi-weather-night mr-1"}),a.nights," noche",a.nights!==1?"s":""]})]}))}},{dataField:"guests",caption:"Huéspedes",width:"90px",cellTemplate:(s,{data:a})=>{j(s,e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"mdi mdi-account-multiple text-primary"})," ",a.guests]}))}},{dataField:"total_price",caption:"Total",cellTemplate:(s,{data:a})=>{j(s,e.jsx("div",{children:e.jsxs("strong",{className:"text-success",children:[C()," ",w(a.total_price||0)]})}))}},{dataField:"sale.status.name",caption:"Estado Pago",cellTemplate:(s,{data:a})=>{var l;const r=(l=a.sale)==null?void 0:l.status;j(s,e.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:r!=null&&r.color?`${r.color}2e`:"#3333332e",color:(r==null?void 0:r.color)??"#333"},children:(r==null?void 0:r.name)||"Sin estado"}))}},{dataField:"status",caption:"Estado Reserva",cellTemplate:(s,{data:a})=>{const{badge:r,label:l}=v(a.status);j(s,e.jsx("span",{className:`badge ${r}`,children:l}))}},{caption:"Acciones",width:"100px",cellTemplate:(s,{data:a})=>{s.css("text-overflow","unset"),s.append(je({className:"btn btn-xs btn-light mr-1",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>N(a.id)})),s.append(je({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ye(a.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(Ae,{modalRef:i,title:`Detalles de la reserva #${Ne.APP_CORRELATIVE}-${((I=t==null?void 0:t.sale)==null?void 0:I.code)||""}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-account mr-1"}),"Información del Cliente"]})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{width:"30%",children:"Nombre:"}),e.jsx("td",{children:((M=t==null?void 0:t.sale)==null?void 0:M.fullname)||((P=t==null?void 0:t.sale)==null?void 0:P.name)||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:e.jsx("a",{href:`mailto:${(z=t==null?void 0:t.sale)==null?void 0:z.email}`,children:((O=t==null?void 0:t.sale)==null?void 0:O.email)||"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Teléfono:"}),e.jsx("td",{children:e.jsxs("a",{href:`tel:${(G=t==null?void 0:t.sale)==null?void 0:G.phone}`,children:[((Y=t==null?void 0:t.sale)==null?void 0:Y.phone_prefix)||"",((q=t==null?void 0:t.sale)==null?void 0:q.phone)||"N/A"]})})]}),(((V=t==null?void 0:t.sale)==null?void 0:V.documentType)||((X=t==null?void 0:t.sale)==null?void 0:X.document_type))&&e.jsxs("tr",{children:[e.jsx("th",{children:"Documento:"}),e.jsxs("td",{children:[((W=t==null?void 0:t.sale)==null?void 0:W.documentType)||((J=t==null?void 0:t.sale)==null?void 0:J.document_type),": ",((K=t==null?void 0:t.sale)==null?void 0:K.document)||"N/A"]})]}),((U=t==null?void 0:t.sale)==null?void 0:U.businessName)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Razón Social:"}),e.jsx("td",{children:(Q=t==null?void 0:t.sale)==null?void 0:Q.businessName})]}),((Z=t==null?void 0:t.sale)==null?void 0:Z.invoiceType)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante:"}),e.jsx("td",{className:"text-capitalize",children:(k=t==null?void 0:t.sale)==null?void 0:k.invoiceType})]}),((L=t==null?void 0:t.sale)==null?void 0:L.payment_method)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Método de Pago:"}),e.jsx("td",{className:"text-capitalize",children:(ee=t==null?void 0:t.sale)==null?void 0:ee.payment_method})]})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-bed-double mr-1"}),"Habitaciones Reservadas (",y.length||1,")"]})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Habitación"}),e.jsx("th",{children:"Check In"}),e.jsx("th",{children:"Check Out"}),e.jsx("th",{children:"Noches"}),e.jsx("th",{children:"Huéspedes"}),e.jsx("th",{children:"Precio/Noche"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:(y.length>0?y:[t]).map((s,a)=>{var l,m;if(!s)return null;const r=v(s.status);return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:((l=s.item)==null?void 0:l.name)||"N/A"}),e.jsx("div",{className:"small text-muted text-capitalize",children:((m=s.item)==null?void 0:m.room_type)||""})]}),e.jsxs("td",{children:[e.jsx("i",{className:"mdi mdi-calendar-arrow-right text-success mr-1"}),b(s.check_in)]}),e.jsxs("td",{children:[e.jsx("i",{className:"mdi mdi-calendar-arrow-left text-danger mr-1"}),b(s.check_out)]}),e.jsx("td",{className:"text-center",children:s.nights}),e.jsxs("td",{className:"text-center",children:[s.guests,e.jsxs("div",{className:"small text-muted",children:[s.adults||s.guests," adulto",(s.adults||s.guests)!==1?"s":"",s.children>0&&`, ${s.children} niño${s.children!==1?"s":""}`]})]}),e.jsxs("td",{className:"text-right",children:[C()," ",w(s.price_per_night||0)]}),e.jsx("td",{className:"text-right",children:e.jsxs("strong",{children:[C()," ",w(s.total_price||0)]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${r.badge}`,children:r.label})})]},a)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-calculator mr-1"}),"Resumen"]})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total Habitaciones:"}),e.jsx("span",{children:_.totalRooms})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total Noches:"}),e.jsx("span",{children:_.totalNights})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:[C()," ",w(_.totalAmount)]})})]})]})]}),((te=t==null?void 0:t.sale)==null?void 0:te.payment_proof)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-file-image mr-1"}),"Comprobante de Pago"]})}),e.jsx("div",{className:"card-body p-2 text-center",children:e.jsx(He,{content:"Ver comprobante de pago",placement:"top",children:e.jsx("a",{href:`/storage/images/sale/${t.sale.payment_proof}`,target:"_blank",children:e.jsx("img",{src:`/storage/images/sale/${t.sale.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"200px",cursor:"pointer"}})})})})]}),(t==null?void 0:t.special_requests)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-note-text mr-1"}),"Solicitudes Especiales"]})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("div",{className:"alert alert-light border mb-0",children:t.special_requests})})]}),((se=t==null?void 0:t.sale)==null?void 0:se.comment)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-comment-text mr-1"}),"Comentarios del Cliente"]})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("div",{className:"alert alert-info mb-0",children:t.sale.comment})})]}),(t==null?void 0:t.cancellation_reason)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2 bg-danger text-white",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-alert-circle mr-1"}),"Razón de Cancelación"]})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("div",{className:"alert alert-danger mb-0",children:t.cancellation_reason})})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-clipboard-check mr-1"}),"Estado del Pedido"]})}),e.jsxs("div",{className:"card-body p-2 position-relative",id:"statusSelectContainer",children:[E&&e.jsx("div",{className:"position-absolute d-flex align-items-center justify-content-center",style:{top:0,left:0,right:0,bottom:0,zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.125)",backdropFilter:"blur(2px)",cursor:"not-allowed"},children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),e.jsx(Fe,{label:"Estado actual",dropdownParent:"#statusSelectContainer",minimumResultsForSearch:-1,templateResult:H,templateSelection:H,onChange:be,value:(ae=t==null?void 0:t.sale)==null?void 0:ae.status_id,changeWith:[t],disabled:E||((le=(re=t==null?void 0:t.sale)==null?void 0:re.status)==null?void 0:le.reversible)==0,children:h.map((s,a)=>e.jsx("option",{value:s.id,"data-status":JSON.stringify(s),children:s.name},a))}),e.jsxs("div",{className:"form-check",style:{cursor:((ne=(ce=t==null?void 0:t.sale)==null?void 0:ce.status)==null?void 0:ne.reversible)==0?"not-allowed":"pointer"},children:[e.jsx("input",{ref:d,className:"form-check-input",type:"checkbox",id:"notifyClient",defaultChecked:!0,disabled:((oe=(ie=t==null?void 0:t.sale)==null?void 0:ie.status)==null?void 0:oe.reversible)==0,style:{cursor:((me=(de=t==null?void 0:t.sale)==null?void 0:de.status)==null?void 0:me.reversible)==0?"not-allowed":"pointer"}}),e.jsx("label",{className:"form-check-label",htmlFor:"notifyClient",style:{cursor:((ue=(he=t==null?void 0:t.sale)==null?void 0:he.status)==null?void 0:ue.reversible)==0?"not-allowed":"pointer"},children:"Notificar al cliente"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-history mr-1"}),"Historial de Estados"]})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:R.length>0?R.map((s,a)=>{const r=h.find(m=>m.id===s.status_id||m.name===s.name),l=(r==null?void 0:r.color)||s.color||"#333";return e.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:`${l}2e`},children:[e.jsx("i",{className:`${s.icon||(r==null?void 0:r.icon)||"mdi mdi-circle"} left-2`,style:{color:l,position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:l},children:s==null?void 0:s.name}),e.jsxs("small",{className:"d-block text-truncate",children:[s==null?void 0:s.user_name," ",s==null?void 0:s.user_lastname]}),e.jsx("small",{className:"d-block text-muted",children:moment(s.created_at).format("YYYY-MM-DD HH:mm")})]},a)}):e.jsxs("div",{className:"text-muted text-center py-2",children:[e.jsx("i",{className:"mdi mdi-information-outline mr-1"}),"Sin historial de estados"]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-calendar-check mr-1"}),"Estado de la Reserva"]})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Estado actual:"})," ",e.jsx("span",{className:`badge ${v(t==null?void 0:t.status).badge}`,children:v(t==null?void 0:t.status).label})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[(t==null?void 0:t.status)==="pending"&&e.jsxs("button",{type:"button",className:"btn btn-sm btn-success",onClick:()=>ve(t.id),children:[e.jsx("i",{className:"mdi mdi-check-circle mr-1"})," Confirmar"]}),(t==null?void 0:t.status)==="confirmed"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"btn btn-sm btn-info",onClick:()=>Ce(t.id),children:[e.jsx("i",{className:"mdi mdi-check-all mr-1"})," Completar"]}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-secondary",onClick:()=>ge(t.id),children:[e.jsx("i",{className:"mdi mdi-account-off mr-1"})," No Show"]})]}),["pending","confirmed"].includes(t==null?void 0:t.status)&&e.jsxs("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>we(t.id),children:[e.jsx("i",{className:"mdi mdi-close-circle mr-1"})," Cancelar"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"mdi mdi-clock-outline mr-1"}),"Información de Registro"]})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("table",{className:"table table-sm table-borderless mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Creado:"})}),e.jsx("td",{children:B(t==null?void 0:t.created_at)})]}),(t==null?void 0:t.confirmed_at)&&e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Confirmado:"})}),e.jsx("td",{children:B(t==null?void 0:t.confirmed_at)})]}),(t==null?void 0:t.cancelled_at)&&e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Cancelado:"})}),e.jsx("td",{children:B(t==null?void 0:t.cancelled_at)})]})]})})})]})]})]})})]})};De((h,n)=>{Be.createRoot(h).render(e.jsx(Re,{...n,title:"Reservas de Hotel",children:e.jsx(Me,{...n})}))});

import{c as e,j as a,r as t,s as o}from"./vendor-react-CtPXetfm.js";import{B as r}from"./Base-B2hVq4yw.js";import{C as n}from"./CreateReactScript-Cjoo020C.js";import{T as l}from"./Table-CR9fFUuq.js";import{R as i}from"./ReactAppend-RIOEhuYO.js";import{D as s}from"./DxButton-C6FT_beP.js";import{S as c}from"./CartKuchara-CLqHnhL7.js";import{P as d}from"./ProvidersRest-B54wmRuN.js";import{M as m}from"./Modal-CUkY7A3F.js";import{I as u}from"./InputFormGroup-CRGKsLQr.js";import{S as p}from"./SelectFormGroup-2ND56lst.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-coriRrmf.js";import"./TippyButton-Dqi9Vaf_.js";import"./Logout-DQyEsGXW.js";import"./MenuItemContainer-UDNHvqM7.js";import"./Menu-BjIZNCK0.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";import"./OpenPayCardModal-Dy4WIZ0X.js";import"./BasicRest-DpoFkM_z.js";const f=new d,v=({})=>{const e=t.useRef(),r=t.useRef(),n=t.useRef(),d=t.useRef(),v=t.useRef(),b=t.useRef(),x=t.useRef(),h=t.useRef(),g=t.useRef(),y=t.useRef(),j=t.useRef(),w=t.useRef(),C=t.useRef(),R=t.useRef(),[N,D]=t.useState(!1),T=e=>{D(!!e?.id),d.current.value=e?.id??"",v.current.value=e?.name??"",b.current.value=e?.lastname??"",x.current.value=e?.email??"",h.current.value="",g.current.value="",y.current.value=e?.phone??"";const a=e?.phone_prefix??"+51";j.current.value=a,$(j.current).val(a).trigger("change"),w.current.value=e?.dni??e?.document_number??"",C.current&&(C.current.value="Provider"),$(r.current).modal("show")},S=async({id:a,value:t})=>{const{isConfirmed:o}=await c.fire({title:t?"Activar proveedor":"Desactivar proveedor",text:`¿Estás seguro de ${t?"activar":"desactivar"} este proveedor?`,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar"});if(!o)return void $(e.current).dxDataGrid("instance").refresh();await f.boolean({id:a,field:"status",value:t})&&$(e.current).dxDataGrid("instance").refresh()};return a.jsxs(a.Fragment,{children:[a.jsx(l,{gridRef:e,title:"Proveedores",rest:f,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"email",text:"Invitar proveedor",type:"default",stylingMode:"contained",hint:"Enviar invitación por correo",onClick:()=>(R.current.value="",void $(n.current).modal("show"))}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo proveedor",hint:"Crear nuevo proveedor",onClick:()=>T()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Proveedor",width:"25%",cellTemplate:(e,{data:t})=>{i(e,a.jsxs("div",{children:[a.jsxs("strong",{children:[t.name," ",t.lastname||""]}),a.jsx("br",{}),a.jsx("small",{className:"text-muted",children:t.email}),a.jsx("br",{}),a.jsx("span",{className:"badge badge-soft-primary",style:{fontSize:"10px"},children:t.uuid})]}))}},{dataField:"phone",caption:"Teléfono",cellTemplate:(e,{data:t})=>{t.phone?i(e,a.jsxs("span",{children:[t.phone_prefix||"+51"," ",t.phone]})):i(e,a.jsx("span",{className:"text-muted",children:"- Sin teléfono -"}))}},{dataField:"document_number",caption:"Documento",cellTemplate:(e,{data:t})=>{t.document_number?i(e,a.jsx("div",{children:a.jsxs("span",{children:[t.document_type||"DOC",":"," ",t.document_number]})})):i(e,a.jsx("span",{className:"text-muted",children:"- Sin documento -"}))}},{dataField:"city",caption:"Ubicación",cellTemplate:(e,{data:t})=>{const o=[t.city,t.department].filter(Boolean).join(", ");i(e,o?a.jsx("span",{children:o}):a.jsx("span",{className:"text-muted",children:"- Sin ubicación -"}))}},{dataField:"created_at",caption:"Registro",dataType:"date",cellTemplate:(e,{data:t})=>{const r=new Date(t.created_at);e.html(o.renderToString(a.jsxs(a.Fragment,{children:[a.jsx("div",{children:r.toLocaleDateString("es-ES")}),a.jsx("small",{className:"text-muted",children:r.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})))}},{dataField:"status",caption:"Estado",dataType:"boolean",width:"120px",cellTemplate:(e,{data:t})=>{1==t.status?i(e,a.jsx("span",{className:"badge badge-success",children:"Activo"})):i(e,a.jsx("span",{className:"badge badge-secondary",children:"Archivado"}))}},{caption:"Acciones",cellTemplate:(a,{data:t})=>{a.css("text-overflow","unset"),a.append(s({className:"btn btn-xs btn-soft-info",title:"Ver detalles",icon:"fa fa-eye",onClick:()=>(e=>{const a=new Date(e.created_at),t=a.toLocaleDateString("es-ES")+" "+a.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});c.fire({title:"Detalles del Proveedor",html:`\n        <div style="text-align: left; max-width: 100%;">\n          <form style="padding: 20px 0;">\n            <div class="row">\n              \n              \x3c!-- Columna Izquierda --\x3e\n              <div class="col-md-6">\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Nombre Completo</label>\n                  <input type="text" class="form-control" value="${e.name} ${e.lastname||""}" readonly style="background-color: #f8f9fa;">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Email</label>\n                  <input type="email" class="form-control" value="${e.email||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Teléfono</label>\n                  <input type="text" class="form-control" value="${e.phone?(e.phone_prefix||"+51")+" "+e.phone:""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                 <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Código de Referido (UUID)</label>\n                  <input type="text" class="form-control" value="${e.uuid||""}" readonly style="background-color: #f8f9fa;" placeholder="No generado">\n                </div>\n\n                ${e.alternate_phone?`\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Teléfono Alternativo</label>\n                  <input type="text" class="form-control" value="${e.alternate_phone}" readonly style="background-color: #f8f9fa;">\n                </div>\n                `:""}\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Tipo de Documento</label>\n                  <input type="text" class="form-control" value="${e.document_type||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n              </div>\n              \n              \x3c!-- Columna Derecha --\x3e\n              <div class="col-md-6">\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Número de Documento</label>\n                  <input type="text" class="form-control" value="${e.document_number||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Dirección</label>\n                  <input type="text" class="form-control" value="${e.address||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificada">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Distrito</label>\n                  <input type="text" class="form-control" value="${e.district||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Provincia</label>\n                  <input type="text" class="form-control" value="${e.province||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Departamento</label>\n                  <input type="text" class="form-control" value="${e.department||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n              </div>\n              \n              \x3c!-- Fila completa para campos adicionales --\x3e\n              <div class="col-12">\n                ${e.reference?`\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Referencia</label>\n                  <textarea class="form-control" readonly style="background-color: #f8f9fa; resize: none;" rows="2">${e.reference}</textarea>\n                </div>\n                `:""}\n                \n                <div class="row">\n                  <div class="col-md-6">\n                    <div class="form-group mb-3">\n                      <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Estado</label>\n                      <input type="text" class="form-control ${1==e.status?"border-success":"border-danger"}" \n                             value="${1==e.status?"Activo":"Inactivo"}" readonly \n                             style="background-color: ${1==e.status?"#d4edda":"#f8d7da"}; \n                                    color: ${1==e.status?"#155724":"#721c24"}; \n                                    font-weight: 600;">\n                    </div>\n                  </div>\n                  <div class="col-md-6">\n                    <div class="form-group mb-3">\n                      <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Fecha de Registro</label>\n                      <input type="text" class="form-control" value="${t}" readonly style="background-color: #f8f9fa;">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n            </div>\n          </form>\n        </div>\n      `,width:"800px",showConfirmButton:!0,confirmButtonText:"Cerrar",confirmButtonColor:"#6c757d",allowOutsideClick:!0,allowEscapeKey:!0,customClass:{popup:"client-details-modal"},didOpen:()=>{const e=document.createElement("style");e.innerHTML="\n          .client-details-modal {\n            border-radius: 8px !important;\n          }\n          .client-details-modal .swal2-title {\n            color: #495057 !important;\n            font-size: 1.5rem !important;\n            font-weight: 600 !important;\n            margin-bottom: 10px !important;\n          }\n          .client-details-modal .swal2-html-container {\n            margin: 0 !important;\n            padding: 0 20px 20px 20px !important;\n          }\n          .client-details-modal .form-control:read-only {\n            cursor: default !important;\n          }\n          .client-details-modal .form-label {\n            font-size: 0.9rem !important;\n          }\n        ",document.head.appendChild(e)}})})(t)})),1!=t.status&&a.append(s({className:"btn btn-xs btn-soft-success",title:"Restaurar (Activar)",icon:"fa fa-check",onClick:()=>S({id:t.id,value:!0})})),a.append(s({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>T(t)})),a.append(s({className:"btn btn-xs "+(1==t.status?"btn-soft-warning":"btn-soft-danger"),title:1==t.status?"Archivar":"Eliminar permanentemente",icon:1==t.status?"fa fa-archive":"fa fa-trash",onClick:async()=>{if(1==t.status){const{isConfirmed:e}=await c.fire({title:"¿Archivar Proveedor?",text:"El proveedor se desactivará y pasará a estado 'Archivado'.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, archivar",cancelButtonText:"Cancelar"});e&&S({id:t.id,value:!1})}else(async a=>{const{isConfirmed:t}=await c.fire({title:"Eliminar proveedor",text:"¿Estás seguro de eliminar este proveedor?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!t)return;await f.delete(a)&&$(e.current).dxDataGrid("instance").refresh()})(t.id)}}))},allowFiltering:!1,allowExporting:!1}]}),a.jsx(m,{modalRef:r,title:N?"Editar proveedor":"Crear nuevo proveedor",onSubmit:async a=>{if(a.preventDefault(),!N||h.current.value){if(h.current.value!==g.current.value)return void c.fire({title:"Error",text:"Las contraseñas no coinciden",icon:"error"});if(h.current.value.length<6)return void c.fire({title:"Error",text:"La contraseña debe tener al menos 6 caracteres",icon:"error"})}const t={id:d.current.value||void 0,name:v.current.value,lastname:b.current.value,email:x.current.value,phone:y.current.value,phone_prefix:j.current.value,dni:w.current.value,role:"Provider"};h.current.value&&(t.password=h.current.value);await f.save(t)&&($(e.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"))},size:"lg",children:a.jsxs("div",{className:"row",id:"principal-container",children:[a.jsx("input",{ref:d,type:"hidden"}),a.jsx(u,{eRef:v,label:"Nombres",col:"col-md-6",required:!0}),a.jsx(u,{eRef:b,label:"Apellidos",col:"col-md-6",required:!0}),a.jsx(u,{eRef:x,label:"Correo electrónico",type:"email",col:"col-md-6",required:!0}),a.jsx(u,{eRef:w,label:"DNI / Documento",col:"col-md-6"}),a.jsx("div",{className:"col-md-3",children:a.jsxs(p,{eRef:j,label:"Prefijo",required:!0,dropdownParent:"#principal-container",children:[a.jsx("option",{value:"+51",children:"+51 (Perú)"}),a.jsx("option",{value:"+1",children:"+1 (EE.UU.)"}),a.jsx("option",{value:"+34",children:"+34 (España)"}),a.jsx("option",{value:"+52",children:"+52 (México)"}),a.jsx("option",{value:"+57",children:"+57 (Colombia)"})]})}),a.jsx(u,{eRef:y,label:"Teléfono",type:"tel",col:"col-md-9"}),a.jsx("input",{type:"hidden",ref:C,value:"Provider"}),a.jsxs("div",{className:"col-12",children:[a.jsx("hr",{}),a.jsx("h6",{children:N?"Cambiar contraseña (opcional)":"Contraseña"})]}),a.jsx(u,{eRef:h,label:N?"Nueva contraseña":"Contraseña",type:"password",col:"col-md-6",required:!N,placeholder:N?"Dejar vacío para mantener la actual":""}),a.jsx(u,{eRef:g,label:"Confirmar contraseña",type:"password",col:"col-md-6",required:!N})]})}),a.jsx(m,{modalRef:n,title:"Invitar proveedor",onSubmit:async e=>{e.preventDefault();const a=R.current.value;await f.invite({email:a})&&(c.fire({title:"Éxito",text:"Se ha enviado la invitación correctamente",icon:"success"}),$(n.current).modal("hide"))},children:a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-12 mb-4",children:a.jsx("p",{className:"text-muted",children:"Ingresa el correo electrónico de la persona que deseas invitar. Recibirá un enlace único para completar su registro como proveedor."})}),a.jsx(u,{eRef:R,label:"Correo electrónico",type:"email",col:"col-12",required:!0})]})})]})};n((t,o)=>{e.createRoot(t).render(a.jsx(r,{...o,title:"Proveedores",children:a.jsx(v,{...o})}))});

import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as p}from"./index-BOnQTV8N.js";import{S as w}from"./CartKuchara-CVImXKD8.js";import{I as v}from"./ImageFormGroup-40MuGzez.js";import{P as B}from"./plus-CTIomuuF.js";import{I as E}from"./image-BPmHvEaV.js";import{M as I,a as _}from"./move-up-Gz4AiwKb.js";import{T as C}from"./trash-2-DU7LB6-f.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./createLucideIcon-DfjclApS.js";const k=p.forwardRef(({name:h="banners",label:b="Banners",initialValue:A=[],model:R="category"},j)=>{const[l,d]=p.useState([]),[c,u]=p.useState({}),a=p.useRef({});p.useImperativeHandle(j,()=>({getValue:()=>JSON.stringify(l),setValue:e=>{console.log("BannersJsonEditor.setValue called with:",e,"type:",typeof e);try{const t=typeof e=="string"?JSON.parse(e):e;if(console.log("Parsed value:",t,"is array:",Array.isArray(t)),d(Array.isArray(t)?t:[]),console.log("setBanners called, should trigger re-render"),Array.isArray(t)&&t.length>0){const n={};t.forEach((r,i)=>{n[i]=!0}),u(n)}}catch(t){console.error("Error setting banners:",t),d([])}},reset:()=>{d([]),a.current={}},getImageRefs:()=>a.current,getImageFiles:()=>{const e={};return console.log("getImageFiles - imageRefs.current:",a.current),Object.keys(a.current).forEach(t=>{var r,i;const n=a.current[t];console.log(`getImageFiles - index ${t}:`,n),(i=(r=n==null?void 0:n.current)==null?void 0:r.files)!=null&&i[0]&&(e[`banner_image_${t}`]=n.current.files[0],console.log(`getImageFiles - Added file for banner_image_${t}:`,n.current.files[0].name))}),console.log("getImageFiles - Final files object:",e),e}}));const x=()=>{const e={image:"",title:"",description:"",button_text:"",button_link:""},t=[...l,e];d(t),u({...c,[t.length-1]:!0}),a.current[t.length-1]={current:null}},N=async e=>{const{isConfirmed:t}=await w.fire({title:"¿Eliminar banner?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(t){const n=l.filter((m,o)=>o!==e);d(n),delete a.current[e];const r={};Object.keys(a.current).forEach(m=>{const o=parseInt(m);o>e?r[o-1]=a.current[m]:o<e&&(r[o]=a.current[m])}),a.current=r;const i={};Object.keys(c).forEach(m=>{const o=parseInt(m);o<e?i[o]=c[m]:o>e&&(i[o-1]=c[m])}),u(i)}},f=(e,t)=>{const n=t==="up"?e-1:e+1;if(n<0||n>=l.length)return;const r=[...l];[r[e],r[n]]=[r[n],r[e]],d(r);const i=a.current[e];a.current[e]=a.current[n],a.current[n]=i;const m=c[e],o=c[n];u({...c,[e]:o,[n]:m})},g=(e,t,n)=>{const r=[...l];r[e]={...r[e],[t]:n},d(r)},y=e=>{u({...c,[e]:!c[e]})};return s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"font-weight-bold mb-2",children:b}),s.jsxs("div",{className:"border rounded p-3 bg-light",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[s.jsxs("small",{className:"text-muted",children:[l.length," banner",l.length!==1?"s":""," configurado",l.length!==1?"s":""]}),s.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:x,children:[s.jsx(B,{size:16,className:"mr-1"}),"Agregar Banner"]})]}),l.length===0?s.jsxs("div",{className:"text-center py-4 text-muted",children:[s.jsx(E,{size:48,className:"mb-2 opacity-50",style:{display:"block",margin:"0 auto"}}),s.jsx("p",{className:"mb-0",children:"No hay banners configurados"}),s.jsx("small",{children:'Haz clic en "Agregar Banner" para comenzar'})]}):s.jsx("div",{className:"space-y-2",children:l.map((e,t)=>s.jsxs("div",{className:"card mb-2 shadow-sm",children:[s.jsxs("div",{className:"card-header bg-white d-flex justify-content-between align-items-center p-2",children:[s.jsxs("button",{type:"button",className:"btn btn-link text-left flex-grow-1 text-decoration-none p-2",onClick:()=>y(t),children:[s.jsxs("strong",{children:["Banner ",t+1]}),e.title&&s.jsxs("small",{className:"text-muted ml-2",children:["- ",e.title]})]}),s.jsxs("div",{className:"d-flex gap-1",children:[t>0&&s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>f(t,"up"),title:"Mover arriba",children:s.jsx(I,{size:14})}),t<l.length-1&&s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>f(t,"down"),title:"Mover abajo",children:s.jsx(_,{size:14})}),s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>N(t),title:"Eliminar",children:s.jsx(C,{size:14})})]})]}),c[t]&&s.jsx("div",{className:"card-body p-3",children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx(v,{eRef:(a.current[t]||(a.current[t]={current:null}),a.current[t]),name:`banner_image_${t}`,label:"Imagen del Banner",col:"col-12",aspect:16/9,onChange:n=>{if(n.target.files&&n.target.files[0]){const r=n.target.files[0];g(t,"image",r.name)}}}),e.image&&s.jsxs("small",{className:"text-muted d-block mt-2",children:["Archivo actual: ",s.jsx("strong",{children:e.image})]})]}),s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"font-weight-semibold small",children:"Título"}),s.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Título del banner",value:e.title||"",onChange:n=>g(t,"title",n.target.value)})]}),s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"font-weight-semibold small",children:"Descripción"}),s.jsx("textarea",{className:"form-control form-control-sm",rows:"3",placeholder:"Descripción del banner",value:e.description||"",onChange:n=>g(t,"description",n.target.value)})]}),s.jsxs("div",{className:"col-md-6 mb-3",children:[s.jsx("label",{className:"font-weight-semibold small",children:"Texto del Botón"}),s.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Ver más",value:e.button_text||"",onChange:n=>g(t,"button_text",n.target.value)})]}),s.jsxs("div",{className:"col-md-6 mb-3",children:[s.jsx("label",{className:"font-weight-semibold small",children:"Link del Botón"}),s.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"/ruta-destino",value:e.button_link||"",onChange:n=>g(t,"button_link",n.target.value)})]})]})})]},`banner-${t}-${e.image||"new"}`))})]}),s.jsx("input",{type:"hidden",name:h,value:JSON.stringify(l)})]})});k.displayName="BannersJsonEditor";

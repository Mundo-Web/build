var H=Object.defineProperty;var I=(n,i,c)=>i in n?H(n,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[i]=c;var R=(n,i,c)=>I(n,typeof i!="symbol"?i+"":i,c);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{r as f}from"./index-BOnQTV8N.js";import{F as m,h as D}from"./CreateReactScript-BSTb2hiI.js";import{M as P}from"./Modal-BYL-UsqM.js";import{m as T}from"./main-B6F2O9-U.js";import{t as B,T as U}from"./CardProductKatya-ncpmQ0JU.js";import{B as E}from"./BooleanLimit-D-OsQsek.js";class K{constructor(){R(this,"save",async(i,c)=>{try{const{status:l,result:p}=await T.Fetch(`/api/admin/fillable/${i}`,{method:"POST",body:JSON.stringify(c)});if(!l)throw new Error((p==null?void 0:p.message)??"Ocurrió un error inesperado");return p.data??!0}catch(l){return B.error("¡Error!",{description:l.message,duration:3e3,position:"bottom-center",richColors:!0}),null}})}}class Q{constructor(){R(this,"save",async(i=[])=>{try{const{status:c,result:l}=await T.Fetch("/api/admin/boolean-limits",{method:"POST",body:JSON.stringify({limits:i})});if(!c)throw new Error((l==null?void 0:l.message)??"Ocurrió un error inesperado");return B.success("¡Excelente!",{description:(l==null?void 0:l.message)??"Límites actualizados correctamente",duration:3e3,position:"bottom-center",richColors:!0}),(l==null?void 0:l.data)??!0}catch(c){return B.error("¡Error!",{description:c.message,duration:3e3,position:"bottom-center",richColors:!0}),!1}})}}const V=new K,X=new Q,Y=({gridRef:n,pageSize:i=10,rest:c,columns:l,toolBar:p,masterDetail:v,filterValue:y,exportable:j,exportableName:w,customizeCell:k=()=>{},onRefresh:C=()=>{},rowDragging:N,sorting:S})=>{const h=f.useRef(),x=f.useRef(),[L,F]=f.useState(!1),[d,_]=f.useState(m.models[0]??null),[A,M]=f.useState(!1),[b,g]=f.useState([]),G=()=>{if(!d)return;const e=E.list(d);e.length&&(g(e.map(a=>({field:a.field,label:a.label??a.field,max:typeof a.max=="number"?a.max:"",message:a.message??"",general_key:a.general_key,model:d}))),$(x.current).modal("show"))},O=(e,a)=>{g(o=>o.map((s,r)=>r===e?{...s,...a}:s))},J=async e=>{var s;if(e.preventDefault(),!b.length){$(x.current).modal("hide");return}const a=b.filter(r=>r.general_key).map(r=>{var u;return{model:r.model??d,field:r.field,general_key:r.general_key,max:Number(r.max===""?0:r.max),message:((u=r.message)==null?void 0:u.trim())??null,label:r.label}});M(!0);const o=await X.save(a);M(!1),o&&((s=o==null?void 0:o.limits)!=null&&s.length&&(E.bulkUpdate(d,o.limits),g(o.limits.map(({field:r,limit:u})=>{var z;return{field:r,label:u.label??r,max:typeof u.max=="number"?u.max:"",message:u.message??"",general_key:u.general_key??((z=a.find(q=>q.field===r))==null?void 0:z.general_key),model:d}}))),$(x.current).modal("hide"))},W=async e=>{e.preventDefault();const a=document.querySelectorAll(`input[type="checkbox"][id^="fillable-ck-${d}"]`),o=Array.from(a).reduce((r,u)=>(r[u.value]=u.checked,r),{});F(!0);const s=await V.save(d,o);F(!1),s&&m.set(d,s)};return f.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(n.current).dxDataGrid({language:"es",dataSource:{load:async e=>{const a=await c.paginate({...e,requireTotalCount:!0});return C(a),a}},onToolbarPreparing:e=>{const{items:a}=e.toolbarOptions;D("Root")&&E.list(d).length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-shield-account",hint:"Configurar límites",text:"Límites",onClick:G}}),D("Root")&&m.models.length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-cog",hint:"Configurar campos",text:"Configurar",onClick:()=>$(h.current).modal("show")}}),p(a)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:y,export:{enabled:j},onExporting:function(e){var a=new ExcelJS.Workbook,o=a.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:o,component:e.component,customizeCell:function(s){k(s),s.excelCell.alignment={horizontal:"left",vertical:"top",...s.excelCell.alignment}},includeHiddenColumns:!0}).then(function(){a.xlsx.writeBuffer().then(function(s){saveAs(new Blob([s],{type:"application/octet-stream"}),`${w}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:i},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:l,masterDetail:v,rowDragging:N,sorting:S,onContentReady:(...e)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),t.jsxs(t.Fragment,{children:[t.jsx(U,{}),t.jsx("div",{ref:n}),t.jsxs(P,{modalRef:h,title:"Configurar campos visibles",onSubmit:W,onClose:()=>{m.models.forEach(e=>{Object.keys(m.values[e]).forEach(a=>{const o=document.getElementById(`fillable-ck-${e}-${a}`);o&&(o.checked=m.values[e][a])})})},loading:L,children:[t.jsx("ul",{class:"nav nav-tabs nav-bordered",children:m.models.map((e,a)=>t.jsx("li",{class:"nav-item",children:t.jsx("button",{href:`#fillable-${e}`,"data-bs-toggle":"tab","aria-expanded":"false",class:`nav-link ${d==e&&"active"}`,onClick:()=>_(e),disabled:L,type:"button",children:e})},a))}),t.jsx("div",{class:"tab-content",style:{minHeight:"240px"},children:m.models.map((e,a)=>t.jsx("div",{class:`tab-pane ${d==e&&"active"}`,id:`fillable-${e}`,children:t.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:Object.keys(m.values[e]).map((o,s)=>t.jsxs("label",{class:"form-check form-check-success border cursor-pointer",htmlFor:`fillable-ck-${e}-${o}`,style:{padding:"2px 10px 2px 30px",borderRadius:"8px",userSelect:"none"},children:[t.jsx("input",{class:"form-check-input cursor-pointer",type:"checkbox",value:o,id:`fillable-ck-${e}-${o}`,defaultChecked:m.values[e][o]}),t.jsx("span",{class:"form-check-label",children:o})]},s))})},a))})]}),t.jsxs(P,{modalRef:x,title:"Configurar límites",onSubmit:J,loading:A,onClose:()=>g([]),children:[!b.length&&t.jsx("p",{className:"text-muted mb-0",children:"No hay límites configurados para este módulo."}),b.map((e,a)=>t.jsxs("div",{className:"row g-2 align-items-center mb-3",children:[t.jsx("div",{className:"col-md-12",children:t.jsx("label",{className:"form-label mb-0",children:e.label})}),t.jsx("div",{className:"col-md-3",children:t.jsx("input",{type:"number",min:"0",className:"form-control",value:e.max===""?"":e.max,onChange:o=>{const s=o.target.value;O(a,{max:s===""?"":Number(s)})}})}),t.jsx("div",{className:"col-md-9",children:t.jsx("input",{type:"text",className:"form-control",value:e.message??"",onChange:o=>O(a,{message:o.target.value}),placeholder:"Mensaje personalizado (opcional)"})})]},e.field))]})]})},ne=({title:n,gridRef:i,pageSize:c,rest:l,columns:p,toolBar:v,masterDetail:y,filterValue:j=[],onRefresh:w,exportable:k,exportableName:C,customizeCell:N=()=>{},rowDragging:S,sorting:h})=>t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[typeof n=="object"?t.jsx("div",{className:"card-header",children:n}):"",t.jsxs("div",{className:"card-body",children:[typeof n!="object"?t.jsxs("h4",{className:"header-title",children:[t.jsx("div",{id:"header-title-options",className:"float-end"}),t.jsx("span",{id:"header-title-prefix"})," Lista de ",n," ",t.jsx("span",{id:"header-title-suffix"})]}):"",t.jsx(Y,{gridRef:i,rest:l,pageSize:c,columns:p.filter(Boolean),toolBar:v,masterDetail:y,filterValue:j,onRefresh:w,exportable:k,exportableName:C,customizeCell:N,rowDragging:S,sorting:h})]})]})})});export{ne as T};

import{c as g}from"./createLucideIcon-DfjclApS.js";import{r as p}from"./index-BOnQTV8N.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=g("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),m=()=>{const a=p.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),s=(t,e={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[t],content_type:"product",content_name:e.name||"",value:e.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:e.price||0,items:[{item_id:t,item_name:e.name||"",category:e.category||"",price:e.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:t,content_type:"product",content_name:e.name||"",value:e.price||0,currency:"PEN"}),console.log("âœ… ProductView tracked for product:",t))},d=async(t,e=1,r={})=>{var n;if(!(typeof window>"u"))try{const c=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)||""},body:JSON.stringify({product_id:t,quantity:e,...r})})).json();c.success&&c.tracking_scripts&&(i(c.tracking_scripts),console.log("âœ… AddToCart tracked successfully"))}catch(o){console.error("âŒ Error tracking AddToCart:",o)}},u=async(t,e)=>{var r;if(!(typeof window>"u"||a.current.hasTrackedInitiateCheckout))try{a.current.hasTrackedInitiateCheckout=!0;const o=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)||""},body:JSON.stringify({cart_items:t.map(c=>({product_id:c.id,name:c.name,price:c.final_price||c.price,quantity:c.quantity,subtotal:(c.final_price||c.price)*c.quantity}))})})).json();o.success&&o.tracking_scripts&&(i(o.tracking_scripts),console.log("âœ… InitiateCheckout tracked successfully"))}catch(n){console.error("âŒ Error tracking InitiateCheckout:",n),a.current.hasTrackedInitiateCheckout=!1}},l=(t,e)=>{if(!(typeof window>"u")){console.log("ðŸŽ¯ Iniciando tracking de compra:",{orderId:t,conversionScripts:e});try{e?(console.log("ðŸ“Š Usando scripts de conversiÃ³n del servidor"),i(e)):(console.log("ðŸ”„ Obteniendo scripts de conversiÃ³n del API"),fetch(`/api/tracking/purchase/${t}`).then(r=>r.text()).then(r=>{r&&(i(r),console.log("âœ… Purchase tracked successfully"))}).catch(r=>{console.error("âŒ Error tracking Purchase:",r)}))}catch(r){console.error("âŒ Error general en trackPurchase:",r)}}},f=(t,e=[])=>{if(typeof window>"u"||a.current.hasTrackedPageView)return;a.current.hasTrackedPageView=!0;const r=e.reduce((n,o)=>n+(o.final_price||o.price)*o.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),t===1&&e.length>0&&window.fbq("track","AddToCart",{content_ids:e.map(n=>n.id),content_type:"product",value:r,currency:"PEN",num_items:e.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${t}`,page_location:window.location.href}),t===1&&e.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:r,items:e.map(n=>{var o;return{item_id:n.id,item_name:n.name,category:((o=n.category)==null?void 0:o.name)||"Sin categorÃ­a",quantity:n.quantity,price:n.final_price||n.price}})})),console.log(`âœ… Checkout PageView tracked - Step ${t}`)},i=t=>{if(typeof window>"u"||!t)return;console.log("ðŸŽ¯ Ejecutando scripts de tracking:",t);const e=document.createElement("div");e.innerHTML=t,e.querySelectorAll("script").forEach((n,o)=>{try{const c=document.createElement("script");c.textContent=n.textContent,console.log(`ðŸ“Š Ejecutando script de tracking ${o+1}:`,n.textContent.trim()),document.head.appendChild(c),setTimeout(()=>{c.parentNode&&c.parentNode.removeChild(c)},100),console.log(`âœ… Script de tracking ${o+1} ejecutado exitosamente`)}catch(c){console.error(`âŒ Error ejecutando script de tracking ${o+1}:`,c),console.error("Script content:",n.textContent)}}),console.log("ðŸŽ¯ Todos los scripts de tracking procesados")};return{trackProductView:s,trackAddToCart:d,trackInitiateCheckout:u,trackPurchase:l,trackCheckoutPageView:f,resetTracking:()=>{a.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};export{y as O,m as u};

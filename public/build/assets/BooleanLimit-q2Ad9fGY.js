var t,e=Object.defineProperty;class a{static hydrate(t={}){if(t&&"object"==typeof t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&this.set(e,t[e])}static ensureModel(t){this.registry[t]||(this.registry[t]={})}static set(t,e={}){if(t&&"string"==typeof t&&e){this.ensureModel(t);for(const a in e){if(!Object.prototype.hasOwnProperty.call(e,a))continue;const i=e[a]||{},r=this.registry[t][a]||{},s={...r,...i};if("number"!=typeof s.max){const t=Number(s.max??i.max??r.max??0);s.max=Number.isNaN(t)?0:t}if("number"!=typeof s.active){const t=Number(i.active??r.active??0);s.active=Number.isNaN(t)?0:t}"number"==typeof s.max&&"number"==typeof s.active&&(s.remaining=Math.max(0,s.max-s.active)),this.registry[t][a]=s}}}static list(t){if(!t)return[];const e=this.registry?.[t]??{};return Object.keys(e).map(t=>({field:t,...e[t]}))}static get(t,e){return t&&e?this.registry?.[t]?.[e]??null:null}static has(t,e){return Boolean(this.get(t,e))}static canEnable(t,e,a=!1){const i=this.get(t,e);return!i||(!!a||("number"!=typeof i.max||i.max<=0||("number"!=typeof i.active||i.active<i.max)))}static shouldBlock(t,e,a=!1){return!this.canEnable(t,e,a)}static getMessage(t,e){return this.get(t,e)?.message??null}static updateFromServer(t,e){if(!t||!e)return;const{field:a,limit:i}=e;if(!a||!i)return;this.ensureModel(t);const r=this.registry[t][a]||{},s={...r,...i};if("number"!=typeof s.max){const t=Number(s.max??i.max??r.max??0);s.max=Number.isNaN(t)?0:t}if("number"!=typeof s.active){const t=Number(i.active??r.active??0);s.active=Number.isNaN(t)?0:t}"number"==typeof s.max&&"number"==typeof s.active&&(s.remaining=Math.max(0,s.max-s.active)),this.registry[t][a]=s}static bulkUpdate(t,e=[]){t&&Array.isArray(e)&&(this.ensureModel(t),e.forEach(({field:e,limit:a})=>{if(!e||!a)return;const i=this.registry[t][e]||{},r={...i,...a};if("number"!=typeof r.max){const t=Number(r.max??a.max??i.max??0);r.max=Number.isNaN(t)?0:t}if("number"!=typeof r.active){const t=Number(a.active??i.active??0);r.active=Number.isNaN(t)?0:t}"number"==typeof r.max&&"number"==typeof r.active&&(r.remaining=Math.max(0,r.max-r.active)),this.registry[t][e]=r}))}static applyChange(t,e,{previous:a,next:i}){const r=this.get(t,e);r&&"number"==typeof r.max&&("number"!=typeof r.active&&(r.active=0),a!==i&&(i?r.active=Math.min(r.max,r.active+1):a&&(r.active=Math.max(0,r.active-1)),r.remaining=Math.max(0,r.max-r.active)))}static remaining(t,e){const a=this.get(t,e);return a?"number"==typeof a.remaining?a.remaining:"number"==typeof a.max&&"number"==typeof a.active?Math.max(0,a.max-a.active):null:null}}((t,a,i)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i})(a,"symbol"!=typeof(t="registry")?t+"":t,{});export{a as B};

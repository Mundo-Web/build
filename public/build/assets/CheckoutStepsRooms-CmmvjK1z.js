var ns=Object.defineProperty;var ls=(x,l,i)=>l in x?ns(x,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):x[l]=i;var de=(x,l,i)=>ls(x,typeof l!="symbol"?l+"":l,i);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BOnQTV8N.js";import{R as me}from"./PolicyModal-C80IvD61.js";import{H as is}from"./HtmlContent-ghmllTyl.js";import{C as R,N as O}from"./Number2Currency-jIsa99f9.js";import{U as re}from"./users-w-WaEtvX.js";import{M as ue}from"./moon-BU5XInRR.js";import{c as os}from"./createLucideIcon-DfjclApS.js";import{C as se}from"./calendar-BSC6xbA7.js";import{X as ge}from"./x-fof_H3Vv.js";import{f as we}from"./format-B6vr9H0z.js";import{e as Ce}from"./es-QTeD0CGG.js";import{S as he}from"./shield-check-Ch9bgmMr.js";import{C as Oe}from"./clock-BLXQcN-l.js";import{A as cs}from"./award-M5cUojD6.js";import{O as ds,p as ms,a as xs}from"./OpenPayCardModal-n1KG45qI.js";import{C as ps,p as hs,B as us}from"./culqiPayment-BOuHXhF8.js";import{G as w}from"./General-apRuNwp7.js";import{G as D}from"./Global-Bz6gVLc5.js";import{m as X}from"./main-B6F2O9-U.js";import{t as V}from"./CardProductKatya-ncpmQ0JU.js";import{U as Le}from"./upload-GO9GDST_.js";import{C as J}from"./circle-x-5vreeYph.js";import{B as Ae}from"./building-2-DSFvhCB-.js";import{C as ze}from"./check-D5vaIe6v.js";import{C as Ie}from"./copy-BnGV3h9k.js";import{S as gs}from"./react-select.esm-H4wpMl-h.js";import{C as fs}from"./credit-card-MgdEzS7h.js";import{C as ae}from"./circle-check-big-CYWUGR3Z.js";import{U as bs}from"./user-round-x-C2OImLTZ.js";import{M as ve}from"./mail-drJGpT4k.js";import{P as ys}from"./phone-ZNY-sPqk.js";import{M as js}from"./map-pin-Cj3PUWlD.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./index-Chjiymov.js";import"./loader-circle-CSFYLd5m.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./index-pSueRYGM.js";import"./useStateManager-7e1e8489.esm-C6DnWqDr.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./floating-ui.dom-CID5cQpR.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=os("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),vs=({setCart:x,...l})=>{const i=()=>{x(a=>a.filter(d=>d.id!==l.id||d.checkIn!==l.checkIn))},f=a=>{if(!a)return"";try{const d=new Date(a);return we(d,"dd 'de' MMMM",{locale:Ce})}catch{return a}},j=l.final_price||l.price,M=l.nights||1,r=j*M,o=l.guests||2,L=a=>({standard:"Estándar",suite:"Suite",deluxe:"Deluxe",presidential:"Presidencial",family:"Familiar",executive:"Ejecutiva",single:"Individual",double:"Doble"})[a]||a;return e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300 font-paragraph",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"md:w-64 h-48 md:h-auto relative flex-shrink-0",children:[e.jsx("img",{src:`/storage/images/item/${l.image}`,alt:l.name,className:"w-full h-full object-cover",onError:a=>a.target.src="/assets/img/noimage/no_img.jpg"}),l.room_type&&e.jsx("div",{className:"absolute top-3 left-3 bg-white/95 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-semibold text-gray-700 shadow-md",children:L(l.room_type)})]}),e.jsxs("div",{className:"flex-1 p-5 md:p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-900 mb-2",children:l.name}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(re,{size:16,className:"text-blue-600"}),e.jsxs("span",{children:[o," ",o===1?"huésped":"huéspedes"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ue,{size:16,className:"text-indigo-600"}),e.jsxs("span",{children:[M," ",M===1?"noche":"noches"]})]}),l.amenities&&l.amenities.includes("wifi")&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ns,{size:16,className:"text-green-600"}),e.jsx("span",{children:"WiFi"})]})]}),e.jsxs("div",{className:"inline-flex items-center gap-3 bg-gray-50 rounded-xl px-4 py-2.5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Check-in"}),e.jsx("div",{className:"font-semibold text-gray-900",children:f(l.checkIn)})]})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Check-out"}),e.jsx("div",{className:"font-semibold text-gray-900",children:f(l.checkOut)})]})]})]})]}),e.jsx("button",{onClick:i,className:"ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all","aria-label":"Eliminar reserva",title:"Eliminar reserva",children:e.jsx(ge,{size:20})})]}),e.jsxs("div",{className:"flex items-end justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Precio por noche:"}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:[R()," ",j.toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Total a pagar"}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[R()," ",r.toFixed(2)]})]})]})]})]})})};function ws({data:x,cart:l,setCart:i,onContinue:f,subTotal:j,igv:M,totalFinal:r,openModal:o,totalWithoutDiscounts:L}){const a=l.length===0;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 font-paragraph",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-2",children:a?"Tu carrito está vacío":"Revisa tu reserva"}),!a&&e.jsxs("p",{className:"text-gray-600",children:[l.length," ",l.length===1?"habitación seleccionada":"habitaciones seleccionadas"]})]}),e.jsx("div",{className:"space-y-4",children:a?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 bg-gray-50 rounded-2xl",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No hay habitaciones seleccionadas"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Explora nuestras opciones de alojamiento"}),e.jsx("a",{href:"/habitaciones",className:"px-6 py-3 bg-primary text-white rounded-full hover:opacity-90 transition-all",children:"Ver habitaciones disponibles"})]}):l.map((d,C)=>e.jsx(vs,{...d,setCart:i},`${d.id}-${d.checkIn}-${C}`))}),!a&&e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-xl",children:[e.jsx(he,{className:"w-6 h-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-green-900",children:"Reserva segura"}),e.jsx("p",{className:"text-xs text-green-700",children:"Pago 100% protegido"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-xl",children:[e.jsx(Oe,{className:"w-6 h-6 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-blue-900",children:"Confirmación inmediata"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Por email y SMS"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl",children:[e.jsx(cs,{className:"w-6 h-6 text-purple-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-purple-900",children:"Mejor precio"}),e.jsx("p",{className:"text-xs text-purple-700",children:"Garantizado"})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-6 sticky top-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Resumen de reserva"}),!a&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 pb-6 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:l.length}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:l.length===1?"Habitación":"Habitaciones"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:l.reduce((d,C)=>d+(C.nights||1),0)}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Noches"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:l.reduce((d,C)=>d+(C.guests||2),0)}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Huéspedes"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[R()," ",O(j)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Impuestos y cargos"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[R()," ",O(M)]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[R()," ",O(r)]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Incluye impuestos"})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:f,disabled:a,className:`w-full py-4 px-6 rounded-xl font-semibold text-base transition-all duration-300 ${a?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-primary text-white hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]"} ${(x==null?void 0:x.class_button)||""}`,children:a?"Carrito vacío":"Continuar con la reserva"}),e.jsx("a",{href:"/habitaciones",className:"block w-full py-3 px-6 text-center rounded-xl font-medium text-gray-700 border-2 border-gray-300 hover:border-primary hover:text-primary transition-all",children:a?"Explorar habitaciones":"Agregar más habitaciones"})]}),e.jsx("div",{className:"mt-6 p-4 bg-green-50 rounded-xl border border-green-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-900 mb-1",children:"¡Excelente elección!"}),e.jsx("p",{className:"text-xs text-green-700 leading-relaxed",children:"Reserva ahora y asegura tu estadía. Confirmación inmediata por email."})]})]})}),e.jsx("div",{className:"mt-6 pt-6 border-t",children:e.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["Al proceder, aceptas nuestros"," ",e.jsx("button",{onClick:()=>o&&o(1),className:"text-primary font-medium hover:underline",children:"Términos y Condiciones"})," ","y"," ",e.jsx("button",{onClick:()=>o&&o(0),className:"text-primary font-medium hover:underline",children:"Política de Privacidad"}),"."]})})]})})]})}function Cs({isOpen:x,onClose:l,onPaymentComplete:i,contacts:f=[],cart:j=[],totalFinal:M=0}){const[r,o]=c.useState(null),[L,a]=c.useState(!1);c.useEffect(()=>{x||(a(!1),o(null))},[x]);const d=()=>{r&&(a(!0),i(r))},C=L||!r,m=f==null?void 0:f.find(g=>g.correlative==="checkout_mercadopago"),N=f==null?void 0:f.find(g=>g.correlative==="checkout_openpay"),k=f==null?void 0:f.find(g=>g.correlative==="checkout_culqi"),_=j.reduce((g,A)=>g+(A.nights||1),0),P=j.reduce((g,A)=>g+(A.guests||2),0);return e.jsx(me,{isOpen:x,onRequestClose:l,className:"absolute left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-lg w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:h-[85vh] lg:min-h-[85vh] lg:max-h-[85vh]",children:[e.jsxs("div",{className:"hidden md:flex flex-col bg-gradient-to-br from-[#281409] to-[#3d2410] h-full p-6 text-white",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(se,{className:"w-6 h-6"}),"Resumen de tu Reserva"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:j.length}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:j.length===1?"Habitación":"Habitaciones"})]}),e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:_}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"Noches"})]}),e.jsxs("div",{className:"bg-white/10 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:P}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"Huéspedes"})]})]}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-2",children:j.map((g,A)=>e.jsx("div",{className:"bg-white/10 rounded-xl p-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:g.image?`/storage/images/item/${g.image}`:"/assets/img/noimage/no_img.jpg",alt:g.name,className:"w-16 h-16 rounded-lg object-cover",onError:y=>{y.target.src="/assets/img/noimage/no_img.jpg"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:g.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300 mt-1",children:[e.jsx(ue,{size:12}),e.jsxs("span",{children:[g.nights||1," noches"]}),e.jsx(re,{size:12,className:"ml-2"}),e.jsxs("span",{children:[g.guests||2," huéspedes"]})]})]})]})},`${g.id}-${g.checkIn||g.check_in}-${A}`))})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-white/20",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Total a pagar"}),e.jsxs("span",{className:"text-2xl font-bold",children:["S/ ",M.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-400",children:[e.jsx(he,{size:14}),e.jsx("span",{children:"Pago seguro y encriptado"})]})]})]}),e.jsxs("div",{className:"p-6 max-h-[90vh] md:max-h-[100vh] flex flex-col justify-center overflow-y-auto",children:[e.jsxs("div",{className:"mb-0 md:mb-4",children:[e.jsx("h2",{className:"text-xl md:text-2xl 2xl:text-3xl font-bold customtext-primary",children:"¿Cómo deseas pagar tu reserva?"}),e.jsx("p",{className:"mt-2 text-sm 2xl:text-base text-gray-600",children:"Elige una de las opciones disponibles para completar tu pago de forma segura."})]}),e.jsx("div",{className:"md:hidden mb-4 p-3 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-600",children:[j.length," habitación(es) - ",_," noche(s)"]}),e.jsxs("span",{className:"font-bold text-primary",children:["S/ ",M.toFixed(2)]})]})}),(m==null?void 0:m.description)!=="true"&&(N==null?void 0:N.description)!=="true"&&(k==null?void 0:k.description)!=="true"&&w.get("checkout_dwallet")!=="true"&&w.get("checkout_transfer")!=="true"?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"Sin opciones de pago disponibles"}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-3 space-y-3",children:[(m==null?void 0:m.description)=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${r==="tarjeta"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>o("tarjeta"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"tarjeta",name:"paymentMethod",checked:r==="tarjeta",onChange:()=>o("tarjeta"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"tarjeta",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Paga de forma segura con tu tarjeta de crédito o débito."}),parseFloat(w.get("checkout_mercadopago_commission")||0)>0&&e.jsxs("p",{className:"text-xs mt-1 text-yellow-600 font-medium",children:["+ Comisión ",w.get("checkout_mercadopago_commission"),"%"]})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${r==="tarjeta"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${r==="tarjeta"?"bg-white":""}`})})})]})}),(N==null?void 0:N.description)=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${r==="openpay"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>o("openpay"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"openpay",name:"paymentMethod",checked:r==="openpay",onChange:()=>o("openpay"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"openpay",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta (OpenPay)"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Paga de forma segura con tu tarjeta de crédito o débito."}),parseFloat(w.get("checkout_openpay_commission")||0)>0&&e.jsxs("p",{className:"text-xs mt-1 text-yellow-600 font-medium",children:["+ Comisión ",w.get("checkout_openpay_commission"),"%"]})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${r==="openpay"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${r==="openpay"?"bg-white":""}`})})})]})}),(k==null?void 0:k.description)=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${r==="culqi"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>o("culqi"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"culqi",name:"paymentMethod",checked:r==="culqi",onChange:()=>o("culqi"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"culqi",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta (Culqi)"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Paga de forma segura con tarjeta de crédito, débito, Yape y más."}),parseFloat(w.get("checkout_culqi_commission")||0)>0&&e.jsxs("p",{className:"text-xs mt-1 text-yellow-600 font-medium",children:["+ Comisión ",w.get("checkout_culqi_commission"),"%"]})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${r==="culqi"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${r==="culqi"?"bg-white":""}`})})})]})}),w.get("checkout_dwallet")=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${r==="yape"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>o("yape"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"yape",name:"paymentMethod",checked:r==="yape",onChange:()=>o("yape"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"yape",className:"font-medium text-base 2xl:text-lg",children:"Yape / Plin"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:parseFloat(w.get("checkout_dwallet_commission")||0)>0?"Pago rápido desde tu celular.":"Realiza el pago desde tu celular sin comisiones."}),parseFloat(w.get("checkout_dwallet_commission")||0)>0&&e.jsxs("p",{className:"text-xs mt-1 text-yellow-600 font-medium",children:["+ Comisión ",w.get("checkout_dwallet_commission"),"%"]})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${r==="yape"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${r==="yape"?"bg-white":""}`})})})]})}),w.get("checkout_transfer")=="true"&&e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${r==="transferencia"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>o("transferencia"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"transferencia",name:"paymentMethod",checked:r==="transferencia",onChange:()=>o("transferencia"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"transferencia",className:"font-medium text-base 2xl:text-lg",children:"Pago por Transferencia"}),e.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Haz una transferencia bancaria desde tu app o banca por internet."}),parseFloat(w.get("checkout_transfer_commission")||0)>0&&e.jsxs("p",{className:"text-xs mt-1 text-yellow-600 font-medium",children:["+ Comisión ",w.get("checkout_transfer_commission"),"%"]})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${r==="transferencia"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${r==="transferencia"?"bg-white":""}`})})})]})})]})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[((m==null?void 0:m.description)==="true"||(N==null?void 0:N.description)==="true"||(k==null?void 0:k.description)==="true"||w.get("checkout_dwallet")==="true"||w.get("checkout_transfer")==="true")&&e.jsx("button",{className:`w-full bg-primary hover:bg-primary text-white py-3 rounded-3xl text-base 2xl:text-lg leading-normal font-medium transition-colors 
                                ${C?"opacity-70 cursor-not-allowed":""}`,onClick:d,disabled:L,children:L?"Procesando...":"Confirmar Reserva"}),e.jsx("button",{className:"w-full border border-primary text-primary hover:bg-[#f8f5f2] py-3 text-base 2xl:text-lg leading-normal rounded-3xl font-medium transition-colors",onClick:l,disabled:L,children:"Volver"})]})]})]})})}class qe{constructor(){de(this,"checkout",async l=>{try{const i=await fetch(`${this.baseUrl}/checkout`,{method:"POST",body:l}),f=await i.json();if(!i.ok||f.status>=400)throw new Error(f.message||"Error al procesar la reserva");return f}catch(i){throw console.error("Error en checkout de booking:",i),i}});de(this,"search",async l=>{try{return await X.Fetch("/api/hotels/rooms/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}catch(i){throw console.error("Error buscando habitaciones:",i),i}});de(this,"track",async l=>{try{return await X.Fetch(`${this.baseUrl}/${l}/track`,{method:"GET"})}catch(i){throw console.error("Error rastreando reserva:",i),i}});de(this,"create",async l=>{try{return await X.Fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}catch(i){throw console.error("Error creando reserva:",i),i}});this.baseUrl="/api/hotels/bookings"}}const ks=new qe;function _s({isOpen:x,onClose:l,cart:i=[],subTotal:f,igv:j,totalFinal:M,request:r,coupon:o=null,descuentofinal:L=0}){const[a,d]=c.useState(!1),[C,m]=c.useState(null),N=c.useRef(null),k=y=>{const F=y.target.files[0];F&&m(F)},_=()=>{m(null),N.current&&(N.current.value="")},P=async()=>{if(!a){if(!C){V.error("Error al subir comprobante",{description:"Por favor, sube tu comprobante de pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"});return}d(!0);try{const y=new FormData;Object.keys(r).forEach(z=>{r[z]!==null&&r[z]!==void 0&&y.append(z,r[z])}),y.append("payment_proof",C);const F=await ks.checkout(y);F&&F.code&&(X.Local.set(`${D.APP_CORRELATIVE}_cart`,(X.Local.get(`${D.APP_CORRELATIVE}_cart`)||[]).filter(z=>z.type!=="booking")),location.href=`${location.origin}/cart?code=${F.code}`)}catch(y){console.error("Error al procesar el pago:",y),V.error("Error al procesar el pago",{description:y.message||"Ocurrió un error al procesar tu pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}finally{d(!1)}}},g=i.reduce((y,F)=>y+(F.nights||1),0),A=i.reduce((y,F)=>y+(F.guests||2),0);return e.jsx(me,{isOpen:x,onRequestClose:l,className:"absolute left-1/2 -translate-x-1/2 bg-[#f5f5f5] rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden font-paragraph",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:e.jsxs("div",{className:"py-6 px-6 md:px-10 flex flex-col gap-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:D.APP_NAME,className:"h-12 object-contain",onError:y=>{y.target.onerror=null,y.target.src="/assets/img/logo-bk.svg"}})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:w.get("checkout_dwallet_name")||"Pago con Yape / Plin"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:w.get("checkout_dwallet_description")||"Sube tu comprobante de pago para confirmar tu reserva"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(se,{size:18}),"Resumen de tu reserva"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:i.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Habitación(es)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:g}),e.jsx("div",{className:"text-xs text-gray-500",children:"Noche(s)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:A}),e.jsx("div",{className:"text-xs text-gray-500",children:"Huésped(es)"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Escanea el código QR para pagar"}),w.get("checkout_dwallet_qr")?e.jsx("img",{src:`/assets/resources/${w.get("checkout_dwallet_qr")}`,alt:w.get("checkout_dwallet_name")||"QR Yape",className:"mx-auto max-w-[200px] rounded-lg",onError:y=>{y.currentTarget.src="/assets/img/salafabulosa/logoyape.png"}}):e.jsx("div",{className:"w-[200px] h-[200px] mx-auto bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:"QR no configurado"})}),w.get("checkout_dwallet_phone")&&e.jsxs("p",{className:"mt-3 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"O transfiere a: "}),e.jsx("span",{className:"font-bold text-primary",children:w.get("checkout_dwallet_phone")})]})]}),e.jsxs("div",{className:"bg-primary text-white rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm opacity-90",children:"Total a pagar"}),e.jsxs("p",{className:"text-2xl font-bold",children:[R()," ",O(M)]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Sube tu comprobante de pago *"}),e.jsx("input",{type:"file",ref:N,onChange:k,accept:"image/*",className:"hidden"}),C?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(C),alt:"Comprobante",className:"w-full max-h-48 object-contain rounded-lg"}),e.jsx("button",{type:"button",onClick:_,className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(ge,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var y;return(y=N.current)==null?void 0:y.click()},className:"w-full border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-primary transition-colors",children:[e.jsx(Le,{className:"mx-auto h-8 w-8 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Haz clic para subir tu comprobante"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG hasta 5MB"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:P,disabled:a||!C,className:`w-full py-3 px-6 rounded-full font-semibold text-white transition-all ${a||!C?"bg-gray-400 cursor-not-allowed":"bg-primary hover:opacity-90"}`,children:a?"Procesando...":"Confirmar Reserva"}),e.jsx("button",{onClick:l,disabled:a,className:"w-full py-3 px-6 rounded-full font-semibold border border-gray-300 text-gray-700 hover:bg-gray-50 transition-all",children:"Cancelar"})]})]})})}const Ps=new qe;function Es({isOpen:x,onClose:l,cart:i=[],subTotal:f,igv:j,totalFinal:M,request:r,contacts:o=[],coupon:L=null,descuentofinal:a=0}){const[d,C]=c.useState(!1),[m,N]=c.useState(null),[k,_]=c.useState(null),P=c.useRef(null),g=h=>{const I=h.target.files[0];I&&N(I)},A=()=>{N(null),P.current&&(P.current.value="")},y=(h,I)=>{navigator.clipboard.writeText(h),_(I),setTimeout(()=>_(null),2e3)},F=async()=>{if(!d){if(!m){V.error("Error al subir comprobante",{description:"Por favor, sube tu comprobante de pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"});return}C(!0);try{const h=new FormData;Object.keys(r).forEach(U=>{r[U]!==null&&r[U]!==void 0&&h.append(U,r[U])}),h.append("payment_proof",m);const I=await Ps.checkout(h);I&&I.code&&(X.Local.set(`${D.APP_CORRELATIVE}_cart`,(X.Local.get(`${D.APP_CORRELATIVE}_cart`)||[]).filter(U=>U.type!=="booking")),location.href=`${location.origin}/cart?code=${I.code}`)}catch(h){console.error("Error al procesar el pago:",h),V.error("Error al procesar el pago",{description:h.message||"Ocurrió un error al procesar tu pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}finally{C(!1)}}},z=h=>{var I;return((I=o.find(U=>U.correlative===h))==null?void 0:I.description)||""},v=i.reduce((h,I)=>h+(I.nights||1),0),S=i.reduce((h,I)=>h+(I.guests||2),0),G=z("checkout_bank_name")||"Banco",t=z("checkout_account_number"),q=z("checkout_cci_number"),K=z("checkout_account_holder");return e.jsx(me,{isOpen:x,onRequestClose:l,className:"absolute left-1/2 -translate-x-1/2 bg-[#f5f5f5] rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden font-paragraph",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:e.jsxs("div",{className:"py-6 px-6 md:px-10 flex flex-col gap-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:D.APP_NAME,className:"h-12 object-contain",onError:h=>{h.target.onerror=null,h.target.src="/assets/img/logo-bk.svg"}})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Pago por Transferencia"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Realiza la transferencia y sube tu comprobante"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(se,{size:18}),"Resumen de tu reserva"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:i.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Habitación(es)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:v}),e.jsx("div",{className:"text-xs text-gray-500",children:"Noche(s)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:S}),e.jsx("div",{className:"text-xs text-gray-500",children:"Huésped(es)"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ae,{size:18}),"Datos para transferencia"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Banco"}),e.jsx("p",{className:"font-medium text-gray-800",children:G})]})}),t&&e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Número de cuenta"}),e.jsx("p",{className:"font-medium text-gray-800",children:t})]}),e.jsx("button",{onClick:()=>y(t,"account"),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:k==="account"?e.jsx(ze,{size:18,className:"text-green-500"}):e.jsx(Ie,{size:18,className:"text-gray-400"})})]}),q&&e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"CCI (Interbancario)"}),e.jsx("p",{className:"font-medium text-gray-800",children:q})]}),e.jsx("button",{onClick:()=>y(q,"cci"),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:k==="cci"?e.jsx(ze,{size:18,className:"text-green-500"}):e.jsx(Ie,{size:18,className:"text-gray-400"})})]}),K&&e.jsx("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Titular"}),e.jsx("p",{className:"font-medium text-gray-800",children:K})]})})]})]}),e.jsxs("div",{className:"bg-primary text-white rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-sm opacity-90",children:"Total a transferir"}),e.jsxs("p",{className:"text-2xl font-bold",children:[R()," ",O(M)]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Sube tu comprobante de transferencia *"}),e.jsx("input",{type:"file",ref:P,onChange:g,accept:"image/*",className:"hidden"}),m?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(m),alt:"Comprobante",className:"w-full max-h-48 object-contain rounded-lg"}),e.jsx("button",{type:"button",onClick:A,className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(ge,{size:16})})]}):e.jsxs("button",{type:"button",onClick:()=>{var h;return(h=P.current)==null?void 0:h.click()},className:"w-full border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-primary transition-colors",children:[e.jsx(Le,{className:"mx-auto h-8 w-8 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Haz clic para subir tu comprobante"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG hasta 5MB"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:F,disabled:d||!m,className:`w-full py-3 px-6 rounded-full font-semibold text-white transition-all ${d||!m?"bg-gray-400 cursor-not-allowed":"bg-primary hover:opacity-90"}`,children:d?"Procesando...":"Confirmar Reserva"}),e.jsx("button",{onClick:l,disabled:d,className:"w-full py-3 px-6 rounded-full font-semibold border border-gray-300 text-gray-700 hover:bg-gray-50 transition-all",children:"Cancelar"})]})]})})}function Ss({cart:x,setBooking:l,setCode:i,setCart:f,onContinue:j,noContinue:M,subTotal:r,igv:o,totalFinal:L,user:a,prefixes:d=[],ubigeos:C=[],contacts:m=[],totalPrice:N,data:k,openModal:_,setCouponDiscount:P,setCouponCode:g,totalWithoutDiscounts:A}){const y=(s,n)=>n?n.startsWith(s)?n:`${s}${n}`:"",F=(s,n)=>s?s.startsWith(n)?s.substring(n.length):s:"",z=c.useRef(null),[v,S]=c.useState(null),G=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[t,q]=c.useState(()=>{var b;const s=(a==null?void 0:a.phone_prefix)||"51",n=F((a==null?void 0:a.phone)||"",s);return{name:(a==null?void 0:a.name)||"",lastname:(a==null?void 0:a.lastname)||"",email:(a==null?void 0:a.email)||"",phone_prefix:s,phone:n,documentType:((b=a==null?void 0:a.document_type)==null?void 0:b.toLowerCase())||"dni",document:(a==null?void 0:a.document_number)||"",comment:"",specialRequests:"",invoiceType:(a==null?void 0:a.invoiceType)||"boleta",businessName:(a==null?void 0:a.businessName)||""}});c.useEffect(()=>{if(a){const s=a.phone_prefix||"51",n=F(a.phone||"",s);q(b=>{var T;return{...b,name:a.name||"",lastname:a.lastname||"",email:a.email||"",phone_prefix:s,phone:n,documentType:((T=a.document_type)==null?void 0:T.toLowerCase())||"dni",document:a.document_number||"",invoiceType:a.invoiceType||"boleta",businessName:a.businessName||""}})}},[a]);const K=(()=>{const s=m==null?void 0:m.find(T=>T.correlative==="checkout_mercadopago"),n=m==null?void 0:m.find(T=>T.correlative==="checkout_openpay"),b=m==null?void 0:m.find(T=>T.correlative==="checkout_culqi");return(s==null?void 0:s.description)==="true"||(n==null?void 0:n.description)==="true"||(b==null?void 0:b.description)==="true"||w.get("checkout_dwallet")==="true"||w.get("checkout_transfer")==="true"})(),h=s=>{const{name:n,value:b}=s.target;q(T=>({...T,[n]:b})),n==="invoiceType"&&q(T=>({...T,documentType:b==="factura"?"ruc":"dni",document:"",businessName:b==="factura"?T.businessName:""}))},[I,U]=c.useState(!1),[ne,te]=c.useState(!1),[p,$]=c.useState({}),[Q,Z]=c.useState(""),[E,xe]=c.useState(null),[$s,Fs]=c.useState(0),[ke,_e]=c.useState(!1),[Pe,le]=c.useState(""),[He,fe]=c.useState(!1),[ie,Be]=c.useState(0),[Ue,Ve]=c.useState(null),H=s=>Math.round((s+Number.EPSILON)*100)/100,W=(()=>{if(!E)return 0;const s=H(r+o);if(E.discount_type==="percentage"){const n=parseFloat(E.discount_value)||0;return H(s*(n/100))}else return H(parseFloat(E.discount_value)||0)})(),ee=H(r+o),be=(()=>{if(!Ue||ie<=0)return 0;const s=Math.max(0,H(ee-W));return H(s*(ie/100))})(),pe=(()=>{const s=H(ee),n=Math.max(0,H(s-W)),b=H(n+be);return Math.max(0,b)})(),De=()=>{const s={};return t.name||(s.name="Nombre es requerido"),t.lastname||(s.lastname="Apellido es requerido"),t.email||(s.email="Email es requerido"),t.phone||(s.phone="Teléfono es requerido"),t.document||(s.document="Documento es requerido"),t.email&&!/\S+@\S+\.\S+/.test(t.email)&&(s.email="Email inválido"),t.document&&(t.documentType==="dni"&&t.document.length!==8?s.document="DNI debe tener 8 dígitos":t.documentType==="ruc"&&t.document.length!==11&&(s.document="RUC debe tener 11 dígitos")),t.invoiceType==="factura"&&!t.businessName&&(s.businessName="Razón social es requerida para factura"),$(s),Object.keys(s).length===0},Ge=s=>{const n=Object.keys(s)[0];setTimeout(()=>{let b=document.querySelector(`[name="${n}"]`);b&&(b.classList.add("highlight-error"),setTimeout(()=>b.classList.remove("highlight-error"),2e3),b.scrollIntoView({behavior:"smooth",block:"center"}),["INPUT","SELECT","TEXTAREA"].includes(b.tagName)&&b.focus())},100)},We=async()=>{if(!Q.trim()){le("Ingresa un código de cupón");return}_e(!0),le("");try{const s=await ps.validate({code:Q,total:ee});if(s.valid){if(xe(s.coupon),S(s.coupon),P)if(s.coupon.discount_type==="percentage"){const n=ee*(parseFloat(s.coupon.discount_value)/100);P(H(n))}else P(H(parseFloat(s.coupon.discount_value)));g&&g(Q),V.success("Cupón aplicado",{description:`Descuento de ${s.coupon.discount_type==="percentage"?s.coupon.discount_value+"%":R()+" "+s.coupon.discount_value}`,icon:e.jsx(ae,{className:"h-5 w-5 text-green-500"}),duration:3e3,position:"top-right"})}else le(s.message||"Cupón no válido")}catch(s){console.error("Error validating coupon:",s),le("Error al validar el cupón")}finally{_e(!1)}},Je=()=>{xe(null),S(null),Z(""),le(""),P&&P(0),g&&g(null)},Ee=s=>{if(!s)return"";try{const n=new Date(s);return we(n,"dd MMM yyyy",{locale:Ce})}catch{return s}},[Qe,ye]=c.useState(!1),[Ye,je]=c.useState(!1),[Ms,zs]=c.useState(null),[Xe,Se]=c.useState(!1),[Ke,Te]=c.useState(!1),[Is,Ze]=c.useState(null),[Re,Ne]=c.useState(null),es=s=>{if(s.preventDefault(),!a){fe(!0);return}if(!De()){Ge(p);return}ye(!0)},ss=async s=>{try{let n=0;switch(s){case"tarjeta":n=parseFloat(D.get("checkout_mercadopago_commission")||0);break;case"culqi":n=parseFloat(D.get("checkout_culqi_commission")||0);break;case"openpay":n=parseFloat(D.get("checkout_openpay_commission")||0);break;case"yape":n=parseFloat(D.get("checkout_dwallet_commission")||0);break;case"transferencia":n=parseFloat(D.get("checkout_transfer_commission")||0);break;default:n=0}if(Be(n),Ve(s),ye(!1),Ze(s),s==="openpay"){je(!0);return}const b=H((ee-W)*(n/100)),T=H(ee-W+b),Y=x.map(u=>({id:u.id,name:u.name,room_type:u.room_type,check_in:u.check_in||u.checkIn,check_out:u.check_out||u.checkOut,nights:u.nights||1,guests:u.guests||2,price:u.price,final_price:u.final_price||u.price,image:u.image})),B={user_id:(a==null?void 0:a.id)||"",name:(t==null?void 0:t.name)||"",lastname:(t==null?void 0:t.lastname)||"",fullname:`${t==null?void 0:t.name} ${t==null?void 0:t.lastname}`,phone_prefix:(t==null?void 0:t.phone_prefix)||"51",email:(t==null?void 0:t.email)||"",phone:y(t.phone_prefix||"51",t.phone),country:"Perú",comment:(t==null?void 0:t.comment)||"",special_requests:(t==null?void 0:t.specialRequests)||"",amount:T||0,delivery_type:"domicilio",details:JSON.stringify(Y),cart:Y,booking_type:"rooms",invoiceType:t.invoiceType||"",documentType:t.documentType||"",document:t.document||"",businessName:t.businessName||"",payment_method:s||null,coupon_id:E?E.id:null,coupon_discount:W||0,payment_commission:b||0,payment_commission_percentage:n||0,total_amount:T||0};if(Ne(B),s==="tarjeta"){if(!window.MercadoPago){console.error("❌ MercadoPago aún no se ha cargado.");return}try{const oe=await ms(B);oe.status?(l(oe.sale),i(oe.code),j()):V.error("Error en el Pago",{description:"El pago ha sido rechazado",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch{V.error("Error en el Pago",{description:"No se llegó a procesar el pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}}else if(s==="culqi"){te(!0);try{if(!D.CULQI_ENABLED){V.error("Método de pago no disponible",{description:"El procesamiento de pagos con Culqi está temporalmente deshabilitado",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),te(!1);return}const u=await hs(B);u.status?(l(u.sale),i(u.code),j()):V.error("Error en el Pago",{description:u.message||"El pago ha sido rechazado",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch{V.error("Error en el Pago",{description:"No se llegó a procesar el pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{te(!1)}}else s==="yape"?(Ne(B),Se(!0)):s==="transferencia"&&(Ne(B),Te(!0))}catch(n){console.error("Error en pago:",n),V.error("Error",{description:"Ocurrió un error inesperado",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}},ts=async s=>{je(!1);try{const n=H((ee-W)*(ie/100)),b=H(ee-W+n),T=x.map(u=>({id:u.id,name:u.name,room_type:u.room_type,checkIn:u.checkIn,checkOut:u.checkOut,nights:u.nights||1,guests:u.guests||2,price:u.price,final_price:u.final_price||u.price,image:u.image})),Y={...s,user_id:(a==null?void 0:a.id)||"",name:(t==null?void 0:t.name)||"",lastname:(t==null?void 0:t.lastname)||"",fullname:`${t==null?void 0:t.name} ${t==null?void 0:t.lastname}`,phone_prefix:(t==null?void 0:t.phone_prefix)||"51",email:(t==null?void 0:t.email)||"",phone:y(t.phone_prefix||"51",t.phone),country:"Perú",comment:(t==null?void 0:t.comment)||"",special_requests:(t==null?void 0:t.specialRequests)||"",amount:b||0,cart:T,booking_type:"rooms",invoiceType:t.invoiceType||"",documentType:t.documentType||"",document:t.document||"",businessName:t.businessName||"",payment_method:"openpay",coupon_id:E?E.id:null,coupon_discount:W||0,payment_commission:n||0,payment_commission_percentage:ie||0,total_amount:b||0},B=await xs(Y);B.status?(l(B.sale),i(B.code),j()):V.error("Error en el Pago",{description:B.message||"El pago ha sido rechazado",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(n){console.error("Error en pago OpenPay:",n),V.error("Error en el Pago",{description:"No se llegó a procesar el pago",icon:e.jsx(J,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}},as=x.reduce((s,n)=>s+(n.nights||1),0),rs=x.reduce((s,n)=>s+(n.guests||2),0);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 font-paragraph",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-2",children:"Datos de la reserva"}),e.jsx("p",{className:"text-gray-600",children:"Completa tus datos para confirmar la reserva"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"Resumen de tu estadía"]}),e.jsx("div",{className:"space-y-3",children:x.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white rounded-lg p-3",children:[e.jsx("img",{src:`/storage/images/item/${s.image}`,alt:s.name,className:"w-16 h-16 object-cover rounded-lg",onError:b=>b.target.src="/assets/img/noimage/no_img.jpg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{size:14}),Ee(s.checkIn)," - ",Ee(s.checkOut)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{size:14}),s.nights||1," noches"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{size:14}),s.guests||2," huéspedes"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-bold text-primary",children:[R()," ",O((s.final_price||s.price)*(s.nights||1))]})})]},`${s.id}-${s.checkIn}-${n}`))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),"Datos del huésped principal"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nombre ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:h,className:`w-full border ${p.name?"border-red-500":"border-gray-300"} rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all`,placeholder:"Tu nombre"}),p.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Apellido ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"lastname",value:t.lastname,onChange:h,className:`w-full border ${p.lastname?"border-red-500":"border-gray-300"} rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all`,placeholder:"Tu apellido"}),p.lastname&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.lastname})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:h,className:`w-full border ${p.email?"border-red-500":"border-gray-300"} rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all`,placeholder:"tu@email.com"}),p.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.email})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:["Celular ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("div",{className:"max-w-[120px]",children:e.jsx(gs,{name:"phone_prefix",value:d.find(s=>s.realCode===t.phone_prefix)?{value:d.find(s=>s.realCode===t.phone_prefix).realCode,label:`${d.find(s=>s.realCode===t.phone_prefix).beautyCode}`,flag:d.find(s=>s.realCode===t.phone_prefix).flag,code:d.find(s=>s.realCode===t.phone_prefix).beautyCode,country:d.find(s=>s.realCode===t.phone_prefix).country}:null,onChange:s=>q(n=>({...n,phone_prefix:(s==null?void 0:s.value)||""})),options:d.sort((s,n)=>s.country.localeCompare(n.country)).map(s=>({value:s.realCode,label:s.beautyCode,flag:s.flag,code:s.beautyCode,country:s.country})),formatOptionLabel:({flag:s,code:n,country:b})=>{var $e,Fe;const T=d.find(ce=>ce.country===b),Y=((Fe=($e=T==null?void 0:T.isoCode)==null?void 0:$e.ISO1)==null?void 0:Fe.toLowerCase())||b.toLowerCase().substring(0,2),B=[`https://flagsapi.com/${Y.toUpperCase()}/flat/24.png`,`https://flagcdn.com/${Y}.svg`,`https://purecatamphetamine.github.io/country-flag-icons/3x2/${Y.toUpperCase()}.svg`,`https://cdn.jsdelivr.net/gh/hampusborgos/country-flags@main/svg/${Y}.svg`,`https://raw.githubusercontent.com/lipis/flag-icons/main/flags/4x3/${Y}.svg`];let u=0;const oe=ce=>{if(u++,u<B.length)ce.target.src=B[u];else{ce.target.style.display="none";const Me=ce.target.parentNode.querySelector(".flag-fallback");Me&&(Me.style.display="flex")}};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:B[0],alt:`Bandera de ${b}`,className:"w-6 h-4 object-cover rounded-sm flex-shrink-0 border border-gray-200",onError:oe,style:{minWidth:"24px",minHeight:"16px"}}),e.jsx("div",{className:"flag-fallback w-6 h-4 bg-gray-200 rounded-sm flex items-center justify-center flex-shrink-0 border border-gray-300",style:{display:"none",minWidth:"24px",minHeight:"16px"},children:e.jsx("span",{className:"text-xs text-gray-500",children:Y.toUpperCase()})}),e.jsx("span",{className:"font-medium text-sm",children:n})]})},placeholder:"País",isClearable:!1,isSearchable:!0,styles:{control:s=>({...s,minHeight:"48px",border:"1px solid #d1d5db",borderRadius:"0.75rem",fontSize:"14px","&:hover":{borderColor:"#9ca3af"},"&:focus-within":{borderColor:"#3b82f6",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.1)"}}),option:(s,n)=>({...s,backgroundColor:n.isSelected?"#3b82f6":n.isFocused?"#f3f4f6":"white",color:n.isSelected?"white":"#374151",padding:"8px 12px"}),singleValue:s=>({...s,display:"flex",alignItems:"center",gap:"6px"}),menu:s=>({...s,zIndex:9999})},filterOption:(s,n)=>s.data.country.toLowerCase().includes(n.toLowerCase())||s.data.code.toLowerCase().includes(n.toLowerCase())})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"tel",id:"phone",name:"phone",value:t.phone,onChange:h,className:`w-full border ${p.phone?"border-red-500":"border-gray-300"} rounded-xl px-4 py-3 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all`,placeholder:"000 000 000"})})]}),p.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.phone})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tipo de documento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{name:"documentType",value:t.documentType,onChange:h,className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all",children:G.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Número de documento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"document",value:t.document,onChange:h,className:`w-full border ${p.document?"border-red-500":"border-gray-300"} rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all`,placeholder:t.documentType==="dni"?"12345678":"Número de documento",maxLength:t.documentType==="dni"?8:t.documentType==="ruc"?11:20}),p.document&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.document})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Solicitudes especiales (opcional)"}),e.jsx("textarea",{name:"specialRequests",value:t.specialRequests,onChange:h,rows:3,className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all resize-none",placeholder:"¿Tienes alguna solicitud especial? (cama extra, llegada tarde, etc.)"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(fs,{className:"w-5 h-5 text-primary"}),"Comprobante de pago"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("label",{className:`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${t.invoiceType==="boleta"?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"invoiceType",value:"boleta",checked:t.invoiceType==="boleta",onChange:h,className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"font-medium",children:"Boleta"})]}),e.jsxs("label",{className:`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${t.invoiceType==="factura"?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"invoiceType",value:"factura",checked:t.invoiceType==="factura",onChange:h,className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"font-medium",children:"Factura"})]})]}),t.invoiceType==="factura"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Razón Social ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"businessName",value:t.businessName,onChange:h,className:`w-full border ${p.businessName?"border-red-500":"border-gray-300"} rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all`,placeholder:"Nombre de la empresa"}),p.businessName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:p.businessName})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsxs("h3",{className:"font-semibold text-amber-900 mb-2 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Información importante"]}),e.jsxs("ul",{className:"text-sm text-amber-800 space-y-1",children:[e.jsx("li",{children:"• Check-in: A partir de las 15:00 hrs"}),e.jsx("li",{children:"• Check-out: Hasta las 12:00 hrs"}),e.jsx("li",{children:"• Recibirás un correo de confirmación con todos los detalles"})]})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx("button",{onClick:M,className:"w-full py-3 px-6 text-center rounded-xl font-medium text-gray-700 border-2 border-gray-300 hover:border-primary hover:text-primary transition-all",children:"Volver al carrito"})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-6 sticky top-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Resumen de pago"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pb-6 border-b mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:x.length}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:x.length===1?"Habitación":"Habitaciones"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:as}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Noches"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:rs}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Huéspedes"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[R()," ",O(r)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Impuestos y cargos"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[R()," ",O(o)]})]}),E&&W>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:14}),"Cupón (",E.code,")"]}),e.jsxs("span",{className:"font-medium",children:["-",R()," ",O(W)]})]}),be>0&&e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Comisión (",ie,"%)"]}),e.jsxs("span",{className:"font-medium",children:["+",R()," ",O(be)]})]})]}),e.jsxs("div",{className:"mb-6 pb-6 border-b",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"¿Tienes un cupón?"}),E?e.jsxs("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:18,className:"text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:E.code})]}),e.jsx("button",{onClick:Je,className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Quitar"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",ref:z,value:Q,onChange:s=>Z(s.target.value.toUpperCase()),placeholder:"Código de cupón",className:"flex-1 border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"}),e.jsx("button",{onClick:We,disabled:ke,className:"px-4 py-2.5 bg-primary text-white rounded-lg text-sm font-medium hover:opacity-90 transition-all disabled:opacity-50",children:ke?"...":"Aplicar"})]}),Pe&&e.jsx("p",{className:"text-red-500 text-xs mt-2",children:Pe})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total a pagar"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[R()," ",O(pe)]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Incluye impuestos"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:es,disabled:ne||!K,className:`w-full py-4 px-6 rounded-xl font-semibold text-base transition-all duration-300 bg-primary text-white hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed ${(k==null?void 0:k.class_button)||""}`,children:ne?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Procesando..."]}):"Confirmar y pagar"}),e.jsx("button",{onClick:M,className:"hidden lg:block w-full py-3 px-6 text-center rounded-xl font-medium text-gray-700 border-2 border-gray-300 hover:border-primary hover:text-primary transition-all",children:"Volver al carrito"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(he,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Pago 100% seguro"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{children:"Confirmación inmediata"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t",children:e.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:["Al proceder, aceptas nuestros"," ",e.jsx("button",{onClick:()=>_&&_(1),className:"text-primary font-medium hover:underline",children:"Términos y Condiciones"})," ","y"," ",e.jsx("button",{onClick:()=>_&&_(0),className:"text-primary font-medium hover:underline",children:"Política de Privacidad"})]})})]})}),e.jsx(me,{isOpen:He,onRequestClose:()=>fe(!1),contentLabel:"Iniciar sesión",className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(bs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Inicia sesión"}),e.jsx("p",{className:"text-gray-600",children:"Para continuar con tu reserva, necesitas iniciar sesión o crear una cuenta."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("a",{href:"/login",className:"block w-full py-3 px-6 text-center rounded-xl font-medium bg-primary text-white hover:opacity-90 transition-all",children:"Iniciar sesión"}),e.jsx("a",{href:"/register",className:"block w-full py-3 px-6 text-center rounded-xl font-medium text-gray-700 border-2 border-gray-300 hover:border-primary hover:text-primary transition-all",children:"Crear cuenta"}),e.jsx("button",{onClick:()=>fe(!1),className:"block w-full py-2 text-center text-gray-500 hover:text-gray-700 text-sm",children:"Cancelar"})]})]})}),e.jsx(Cs,{isOpen:Qe,contacts:m,cart:x,totalFinal:E?pe:L,onClose:()=>ye(!1),onPaymentComplete:ss}),e.jsx(ds,{isOpen:Ye,onClose:()=>je(!1),onTokenCreated:ts}),e.jsx(_s,{isOpen:Xe,cart:x,subTotal:r,igv:o,totalFinal:E?pe:L,request:Re,onClose:()=>Se(!1),contacts:m,coupon:E,descuentofinal:W}),e.jsx(Es,{isOpen:Ke,cart:x,subTotal:r,igv:o,totalFinal:E?pe:L,contacts:m,request:Re,onClose:()=>Te(!1),coupon:E,descuentofinal:W})]})}const Ts=({code:x})=>new Promise(async(l,i)=>{try{console.log("Codigo de reserva:",x);const{status:f,result:j}=await X.Fetch("./api/hotels/bookings/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:x})});if(!f||!j.order){X.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(j==null?void 0:j.message)||"Error: no se pudo cargar la reserva",type:"danger"}),i((j==null?void 0:j.message)||"Error: no se pudo cargar la reserva");return}l(j)}catch(f){console.error("Error en recoveryBookingData:",f),X.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:f.message||"Error al cargar los datos de la reserva",type:"danger"}),i(f.message||"Error al cargar los datos de la reserva")}});function Rs({setCart:x,cart:l,code:i,data:f,couponDiscount:j=0,couponCode:M=null}){var z;const[r,o]=c.useState(null),[L,a]=c.useState(!0),[d,C]=c.useState(null);c.useEffect(()=>{i&&((async()=>{try{const S=await Ts({code:i});o(S.order)}catch(S){C(S.message||S)}finally{a(!1)}})(),X.Local.delete(`${D.APP_CORRELATIVE}_cart`))},[i]);const m=v=>{if(!v)return"";try{const S=new Date(v);return we(S,"dd 'de' MMMM, yyyy",{locale:Ce})}catch{return v}},N=v=>({standard:"Estándar",suite:"Suite",deluxe:"Deluxe",presidential:"Presidencial",family:"Familiar",executive:"Ejecutiva",single:"Individual",double:"Doble"})[v]||v;if(L)return e.jsx("div",{className:"mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Cargando detalles de tu reserva..."})]})});if(d)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph text-center text-red-500",children:e.jsxs("p",{children:["Error al cargar la reserva: ",d]})})});if(!r)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph text-center",children:e.jsx("p",{children:"No se encontraron datos de la reserva"})})});const k=((z=r==null?void 0:r.items)==null?void 0:z.reduce((v,S)=>{const G=S.final_price||S.price||0,t=S.nights||1;return v+G*t},0))||0,_=parseFloat((k/1.18).toFixed(2)),P=parseFloat((k-_).toFixed(2)),g=parseFloat(r.coupon_discount||0),A=parseFloat(r.payment_commission||0),F=parseFloat(_)+parseFloat(P)-g+A;return e.jsx("div",{className:"max-w-4xl mx-auto font-paragraph",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-8 text-white text-center",children:[e.jsx(ae,{className:"w-16 h-16 mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"¡Reserva Confirmada!"}),e.jsxs("p",{className:"text-lg opacity-90",children:["Código de reserva: ",e.jsx("span",{className:"font-mono font-bold",children:r.code})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),"Información del Huésped"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nombre completo"}),e.jsxs("p",{className:"font-semibold",children:[r.name," ",r.lastname]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"font-semibold",children:r.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ys,{className:"w-5 h-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Teléfono"}),e.jsxs("p",{className:"font-semibold",children:["+",r.phone_prefix," ",r.phone]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(js,{className:"w-5 h-5 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Documento"}),e.jsx("p",{className:"font-semibold",children:r.document})]})]})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Habitaciones Reservadas"}),e.jsx("div",{className:"space-y-4",children:r.items&&r.items.map((v,S)=>{const G=v.final_price||v.price||0,t=v.nights||1,q=G*t,K=v.guests||2;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:v.image?`/storage/images/item/${v.image}`:"/assets/img/noimage/no_img.jpg",alt:v.name,className:"w-24 h-24 object-cover rounded-lg",onError:h=>h.target.src="/assets/img/noimage/no_img.jpg"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:v.name}),v.room_type&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Tipo: ",N(v.room_type)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Check-in:"}),e.jsx("span",{className:"font-semibold",children:m(v.check_in)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-gray-600",children:"Check-out:"}),e.jsx("span",{className:"font-semibold",children:m(v.check_out)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-gray-600",children:"Noches:"}),e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Huéspedes:"}),e.jsx("span",{className:"font-semibold",children:K})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Precio por noche"}),e.jsxs("p",{className:"font-semibold",children:[R()," ",O(G)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total habitación"}),e.jsxs("p",{className:"font-bold text-lg text-primary",children:[R()," ",O(q)]})]})]})]})]})},S)})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Resumen de Pago"}),e.jsxs("div",{className:"space-y-3 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:[R()," ",O(_)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV (18%)"}),e.jsxs("span",{className:"font-semibold",children:[R()," ",O(P)]})]}),r.coupon_id&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 border-t pt-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:16}),"Cupón aplicado (",r.coupon_code,")"]}),e.jsxs("span",{className:"font-semibold",children:["-",R()," ",O(g)]})]}),A>0&&e.jsxs("div",{className:"flex justify-between items-center text-orange-600 border-t pt-2",children:[e.jsxs("span",{className:"text-sm",children:["Comisión método de pago (",r.payment_commission_percentage||0,"%)"]}),e.jsxs("span",{className:"font-semibold",children:["+",R()," ",O(A)]})]}),e.jsxs("div",{className:"flex justify-between items-center font-bold text-xl border-t-2 pt-3 mt-3",children:[e.jsx("span",{children:"Total Pagado"}),e.jsxs("span",{className:"text-primary",children:[R()," ",O(F)]})]}),r.payment_method&&e.jsxs("div",{className:"text-center text-sm text-gray-600 pt-2",children:["Método de pago: ",e.jsx("span",{className:"font-semibold capitalize",children:r.payment_method})]})]})]}),e.jsx("div",{className:"p-6 bg-blue-50 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Confirmación enviada por email"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["Hemos enviado un correo electrónico a ",e.jsx("span",{className:"font-semibold",children:r.email})," con todos los detalles de tu reserva. Por favor, revisa tu bandeja de entrada y la carpeta de spam."]})]})]})}),r.comment&&e.jsxs("div",{className:"p-6 bg-yellow-50 border-t border-yellow-200",children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"Comentarios adicionales"}),e.jsx("p",{className:"text-sm text-yellow-800",children:r.comment})]}),e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsx(us,{href:"/habitaciones",className:`w-full !rounded-full ${f==null?void 0:f.class_button}`,children:"Ver más habitaciones"})}),e.jsxs("div",{className:"p-6 bg-gray-50 text-center text-sm text-gray-600",children:[e.jsx("p",{children:"Si tienes alguna pregunta sobre tu reserva, no dudes en contactarnos."}),e.jsxs("p",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Código de reserva:"})," ",r.code]})]})]})})}function Pt({cart:x,setCart:l,user:i,prefixes:f,ubigeos:j,items:M,contacts:r,data:o,generals:L=[]}){const[a,d]=c.useState(1),C=c.useMemo(()=>x.filter(p=>p.type==="booking"),[x]),m=p=>{l($=>{const Q=$.filter(E=>E.type!=="booking"),Z=typeof p=="function"?p($.filter(E=>E.type==="booking")):p;return[...Q,...Z]})},N=C.reduce((p,$)=>{const Q=$.final_price||$.price,Z=$.nights||1;return p+Q*Z},0),k=parseFloat(w.igv_checkout||0);let _,P;k>0?(_=N,P=parseFloat((N*(k/100)).toFixed(2))):(_=parseFloat((N/1.18).toFixed(2)),P=parseFloat((N-_).toFixed(2)));const[g,A]=c.useState(0),[y,F]=c.useState(null),[z,v]=c.useState(null),S=p=>v(p),G=()=>v(null),t={privacy_policy:"Políticas de privacidad",terms_conditions:"Términos y condiciones",saleback_policy:"Políticas de cancelación y cambios"},q=_+P,K=Math.max(0,q-g),[h,I]=c.useState([]),[U,ne]=c.useState([]);c.useEffect(()=>{const $=new URLSearchParams(window.location.search).get("code");$&&(ne($),d(3))},[window.location.search]),c.useEffect(()=>{U&&l(p=>p.filter($=>$.type!=="booking"))},[U]),c.useEffect(()=>{(()=>{const $=document.createElement("script");$.src="https://sdk.mercadopago.com/js/v2",$.async=!0,document.body.appendChild($)})()},[]);const te=p=>{d(p),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${a>=1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm bg-primary text-white border-primary",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 transition-all duration-500 bg-primary",style:{width:a>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${a>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${a>1?"bg-primary text-white border-transparent":"bg-white customtext-primary  border-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Pago"})]}),e.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${o!=null&&o.gradient?"bg-gradient":"bg-primary"}`,style:{width:a>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${a===3?`${o!=null&&o.gradient?"customtext-gradient":"customtext-primary"} font-medium`:"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${a===3?o!=null&&o.gradient?"bg-gradient text-white border-transparent":"bg-primary text-white border-primary":o!=null&&o.gradient?"bg-white customtext-gradient border-gradient":"bg-white customtext-primary border-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmación"})]})]})}),a===1&&e.jsx(ws,{data:o,cart:C,setCart:m,onContinue:()=>te(2),subTotal:_,totalPrice:N,igv:P,totalFinal:K,openModal:S,totalWithoutDiscounts:q}),a===2&&e.jsx(Ss,{data:o,setCode:ne,cart:C,setBooking:I,setCart:m,onContinue:()=>te(3),noContinue:()=>te(1),subTotal:_,totalPrice:N,igv:P,totalFinal:K,user:i,prefixes:f,contacts:r,ubigeos:j,items:M,openModal:S,setCouponDiscount:A,setCouponCode:F,totalWithoutDiscounts:q}),a===3&&e.jsx(Rs,{data:o,code:U,setCart:m,cart:h,subTotal:_,totalPrice:N,igv:P,totalFinal:K,couponDiscount:g,couponCode:y,totalWithoutDiscounts:q})]}),Object.keys(t).map((p,$)=>{var E;const Q=t[p],Z=((E=L.find(xe=>xe.correlative==p))==null?void 0:E.description)??"";return e.jsx(me,{isOpen:z===$,onRequestClose:G,contentLabel:Q,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:Q}),e.jsx("button",{onClick:G,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(ge,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(is,{html:Z})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:G,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},$)})]})}export{Pt as default};

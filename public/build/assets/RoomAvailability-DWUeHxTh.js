import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r}from"./index-BOnQTV8N.js";import{c as ce}from"./ReactAppend-QR5TrZfj.js";import{B as de}from"./Base-ZNWmhL1i.js";import{C as me}from"./CreateReactScript-Uc5dYj9m.js";import{m as D}from"./main-B6F2O9-U.js";import{S as h}from"./CartKuchara-D9l7c7at.js";import{C as pe,N as he}from"./Number2Currency-jIsa99f9.js";import{M as Q}from"./Modal-xDw9ufjg.js";import{D as M}from"./index.es-6yWvxdWu.js";import"./SearchWidget-D7iHOckK.js";import{e as F}from"./es-QTeD0CGG.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./Global-Bz6gVLc5.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CanAccess-VF1adbOh.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";import"./BooleanLimit-D-OsQsek.js";import"./floating-ui.react-h8x3UwNO.js";import"./floating-ui.dom-CID5cQpR.js";import"./format-B6vr9H0z.js";const xe=({rooms:P=[]})=>{var W;const j=r.useRef(),w=r.useRef(),[q,Z]=r.useState(new Date),[z,ee]=r.useState([]),[B,L]=r.useState(!1),[m,X]=r.useState(null),[x,se]=r.useState(null),[ae,G]=r.useState(!1),[g,K]=r.useState(null),[N,H]=r.useState(null),[U,Y]=r.useState(""),[C,E]=r.useState(!0),k=async(s=q)=>{L(!0);try{const a=s.toISOString().split("T")[0],n=await(await fetch(`/api/admin/room-availability/summary?date=${a}`,{headers:{Accept:"application/json","X-Xsrf-Token":decodeURIComponent(D.Cookies.get("XSRF-TOKEN"))}})).json();n.status===200&&ee(n.data.rooms||[])}catch(a){console.error("Error al cargar resumen:",a)}L(!1)};r.useEffect(()=>{k()},[]);const te=s=>{Z(s),k(s)},le=s=>{const a={available:{bg:"#d4edda",text:"#155724",label:"Disponible"},occupied:{bg:"#f8d7da",text:"#721c24",label:"Ocupada"},reserved:{bg:"#fff3cd",text:"#856404",label:"Reservada"},blocked:{bg:"#e2e3e5",text:"#383d41",label:"Bloqueada"},full:{bg:"#cce5ff",text:"#004085",label:"Sin disponibilidad"}};return a[s]||a.available},_=async s=>{X(s),G(!0),$(j.current).modal("show");try{const a=new Date,l=new Date;l.setMonth(l.getMonth()+3);const t=await(await fetch(`/api/admin/room-availability/${s.id}/calendar?start_date=${a.toISOString().split("T")[0]}&end_date=${l.toISOString().split("T")[0]}`,{headers:{Accept:"application/json","X-Xsrf-Token":decodeURIComponent(D.Cookies.get("XSRF-TOKEN"))}})).json();t.status===200&&se(t.data)}catch(a){console.error("Error al cargar calendario:",a)}G(!1)},ne=s=>{X(s),K(new Date),H(new Date),Y(""),E(!0),$(w.current).modal("show")},oe=async()=>{if(!g||!N){h.fire("Error","Selecciona las fechas","error");return}try{const a=await(await fetch(`/api/admin/room-availability/${m.id}/block`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(D.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify({start_date:g.toISOString().split("T")[0],end_date:N.toISOString().split("T")[0],block:C,reason:U})})).json();a.status===200?(h.fire("Â¡Ã‰xito!",a.message,"success"),$(w.current).modal("hide"),k(),x&&_(m)):h.fire("Error",a.message,"error")}catch{h.fire("Error","Error al procesar la solicitud","error")}},ie=async s=>{if((await h.fire({title:"Generar disponibilidad",text:"Â¿Generar disponibilidad para los prÃ³ximos 365 dÃ­as?",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d",confirmButtonText:"SÃ­, generar",cancelButtonText:"Cancelar"})).isConfirmed)try{const n=await(await fetch(`/api/admin/room-availability/${s}/generate`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(D.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify({days:365})})).json();n.status===200?(h.fire("Â¡Ã‰xito!",n.message,"success"),k()):h.fire("Error",n.message,"error")}catch{h.fire("Error","Error al generar disponibilidad","error")}},re=()=>{if(!x)return null;const{availability:s,bookings:a}=x;console.log("ğŸ“… DEBUG CALENDARIO:",{totalBookings:a==null?void 0:a.length,bookings:a==null?void 0:a.map(t=>{var o;return{id:t.id,check_in:t.check_in,check_out:t.check_out,status:t.status,guest:(o=t.sale)==null?void 0:o.name}}),availabilityDates:s==null?void 0:s.slice(0,5).map(t=>t.date)});const l={};a==null||a.forEach(t=>{const o=t.check_in.split(" ")[0],p=t.check_out.split(" ")[0],[f,y,i]=o.split("-"),[b,O,I]=p.split("-"),J=new Date(parseInt(f),parseInt(y)-1,parseInt(i)),R=new Date(parseInt(b),parseInt(O)-1,parseInt(I));let c=new Date(J);for(;c<=R;){const A=c.getFullYear(),T=String(c.getMonth()+1).padStart(2,"0"),u=String(c.getDate()).padStart(2,"0"),d=`${A}-${T}-${u}`;l[d]||(l[d]=[]),l[d].push(t),c.setDate(c.getDate()+1)}}),console.log("ğŸ—“ï¸ MAPA DE BOOKINGS POR FECHA:",{totalDates:Object.keys(l).length,dates:Object.keys(l).slice(0,10),sampleBooking:l[Object.keys(l)[0]]});const n={};return s==null||s.forEach(t=>{const o=t.date.split("T")[0],[p,f,y]=o.split("-"),i=new Date(parseInt(p),parseInt(f)-1,parseInt(y)),b=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;n[b]||(n[b]=[]),n[b].push({...t,date:o,bookings:l[o]||[]})}),console.log("ğŸ“Š DÃAS CON BOOKINGS:",{totalDays:Object.values(n).flat().length,daysWithBookings:Object.values(n).flat().filter(t=>t.bookings.length>0).length,sample:Object.values(n).flat().slice(0,5).map(t=>({date:t.date,bookings:t.bookings.length,statuses:t.bookings.map(o=>o.status)}))}),Object.entries(n).map(([t,o])=>{const[p,f]=t.split("-"),y=new Date(p,f-1).toLocaleDateString("es-PE",{month:"long",year:"numeric"});return e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-capitalize mb-3",children:y}),e.jsx("div",{className:"d-flex flex-wrap gap-1",children:o.map(i=>{const[b,O,I]=i.date.split("-"),R=new Date(parseInt(b),parseInt(O)-1,parseInt(I)).getDate(),c=i.is_blocked;i.bookings.length>0;const A=i.bookings.some(S=>S.status==="confirmed"),T=i.bookings.some(S=>S.status==="pending");let u="#d4edda",d="#155724",v="Disponible";return c?(u="#e2e3e5",d="#383d41",v="Bloqueada"):A?(u="#f8d7da",d="#721c24",v="Ocupada"):T?(u="#fff3cd",d="#856404",v="Reservada"):i.available_rooms===0&&(u="#fff3cd",d="#856404",v="Sin disponibilidad"),e.jsxs("div",{className:"text-center rounded p-2 d-flex align-items-center justify-content-center position-relative",style:{width:"45px",height:"45px",backgroundColor:u,color:d,cursor:"pointer",fontSize:"14px",fontWeight:"bold",border:"1px solid rgba(0,0,0,0.1)"},title:`${i.date}
${v}${i.bookings.map(S=>{var V;return`
ğŸ‘¤ ${((V=S.sale)==null?void 0:V.name)||"Cliente"}`}).join("")}`,children:[R,c&&e.jsx("i",{className:"mdi mdi-lock position-absolute",style:{fontSize:"10px",top:"2px",right:"2px"}})]},i.date)})})]},t)})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h4",{className:"header-title mb-0",children:[e.jsx("i",{className:"mdi mdi-calendar-check mr-2"}),"Disponibilidad de Habitaciones"]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"small text-muted mb-1 d-block",children:"Fecha de consulta:"}),e.jsx(M,{selected:q,onChange:te,locale:F,dateFormat:"dd/MM/yyyy",className:"form-control form-control-sm"})]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>k(),disabled:B,children:[e.jsx("i",{className:"mdi mdi-refresh mr-1"}),B?"Cargando...":"Actualizar"]})]})]}),e.jsxs("div",{className:"d-flex gap-3 mb-4 flex-wrap",children:[e.jsxs("span",{className:"badge px-3 py-2",style:{backgroundColor:"#d4edda",color:"#155724"},children:[e.jsx("i",{className:"mdi mdi-check-circle mr-1"})," Disponible"]}),e.jsxs("span",{className:"badge px-3 py-2",style:{backgroundColor:"#f8d7da",color:"#721c24"},children:[e.jsx("i",{className:"mdi mdi-bed mr-1"})," Ocupada"]}),e.jsxs("span",{className:"badge px-3 py-2",style:{backgroundColor:"#fff3cd",color:"#856404"},children:[e.jsx("i",{className:"mdi mdi-clock mr-1"})," Reservada (pendiente)"]}),e.jsxs("span",{className:"badge px-3 py-2",style:{backgroundColor:"#e2e3e5",color:"#383d41"},children:[e.jsx("i",{className:"mdi mdi-lock mr-1"})," Bloqueada"]})]}),e.jsx("div",{className:"row",children:z.map(s=>{const a=le(s.status);return e.jsx("div",{className:"col-xl-4 col-lg-6 col-md-6 mb-4",children:e.jsx("div",{className:"card h-100 border shadow-sm",style:{borderLeft:`4px solid ${a.text}`},children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"mr-3",style:{width:"80px",height:"80px",flexShrink:0},children:e.jsx("img",{src:`/storage/images/item/${s.image}`,alt:s.name,className:"rounded",style:{width:"100%",height:"100%",objectFit:"cover"},onError:l=>{l.target.src="/assets/img/noimage/no_img.jpg"}})}),e.jsxs("div",{className:"flex-grow-1 position-relative px-2",children:[e.jsx("h5",{className:"mb-1",children:s.name}),e.jsx("span",{className:"badge mb-2",style:{backgroundColor:a.bg,color:a.text},children:a.label}),e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"mdi mdi-bed mr-1"}),s.available_rooms?"Disponible":"Reservada"]}),e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"mdi mdi-account-multiple mr-1"}),"MÃ¡x. ",s.max_occupancy," personas"]}),e.jsxs("div",{className:"small text-success font-weight-bold",children:[pe()," ",he(s.price||0)," /noche"]})]})]}),s.active_booking&&e.jsxs("div",{className:"mt-3 p-2 rounded",style:{backgroundColor:"#f8f9fa"},children:[e.jsxs("div",{className:"small font-weight-bold text-primary mb-1",children:[e.jsx("i",{className:"mdi mdi-account mr-1"}),"HuÃ©sped actual:"]}),e.jsx("div",{className:"small",children:s.active_booking.guest_name}),e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"mdi mdi-calendar-range mr-1"}),new Date(s.active_booking.check_in).toLocaleDateString("es-PE")," - ",new Date(s.active_booking.check_out).toLocaleDateString("es-PE")]}),e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"mdi mdi-weather-night mr-1"}),s.active_booking.nights," noches Â· ",s.active_booking.guests," huÃ©spedes"]}),e.jsx("div",{className:"small",children:e.jsx("span",{className:`badge badge-${s.active_booking.status==="confirmed"?"success":"warning"}`,children:s.active_booking.status==="confirmed"?"Confirmada":"Pendiente"})})]}),!s.active_booking&&s.upcoming_bookings>0&&e.jsxs("div",{className:"mt-3 p-2 rounded",style:{backgroundColor:"#fff3cd"},children:[e.jsxs("div",{className:"small font-weight-bold text-warning mb-1",children:[e.jsx("i",{className:"mdi mdi-calendar-clock mr-1"}),"PrÃ³ximas reservas:"]}),e.jsxs("div",{className:"small",children:[s.upcoming_bookings," reserva",s.upcoming_bookings>1?"s":""," en los prÃ³ximos 7 dÃ­as"]}),e.jsx("button",{className:"btn btn-xs btn-outline-warning mt-1",onClick:()=>_(s),children:"Ver calendario"})]}),e.jsxs("div",{className:"mt-3 d-flex gap-2 flex-wrap",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>_(s),title:"Ver calendario",children:e.jsx("i",{className:"mdi mdi-calendar"})}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ne(s),title:"Bloquear fechas",children:e.jsx("i",{className:"mdi mdi-lock"})}),e.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>ie(s.id),title:"Generar disponibilidad",children:e.jsx("i",{className:"mdi mdi-plus-circle"})})]})]})})},s.id)})}),z.length===0&&!B&&e.jsxs("div",{className:"text-center text-muted py-5",children:[e.jsx("i",{className:"mdi mdi-bed-empty mdi-48px"}),e.jsx("p",{className:"mt-2",children:"No hay habitaciones registradas"})]})]})})})}),e.jsx(Q,{modalRef:j,title:`Calendario - ${(m==null?void 0:m.name)||""}`,size:"lg",hideButtonSubmit:!0,children:ae?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando calendario..."})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:"badge px-2 py-1",style:{backgroundColor:"#d4edda",color:"#155724",fontSize:"11px"},children:"Disponible"}),e.jsx("span",{className:"badge px-2 py-1",style:{backgroundColor:"#f8d7da",color:"#721c24",fontSize:"11px"},children:"Ocupado"}),e.jsx("span",{className:"badge px-2 py-1",style:{backgroundColor:"#fff3cd",color:"#856404",fontSize:"11px"},children:"Sin disponibilidad"}),e.jsx("span",{className:"badge px-2 py-1",style:{backgroundColor:"#e2e3e5",color:"#383d41",fontSize:"11px"},children:"Bloqueado"})]}),re(),((W=x==null?void 0:x.bookings)==null?void 0:W.length)>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{children:"Reservas en este perÃ­odo:"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"HuÃ©sped"}),e.jsx("th",{children:"Check-in"}),e.jsx("th",{children:"Check-out"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:x.bookings.map(s=>{var n,t,o;const l=(p=>({pending:{badge:"badge-warning",label:"Pendiente",color:"#f1b44c",bg:"#fff3cd"},confirmed:{badge:"badge-success",label:"Confirmada",color:"#28a745",bg:"#d4edda"},cancelled:{badge:"badge-danger",label:"Cancelada",color:"#dc3545",bg:"#f8d7da"},completed:{badge:"badge-info",label:"Completada",color:"#17a2b8",bg:"#d1ecf1"},no_show:{badge:"badge-secondary",label:"No Show",color:"#6c757d",bg:"#e2e3e5"}})[p]||{badge:"badge-secondary",label:p||"Sin estado",color:"#6c757d",bg:"#e2e3e5"})(s.status);return e.jsxs("tr",{children:[e.jsxs("td",{children:[(n=s.sale)==null?void 0:n.name," ",(t=s.sale)==null?void 0:t.lastname,e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:(o=s.sale)==null?void 0:o.email})]}),e.jsx("td",{children:new Date(s.check_in).toLocaleDateString("es-PE")}),e.jsx("td",{children:new Date(s.check_out).toLocaleDateString("es-PE")}),e.jsx("td",{children:e.jsx("span",{className:"badge",style:{backgroundColor:l.bg,color:l.color,fontWeight:"500"},children:l.label})})]},s.id)})})]})})]})]})}),e.jsxs(Q,{modalRef:w,title:`Bloquear/Desbloquear - ${(m==null?void 0:m.name)||""}`,size:"md",buttonSubmit:"Aplicar",onSubmit:oe,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"AcciÃ³n"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:"blockAction",checked:C,onChange:()=>E(!0)}),e.jsxs("label",{className:"form-check-label",htmlFor:"blockAction",children:[e.jsx("i",{className:"mdi mdi-lock mr-1 text-danger"}),"Bloquear fechas"]})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:"unblockAction",checked:!C,onChange:()=>E(!1)}),e.jsxs("label",{className:"form-check-label",htmlFor:"unblockAction",children:[e.jsx("i",{className:"mdi mdi-lock-open mr-1 text-success"}),"Desbloquear fechas"]})]})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha inicio"}),e.jsx(M,{selected:g,onChange:s=>K(s),selectsStart:!0,startDate:g,endDate:N,minDate:new Date,locale:F,dateFormat:"dd/MM/yyyy",className:"form-control"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha fin"}),e.jsx(M,{selected:N,onChange:s=>H(s),selectsEnd:!0,startDate:g,endDate:N,minDate:g||new Date,locale:F,dateFormat:"dd/MM/yyyy",className:"form-control"})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"RazÃ³n (opcional)"}),e.jsx("textarea",{className:"form-control",rows:"3",value:U,onChange:s=>Y(s.target.value),placeholder:"Ej: Mantenimiento, limpieza profunda, evento privado..."})]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"mdi mdi-information mr-1"}),C?"Las fechas bloqueadas no estarÃ¡n disponibles para reservas.":"Las fechas desbloqueadas volverÃ¡n a estar disponibles para reservas."]})]})]})};me((P,j)=>{ce.createRoot(P).render(e.jsx(de,{...j,title:"Disponibilidad de Habitaciones",children:e.jsx(xe,{...j})}))});

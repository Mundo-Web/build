import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as p}from"./index-BH53Isel.js";import{N as v}from"./Number2Currency-e57Tgsuk.js";import{B as ue,a as Se,D as Me,A as Ie,O as Oe,C as Le}from"./OptionCard-C_V13-dD.js";import{M as De}from"./CartItemRow-4VUVjpPz.js";import{P as _e}from"./plus-Bot15Khs.js";import{T as Ve}from"./trash-2-DK1wnsDn.js";import{a as ze}from"./index-xsH4HHeE.js";import{c as xe}from"./createLucideIcon-Cy5Ya80P.js";import{T as Be}from"./tag-BY9rARtP.js";import{m as Ue}from"./main-BvVILmTO.js";import{G as te}from"./Global-ErywZRdd.js";import{t as R}from"./index-CMHsc23u.js";import{I as J}from"./InputForm-ZnsQvLid.js";import{l as Ge}from"./lodash-CblvOeJM.js";import{C as ae}from"./circle-x-p-TkKhsF.js";import{m as Q}from"./proxy-BTYtmp9V.js";import"./ProductNavigation-B9bkgv22.js";import"./ProductCard-Ap6bpF1Q.js";/* empty css              */import"./BlogCarousel-CCgb3gK1.js";/* empty css               */import"./InfiniteCategory-BtlY-czj.js";import{M as He}from"./PaymentModal-Bxx5p2o_.js";import{H as Xe}from"./HtmlContent-FTivcJrM.js";import{X as Ke}from"./x-DBMwyD6F.js";import"./index-yBjzXJbu.js";import"./useStateManager-7e1e8489.esm-oj4m82YY.js";import"./hoist-non-react-statics.cjs-kbdZbs82.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./tippy-react.esm-BWiGTO87.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./ItemsRest-DGjwRLrz.js";import"./BasicRest-B3rfI5GY.js";import"./HeaderSearch-B_41BEro.js";import"./index-CFtDjG4d.js";import"./eye-CKCH9ORv.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=xe("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=xe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=xe("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=xe("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]),We=({setCart:n,...r})=>{const l=()=>{n(x=>x.filter(c=>c.id!==r.id))},g=()=>{n(x=>x.map(c=>c.id===r.id?{...c,quantity:(c.quantity||1)+1}:c))},N=()=>{n(x=>x.map(c=>{if(c.id===r.id){const h=(c.quantity||1)-1;return h<=0?(l(r.id),null):{...c,quantity:h}}return c}).filter(Boolean))};return e.jsx("div",{className:"w-full bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center  justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[e.jsx("img",{src:`/storage/images/item/${r.image}`,alt:r.name,className:"w-20 h-20 object-cover rounded flex-shrink-0",onError:x=>x.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-lg mb-2 line-clamp-2",children:r.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark",children:r.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Disponibilidad: ",e.jsxs("span",{className:"customtext-neutral-dark",children:[r.stock>=r.quantity?"En stock":"Agotado"," "]})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark",children:r.sku})]})]})]}),e.jsxs("div",{className:"flex flex-row justify-between md:flex-col items-end md:items-end gap-4 mt-4 md:mt-0 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(r.price*r.quantity).toFixed(2)]}),e.jsxs("div",{className:"font-bold text-lg",children:["S/ ",Number(r.final_price*r.quantity).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsx("button",{type:"button",onClick:N,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Decrease quantity",children:e.jsx(De,{size:16})}),e.jsx("div",{className:"w-12 h-8 flex justify-center items-center bg-white",children:e.jsx("span",{className:"font-semibold text-sm",children:r.quantity||1})}),e.jsx("button",{type:"button",onClick:g,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Increase quantity",children:e.jsx(_e,{size:16})})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-red-500 transition-colors duration-200 rounded-full hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200","aria-label":"Remove item",children:e.jsx(Ve,{size:18})})]})]})]})},r.id)},Ze="/api";class ye{static async applyToCart(r,l,g=null){var N;try{if(console.log("🛒 Applying discount rules to cart:",{cartItems:r,totalAmount:l,customerEmail:g}),!Array.isArray(r)||r.length===0)return{success:!1,error:"Carrito vacío o inválido",data:null};const x={cart_items:r.map(h=>{const u={item_id:String(h.item_id||h.id||""),quantity:parseInt(h.quantity)||1,price:parseFloat(h.price||h.final_price||0),name:String(h.name||h.description||"Producto sin nombre"),category_id:h.category_id?String(h.category_id):null};return console.log("📦 Processing cart item:",u),u}),total_amount:parseFloat(l)||0,customer_email:g||null};console.log("📤 Sending payload to API:",x);const c=await ze.post(`${Ze}/discount-rules/apply-to-cart`,x);return c.data.status===200?{success:!0,data:c.data.data,message:c.data.message}:{success:!1,error:c.data.message||"Error al aplicar descuentos",data:null}}catch(x){return console.error("Error applying discount rules:",x),(N=x.response)!=null&&N.data?{success:!1,error:x.response.data.message||"Error del servidor",data:x.response.data.data||null}:{success:!1,error:"Error de conexión",data:null}}}static formatDiscounts(r){return!r||!Array.isArray(r)?[]:r.map(l=>({id:l.rule_id,name:l.rule_name||"Descuento automático",description:l.description||"",amount:parseFloat(l.discount_amount||0),type:l.discount_type||"fixed",promotion_type:l.promotion_type||null,free_items:l.free_items||[],formatted_amount:l.discount_type==="percentage"?`${l.discount_amount}%`:`S/ ${parseFloat(l.discount_amount||0).toFixed(2)}`}))}static getFreeItems(r){if(!r||!Array.isArray(r))return[];const l=[];return r.forEach(g=>{g.free_items&&Array.isArray(g.free_items)&&l.push(...g.free_items)}),l}static calculateTotalDiscount(r){return!r||!Array.isArray(r)?0:r.reduce((l,g)=>l+parseFloat(g.discount_amount||0),0)}}function qe({freeItems:n}){return!n||n.length===0?null:e.jsxs("div",{className:"space-y-3 border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-semibold",children:[e.jsx("span",{className:"text-lg",children:"🎁"}),e.jsx("span",{className:"text-sm",children:"¡Productos GRATIS incluidos!"})]}),e.jsx("div",{className:"space-y-3",children:n.map((r,l)=>e.jsx("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`/storage/images/item/${r.item_image}`,alt:r.item_name,className:"w-16 h-16 object-cover rounded-lg",onError:g=>{g.target.src="/api/cover/thumbnail/null"}}),e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:"¡GRATIS!"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-green-700 text-sm",children:r.item_name}),e.jsxs("p",{className:"text-green-600 text-xs",children:["Cantidad gratuita: ",r.quantity]}),e.jsxs("p",{className:"text-green-600 text-xs",children:["Valor: S/ ",v(r.item_price)," c/u"]}),r.buy_quantity&&r.get_quantity&&e.jsxs("p",{className:"text-green-600 text-xs font-medium mt-1",children:["📦 Compra ",r.buy_quantity," → Lleva ",r.get_quantity," GRATIS"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-green-700 font-bold text-sm",children:"Ahorras"}),e.jsxs("div",{className:"text-green-700 font-bold text-lg",children:["S/ ",v(r.discount)]})]})]})},l))}),n.length>1&&e.jsx("div",{className:"bg-green-100 border-2 border-green-300 rounded-xl p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-green-700 font-semibold",children:"Total ahorro en productos gratis:"}),e.jsxs("span",{className:"text-green-700 font-bold text-lg",children:["S/ ",v(n.reduce((r,l)=>r+parseFloat(l.discount||0),0))]})]})})]})}function et({suggestion:n,onAddToCart:r,cart:l,setCart:g}){const[N,x]=p.useState(!1),c=async()=>{x(!0);try{const h=l.findIndex(u=>(u.item_id||u.id)===n.item_id);if(h!==-1){const u=[...l];u[h].quantity+=n.suggested_quantity,g(u)}else console.warn("Item no encontrado en carrito para promoción");r&&await r()}catch(h){console.error("Error al agregar producto promocional:",h)}finally{x(!1)}};return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-4 mb-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-green-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold text-green-800 uppercase tracking-wide",children:"¡Promoción Disponible!"})]}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:["¡Agrega ",n.suggested_quantity," más y llévalo GRATIS!"]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Producto:"})," ",n.item_name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tienes:"})," ",n.current_quantity," unidades"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Agrega:"})," ",n.suggested_quantity," más y",e.jsxs("span",{className:"font-bold text-green-600",children:[" ¡te ahorras S/ ",n.savings,"!"]})]})]}),e.jsxs("div",{className:"text-xs text-green-700 bg-green-100 px-3 py-1 rounded-full inline-block mb-3",children:["Compra ",n.buy_quantity," lleva ",n.get_quantity," gratis"]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:`/storage/${n.item_image}`,alt:n.item_name,className:"w-16 h-16 object-cover rounded-lg border border-gray-200"})})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-green-200",children:e.jsx("button",{onClick:c,disabled:N,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Agregando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4"}),"¡Aprovechar Promoción Gratis!"]})})})]})}function tt({cart:n,setCart:r,onContinue:l,subTotal:g,envio:N,igv:x,totalFinal:c,openModal:h,automaticDiscounts:u,setAutomaticDiscounts:m,automaticDiscountTotal:s,setAutomaticDiscountTotal:o,totalWithoutDiscounts:d}){const[b,$]=p.useState(u||[]),[F,L]=p.useState(s||0),[D,K]=p.useState(!1),[re,Y]=p.useState([]),[H,B]=p.useState([]),M=n.length===0;p.useEffect(()=>{if(n.length>0&&g>0)U();else{const y=[];$(y),L(0),Y([]),B([]),m&&m(y),o&&o(0)}},[n,g]);const U=async()=>{K(!0);try{console.log("🛒 CartStep applying discounts:",{cart:n,subTotal:g,totalWithoutDiscounts:d});const y=await ye.applyToCart(n,d);if(y.success&&y.data){const k=ye.formatDiscounts(y.data.applied_discounts),E=y.data.total_discount||0,f=ye.getFreeItems(y.data.applied_discounts),A=[];y.data.applied_discounts.forEach(X=>{X.suggested_items&&Array.isArray(X.suggested_items)&&A.push(...X.suggested_items)}),$(k),L(E),Y(f),B(A),m&&m(k),o&&o(E)}else{console.error("❌ Discount application failed:",y.error);const k=[],E=0;$(k),L(E),Y([]),B([]),m&&m(k),o&&o(E)}}catch(y){console.error("Error applying discount rules:",y);const k=[],E=0;$(k),L(E),Y([]),B([]),m&&m(k),o&&o(E)}finally{K(!1)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:[H.length>0&&e.jsx("div",{className:"space-y-4",children:H.map((y,k)=>e.jsx(et,{suggestion:y,cart:n,setCart:r,onAddToCart:U},`suggestion-${y.item_id}-${k}`))}),M?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito está vacío"}),e.jsx("p",{className:"text-gray-500",children:"¡Explora nuestros productos y encuentra algo especial!"})]}):n.map((y,k)=>e.jsx(We,{...y,setCart:r},k))]}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",v(g)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",v(x)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",v(N)]})]}),D&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!D&&b.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-green-600 mb-2",children:"🎉 Descuentos aplicados:"}),b.map((y,k)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-green-600",children:[y.name,y.description&&e.jsx("span",{className:"text-xs text-gray-500 block",children:y.description})]}),e.jsxs("span",{className:"text-green-600 font-semibold",children:["-S/ ",v(y.amount)]})]},k)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold text-green-600 pt-1 border-t border-green-200",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",v(F)]})]})]}),e.jsx(qe,{freeItems:re}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",v(c)]})]}),F>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:["S/ ",v(d||c+F)]}),e.jsxs("span",{className:"ml-2 text-green-600 font-semibold",children:["Ahorras S/ ",v(F)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(ue,{onClick:l,className:"w-full",disabled:M,children:M?"Carrito Vacío":"Continuar Compra"}),e.jsx(Se,{href:"/",className:"w-full",children:M?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>h(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>h(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]})]})}function st(){let n="";for(let r=0;r<12;r++){const l=Math.floor(Math.random()*10);n+=l}return n}const at=n=>new Promise((r,l)=>{var g;try{console.log(n);const N=st(n.email);console.log(N);let x=!1;window.Culqi.publicKey=te.CULQI_PUBLIC_KEY;const c=parseFloat(n.amount.toFixed(2)),h=Math.round(c*100);console.log("💰 Configurando Culqi:"),console.log("   - Monto original:",n.amount),console.log("   - Monto redondeado (soles):",c),console.log("   - Monto en céntimos:",h),console.log("   - Email:",n.email),window.Culqi.settings({title:te.APP_NAME,email:n.email,currency:"PEN",amount:h,order:`${N}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:te.APP_URL+"/assets/resources/logo.png",bannerColor:te.APP_COLOR_PRIMARY,buttonBackground:te.APP_COLOR_PRIMARY}});const u=(g=window.Culqi)==null?void 0:g.close;u&&(window.Culqi.close=function(){return!window.Culqi.token&&!x&&(console.log("🚫 Modal de Culqi cerrado sin completar el pago"),l("Pago cancelado por el usuario")),u.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){l("No se obtuvo un token de Culqi");return}x=!0;const s=window.Culqi.token.id;console.log("✅ Token generado:",s),n={...n,token:s,orderNumber:N},console.log("_request actualizado",n);const{status:o,result:d}=await Ue.Fetch("./api/pago",{method:"POST",body:JSON.stringify(n)});o||console.log((d==null?void 0:d.message)||"Error en el pago"),window.Culqi.close(),R.success("¡Pago exitoso!",{description:"Tu pago se procesó correctamente. Pronto recibirás la confirmación de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),r(d)}catch(s){R.error("¡Error en el Pago!",{description:s.message,duration:3e3,position:"top-right",richColors:!0}),l(s.message||"Error en el pago")}},window.addEventListener("message",function(s){s.data==="culqi_closed"&&l("Pago cancelado por el usuario")});const m=s=>{s.key==="Escape"&&!x&&(console.log("🚫 Modal de Culqi cerrado con Escape"),l("Pago cancelado por el usuario"))};document.addEventListener("keydown",m),setTimeout(()=>{document.removeEventListener("keydown",m)},3e5),document.addEventListener("culqi.error",function(s){var o,d;R.error("¡Error en Culqi!",{description:((o=s.detail)==null?void 0:o.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),l(((d=s.detail)==null?void 0:d.message)||"Error desconocido")})}catch(N){R.error("¡Error en la integración con Culqi!",{description:N.message,duration:3e3,position:"top-right",richColors:!0}),l("Error en la integración con Culqi")}});function rt({cart:n,setSale:r,setCode:l,setDelivery:g,setCart:N,onContinue:x,noContinue:c,subTotal:h,igv:u,totalFinal:m,user:s,setEnvio:o,envio:d,ubigeos:b=[],openModal:$,setCouponDiscount:F,setCouponCode:L,automaticDiscounts:D=[],automaticDiscountTotal:K=0,totalWithoutDiscounts:re,conversionScripts:Y,setConversionScripts:H,onPurchaseComplete:B}){var Ce,ke;const[M,U]=p.useState(null),[y,k]=p.useState(null),E=D.reduce((a,t)=>t.free_items&&Array.isArray(t.free_items)?[...a,...t.free_items]:a,[]),[f,A]=p.useState({name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:"",reference:(s==null?void 0:s.reference)||"",ubigeo:(s==null?void 0:s.ubigeo)||null});p.useEffect(()=>{if(s!=null&&s.ubigeo&&(s!=null&&s.district)&&(s!=null&&s.province)&&(s!=null&&s.department)){const a={value:s.ubigeo,label:`${s.district}, ${s.province}, ${s.department}`,data:{reniec:s.ubigeo,departamento:s.department,provincia:s.province,distrito:s.district}};k(a),U(a),Ne(a)}},[s]);const[X,ne]=p.useState(!1),[W,oe]=p.useState(!1),[Z,ie]=p.useState([]),[V,ee]=p.useState(null),[be,he]=p.useState(null),[C,I]=p.useState({}),[S,O]=p.useState(""),[G,le]=p.useState(""),[_,ce]=p.useState(null),[de,je]=p.useState(0),[me,ve]=p.useState(!1),[ge,se]=p.useState(""),Ee=a=>{var i,w,j;const t=["name","lastname","email","phone","ubigeo","address","shipping"];for(const q of t)if(a[q]){let P=null,T=!1;if(q==="ubigeo"?P=((w=(i=document.querySelector('[name="ubigeo"]'))==null?void 0:i.parentElement)==null?void 0:w.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):q==="shipping"?P=((j=document.querySelector('input[name="shipping"]'))==null?void 0:j.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(P=document.querySelector(`[name="${q}"]`),T=!0),P){P.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),T&&setTimeout(()=>{try{P.focus(),P.tagName==="INPUT"&&P.type==="text"&&P.select()}catch($e){console.warn("No se pudo enfocar el elemento:",$e)}},600),Pe(P);break}}},Pe=a=>{if(!a)return;const t=document.createElement("div");if(t.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const w=document.createElement("style");w.id="error-highlight-styles",w.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(w)}const i=a.style.position;(!i||i==="static")&&(a.style.position="relative"),a.appendChild(t),setTimeout(()=>{t.parentNode&&(t.parentNode.removeChild(t),(!i||i==="static")&&(a.style.position=i))},1200)},Ne=async a=>{if(!a)return;I(i=>({...i,ubigeo:""}));const{data:t}=a;A(i=>({...i,department:t.departamento,province:t.provincia,district:t.distrito,ubigeo:t.reniec})),ne(!0);try{const i=await Me.getShippingCost({ubigeo:t.reniec}),w=[];i.data.is_free?(w.push({type:"free",price:0,description:i.data.standard.description,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics}),i.data.express.price>0&&w.push({type:"express",price:i.data.express.price,description:i.data.express.description,deliveryType:i.data.express.type,characteristics:i.data.express.characteristics})):i.data.is_agency?w.push({type:"agency",price:0,description:i.data.agency.description,deliveryType:i.data.agency.type,characteristics:i.data.agency.characteristics}):w.push({type:"standard",price:i.data.standard.price,description:i.data.standard.description,deliveryType:i.data.standard.type,characteristics:i.data.standard.characteristics}),ie(w),ee(w[0].type),o(w[0].price)}catch{R.error("Sin cobertura",{description:"No realizamos envíos a esta ubicación.",icon:e.jsx(fe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),ie([]),ee(null),o(0)}ne(!1)},we=async a=>{var j,q;if(a.preventDefault(),W)return;if(!s){R.error("Acceso requerido",{description:"Debe iniciar sesión para continuar.",icon:e.jsx(Qe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"});return}const t={},i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,w=/^[0-9]{9}$/;if(f.name.trim()||(t.name="Nombre es requerido"),f.lastname.trim()||(t.lastname="Apellido es requerido"),f.email.trim()?i.test(f.email)||(t.email="Email inválido"):t.email="Email es requerido",f.phone.trim()?w.test(f.phone.trim())||(t.phone="Teléfono debe tener exactamente 9 dígitos"):t.phone="Teléfono es requerido",f.ubigeo||(t.ubigeo="Ubicación es requerida"),f.address||(t.address="Dirección es requerida"),V||(t.shipping="Seleccione un método de envío"),Object.keys(t).length>0){I(t);const P=Object.keys(t)[0],T={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",email:(j=t.email)!=null&&j.includes("inválido")?"Por favor ingrese un correo electrónico válido":"Por favor ingrese su correo electrónico",phone:(q=t.phone)!=null&&q.includes("9 dígitos")?"El teléfono debe tener exactamente 9 dígitos":"Por favor ingrese su número de teléfono",ubigeo:"Por favor seleccione su ubicación de entrega",address:"Por favor ingrese su dirección de entrega",shipping:"Por favor seleccione un método de envío"};R.error("Complete el campo requerido",{description:T[P],icon:e.jsx(ae,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),Ee(t);return}oe(!0);try{const P={user_id:s.id,...f,fullname:`${f.name} ${f.lastname}`,country:"Perú",amount:z(pe),delivery:z(d),cart:n,coupon_id:(_==null?void 0:_.id)||null,coupon_code:(_==null?void 0:_.code)||null,coupon_discount:z(de||0)};console.log("📦 Request completo a enviar:",P),console.log("💰 Monto final con cupón:",pe),console.log("🎟️ Descuento del cupón:",de),console.log("🚚 Costo de envío:",d);const T=await at(P);T.status?(r(T.sale),g(T.delivery),l(T.code),T.conversion_scripts&&(console.log("Scripts de conversión recibidos:",T.conversion_scripts),H(T.conversion_scripts),B&&B(T.sale_id,T.conversion_scripts)),N([]),x()):R.error("Error en el pago",{description:T.message||"Pago rechazado",icon:e.jsx(fe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch{R.error("Lo sentimos, no puede continuar con la compra",{description:"Ocurrió un error al procesar el pedido.",icon:e.jsx(fe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{oe(!1)}},Te=p.useCallback(Ge.debounce((a,t)=>{if(a.length<3){t([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(a)}`).then(i=>{if(!i.ok)throw new Error("Error en la respuesta");return i.json()}).then(i=>{const w=i.map(j=>({value:j.reniec,label:`${j.distrito}, ${j.provincia}, ${j.departamento}`,data:{inei:j.inei,reniec:j.reniec,departamento:j.departamento,provincia:j.provincia,distrito:j.distrito}}));t(w)}).catch(i=>{t([])})},300),[]);p.useEffect(()=>{I(a=>{const t={...a};return f.name.trim()&&delete t.name,f.lastname.trim()&&delete t.lastname,f.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email)&&delete t.email,f.phone.trim()&&/^[0-9]{9}$/.test(f.phone.trim())&&delete t.phone,f.address.trim()&&delete t.address,f.ubigeo&&delete t.ubigeo,V&&delete t.shipping,t})},[f,V]);const Fe=a=>({control:t=>({...t,border:`1px solid ${a?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:a?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:t=>({...t,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:t=>({...t,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),Ae=async()=>{var a;if(!G.trim()){se("Ingrese un código de cupón");return}ve(!0),se("");try{const t=[...new Set(n.map(q=>q.category_id).filter(Boolean))],i=n.map(q=>q.id);console.log("Validando cupón:",{code:G.trim(),cart_total:h,category_ids:t,product_ids:i});const w=await Le.validateCoupon({code:G.trim(),cart_total:h,category_ids:t,product_ids:i});console.log("Respuesta del cupón:",w);const j=w.data||w;if(j&&j.valid){ce(j.coupon);const q=Math.round(j.discount*100)/100;je(q),F&&F(q),L&&L(((a=j.coupon)==null?void 0:a.code)||G.trim()),R.success("Cupón aplicado",{description:j.message||"Cupón aplicado correctamente",duration:3e3,position:"top-center"})}else{const q=(j==null?void 0:j.message)||"Cupón no válido";se(q),R.error("Cupón no válido",{description:q,icon:e.jsx(ae,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(t){console.error("Error al validar cupón:",t),se("Error al validar el cupón"),R.error("Error",{description:t.message||"No se pudo validar el cupón. Intente nuevamente.",icon:e.jsx(ae,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{ve(!1)}},Re=()=>{ce(null),je(0),le(""),se(""),F&&F(0),L&&L(""),R.success("Cupón removido",{description:"El cupón ha sido removido de su pedido",duration:2e3,position:"top-center"})},z=a=>{const t=typeof a=="string"?parseFloat(a):a;return parseFloat(t.toFixed(2))},pe=z(m-de);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:we,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{name:"name",label:"Nombres",value:f.name,error:C.name,onChange:a=>{A(t=>({...t,name:a.target.value})),a.target.value.trim()&&C.name&&I(t=>({...t,name:""}))},required:!0,className:`border-gray-200 ${C.name?"border-red-500 bg-red-50":""}`}),e.jsx(J,{name:"lastname",label:"Apellidos",value:f.lastname,error:C.lastname,onChange:a=>{A(t=>({...t,lastname:a.target.value})),a.target.value.trim()&&C.lastname&&I(t=>({...t,lastname:""}))},required:!0,className:`border-gray-200 ${C.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsx(J,{name:"email",label:"Correo electrónico",type:"email",value:f.email,error:C.email,onChange:a=>{A(t=>({...t,email:a.target.value})),a.target.value.trim()&&C.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.target.value)&&I(i=>({...i,email:""}))},required:!0,className:`border-gray-200 ${C.email?"border-red-500 bg-red-50":""}`}),e.jsx(J,{name:"phone",label:"Teléfono",type:"tel",value:f.phone,error:C.phone,onChange:a=>{const t=a.target.value.replace(/\D/g,"");A(i=>({...i,phone:t})),t.length===9&&C.phone&&I(i=>({...i,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${C.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (Ubicación de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(Ie,{name:"ubigeo",cacheOptions:!0,value:M,loadOptions:Te,onChange:a=>{U(a),Ne(a),O("")},inputValue:S,onInputChange:(a,{action:t})=>{t==="input-change"&&O(a)},onFocus:()=>{U(null),O("")},onMenuOpen:()=>{M&&(U(null),O(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:a})=>a.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:X,styles:Fe(!!C.ubigeo),formatOptionLabel:({data:a})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:a.distrito}),e.jsxs("div",{className:"text-gray-500",children:[a.provincia,", ",a.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),C.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:C.ubigeo})]}),e.jsx(J,{name:"address",label:"Dirección ",value:f.address,error:C.address,onChange:a=>{A(t=>({...t,address:a.target.value})),a.target.value.trim()&&C.address&&I(t=>({...t,address:""}))},required:!0,className:`border-gray-200 ${C.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Número",value:f.number,onChange:a=>A(t=>({...t,number:a.target.value})),className:"border-gray-200"}),e.jsx(J,{label:"Referencia",value:f.reference,onChange:a=>A(t=>({...t,reference:a.target.value})),className:"border-gray-200"})]}),Z.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Método de envío"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Z.map(a=>e.jsx(Oe,{title:a.deliveryType,price:a.price,description:a.description,selected:V===a.type,onSelect:()=>{ee(a.type),o(a.price),I(t=>({...t,shipping:""}))}},a.type))}),V&&Z.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(ke=(Ce=Z.find(a=>a.type===V))==null?void 0:Ce.characteristics)==null?void 0:ke.map((a,t)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(Je,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:a})})]},`char-${t}`))})]}),!c&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(Se,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(ue,{type:"submit",loading:X,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:n.map(a=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/storage/images/item/${a.image}`,alt:a.name,className:"w-16 h-16 object-cover rounded-lg",onError:t=>t.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cantidad: ",a.quantity]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["S/ ",v(a.final_price)]})]})]},a.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",v(z(h))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",v(z(u))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Envío:"}),e.jsxs("span",{children:["S/ ",v(z(d))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"¿Tienes un cupón de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu código de cupón",value:G,onChange:a=>le(a.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${ge?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":_?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!_||me}),me&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),_?e.jsx("button",{type:"button",onClick:Re,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cupón",children:e.jsx(ae,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:Ae,disabled:me||!G.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:me?"Validando...":"Aplicar"})]}),ge&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:ge})]}),_&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",_.type==="percentage"?`${_.value}%`:`S/${v(_.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:_.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-S/ ",v(z(de))]})})]})})]})}),D&&D.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium text-green-600 mb-2",children:"🎉 Descuentos automáticos aplicados:"}),D.map((a,t)=>e.jsx("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-700 font-semibold text-sm",children:a.name}),a.description&&e.jsx("p",{className:"text-green-600 text-xs mt-1",children:a.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"text-green-700 font-bold text-base",children:["-S/ ",v(a.amount)]})})]})},t)),K>0&&e.jsx("div",{className:"bg-green-50 border-2 border-green-300 rounded-xl p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-green-700 font-semibold",children:"Total descuentos automáticos:"}),e.jsxs("span",{className:"text-green-700 font-bold text-lg",children:["-S/ ",v(K)]})]})})]})}),E.length>0&&e.jsx(qe,{freeItems:E}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",v(z(pe))]})]})}),e.jsx(ue,{onClick:we,className:"w-full mt-6",disabled:W,loading:W,children:W?"Procesando...":`Pagar S/ ${v(z(pe))}`}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>$(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>$(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})]})]})]})}function nt({cart:n,code:r,delivery:l,couponDiscount:g=0,couponCode:N=null,conversionScripts:x=null}){const h=(n.reduce((o,d)=>{const b=d.final_price;return o+b*d.quantity},0)/1.18).toFixed(2),u=(h*.18).toFixed(2),s=parseFloat(h)+parseFloat(u)+parseFloat(l)-g;return p.useEffect(()=>{if(x){console.log("Executing conversion scripts...");try{if(x.head){const o=document.createElement("script");o.innerHTML=x.head,document.head.appendChild(o)}if(x.body){const o=document.createElement("script");o.innerHTML=x.body,document.body.appendChild(o)}console.log("Conversion scripts executed successfully")}catch(o){console.error("Error executing conversion scripts:",o)}}},[x]),e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(Q.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(Q.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"✓"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"¡Gracias por tu compra! 🎉"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(Q.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"Código de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${r}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:n.map((o,d)=>e.jsx(Q.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:d*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${o.image}`,alt:o.name,className:"w-24 h-24 object-cover rounded-lg",onError:b=>b.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-xl lg:w-8/12 line-clamp-3",children:o.name}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:["S/ ",v(o.final_price*o.quantity)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:o.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:o.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:o.sku})]})]})]})]})},d))}),e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[[{label:"Subtotal",value:h},{label:"IGV",value:u},{label:"Envío",value:l}].map((o,d)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:o.label}),e.jsxs("span",{className:"font-semibold",children:["S/ ",v(o.value)]})]},d)),g>0&&N&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark text-start",children:["Cupón: ",e.jsx("br",{className:"lg:hidden"}),e.jsxs("span",{className:"font-semibold text-xs lg:text-base",children:["(",N,")"]})]}),e.jsxs("span",{className:"font-semibold",children:["-S/ ",v(g)]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",v(s)]})]})})]}),e.jsx(Q.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(ue,{href:"/catalogo",className:"w-full mx-auto md:w-auto",children:"Seguir Comprando"})})]})]})})})}const ot=()=>{const n=p.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),r=(u,m={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[u],content_type:"product",content_name:m.name||"",value:m.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:m.price||0,items:[{item_id:u,item_name:m.name||"",category:m.category||"",price:m.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:u,content_type:"product",content_name:m.name||"",value:m.price||0,currency:"PEN"}),console.log("✅ ProductView tracked for product:",u))},l=async(u,m=1,s={})=>{var o;if(!(typeof window>"u"))try{const b=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.content)||""},body:JSON.stringify({product_id:u,quantity:m,...s})})).json();b.success&&b.tracking_scripts&&(c(b.tracking_scripts),console.log("✅ AddToCart tracked successfully"))}catch(d){console.error("❌ Error tracking AddToCart:",d)}},g=async(u,m)=>{var s;if(!(typeof window>"u"||n.current.hasTrackedInitiateCheckout))try{n.current.hasTrackedInitiateCheckout=!0;const d=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""},body:JSON.stringify({cart_items:u.map(b=>({product_id:b.id,name:b.name,price:b.final_price||b.price,quantity:b.quantity,subtotal:(b.final_price||b.price)*b.quantity}))})})).json();d.success&&d.tracking_scripts&&(c(d.tracking_scripts),console.log("✅ InitiateCheckout tracked successfully"))}catch(o){console.error("❌ Error tracking InitiateCheckout:",o),n.current.hasTrackedInitiateCheckout=!1}},N=(u,m)=>{typeof window>"u"||(m?c(m):fetch(`/api/tracking/purchase/${u}`).then(s=>s.text()).then(s=>{s&&(c(s),console.log("✅ Purchase tracked successfully"))}).catch(s=>{console.error("❌ Error tracking Purchase:",s)}))},x=(u,m=[])=>{if(typeof window>"u"||n.current.hasTrackedPageView)return;n.current.hasTrackedPageView=!0;const s=m.reduce((o,d)=>o+(d.final_price||d.price)*d.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),u===1&&m.length>0&&window.fbq("track","AddToCart",{content_ids:m.map(o=>o.id),content_type:"product",value:s,currency:"PEN",num_items:m.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${u}`,page_location:window.location.href}),u===1&&m.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:s,items:m.map(o=>{var d;return{item_id:o.id,item_name:o.name,category:((d=o.category)==null?void 0:d.name)||"Sin categoría",quantity:o.quantity,price:o.final_price||o.price}})})),console.log(`✅ Checkout PageView tracked - Step ${u}`)},c=u=>{if(typeof window>"u"||!u)return;const m=document.createElement("div");m.innerHTML=u,m.querySelectorAll("script").forEach(o=>{const d=document.createElement("script");d.textContent=o.textContent,document.head.appendChild(d),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},100)})};return{trackProductView:r,trackAddToCart:l,trackInitiateCheckout:g,trackPurchase:N,trackCheckoutPageView:x,resetTracking:()=>{n.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};function Ht({cart:n,setCart:r,user:l,ubigeos:g=[],items:N,generals:x}){const[c,h]=p.useState(1),u=n.reduce((S,O)=>S+O.final_price*O.quantity,0),{trackCheckoutPageView:m,trackInitiateCheckout:s,trackPurchase:o,resetTracking:d}=ot(),b=parseFloat((u/1.18).toFixed(2)),$=parseFloat((u-b).toFixed(2)),[F,L]=p.useState(0),[D,K]=p.useState(0),[re,Y]=p.useState(null),[H,B]=p.useState([]),[M,U]=p.useState(0),y=b+$+parseFloat(F),k=D+M,E=Math.max(0,y-k),[f,A]=p.useState([]),[X,ne]=p.useState([]),[W,oe]=p.useState([]),[Z,ie]=p.useState(null);p.useEffect(()=>(m(c,n),()=>d()),[]),p.useEffect(()=>{m(c,n),c===2&&s(n,E)},[c]),p.useEffect(()=>{const S=document.createElement("script");return S.src=te.CULQI_API,S.async=!0,S.onload=()=>{window.culqi=function(){window.Culqi.token||window.Culqi.order}},document.body.appendChild(S),()=>document.body.removeChild(S)},[]);const V=S=>{h(S),window.scrollTo({top:0,behavior:"smooth"})},ee={privacy_policy:"Políticas de privacidad",terms_conditions:"Términos y condiciones",saleback_policy:"Políticas de devolucion y cambio"},[be,he]=p.useState(null),C=S=>he(S),I=()=>he(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${c===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:c>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${c>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${c>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Envío"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:c>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${c===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${c===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmación"})]})]})}),c===1&&e.jsx(tt,{cart:n,setCart:r,onContinue:()=>V(2),subTotal:b,envio:F,igv:$,totalFinal:E,openModal:C,automaticDiscounts:H,setAutomaticDiscounts:B,automaticDiscountTotal:M,setAutomaticDiscountTotal:U,totalWithoutDiscounts:y}),c===2&&e.jsx(rt,{items:N,setCode:ne,setDelivery:oe,cart:n,setSale:A,setCart:r,onContinue:()=>V(3),noContinue:()=>V(1),subTotal:b,envio:F,setEnvio:L,igv:$,totalFinal:E,user:l,ubigeos:g,openModal:C,setCouponDiscount:K,setCouponCode:Y,automaticDiscounts:H,automaticDiscountTotal:M,totalWithoutDiscounts:y}),c===3&&e.jsx(nt,{code:X,delivery:W,cart:f,subTotal:b,envio:F,igv:$,totalFinal:E,couponDiscount:D,couponCode:re,automaticDiscounts:H,automaticDiscountTotal:M,totalWithoutDiscounts:y,conversionScripts:Z,setConversionScripts:ie,onPurchaseComplete:(S,O)=>{o(S,O)}})]}),Object.keys(ee).map((S,O)=>{var _;const G=ee[S],le=((_=x.find(ce=>ce.correlative==S))==null?void 0:_.description)??"";return e.jsxs(He,{isOpen:be===O,onRequestClose:I,contentLabel:G,className:"absolute left-1/2 -translate-x-1/2 bg-white p-6 rounded-xl shadow-lg w-[95%] max-w-4xl my-8",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",children:[e.jsx("button",{onClick:I,className:"float-right text-red-500 hover:text-red-700 transition-all duration-300 ",children:e.jsx(Ke,{width:"2rem",strokeWidth:"4px"})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:G}),e.jsx(Xe,{className:"prose",html:le})]},O)})]})}export{Ht as default};

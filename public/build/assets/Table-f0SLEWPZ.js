var I=Object.defineProperty;var U=(n,i,c)=>i in n?I(n,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[i]=c;var R=(n,i,c)=>U(n,typeof i!="symbol"?i+"":i,c);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{r as f}from"./index-BOnQTV8N.js";import{F as m,h as P}from"./CreateReactScript--Wm4SzCR.js";import{M as T}from"./Modal-BYL-UsqM.js";import{m as _}from"./main-B6F2O9-U.js";import{t as L,T as K}from"./CardProductKatya-ncpmQ0JU.js";import{B}from"./BooleanLimit-D-OsQsek.js";class Q{constructor(){R(this,"save",async(i,c)=>{try{const{status:l,result:p}=await _.Fetch(`/api/admin/fillable/${i}`,{method:"POST",body:JSON.stringify(c)});if(!l)throw new Error((p==null?void 0:p.message)??"Ocurrió un error inesperado");return p.data??!0}catch(l){return L.error("¡Error!",{description:l.message,duration:3e3,position:"bottom-center",richColors:!0}),null}})}}class V{constructor(){R(this,"save",async(i=[])=>{try{const{status:c,result:l}=await _.Fetch("/api/admin/boolean-limits",{method:"POST",body:JSON.stringify({limits:i})});if(!c)throw new Error((l==null?void 0:l.message)??"Ocurrió un error inesperado");return L.success("¡Excelente!",{description:(l==null?void 0:l.message)??"Límites actualizados correctamente",duration:3e3,position:"bottom-center",richColors:!0}),(l==null?void 0:l.data)??!0}catch(c){return L.error("¡Error!",{description:c.message,duration:3e3,position:"bottom-center",richColors:!0}),!1}})}}const X=new Q,Y=new V,Z=({gridRef:n,pageSize:i=10,rest:c,columns:l,toolBar:p,masterDetail:y,filterValue:j,exportable:w,exportableName:k,customizeCell:C=()=>{},onRefresh:N=()=>{},rowDragging:S,sorting:E,withRelations:h})=>{const x=f.useRef(),b=f.useRef(),[F,M]=f.useState(!1),[d,A]=f.useState(m.models[0]??null),[G,O]=f.useState(!1),[g,v]=f.useState([]),J=()=>{if(!d)return;const e=B.list(d);e.length&&(v(e.map(a=>({field:a.field,label:a.label??a.field,max:typeof a.max=="number"?a.max:"",message:a.message??"",general_key:a.general_key,model:d}))),$(b.current).modal("show"))},z=(e,a)=>{v(o=>o.map((s,r)=>r===e?{...s,...a}:s))},W=async e=>{var s;if(e.preventDefault(),!g.length){$(b.current).modal("hide");return}const a=g.filter(r=>r.general_key).map(r=>{var u;return{model:r.model??d,field:r.field,general_key:r.general_key,max:Number(r.max===""?0:r.max),message:((u=r.message)==null?void 0:u.trim())??null,label:r.label}});O(!0);const o=await Y.save(a);O(!1),o&&((s=o==null?void 0:o.limits)!=null&&s.length&&(B.bulkUpdate(d,o.limits),v(o.limits.map(({field:r,limit:u})=>{var D;return{field:r,label:u.label??r,max:typeof u.max=="number"?u.max:"",message:u.message??"",general_key:u.general_key??((D=a.find(H=>H.field===r))==null?void 0:D.general_key),model:d}}))),$(b.current).modal("hide"))},q=async e=>{e.preventDefault();const a=document.querySelectorAll(`input[type="checkbox"][id^="fillable-ck-${d}"]`),o=Array.from(a).reduce((r,u)=>(r[u.value]=u.checked,r),{});M(!0);const s=await X.save(d,o);M(!1),s&&m.set(d,s)};return f.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(n.current).dxDataGrid({language:"es",dataSource:{load:async e=>{const a=await c.paginate({...e,requireTotalCount:!0,...h&&{with:h}});return N(a),a}},onToolbarPreparing:e=>{const{items:a}=e.toolbarOptions;P("Root")&&B.list(d).length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-shield-account",hint:"Configurar límites",text:"Límites",onClick:J}}),P("Root")&&m.models.length>0&&a.unshift({widget:"dxButton",location:"before",options:{icon:"mdi mdi-cog",hint:"Configurar campos",text:"Configurar",onClick:()=>$(x.current).modal("show")}}),p(a)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:j,export:{enabled:w},onExporting:function(e){var a=new ExcelJS.Workbook,o=a.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:o,component:e.component,customizeCell:function(s){C(s),s.excelCell.alignment={horizontal:"left",vertical:"top",...s.excelCell.alignment}},includeHiddenColumns:!0}).then(function(){a.xlsx.writeBuffer().then(function(s){saveAs(new Blob([s],{type:"application/octet-stream"}),`${k}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:i},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:l,masterDetail:y,rowDragging:S,sorting:E,onContentReady:(...e)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),t.jsxs(t.Fragment,{children:[t.jsx(K,{}),t.jsx("div",{ref:n}),t.jsxs(T,{modalRef:x,title:"Configurar campos visibles",onSubmit:q,onClose:()=>{m.models.forEach(e=>{Object.keys(m.values[e]).forEach(a=>{const o=document.getElementById(`fillable-ck-${e}-${a}`);o&&(o.checked=m.values[e][a])})})},loading:F,children:[t.jsx("ul",{class:"nav nav-tabs nav-bordered",children:m.models.map((e,a)=>t.jsx("li",{class:"nav-item",children:t.jsx("button",{href:`#fillable-${e}`,"data-bs-toggle":"tab","aria-expanded":"false",class:`nav-link ${d==e&&"active"}`,onClick:()=>A(e),disabled:F,type:"button",children:e})},a))}),t.jsx("div",{class:"tab-content",style:{minHeight:"240px"},children:m.models.map((e,a)=>t.jsx("div",{class:`tab-pane ${d==e&&"active"}`,id:`fillable-${e}`,children:t.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:Object.keys(m.values[e]).map((o,s)=>t.jsxs("label",{class:"form-check form-check-success border cursor-pointer",htmlFor:`fillable-ck-${e}-${o}`,style:{padding:"2px 10px 2px 30px",borderRadius:"8px",userSelect:"none"},children:[t.jsx("input",{class:"form-check-input cursor-pointer",type:"checkbox",value:o,id:`fillable-ck-${e}-${o}`,defaultChecked:m.values[e][o]}),t.jsx("span",{class:"form-check-label",children:o})]},s))})},a))})]}),t.jsxs(T,{modalRef:b,title:"Configurar límites",onSubmit:W,loading:G,onClose:()=>v([]),children:[!g.length&&t.jsx("p",{className:"text-muted mb-0",children:"No hay límites configurados para este módulo."}),g.map((e,a)=>t.jsxs("div",{className:"row g-2 align-items-center mb-3",children:[t.jsx("div",{className:"col-md-12",children:t.jsx("label",{className:"form-label mb-0",children:e.label})}),t.jsx("div",{className:"col-md-3",children:t.jsx("input",{type:"number",min:"0",className:"form-control",value:e.max===""?"":e.max,onChange:o=>{const s=o.target.value;z(a,{max:s===""?"":Number(s)})}})}),t.jsx("div",{className:"col-md-9",children:t.jsx("input",{type:"text",className:"form-control",value:e.message??"",onChange:o=>z(a,{message:o.target.value}),placeholder:"Mensaje personalizado (opcional)"})})]},e.field))]})]})},ie=({title:n,gridRef:i,pageSize:c,rest:l,columns:p,toolBar:y,masterDetail:j,filterValue:w=[],onRefresh:k,exportable:C,exportableName:N,customizeCell:S=()=>{},rowDragging:E,sorting:h,withRelations:x})=>t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[typeof n=="object"?t.jsx("div",{className:"card-header",children:n}):"",t.jsxs("div",{className:"card-body",children:[typeof n!="object"?t.jsxs("h4",{className:"header-title",children:[t.jsx("div",{id:"header-title-options",className:"float-end"}),t.jsx("span",{id:"header-title-prefix"})," Lista de ",n," ",t.jsx("span",{id:"header-title-suffix"})]}):"",t.jsx(Z,{gridRef:i,rest:l,pageSize:c,columns:p.filter(Boolean),toolBar:y,masterDetail:j,filterValue:w,onRefresh:k,exportable:C,exportableName:N,customizeCell:S,rowDragging:E,sorting:h,withRelations:x})]})]})})});export{ie as T};

var e=Object.defineProperty,a=(a,t,o)=>((a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o)(a,"symbol"!=typeof t?t+"":t,o);import{c as t,j as o,r,s as n}from"./vendor-react-CZUvQwNQ.js";import{B as l}from"./Base-BE1X8Lb3.js";import{C as i}from"./CreateReactScript-DMiuD_MQ.js";import{T as s}from"./Table-C5YdCL4x.js";import{R as c}from"./ReactAppend-Db2K6xCH.js";import{D as d}from"./DxButton-C6FT_beP.js";import{S as m}from"./CartKuchara-C7vqSevl.js";import{B as u}from"./BasicRest-K-34csnH.js";import{M as p}from"./Modal-MmI0jF6v.js";import{I as f}from"./InputFormGroup-BuXn3s3l.js";import{S as v}from"./SelectFormGroup-DX1jNHQ1.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-DAm0kDL9.js";import"./TippyButton-Gia9IjJq.js";import"./Logout-D6byb_Ua.js";import"./MenuItemContainer-BaCqn8PU.js";import"./Menu-DboRETzC.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";import"./OpenPayCardModal-BHkRoVZ6.js";const b=new class extends u{constructor(){super(...arguments),a(this,"path","admin/providers"),a(this,"hasFiles",!1)}},x=({})=>{const e=r.useRef(),a=r.useRef(),t=r.useRef(),l=r.useRef(),i=r.useRef(),u=r.useRef(),x=r.useRef(),h=r.useRef(),g=r.useRef(),y=r.useRef(),j=r.useRef(),w=r.useRef(),[C,R]=r.useState(!1),N=e=>{R(!!e?.id),t.current.value=e?.id??"",l.current.value=e?.name??"",i.current.value=e?.lastname??"",u.current.value=e?.email??"",x.current.value="",h.current.value="",g.current.value=e?.phone??"";const o=e?.phone_prefix??"+51";y.current.value=o,$(y.current).val(o).trigger("change"),j.current.value=e?.dni??e?.document_number??"",w.current&&(w.current.value="Provider"),$(a.current).modal("show")},T=async({id:a,value:t})=>{const{isConfirmed:o}=await m.fire({title:t?"Activar proveedor":"Desactivar proveedor",text:`¿Estás seguro de ${t?"activar":"desactivar"} este proveedor?`,icon:"question",showCancelButton:!0,confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar"});if(!o)return void $(e.current).dxDataGrid("instance").refresh();await b.boolean({id:a,field:"status",value:t})&&$(e.current).dxDataGrid("instance").refresh()};return o.jsxs(o.Fragment,{children:[o.jsx(s,{gridRef:e,title:"Proveedores",rest:b,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo proveedor",hint:"Crear nuevo proveedor",onClick:()=>N()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Proveedor",width:"25%",cellTemplate:(e,{data:a})=>{c(e,o.jsxs("div",{children:[o.jsxs("strong",{children:[a.name," ",a.lastname||""]}),o.jsx("br",{}),o.jsx("small",{className:"text-muted",children:a.email}),o.jsx("br",{}),o.jsx("span",{className:"badge badge-soft-primary",style:{fontSize:"10px"},children:a.uuid})]}))}},{dataField:"phone",caption:"Teléfono",cellTemplate:(e,{data:a})=>{a.phone?c(e,o.jsxs("span",{children:[a.phone_prefix||"+51"," ",a.phone]})):c(e,o.jsx("span",{className:"text-muted",children:"- Sin teléfono -"}))}},{dataField:"document_number",caption:"Documento",cellTemplate:(e,{data:a})=>{a.document_number?c(e,o.jsx("div",{children:o.jsxs("span",{children:[a.document_type||"DOC",": ",a.document_number]})})):c(e,o.jsx("span",{className:"text-muted",children:"- Sin documento -"}))}},{dataField:"city",caption:"Ubicación",cellTemplate:(e,{data:a})=>{const t=[a.city,a.department].filter(Boolean).join(", ");c(e,t?o.jsx("span",{children:t}):o.jsx("span",{className:"text-muted",children:"- Sin ubicación -"}))}},{dataField:"created_at",caption:"Registro",dataType:"date",cellTemplate:(e,{data:a})=>{const t=new Date(a.created_at);e.html(n.renderToString(o.jsxs(o.Fragment,{children:[o.jsx("div",{children:t.toLocaleDateString("es-ES")}),o.jsx("small",{className:"text-muted",children:t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})))}},{dataField:"status",caption:"Estado",dataType:"boolean",width:"120px",cellTemplate:(e,{data:a})=>{1==a.status?c(e,o.jsx("span",{className:"badge badge-success",children:"Activo"})):c(e,o.jsx("span",{className:"badge badge-secondary",children:"Archivado"}))}},{caption:"Acciones",cellTemplate:(a,{data:t})=>{a.css("text-overflow","unset"),a.append(d({className:"btn btn-xs btn-soft-info",title:"Ver detalles",icon:"fa fa-eye",onClick:()=>(e=>{const a=new Date(e.created_at),t=a.toLocaleDateString("es-ES")+" "+a.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});m.fire({title:"Detalles del Proveedor",html:`\n        <div style="text-align: left; max-width: 100%;">\n          <form style="padding: 20px 0;">\n            <div class="row">\n              \n              \x3c!-- Columna Izquierda --\x3e\n              <div class="col-md-6">\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Nombre Completo</label>\n                  <input type="text" class="form-control" value="${e.name} ${e.lastname||""}" readonly style="background-color: #f8f9fa;">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Email</label>\n                  <input type="email" class="form-control" value="${e.email||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Teléfono</label>\n                  <input type="text" class="form-control" value="${e.phone?(e.phone_prefix||"+51")+" "+e.phone:""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                 <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Código de Referido (UUID)</label>\n                  <input type="text" class="form-control" value="${e.uuid||""}" readonly style="background-color: #f8f9fa;" placeholder="No generado">\n                </div>\n\n                ${e.alternate_phone?`\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Teléfono Alternativo</label>\n                  <input type="text" class="form-control" value="${e.alternate_phone}" readonly style="background-color: #f8f9fa;">\n                </div>\n                `:""}\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Tipo de Documento</label>\n                  <input type="text" class="form-control" value="${e.document_type||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n              </div>\n              \n              \x3c!-- Columna Derecha --\x3e\n              <div class="col-md-6">\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Número de Documento</label>\n                  <input type="text" class="form-control" value="${e.document_number||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Dirección</label>\n                  <input type="text" class="form-control" value="${e.address||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificada">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Distrito</label>\n                  <input type="text" class="form-control" value="${e.district||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Provincia</label>\n                  <input type="text" class="form-control" value="${e.province||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n                \n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Departamento</label>\n                  <input type="text" class="form-control" value="${e.department||""}" readonly style="background-color: #f8f9fa;" placeholder="No especificado">\n                </div>\n              </div>\n              \n              \x3c!-- Fila completa para campos adicionales --\x3e\n              <div class="col-12">\n                ${e.reference?`\n                <div class="form-group mb-3">\n                  <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Referencia</label>\n                  <textarea class="form-control" readonly style="background-color: #f8f9fa; resize: none;" rows="2">${e.reference}</textarea>\n                </div>\n                `:""}\n                \n                <div class="row">\n                  <div class="col-md-6">\n                    <div class="form-group mb-3">\n                      <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Estado</label>\n                      <input type="text" class="form-control ${1==e.status?"border-success":"border-danger"}" \n                             value="${1==e.status?"Activo":"Inactivo"}" readonly \n                             style="background-color: ${1==e.status?"#d4edda":"#f8d7da"}; \n                                    color: ${1==e.status?"#155724":"#721c24"}; \n                                    font-weight: 600;">\n                    </div>\n                  </div>\n                  <div class="col-md-6">\n                    <div class="form-group mb-3">\n                      <label class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 5px;">Fecha de Registro</label>\n                      <input type="text" class="form-control" value="${t}" readonly style="background-color: #f8f9fa;">\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n            </div>\n          </form>\n        </div>\n      `,width:"800px",showConfirmButton:!0,confirmButtonText:"Cerrar",confirmButtonColor:"#6c757d",allowOutsideClick:!0,allowEscapeKey:!0,customClass:{popup:"client-details-modal"},didOpen:()=>{const e=document.createElement("style");e.innerHTML="\n          .client-details-modal {\n            border-radius: 8px !important;\n          }\n          .client-details-modal .swal2-title {\n            color: #495057 !important;\n            font-size: 1.5rem !important;\n            font-weight: 600 !important;\n            margin-bottom: 10px !important;\n          }\n          .client-details-modal .swal2-html-container {\n            margin: 0 !important;\n            padding: 0 20px 20px 20px !important;\n          }\n          .client-details-modal .form-control:read-only {\n            cursor: default !important;\n          }\n          .client-details-modal .form-label {\n            font-size: 0.9rem !important;\n          }\n        ",document.head.appendChild(e)}})})(t)})),1!=t.status&&a.append(d({className:"btn btn-xs btn-soft-success",title:"Restaurar (Activar)",icon:"fa fa-check",onClick:()=>T({id:t.id,value:!0})})),a.append(d({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>N(t)})),a.append(d({className:"btn btn-xs "+(1==t.status?"btn-soft-warning":"btn-soft-danger"),title:1==t.status?"Archivar":"Eliminar permanentemente",icon:1==t.status?"fa fa-archive":"fa fa-trash",onClick:async()=>{if(1==t.status){const{isConfirmed:e}=await m.fire({title:"¿Archivar Proveedor?",text:"El proveedor se desactivará y pasará a estado 'Archivado'.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, archivar",cancelButtonText:"Cancelar"});e&&T({id:t.id,value:!1})}else(async a=>{const{isConfirmed:t}=await m.fire({title:"Eliminar proveedor",text:"¿Estás seguro de eliminar este proveedor?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!t)return;await b.delete(a)&&$(e.current).dxDataGrid("instance").refresh()})(t.id)}}))},allowFiltering:!1,allowExporting:!1}]}),o.jsx(p,{modalRef:a,title:C?"Editar proveedor":"Crear nuevo proveedor",onSubmit:async o=>{if(o.preventDefault(),!C||x.current.value){if(x.current.value!==h.current.value)return void m.fire({title:"Error",text:"Las contraseñas no coinciden",icon:"error"});if(x.current.value.length<6)return void m.fire({title:"Error",text:"La contraseña debe tener al menos 6 caracteres",icon:"error"})}const r={id:t.current.value||void 0,name:l.current.value,lastname:i.current.value,email:u.current.value,phone:g.current.value,phone_prefix:y.current.value,dni:j.current.value,role:"Provider"};x.current.value&&(r.password=x.current.value);await b.save(r)&&($(e.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},size:"lg",children:o.jsxs("div",{className:"row",id:"principal-container",children:[o.jsx("input",{ref:t,type:"hidden"}),o.jsx(f,{eRef:l,label:"Nombres",col:"col-md-6",required:!0}),o.jsx(f,{eRef:i,label:"Apellidos",col:"col-md-6",required:!0}),o.jsx(f,{eRef:u,label:"Correo electrónico",type:"email",col:"col-md-6",required:!0}),o.jsx(f,{eRef:j,label:"DNI / Documento",col:"col-md-6"}),o.jsx("div",{className:"col-md-3",children:o.jsxs(v,{eRef:y,label:"Prefijo",required:!0,dropdownParent:"#principal-container",children:[o.jsx("option",{value:"+51",children:"+51 (Perú)"}),o.jsx("option",{value:"+1",children:"+1 (EE.UU.)"}),o.jsx("option",{value:"+34",children:"+34 (España)"}),o.jsx("option",{value:"+52",children:"+52 (México)"}),o.jsx("option",{value:"+57",children:"+57 (Colombia)"})]})}),o.jsx(f,{eRef:g,label:"Teléfono",type:"tel",col:"col-md-9"}),o.jsx("input",{type:"hidden",ref:w,value:"Provider"}),o.jsxs("div",{className:"col-12",children:[o.jsx("hr",{}),o.jsx("h6",{children:C?"Cambiar contraseña (opcional)":"Contraseña"})]}),o.jsx(f,{eRef:x,label:C?"Nueva contraseña":"Contraseña",type:"password",col:"col-md-6",required:!C,placeholder:C?"Dejar vacío para mantener la actual":""}),o.jsx(f,{eRef:h,label:"Confirmar contraseña",type:"password",col:"col-md-6",required:!C})]})})]})};i((e,a)=>{t.createRoot(e).render(o.jsx(l,{...a,title:"Proveedores",children:o.jsx(x,{...a})}))});

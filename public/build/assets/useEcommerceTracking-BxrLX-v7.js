import{r as e}from"./vendor-react-DB2gWWlz.js";const t=()=>{const t=e.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),n=e=>{if("undefined"==typeof window||!e)return;const t=document.createElement("div");t.innerHTML=e;t.querySelectorAll("script").forEach((e,t)=>{try{const t=document.createElement("script");t.textContent=e.textContent,document.head.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},100)}catch(n){}})};return{trackProductView:(e,t={})=>{"undefined"!=typeof window&&(void 0!==window.fbq&&window.fbq("track","ViewContent",{content_ids:[e],content_type:"product",content_name:t.name||"",value:t.price||0,currency:"PEN"}),void 0!==window.gtag&&window.gtag("event","view_item",{currency:"PEN",value:t.price||0,items:[{item_id:e,item_name:t.name||"",category:t.category||"",price:t.price||0}]}),void 0!==window.ttq&&window.ttq.track("ViewContent",{content_id:e,content_type:"product",content_name:t.name||"",value:t.price||0,currency:"PEN"}))},trackAddToCart:async(e,t=1,i={})=>{if("undefined"!=typeof window)try{const c=await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({product_id:e,quantity:t,...i})}),a=await c.json();a.success&&a.tracking_scripts&&n(a.tracking_scripts)}catch(c){}},trackInitiateCheckout:async(e,i)=>{if("undefined"!=typeof window&&!t.current.hasTrackedInitiateCheckout)try{t.current.hasTrackedInitiateCheckout=!0;const i=await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({cart_items:e.map(e=>({product_id:e.id,name:e.name,price:e.final_price||e.price,quantity:e.quantity,subtotal:(e.final_price||e.price)*e.quantity}))})}),c=await i.json();c.success&&c.tracking_scripts&&n(c.tracking_scripts)}catch(c){t.current.hasTrackedInitiateCheckout=!1}},trackPurchase:(e,t)=>{if("undefined"!=typeof window)try{t?n(t):fetch(`/api/tracking/purchase/${e}`).then(e=>e.text()).then(e=>{e&&n(e)}).catch(e=>{})}catch(i){}},trackCheckoutPageView:(e,n=[])=>{if("undefined"==typeof window||t.current.hasTrackedPageView)return;t.current.hasTrackedPageView=!0;const i=n.reduce((e,t)=>e+(t.final_price||t.price)*t.quantity,0);void 0!==window.fbq&&(window.fbq("track","PageView"),1===e&&n.length>0&&window.fbq("track","AddToCart",{content_ids:n.map(e=>e.id),content_type:"product",value:i,currency:"PEN",num_items:n.length})),void 0!==window.gtag&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${e}`,page_location:window.location.href}),1===e&&n.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:i,items:n.map(e=>({item_id:e.id,item_name:e.name,category:e.category?.name||"Sin categorÃ­a",quantity:e.quantity,price:e.final_price||e.price}))}))},resetTracking:()=>{t.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};export{t as u};

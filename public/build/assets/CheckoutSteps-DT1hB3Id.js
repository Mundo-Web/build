import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BH53Isel.js";import{N as P}from"./Number2Currency-e57Tgsuk.js";import{B as ke,a as Ve,D as Ye,A as Ze,O as et,C as tt}from"./OptionCard-CUXQgNVR.js";import{S as me}from"./sparkles-DeLUn6av.js";import{c as Ce}from"./createLucideIcon-Cy5Ya80P.js";import{M as st}from"./CartItemRow-4VUVjpPz.js";import{P as at}from"./plus-Bot15Khs.js";import{T as rt}from"./trash-2-DK1wnsDn.js";import{a as nt}from"./index-xsH4HHeE.js";import{X as Be}from"./x-DBMwyD6F.js";import{m as ot}from"./main-BvVILmTO.js";import{G as de}from"./Global-ErywZRdd.js";import{t as B}from"./index-CMHsc23u.js";import{I as se}from"./InputForm-ZnsQvLid.js";import{S as it}from"./SelectForm-yNqolDMW.js";import{l as lt}from"./ShippingStep-j3_tvQyk.js";import{C as ce}from"./circle-x-p-TkKhsF.js";import{m as ne}from"./proxy-BTYtmp9V.js";import"./ProductNavigation-Bom5Fzkx.js";import"./ProductCard-Ap6bpF1Q.js";/* empty css              */import"./BlogCarousel-CCgb3gK1.js";/* empty css               */import"./InfiniteCategory-BtlY-czj.js";import{R as ct}from"./PaymentModal-BB1JXzaZ.js";import{H as dt}from"./HtmlContent-FTivcJrM.js";import"./index-yBjzXJbu.js";import"./useStateManager-7e1e8489.esm-VPSU_3UO.js";import"./hoist-non-react-statics.cjs-kbdZbs82.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./floating-ui.dom-8M2NmvqY.js";import"./tippy-react.esm-BWiGTO87.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./chevron-down-DS-mdh9v.js";import"./search-TwiiKGP5.js";import"./check-DQ7QoS0v.js";import"./ItemsRest-DGjwRLrz.js";import"./BasicRest-B3rfI5GY.js";import"./HeaderSearch-DXZLURpX.js";import"./index-CFtDjG4d.js";import"./eye-CKCH9ORv.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=Ce("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=Ce("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=Ce("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=Ce("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]);function pt({onClick:l,className:h=""}){return e.jsxs("div",{className:`relative ${h}`,children:[e.jsx(me,{size:12,className:"absolute -top-1 -left-1 text-yellow-400 animate-ping",style:{animationDelay:"0s"}}),e.jsx(me,{size:10,className:"absolute -top-2 -right-1 text-pink-400 animate-ping",style:{animationDelay:"0.5s"}}),e.jsx(me,{size:8,className:"absolute -bottom-1 -left-2 text-blue-400 animate-ping",style:{animationDelay:"1s"}}),e.jsx(me,{size:14,className:"absolute -bottom-2 -right-2 text-purple-400 animate-ping",style:{animationDelay:"1.5s"}}),e.jsxs("button",{onClick:l,className:"relative group bg-primary p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 animate-bounce cursor-pointer",style:{animationDuration:"2s",animationIterationCount:"infinite"},children:[e.jsx("div",{className:"absolute inset-0 bg-primary rounded-xl opacity-0 group-hover:opacity-50 transition-opacity duration-300 blur-lg"}),e.jsx(we,{size:24,className:"text-white relative z-10 drop-shadow-sm"}),e.jsx("div",{className:"absolute inset-0 bg-primary rounded-xl animate-pulse opacity-30"})]}),e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20",children:"¡Promoción disponible!"})]})}const xt=({setCart:l,hasPromotion:h,onPromotionClick:i,...u})=>{const S=()=>{l(b=>b.filter(m=>m.id!==u.id))},k=()=>{l(b=>b.map(m=>m.id===u.id?{...m,quantity:(m.quantity||1)+1}:m))},f=()=>{l(b=>b.map(m=>{if(m.id===u.id){const p=(m.quantity||1)-1;return p<=0?(S(u.id),null):{...m,quantity:p}}return m}).filter(Boolean))};return e.jsx("div",{className:"w-full bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center  justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`/storage/images/item/${u.image}`,alt:u.name,className:"w-20 h-20 object-cover rounded flex-shrink-0",onError:b=>b.target.src="/api/cover/thumbnail/null"}),h&&e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(pt,{onClick:()=>i(u),className:"group"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-lg mb-2 line-clamp-2",children:u.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark",children:u.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Disponibilidad: ",e.jsxs("span",{className:"customtext-neutral-dark",children:[u.stock>=u.quantity?"En stock":"Agotado"," "]})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark",children:u.sku})]})]})]}),e.jsxs("div",{className:"flex flex-row justify-between md:flex-col items-end md:items-end gap-4 mt-4 md:mt-0 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(u.price*u.quantity).toFixed(2)]}),e.jsxs("div",{className:"font-bold text-lg",children:["S/ ",Number(u.final_price*u.quantity).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsx("button",{type:"button",onClick:f,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Decrease quantity",children:e.jsx(st,{size:16})}),e.jsx("div",{className:"w-12 h-8 flex justify-center items-center bg-white",children:e.jsx("span",{className:"font-semibold text-sm",children:u.quantity||1})}),e.jsx("button",{type:"button",onClick:k,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Increase quantity",children:e.jsx(at,{size:16})})]}),e.jsx("button",{onClick:S,className:"p-2 text-gray-400 hover:text-red-500 transition-colors duration-200 rounded-full hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200","aria-label":"Remove item",children:e.jsx(rt,{size:18})})]})]})]})},u.id)},ht="/api";class Ae{static async applyToCart(h,i,u=null){var S;try{if(console.log("🛒 Applying discount rules to cart:",{cartItems:h,totalAmount:i,customerEmail:u}),!Array.isArray(h)||h.length===0)return{success:!1,error:"Carrito vacío o inválido",data:null};const k={cart_items:h.map(b=>{const m={item_id:String(b.item_id||b.id||""),quantity:parseInt(b.quantity)||1,price:parseFloat(b.price||b.final_price||0),name:String(b.name||b.description||"Producto sin nombre"),category_id:b.category_id?String(b.category_id):null};return console.log("📦 Processing cart item:",m),m}),total_amount:parseFloat(i)||0,customer_email:u||null};console.log("📤 Sending payload to API:",k);const f=await nt.post(`${ht}/discount-rules/apply-to-cart`,k);return f.data.status===200?{success:!0,data:f.data.data,message:f.data.message}:{success:!1,error:f.data.message||"Error al aplicar descuentos",data:null}}catch(k){return console.error("Error applying discount rules:",k),(S=k.response)!=null&&S.data?{success:!1,error:k.response.data.message||"Error del servidor",data:k.response.data.data||null}:{success:!1,error:"Error de conexión",data:null}}}static formatDiscounts(h){return!h||!Array.isArray(h)?[]:h.map(i=>({id:i.rule_id,name:i.rule_name||"Descuento automático",description:i.description||"",amount:parseFloat(i.discount_amount||0),type:i.discount_type||"fixed",promotion_type:i.promotion_type||null,free_items:i.free_items||[],formatted_amount:i.discount_type==="percentage"?`${i.discount_amount}%`:`S/ ${parseFloat(i.discount_amount||0).toFixed(2)}`}))}static getFreeItems(h){if(!h||!Array.isArray(h))return[];const i=[];return h.forEach(u=>{u.free_items&&Array.isArray(u.free_items)&&i.push(...u.free_items)}),i}static calculateTotalDiscount(h){return!h||!Array.isArray(h)?0:h.reduce((i,u)=>i+parseFloat(u.discount_amount||0),0)}}function ft({isOpen:l,onClose:h,suggestion:i,onAddToCart:u,productName:S}){const[k,f]=c.useState(!1);if(!l||!i)return null;const b=async()=>{f(!0);try{console.log("Modal - suggestion data:",i),await u(i),h()}catch(m){console.error("Error adding promotional item:",m)}finally{f(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity duration-300",onClick:h}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto transform transition-all duration-300 scale-100",children:[e.jsx("button",{onClick:h,className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100",children:e.jsx(Be,{size:20})}),e.jsxs("div",{className:"text-center pt-8 pb-6 px-6",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"animate-bounce",children:e.jsx(we,{size:48,className:"customtext-primary mx-auto"})}),e.jsx(me,{size:20,className:"absolute -top-2 -right-2 text-yellow-400 animate-pulse"}),e.jsx(me,{size:16,className:"absolute -bottom-1 -left-2 text-yellow-400 animate-pulse delay-300"})]}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-2",children:"🎉 ¡Promoción Especial!"}),e.jsx("p",{className:"text-gray-600",children:"Tienes un producto que califica para una promoción"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Al tener  ",e.jsxs("span",{className:"font-semibold customtext-primary",children:[i.current_quantity," ",S]})," en tu carrito"]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("p",{className:"font-bold text-lg customtext-primary mb-1",children:i.rule_name}),e.jsx("p",{className:"text-sm customtext-neutral-light",children:i.description||"Obtén un producto gratis"})]})]})}),e.jsx("div",{className:"border-2 border-dashed rounded-xl p-4 mb-6 bg-green-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 w-9/12",children:[e.jsx("div",{className:"w-12 h-12  rounded-full flex items-center justify-center",children:e.jsx(we,{className:"customtext-primary",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold customtext-neutral-dark",children:i.item_name}),e.jsxs("p",{className:"text-sm customtext-primary",children:["Cantidad: ",i.suggested_quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold customtext-primary",children:"¡GRATIS!"}),e.jsxs("p",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(i.value||0).toFixed(2)]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:b,disabled:k,className:"w-full bg-primary text-white font-semibold py-3 px-6 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:transform-none shadow-lg",children:k?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Agregando..."})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(we,{size:20}),e.jsx("span",{children:"¡Agregar Regalo!"})]})}),e.jsx("button",{onClick:h,className:"w-full bg-gray-100 customtext-neutral-light font-medium py-3 px-6 rounded-xl hover:bg-gray-200 transition-colors duration-200",children:"Tal vez después"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"* Promoción válida mientras tengas los productos requeridos en tu carrito"})]})]})})]})}function gt({cart:l,setCart:h,onContinue:i,subTotal:u,envio:S,igv:k,totalFinal:f,openModal:b,automaticDiscounts:m,setAutomaticDiscounts:p,automaticDiscountTotal:s,setAutomaticDiscountTotal:j,totalWithoutDiscounts:r}){const[d,E]=c.useState(m||[]),[T,V]=c.useState(s||0),[F,Q]=c.useState(!1),[oe,J]=c.useState([]),[U,G]=c.useState([]),[W,X]=c.useState(!1),[Y,ae]=c.useState(null),[z,ie]=c.useState(null),K=l.length===0;c.useEffect(()=>{if(l.length>0&&u>0)re();else{const g=[];E(g),V(0),J([]),G([]),p&&p(g),j&&j(0)}},[l,u]);const re=async()=>{Q(!0);try{const g=l.reduce((C,M)=>C+(M.quantity||0),0);console.log("🛒 CartStep applying discounts:",{cart:l,subTotal:u,totalWithoutDiscounts:r,totalQuantity:g,cartLength:l.length,cartItems:l.map(C=>({id:C.id||C.item_id,name:C.name,quantity:C.quantity,price:C.price||C.final_price,category_id:C.category_id}))});const x=await Ae.applyToCart(l,r);if(console.log("📥 Server response:",{success:x.success,data:x.data,error:x.error,fullResult:x}),x.success&&x.data){console.log("✅ Discounts found:",x.data.applied_discounts);const C=Ae.formatDiscounts(x.data.applied_discounts),M=x.data.total_discount||0,H=Ae.getFreeItems(x.data.applied_discounts),Z=[];x.data.applied_discounts.forEach(L=>{L.suggested_items&&Array.isArray(L.suggested_items)&&Z.push(...L.suggested_items)}),E(C),V(M),J(H),G(Z),p&&p(C),j&&j(M)}else{console.error("❌ Discount application failed:",{error:x.error,success:x.success,data:x.data,fullResult:x});const C=[],M=0;E(C),V(M),J([]),G([]),p&&p(C),j&&j(M)}}catch(g){console.error("Error applying discount rules:",g);const x=[],C=0;E(x),V(C),J([]),G([]),p&&p(x),j&&j(C)}finally{Q(!1)}},ue=g=>U.some(x=>x.item_id===g||x.triggering_item_id===g),pe=g=>U.find(x=>x.item_id===g||x.triggering_item_id===g),N=g=>{const x=pe(g.id);x&&(ae(x),ie(g),X(!0))},O=async g=>{try{console.log("CartStep - handleAddPromotionalItem received:",g),console.log("CartStep - current cart:",l),h(x=>{console.log("CartStep - old cart before update:",x);const C=x.findIndex(M=>(M.item_id||M.id)===g.item_id);if(console.log("CartStep - existingItemIndex:",C),C!==-1){const M=[...x],H=g.quantity||g.suggested_quantity||1;return console.log("CartStep - adding quantity:",H),M[C].quantity+=H,console.log("CartStep - updated cart:",M),M}else{console.log("CartStep - item not found, creating new product");const M={id:g.item_id,name:g.item_name,quantity:g.quantity||g.suggested_quantity||1,price:g.value||0,final_price:g.value||0,image:g.item_image||"default.jpg",brand:{name:g.item_brand||"N/A"},sku:g.item_sku||"PROMO",stock:999};return[...x,M]}}),setTimeout(()=>{re()},100)}catch(x){console.error("Error adding promotional item:",x)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:K?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito está vacío"}),e.jsx("p",{className:"text-gray-500",children:"¡Explora nuestros productos y encuentra algo especial!"})]}):l.map((g,x)=>e.jsx(xt,{...g,setCart:h,hasPromotion:ue(g.id),onPromotionClick:N},x))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(u)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(k)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(S)]})]}),F&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!F&&d.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6  customtext-neutral-dark mb-2",children:"🎉 Descuentos aplicados:"}),d.map((g,x)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[g.name,g.description&&e.jsx("span",{className:"text-xs font-semibold block",children:g.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",P(g.amount)]})]},x)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",P(T)]})]})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",P(f)]})]}),T>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:["S/ ",P(r||f+T)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras S/ ",P(T)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(ke,{onClick:i,className:"w-full",disabled:K,children:K?"Carrito Vacío":"Continuar Compra"}),e.jsx(Ve,{href:"/",className:"w-full",children:K?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>b(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>b(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]}),e.jsx(ft,{isOpen:W,onClose:()=>X(!1),suggestion:Y,onAddToCart:O,productName:(z==null?void 0:z.name)||""})]})}function yt(){let l="";for(let h=0;h<12;h++){const i=Math.floor(Math.random()*10);l+=i}return l}const bt=l=>new Promise((h,i)=>{var u;try{console.log(l);const S=yt(l.email);console.log(S);let k=!1;window.Culqi.publicKey=de.CULQI_PUBLIC_KEY;const f=parseFloat(l.amount.toFixed(2)),b=Math.round(f*100);console.log("💰 Configurando Culqi:"),console.log("   - Monto original:",l.amount),console.log("   - Monto redondeado (soles):",f),console.log("   - Monto en céntimos:",b),console.log("   - Email:",l.email),window.Culqi.settings({title:de.APP_NAME,email:l.email,currency:"PEN",amount:b,order:`${S}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:de.APP_URL+"/assets/resources/logo.png",bannerColor:de.APP_COLOR_PRIMARY,buttonBackground:de.APP_COLOR_PRIMARY}});const m=(u=window.Culqi)==null?void 0:u.close;m&&(window.Culqi.close=function(){return!window.Culqi.token&&!k&&(console.log("🚫 Modal de Culqi cerrado sin completar el pago"),i("Pago cancelado por el usuario")),m.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){i("No se obtuvo un token de Culqi");return}k=!0;const s=window.Culqi.token.id;console.log("✅ Token generado:",s),l={...l,token:s,orderNumber:S},console.log("_request actualizado",l);const{status:j,result:r}=await ot.Fetch("./api/pago",{method:"POST",body:JSON.stringify(l)});j||console.log((r==null?void 0:r.message)||"Error en el pago"),window.Culqi.close(),B.success("¡Pago exitoso!",{description:"Tu pago se procesó correctamente. Pronto recibirás la confirmación de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),h(r)}catch(s){B.error("¡Error en el Pago!",{description:s.message,duration:3e3,position:"top-right",richColors:!0}),i(s.message||"Error en el pago")}},window.addEventListener("message",function(s){s.data==="culqi_closed"&&i("Pago cancelado por el usuario")});const p=s=>{s.key==="Escape"&&!k&&(console.log("🚫 Modal de Culqi cerrado con Escape"),i("Pago cancelado por el usuario"))};document.addEventListener("keydown",p),setTimeout(()=>{document.removeEventListener("keydown",p)},3e5),document.addEventListener("culqi.error",function(s){var j,r;B.error("¡Error en Culqi!",{description:((j=s.detail)==null?void 0:j.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),i(((r=s.detail)==null?void 0:r.message)||"Error desconocido")})}catch(S){B.error("¡Error en la integración con Culqi!",{description:S.message,duration:3e3,position:"top-right",richColors:!0}),i("Error en la integración con Culqi")}}),jt=({ubigeoCode:l,onStoreSelect:h,selectedStore:i=null,className:u=""})=>{const[S,k]=c.useState([]),[f,b]=c.useState(!1),[m,p]=c.useState(null);c.useEffect(()=>{l&&s()},[l]);const s=async()=>{b(!0),p(null);try{const d=await(await fetch("/api/stores")).json();k(d.data||[])}catch{k([])}finally{b(!1)}},j=r=>{h(r)};return f?e.jsxs("div",{className:`text-center p-8 ${u}`,children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Cargando tiendas..."}),e.jsx("p",{className:"text-gray-600",children:"Buscando tiendas disponibles en tu ubicación"})]}):m?e.jsxs("div",{className:`bg-red-50 border border-red-200 rounded-lg p-6 ${u}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 text-center mb-2",children:"Error al cargar tiendas"}),e.jsx("p",{className:"text-red-600 text-center",children:m})]}):S.length===0?e.jsxs("div",{className:`bg-amber-50 border border-amber-200 rounded-lg p-6 ${u}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-amber-100 rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-amber-800 text-center mb-2",children:"Sin tiendas disponibles"}),e.jsx("p",{className:"text-amber-700 text-center",children:"No hay tiendas disponibles para retiro en esta ubicación. Por favor, selecciona otra opción de envío."})]}):e.jsxs("div",{className:u,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Selecciona una tienda para retiro"}),e.jsx("p",{className:"text-gray-600",children:"Elige la tienda más conveniente para retirar tu pedido"})]}),e.jsx("div",{className:"grid gap-4",children:S.map(r=>e.jsxs("div",{className:`relative border-2 rounded-lg p-4 cursor-pointer transition-all duration-200 hover:shadow-md ${(i==null?void 0:i.id)===r.id?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300"}`,onClick:()=>j(r),children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${(i==null?void 0:i.id)===r.id?"border-blue-500 bg-blue-500":"border-gray-300 bg-white"}`,children:(i==null?void 0:i.id)===r.id&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),e.jsxs("div",{className:"flex gap-4 pr-8",children:[e.jsx("div",{className:"flex-shrink-0",children:r.image?e.jsx("img",{src:`/storage/images/store/${r.image}`,alt:r.name,className:"w-16 h-16 object-cover rounded-lg border"}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg border flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H5m0 0v-4a2 2 0 012-2h2m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v8.1M9 5l7 7-7 7"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:r.name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.type==="tienda"?"bg-green-100 text-green-800":r.type==="oficina"?"bg-blue-100 text-blue-800":r.type==="almacen"?"bg-yellow-100 text-yellow-800":r.type==="showroom"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:r.type==="tienda"?"Tienda":r.type==="oficina"?"Oficina":r.type==="almacen"?"Almacén":r.type==="showroom"?"Showroom":r.type||"Otro"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:r.address}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 mb-3",children:[r.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{children:r.phone})]}),r.manager&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{children:["Encargado: ",r.manager]})]})]}),r.business_hours&&e.jsxs("div",{className:"bg-gray-50 rounded-md p-3 mt-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Horarios de atención:"}),e.jsx("div",{className:"text-xs text-gray-600",children:(()=>{try{const d=typeof r.business_hours=="string"?JSON.parse(r.business_hours):r.business_hours,E=new Date().toLocaleDateString("es-PE",{weekday:"long"}),V={lunes:"Lunes",martes:"Martes",miércoles:"Miércoles",jueves:"Jueves",viernes:"Viernes",sábado:"Sábado",domingo:"Domingo"}[E.toLowerCase()]||E,F=d.find(Q=>Q.day.toLowerCase()===V.toLowerCase());if(F){const Q=F.closed?"Hoy: Cerrado":`Hoy: ${F.open} - ${F.close}`,oe=!F.closed&&(()=>{const J=new Date,U=J.getHours()*60+J.getMinutes(),[G,W]=F.open.split(":").map(Number),[X,Y]=F.close.split(":").map(Number),ae=G*60+W,z=X*60+Y;return U>=ae&&U<=z})();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:Q}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${oe?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:oe?"Abierto":"Cerrado"})]})}return"Horarios disponibles"}catch{return"Horarios disponibles"}})()})]}),r.description&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsx("p",{className:"text-sm text-gray-600",children:r.description})})]})]})]},r.id))})]})};function vt({cart:l,setSale:h,setCode:i,setDelivery:u,setCart:S,onContinue:k,noContinue:f,subTotal:b,igv:m,totalFinal:p,user:s,setEnvio:j,envio:r,ubigeos:d=[],openModal:E,setCouponDiscount:T,setCouponCode:V,automaticDiscounts:F=[],automaticDiscountTotal:Q=0,totalWithoutDiscounts:oe,conversionScripts:J,setConversionScripts:U,onPurchaseComplete:G}){var De;const[W,X]=c.useState(null),[Y,ae]=c.useState(null),[z,ie]=c.useState([]),[K,re]=c.useState(0);z.reduce((t,a)=>a.free_items&&Array.isArray(a.free_items)?[...t,...a.free_items]:t,[]);const ue=(t,a)=>{var o;let v=[],_=0;for(const n of a)switch(n.type){case"buy_x_get_y":{t.forEach(y=>{var w;if((w=n.product_ids)!=null&&w.includes(y.id)){const $=Math.floor(y.quantity/(n.buy+n.get));if($>0&&n.get>0){const te=$*n.get,fe=te*y.final_price;v.push({name:n.name,amount:fe,description:n.description,free_items:[{...y,quantity:te}]}),_+=fe}}});break}case"quantity_discount":{t.forEach(y=>{var w;if((w=n.product_ids)!=null&&w.includes(y.id)){const $=Math.floor(y.quantity/n.buy);if($>0&&n.pay<n.buy){const te=$*(n.buy-n.pay)*y.final_price;v.push({name:n.name,amount:te,description:n.description}),_+=te}}});break}case"tiered_discount":{t.forEach(y=>{var w;if((w=n.product_ids)!=null&&w.includes(y.id)){const $=Math.floor(y.quantity/n.tier);if($>0&&n.free>0){const te=$*n.free,fe=te*y.final_price;v.push({name:n.name,amount:fe,description:n.description,free_items:[{...y,quantity:te}]}),_+=fe}}});break}case"category_discount":{t.forEach(y=>{var w;if((w=n.category_ids)!=null&&w.includes(y.category_id)){const $=y.final_price*y.quantity*(n.percent/100);$>0&&(v.push({name:n.name,amount:$,description:n.description}),_+=$)}});break}case"cart_discount":{const y=t.reduce((w,$)=>w+$.final_price*$.quantity,0);if(y>=(n.min_total||0)){const w=n.percent?y*(n.percent/100):n.amount||0;w>0&&(v.push({name:n.name,amount:w,description:n.description}),_+=w)}break}case"bundle_discount":{((o=n.product_ids)==null?void 0:o.every(w=>t.some($=>$.id===w)))&&n.amount>0&&(v.push({name:n.name,amount:n.amount,description:n.description}),_+=n.amount);break}}return{discounts:v,totalDiscount:_}};c.useEffect(()=>{if(F&&Array.isArray(F)&&F.length>0){const{discounts:t,totalDiscount:a}=ue(l,F);ie(t),re(a)}else ie([]),re(0)},[l,F]);const pe=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[N,O]=c.useState({name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",documentType:((De=s==null?void 0:s.document_type)==null?void 0:De.toLowerCase())||"",document:(s==null?void 0:s.document_number)||"",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:"",reference:(s==null?void 0:s.reference)||"",ubigeo:(s==null?void 0:s.ubigeo)||null});c.useEffect(()=>{if(s!=null&&s.ubigeo&&(s!=null&&s.district)&&(s!=null&&s.province)&&(s!=null&&s.department)){const t={value:s.ubigeo,label:`${s.district}, ${s.province}, ${s.department}`,data:{reniec:s.ubigeo,departamento:s.department,provincia:s.province,distrito:s.district}};ae(t),X(t),Ie(t)}},[s]),c.useEffect(()=>{s&&O(t=>{var a;return{...t,name:s.name||t.name,lastname:s.lastname||t.lastname,email:s.email||t.email,phone:s.phone||t.phone,documentType:((a=s.document_type)==null?void 0:a.toLowerCase())||t.documentType,document:s.document_number||t.document,department:s.department||t.department,province:s.province||t.province,district:s.district||t.district,address:s.address||t.address,number:s.number||t.number,reference:s.reference||t.reference,ubigeo:s.ubigeo||t.ubigeo}})},[s]);const[g,x]=c.useState(!1),[C,M]=c.useState(!1),[H,Z]=c.useState([]),[L,R]=c.useState(null),[ee,_e]=c.useState(null),[q,D]=c.useState({}),[Se,ge]=c.useState(""),[ye,be]=c.useState(!1),[le,$e]=c.useState(""),[A,Fe]=c.useState(null),[qe,Ee]=c.useState(0),[je,Re]=c.useState(!1),[Pe,xe]=c.useState(""),[ve,Te]=c.useState(null),[He,Le]=c.useState(!1),Ue=t=>{Te(t),D(a=>({...a,store:""}))},Ge=t=>{var v,_,o;const a=["name","lastname","documentType","document","email","phone","ubigeo","address","shipping"];for(const n of a)if(t[n]){let y=null,w=!1;if(n==="ubigeo"?y=((_=(v=document.querySelector('[name="ubigeo"]'))==null?void 0:v.parentElement)==null?void 0:_.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):n==="shipping"?y=((o=document.querySelector('input[name="shipping"]'))==null?void 0:o.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(y=document.querySelector(`[name="${n}"]`),w=!0),y){y.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),w&&setTimeout(()=>{try{y.focus(),y.tagName==="INPUT"&&y.type==="text"&&y.select()}catch($){console.warn("No se pudo enfocar el elemento:",$)}},600),We(y);break}}},We=t=>{if(!t)return;const a=document.createElement("div");if(a.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const _=document.createElement("style");_.id="error-highlight-styles",_.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(_)}const v=t.style.position;(!v||v==="static")&&(t.style.position="relative"),t.appendChild(a),setTimeout(()=>{a.parentNode&&(a.parentNode.removeChild(a),(!v||v==="static")&&(t.style.position=v))},1200)},Ie=async t=>{var v,_;if(!t)return;D(o=>({...o,ubigeo:""}));const{data:a}=t;O(o=>({...o,department:a.departamento,province:a.provincia,district:a.distrito,ubigeo:a.reniec})),x(!0);try{const o=await Ye.getShippingCost({ubigeo:a.reniec}),n=[];let y=!1;o.data.is_free?(n.push({type:"free",price:0,description:o.data.standard.description,deliveryType:o.data.standard.type,characteristics:o.data.standard.characteristics}),o.data.express.price>0&&n.push({type:"express",price:o.data.express.price,description:o.data.express.description,deliveryType:o.data.express.type,characteristics:o.data.express.characteristics}),y=!0):o.data.is_agency?n.push({type:"agency",price:0,description:o.data.agency.description,deliveryType:o.data.agency.type,characteristics:o.data.agency.characteristics}):o.data.is_store_pickup?y=!0:n.push({type:"standard",price:o.data.standard.price,description:o.data.standard.description,deliveryType:o.data.standard.type,characteristics:o.data.standard.characteristics}),y||o.data.is_store_pickup?(n.some($=>$.type==="store_pickup")||(o.data.store_pickup?n.push({type:"store_pickup",price:o.data.store_pickup.price,description:o.data.store_pickup.description,deliveryType:o.data.store_pickup.type,characteristics:o.data.store_pickup.characteristics}):n.push({type:"store_pickup",price:0,description:"Retira tu pedido en una de nuestras tiendas",deliveryType:"Retiro en Tienda",characteristics:["Sin costo de envío","Horarios flexibles","Atención personalizada"]})),Le(!0)):(Le(!1),Te(null)),Z(n),R(((v=n[0])==null?void 0:v.type)||null),j(((_=n[0])==null?void 0:_.price)||0),be(!1)}catch{B.error("Sin cobertura",{description:"No realizamos envíos a esta ubicación.",icon:e.jsx(Me,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),Z([]),R(null),j(0),be(!1)}x(!1)},ze=async t=>{var o,n;if(t.preventDefault(),C)return;if(!s){B.error("Acceso requerido",{description:"Debe iniciar sesión para continuar.",icon:e.jsx(ut,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"});return}const a={},v=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,_=/^[0-9]{9}$/;if(N.name.trim()||(a.name="Nombre es requerido"),N.lastname.trim()||(a.lastname="Apellido es requerido"),N.documentType.trim()||(a.documentType="Tipo de documento es requerido"),N.document.trim()||(a.document="Número de documento es requerido"),N.email.trim()?v.test(N.email)||(a.email="Email inválido"):a.email="Email es requerido",N.phone.trim()?_.test(N.phone.trim())||(a.phone="Teléfono debe tener exactamente 9 dígitos"):a.phone="Teléfono es requerido",N.ubigeo||(a.ubigeo="Ubicación es requerida"),N.address||(a.address="Dirección es requerida"),L||(a.shipping="Seleccione un método de envío"),Object.keys(a).length>0){D(a);const y=Object.keys(a)[0],w={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",documentType:"Por favor seleccione el tipo de documento",document:"Por favor ingrese su número de documento",email:(o=a.email)!=null&&o.includes("inválido")?"Por favor ingrese un correo electrónico válido":"Por favor ingrese su correo electrónico",phone:(n=a.phone)!=null&&n.includes("9 dígitos")?"El teléfono debe tener exactamente 9 dígitos":"Por favor ingrese su número de teléfono",ubigeo:"Por favor seleccione su ubicación de entrega",address:"Por favor ingrese su dirección de entrega",shipping:"Por favor seleccione un método de envío"};B.error("Complete el campo requerido",{description:w[y],icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),Ge(a);return}M(!0);try{const y={user_id:s.id,...N,fullname:`${N.name} ${N.lastname}`,country:"Perú",document_type:N.documentType,amount:I(Ne),delivery:I(r),delivery_type:L,store_id:L==="store_pickup"?ve==null?void 0:ve.id:null,cart:l,coupon_id:(A==null?void 0:A.id)||null,coupon_code:(A==null?void 0:A.code)||null,coupon_discount:I(qe||0),applied_promotions:F||[],promotion_discount:I(Q||0)};console.log("📦 Request completo a enviar:",y),console.log("💰 Monto final con cupón:",Ne),console.log("🎟️ Descuento del cupón:",qe),console.log("🚚 Costo de envío:",r);const w=await bt(y);w.status?(h(w.sale),u(w.delivery),i(w.code),w.conversion_scripts&&(console.log("Scripts de conversión recibidos:",w.conversion_scripts),U(w.conversion_scripts),G&&G(w.sale_id,w.conversion_scripts)),S([]),k()):B.error("Error en el pago",{description:w.message||"Pago rechazado",icon:e.jsx(Me,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch{B.error("Lo sentimos, no puede continuar con la compra",{description:"Ocurrió un error al procesar el pedido.",icon:e.jsx(Me,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{M(!1)}},Xe=c.useCallback(lt.debounce((t,a)=>{if(t.length<3){a([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(t)}`).then(v=>{if(!v.ok)throw new Error("Error en la respuesta");return v.json()}).then(v=>{const _=v.map(o=>({value:o.reniec,label:`${o.distrito}, ${o.provincia}, ${o.departamento}`,data:{inei:o.inei,reniec:o.reniec,departamento:o.departamento,provincia:o.provincia,distrito:o.distrito}}));a(_)}).catch(v=>{a([])})},300),[]);c.useEffect(()=>{D(t=>{const a={...t};return N.name.trim()&&delete a.name,N.lastname.trim()&&delete a.lastname,N.documentType.trim()&&delete a.documentType,N.document.trim()&&delete a.document,N.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(N.email)&&delete a.email,N.phone.trim()&&/^[0-9]{9}$/.test(N.phone.trim())&&delete a.phone,N.address.trim()&&delete a.address,N.ubigeo&&delete a.ubigeo,L&&delete a.shipping,a})},[N,L]);const Ke=t=>({control:a=>({...a,border:`1px solid ${t?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:t?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:a=>({...a,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:a=>({...a,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),Qe=async()=>{var t;if(!le.trim()){xe("Ingrese un código de cupón");return}Re(!0),xe("");try{const a=[...new Set(l.map(n=>n.category_id).filter(Boolean))],v=l.map(n=>n.id);console.log("Validando cupón:",{code:le.trim(),cart_total:b,category_ids:a,product_ids:v});const _=await tt.validateCoupon({code:le.trim(),cart_total:b,category_ids:a,product_ids:v});console.log("Respuesta del cupón:",_);const o=_.data||_;if(o&&o.valid){Fe(o.coupon);const n=Math.round(o.discount*100)/100;Ee(n),T&&T(n),V&&V(((t=o.coupon)==null?void 0:t.code)||le.trim()),B.success("Cupón aplicado",{description:o.message||"Cupón aplicado correctamente",duration:3e3,position:"top-center"})}else{const n=(o==null?void 0:o.message)||"Cupón no válido";xe(n),B.error("Cupón no válido",{description:n,icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(a){console.error("Error al validar cupón:",a),xe("Error al validar el cupón"),B.error("Error",{description:a.message||"No se pudo validar el cupón. Intente nuevamente.",icon:e.jsx(ce,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{Re(!1)}},Je=()=>{Fe(null),Ee(0),$e(""),xe(""),T&&T(0),V&&V(""),B.success("Cupón removido",{description:"El cupón ha sido removido de su pedido",duration:2e3,position:"top-center"})},I=t=>{const a=typeof t=="string"?parseFloat(t):t;return parseFloat(a.toFixed(2))},Oe=I(b)+I(m)+I(r)-I(K);let he=0;A&&(A.type==="percentage"||A.type==="percent"?he=Oe*Number(A.value)/100:A.type==="fixed"&&(he=Number(A.value))),c.useEffect(()=>{Ee(I(he)),T&&T(I(he))},[A,b,m,r,K]);const Ne=Math.max(0,I(Oe-he));return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:ze,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(se,{name:"name",label:"Nombres",value:N.name,error:q.name,onChange:t=>{O(a=>({...a,name:t.target.value})),t.target.value.trim()&&q.name&&D(a=>({...a,name:""}))},required:!0,className:`border-gray-200 ${q.name?"border-red-500 bg-red-50":""}`}),e.jsx(se,{name:"lastname",label:"Apellidos",value:N.lastname,error:q.lastname,onChange:t=>{O(a=>({...a,lastname:t.target.value})),t.target.value.trim()&&q.lastname&&D(a=>({...a,lastname:""}))},required:!0,className:`border-gray-200 ${q.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(it,{label:"Tipo de documento",options:pe,placeholder:"Selecciona tu documento",labelClass:"block text-sm 2xl:!text-base mb-1 customtext-neutral-dark",value:N.documentType,error:q.documentType,onChange:t=>{O(a=>({...a,documentType:t})),t&&q.documentType&&D(a=>({...a,documentType:""}))},required:!0})}),e.jsx(se,{name:"document",label:"Número de documento",value:N.document,error:q.document,onChange:t=>{O(a=>({...a,document:t.target.value})),t.target.value.trim()&&q.document&&D(a=>({...a,document:""}))},placeholder:"Ej: 12345678",required:!0,className:`border-gray-200 ${q.document?"border-red-500 bg-red-50":""}`})]}),e.jsx(se,{name:"email",label:"Correo electrónico",type:"email",value:N.email,error:q.email,onChange:t=>{O(a=>({...a,email:t.target.value})),t.target.value.trim()&&q.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.target.value)&&D(v=>({...v,email:""}))},required:!0,className:`border-gray-200 ${q.email?"border-red-500 bg-red-50":""}`}),e.jsx(se,{name:"phone",label:"Teléfono",type:"tel",value:N.phone,error:q.phone,onChange:t=>{const a=t.target.value.replace(/\D/g,"");O(v=>({...v,phone:a})),a.length===9&&q.phone&&D(v=>({...v,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${q.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (Ubicación de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(Ze,{name:"ubigeo",cacheOptions:!0,value:W,loadOptions:Xe,onChange:t=>{X(t),Ie(t),ge("")},inputValue:Se,onInputChange:(t,{action:a})=>{a==="input-change"&&ge(t)},onFocus:()=>{X(null),ge("")},onMenuOpen:()=>{W&&(X(null),ge(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:t})=>t.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:g,styles:Ke(!!q.ubigeo),formatOptionLabel:({data:t})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:t.distrito}),e.jsxs("div",{className:"text-gray-500",children:[t.provincia,", ",t.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),q.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:q.ubigeo})]}),e.jsx(se,{name:"address",label:"Dirección ",value:N.address,error:q.address,onChange:t=>{O(a=>({...a,address:t.target.value})),t.target.value.trim()&&q.address&&D(a=>({...a,address:""}))},required:!0,className:`border-gray-200 ${q.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(se,{label:"Número",value:N.number,onChange:t=>O(a=>({...a,number:t.target.value})),className:"border-gray-200"}),e.jsx(se,{label:"Referencia",value:N.reference,onChange:t=>O(a=>({...a,reference:t.target.value})),className:"border-gray-200"})]}),H.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Método de envío"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.map(t=>e.jsx(et,{title:t.deliveryType,price:t.price,description:t.description,selected:L===t.type,onSelect:()=>{R(t.type),j(t.price),D(a=>({...a,shipping:"",store:""})),be(!1),t.type!=="store_pickup"&&Te(null)}},t.type))}),L&&H.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(()=>{var _;const t=((_=H.find(o=>o.type===L))==null?void 0:_.characteristics)||[],a=t.length>1,v=a&&!ye?t.slice(0,1):t;return e.jsxs(e.Fragment,{children:[v.map((o,n)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(mt,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:o})})]},`char-${n}`)),a&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{type:"button",onClick:()=>be(!ye),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium customtext-primary hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:ye?"Ver menos información":`Ver más información (${t.length-1} más)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${ye?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})})()})]}),L==="store_pickup"&&He&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(jt,{ubigeoCode:N.ubigeo,onStoreSelect:Ue,selectedStore:ve,className:"border border-gray-200 rounded-xl p-4"}),q.store&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),q.store]})]}),!f&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(Ve,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(ke,{type:"submit",loading:g,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:l.map(t=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/storage/images/item/${t.image}`,alt:t.name,className:"w-16 h-16 object-cover rounded-lg",onError:a=>a.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cantidad: ",t.quantity]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["S/ ",P(t.final_price)]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",P(I(b))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IGV (18%):"}),e.jsxs("span",{children:["S/ ",P(I(m))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Envío:"}),e.jsxs("span",{children:["S/ ",P(I(r))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"¿Tienes un cupón de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu código de cupón",value:le,onChange:t=>$e(t.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${Pe?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":A?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!A||je}),je&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),A?e.jsx("button",{type:"button",onClick:Je,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cupón",children:e.jsx(ce,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:Qe,disabled:je||!le.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:je?"Validando...":"Aplicar"})]}),Pe&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ce,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:Pe})]}),A&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",A.type==="percentage"?`${A.value}%`:`S/${P(A.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:A.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-S/ ",P(I(qe))]})})]})})]})}),z&&z.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"🎉 Descuentos automáticos aplicados:"}),z.map((t,a)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:t.name}),t.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:t.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-S/ ",P(t.amount)]})})]})},a)),K>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos automáticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-S/ ",P(K)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["S/ ",P(I(Ne))]})]})}),e.jsx(ke,{onClick:ze,className:"w-full mt-6",disabled:C,loading:C,children:C?"Procesando...":`Pagar S/ ${P(I(Ne))}`}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{href:"#",onClick:()=>E(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{href:"#",onClick:()=>E(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})]})]})]})}function Nt({cart:l,code:h,delivery:i,couponDiscount:u=0,couponCode:S=null,conversionScripts:k=null,automaticDiscounts:f=[],automaticDiscountTotal:b=0}){const m=l.reduce((d,E)=>{const T=E.final_price;return d+T*E.quantity},0),p=parseFloat((m/1.18).toFixed(2)),s=parseFloat((m-p).toFixed(2)),r=parseFloat(p)+parseFloat(s)+parseFloat(i)-u-b;return c.useEffect(()=>{if(k){console.log("Executing conversion scripts...");try{if(k.head){const d=document.createElement("script");d.innerHTML=k.head,document.head.appendChild(d)}if(k.body){const d=document.createElement("script");d.innerHTML=k.body,document.body.appendChild(d)}console.log("Conversion scripts executed successfully")}catch(d){console.error("Error executing conversion scripts:",d)}}},[k]),e.jsx(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(ne.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"✓"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"¡Gracias por tu compra! 🎉"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(ne.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"Código de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${h}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:l.map((d,E)=>e.jsx(ne.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:E*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${d.image}`,alt:d.name,className:"w-24 h-24 object-cover rounded-lg",onError:T=>T.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-xl lg:w-8/12 line-clamp-3",children:d.name}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:["S/ ",P(d.final_price*d.quantity)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:d.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:d.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:d.sku})]})]})]})]})},E))}),e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[[{label:"Subtotal",value:p},{label:"IGV",value:s},{label:"Envío",value:i}].map((d,E)=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:d.label}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(d.value)]})]},E)),u>0&&S&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark text-start",children:["Cupón: ",e.jsx("br",{className:"lg:hidden"}),e.jsxs("span",{className:"font-semibold text-xs lg:text-base",children:["(",S,")"]})]}),e.jsxs("span",{className:"font-semibold",children:["-S/ ",P(u)]})]}),b>0&&f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 customtext-neutral-dark mb-2",children:"🎉 Descuentos aplicados:"}),f.map((d,E)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:[d.name,d.description&&e.jsx("span",{className:"text-xs font-semibold block",children:d.description})]}),e.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-S/ ",P(d.amount)]})]},E)),e.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[e.jsx("span",{children:"Total descuentos:"}),e.jsxs("span",{children:["-S/ ",P(b)]})]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",P(r)]})]})})]}),e.jsx(ne.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(ke,{href:"/catalogo",className:"w-full mx-auto md:w-auto",children:"Seguir Comprando"})})]})]})})})}const wt=()=>{const l=c.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),h=(m,p={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[m],content_type:"product",content_name:p.name||"",value:p.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:p.price||0,items:[{item_id:m,item_name:p.name||"",category:p.category||"",price:p.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:m,content_type:"product",content_name:p.name||"",value:p.price||0,currency:"PEN"}),console.log("✅ ProductView tracked for product:",m))},i=async(m,p=1,s={})=>{var j;if(!(typeof window>"u"))try{const d=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((j=document.querySelector('meta[name="csrf-token"]'))==null?void 0:j.content)||""},body:JSON.stringify({product_id:m,quantity:p,...s})})).json();d.success&&d.tracking_scripts&&(f(d.tracking_scripts),console.log("✅ AddToCart tracked successfully"))}catch(r){console.error("❌ Error tracking AddToCart:",r)}},u=async(m,p)=>{var s;if(!(typeof window>"u"||l.current.hasTrackedInitiateCheckout))try{l.current.hasTrackedInitiateCheckout=!0;const r=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""},body:JSON.stringify({cart_items:m.map(d=>({product_id:d.id,name:d.name,price:d.final_price||d.price,quantity:d.quantity,subtotal:(d.final_price||d.price)*d.quantity}))})})).json();r.success&&r.tracking_scripts&&(f(r.tracking_scripts),console.log("✅ InitiateCheckout tracked successfully"))}catch(j){console.error("❌ Error tracking InitiateCheckout:",j),l.current.hasTrackedInitiateCheckout=!1}},S=(m,p)=>{typeof window>"u"||(p?f(p):fetch(`/api/tracking/purchase/${m}`).then(s=>s.text()).then(s=>{s&&(f(s),console.log("✅ Purchase tracked successfully"))}).catch(s=>{console.error("❌ Error tracking Purchase:",s)}))},k=(m,p=[])=>{if(typeof window>"u"||l.current.hasTrackedPageView)return;l.current.hasTrackedPageView=!0;const s=p.reduce((j,r)=>j+(r.final_price||r.price)*r.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),m===1&&p.length>0&&window.fbq("track","AddToCart",{content_ids:p.map(j=>j.id),content_type:"product",value:s,currency:"PEN",num_items:p.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${m}`,page_location:window.location.href}),m===1&&p.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:s,items:p.map(j=>{var r;return{item_id:j.id,item_name:j.name,category:((r=j.category)==null?void 0:r.name)||"Sin categoría",quantity:j.quantity,price:j.final_price||j.price}})})),console.log(`✅ Checkout PageView tracked - Step ${m}`)},f=m=>{if(typeof window>"u"||!m)return;const p=document.createElement("div");p.innerHTML=m,p.querySelectorAll("script").forEach(j=>{const r=document.createElement("script");r.textContent=j.textContent,document.head.appendChild(r),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},100)})};return{trackProductView:h,trackAddToCart:i,trackInitiateCheckout:u,trackPurchase:S,trackCheckoutPageView:k,resetTracking:()=>{l.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};function xs({cart:l,setCart:h,user:i,ubigeos:u=[],items:S,generals:k}){const[f,b]=c.useState(1),m=l.reduce((R,ee)=>R+ee.final_price*ee.quantity,0),{trackCheckoutPageView:p,trackInitiateCheckout:s,trackPurchase:j,resetTracking:r}=wt(),d=parseFloat((m/1.18).toFixed(2)),E=parseFloat((m-d).toFixed(2)),[T,V]=c.useState(0),[F,Q]=c.useState(0),[oe,J]=c.useState(null),[U,G]=c.useState([]),[W,X]=c.useState(0),Y=d+E+parseFloat(T),ae=F+W,z=Math.max(0,Y-ae),[ie,K]=c.useState([]),[re,ue]=c.useState([]),[pe,N]=c.useState([]),[O,g]=c.useState(null);c.useEffect(()=>(p(f,l),()=>r()),[]),c.useEffect(()=>{p(f,l),f===2&&s(l,z)},[f]),c.useEffect(()=>{const R=document.createElement("script");return R.src=de.CULQI_API,R.async=!0,R.onload=()=>{window.culqi=function(){window.Culqi.token||window.Culqi.order}},document.body.appendChild(R),()=>document.body.removeChild(R)},[]);const x=R=>{b(R),window.scrollTo({top:0,behavior:"smooth"})},C={privacy_policy:"Políticas de privacidad",terms_conditions:"Términos y condiciones",saleback_policy:"Políticas de devolucion y cambio"},[M,H]=c.useState(null),Z=R=>H(R),L=()=>H(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${f===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:f>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${f>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${f>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Envío"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:f>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${f===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${f===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmación"})]})]})}),f===1&&e.jsx(gt,{cart:l,setCart:h,onContinue:()=>x(2),subTotal:d,envio:T,igv:E,totalFinal:z,openModal:Z,automaticDiscounts:U,setAutomaticDiscounts:G,automaticDiscountTotal:W,setAutomaticDiscountTotal:X,totalWithoutDiscounts:Y}),f===2&&e.jsx(vt,{items:S,setCode:ue,setDelivery:N,cart:l,setSale:K,setCart:h,onContinue:()=>x(3),noContinue:()=>x(1),subTotal:d,envio:T,setEnvio:V,igv:E,totalFinal:z,user:i,ubigeos:u,openModal:Z,setCouponDiscount:Q,setCouponCode:J,automaticDiscounts:U,automaticDiscountTotal:W,totalWithoutDiscounts:Y}),f===3&&e.jsx(Nt,{code:re,delivery:pe,cart:ie,subTotal:d,envio:T,igv:E,totalFinal:z,couponDiscount:F,couponCode:oe,automaticDiscounts:U,automaticDiscountTotal:W,totalWithoutDiscounts:Y,conversionScripts:O,setConversionScripts:g,onPurchaseComplete:(R,ee)=>{j(R,ee)}})]}),Object.keys(C).map((R,ee)=>{var D;const _e=C[R],q=((D=k.find(Se=>Se.correlative==R))==null?void 0:D.description)??"";return e.jsx(ct,{isOpen:M===ee,onRequestClose:L,contentLabel:_e,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:_e}),e.jsx("button",{onClick:L,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(Be,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(dt,{html:q})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:L,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},ee)})]})}export{xs as default};

var e=Object.defineProperty,a=(a,r,t)=>((a,r,t)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t)(a,"symbol"!=typeof r?r+"":r,t);import{c as r,j as t,r as n}from"./vendor-react-BX-OgZ1w.js";import{B as o}from"./Base-D1ePwdy7.js";import{C as i}from"./CreateReactScript-A9ZGwbIB.js";import{T as s}from"./Table-D-WA49us.js";import{I as l}from"./InputFormGroup-EFtQ7_4Q.js";import{R as c}from"./ReactAppend-S9ISIyFy.js";import{D as d}from"./DxButton-C6FT_beP.js";import{S as u}from"./SwitchFormGroup-B2qNccAM.js";import{S as m}from"./CartKuchara-BRbOrA8K.js";import{B as p}from"./BasicRest-qY-8D5Ep.js";import{M as f}from"./Modal-8M1u2XTi.js";import{S as h}from"./SelectFormGroup-CmffoIIP.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-CrpKyZX2.js";import"./TippyButton-DqdjTa95.js";import"./Logout-BWCHsJMV.js";import"./MenuItemContainer-Dgmk4LC8.js";import"./Menu-BGctQja3.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";import"./OpenPayCardModal-DKUbGzgl.js";const x=new class extends p{constructor(){super(...arguments),a(this,"path","admin/users"),a(this,"hasFiles",!1)}},j=({})=>{const e=n.useRef(),a=n.useRef(),r=n.useRef(),o=n.useRef(),i=n.useRef(),p=n.useRef(),j=n.useRef(),v=n.useRef(),b=n.useRef(),R=n.useRef(),g=n.useRef(),w=n.useRef(),[C,y]=n.useState(!1),N=e=>{y(!!e?.id),r.current.value=e?.id??"",o.current.value=e?.name??"",i.current.value=e?.lastname??"",p.current.value=e?.email??"",j.current.value="",v.current.value="",b.current.value=e?.phone??"",R.current.value=e?.phone_prefix??"+51",g.current.value=e?.dni??"",e?.roles&&e?.roles.length>0?$(w.current).val(e.roles[0].name).trigger("change"):$(w.current).val("Admin").trigger("change"),$(a.current).modal("show")},S=e=>{if(!e||0===e.length)return"Sin rol";const a=e[0].name;switch(a){case"Root":return"Super Administrador";case"Admin":return"Administrador";default:return a}},F=e=>{if(!e||0===e.length)return"badge-secondary";switch(e[0].name){case"Root":return"badge-danger";case"Admin":return"badge-primary";default:return"badge-secondary"}};return t.jsxs(t.Fragment,{children:[t.jsx(s,{gridRef:e,title:"Usuarios del Sistema",rest:x,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo usuario",hint:"Crear nuevo usuario",onClick:()=>N()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre completo",width:"25%",cellTemplate:(e,{data:a})=>{c(e,t.jsxs("div",{children:[t.jsxs("strong",{children:[a.name," ",a.lastname]}),t.jsx("br",{}),t.jsx("small",{className:"text-muted",children:a.email})]}))}},{dataField:"phone",caption:"Teléfono",cellTemplate:(e,{data:a})=>{a.phone?c(e,t.jsxs("span",{children:[a.phone_prefix||"+51"," ",a.phone]})):c(e,t.jsx("span",{className:"text-muted",children:"- Sin teléfono -"}))}},{dataField:"dni",caption:"DNI",cellTemplate:(e,{data:a})=>{a.dni?c(e,t.jsx("span",{children:a.dni})):c(e,t.jsx("span",{className:"text-muted",children:"- Sin DNI -"}))}},{dataField:"roles",caption:"Rol",allowFiltering:!1,cellTemplate:(e,{data:a})=>{c(e,t.jsx("span",{className:`badge ${F(a.roles)}`,children:S(a.roles)}))}},{dataField:"status",caption:"Estado",dataType:"boolean",width:"120px",cellTemplate:(a,{data:r})=>{c(a,t.jsx(u,{checked:1==r.status,onChange:a=>(async({id:a,value:r})=>{await x.boolean({id:a,field:"status",value:r})&&$(e.current).dxDataGrid("instance").refresh()})({id:r.id,value:a.target.checked})}))}},{caption:"Acciones",cellTemplate:(a,{data:r})=>{a.css("text-overflow","unset"),a.append(d({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>N(r)})),a.append(d({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async a=>{const{isConfirmed:r}=await m.fire({title:"Eliminar usuario",text:"¿Estás seguro de eliminar este usuario?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!r)return;await x.delete(a)&&$(e.current).dxDataGrid("instance").refresh()})(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(f,{modalRef:a,title:C?"Editar usuario":"Crear nuevo usuario",onSubmit:async t=>{if(t.preventDefault(),!C||j.current.value){if(j.current.value!==v.current.value)return void m.fire({title:"Error",text:"Las contraseñas no coinciden",icon:"error"});if(j.current.value.length<6)return void m.fire({title:"Error",text:"La contraseña debe tener al menos 6 caracteres",icon:"error"})}const n={id:r.current.value||void 0,name:o.current.value,lastname:i.current.value,email:p.current.value,phone:b.current.value,phone_prefix:R.current.value,dni:g.current.value,role:w.current.value};j.current.value&&(n.password=j.current.value);await x.save(n)&&($(e.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},size:"lg",children:t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:r,type:"hidden"}),t.jsx(l,{eRef:o,label:"Nombres",col:"col-md-6",required:!0}),t.jsx(l,{eRef:i,label:"Apellidos",col:"col-md-6",required:!0}),t.jsx(l,{eRef:p,label:"Correo electrónico",type:"email",col:"col-md-6",required:!0}),t.jsx(l,{eRef:g,label:"DNI",col:"col-md-6"}),t.jsx("div",{className:"col-md-3",children:t.jsxs(h,{eRef:R,label:"Prefijo",required:!0,children:[t.jsx("option",{value:"+51",children:"+51 (Perú)"}),t.jsx("option",{value:"+1",children:"+1 (EE.UU.)"}),t.jsx("option",{value:"+34",children:"+34 (España)"}),t.jsx("option",{value:"+52",children:"+52 (México)"}),t.jsx("option",{value:"+57",children:"+57 (Colombia)"})]})}),t.jsx(l,{eRef:b,label:"Teléfono",type:"tel",col:"col-md-9"}),t.jsx("div",{className:"col-md-6",children:t.jsxs(h,{eRef:w,label:"Rol",required:!0,children:[t.jsx("option",{value:"Admin",children:"Administrador"}),("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)&&t.jsx("option",{value:"Root",children:"Super Administrador"})]})}),t.jsxs("div",{className:"col-12",children:[t.jsx("hr",{}),t.jsx("h6",{children:C?"Cambiar contraseña (opcional)":"Contraseña"})]}),t.jsx(l,{eRef:j,label:C?"Nueva contraseña":"Contraseña",type:"password",col:"col-md-6",required:!C,placeholder:C?"Dejar vacío para mantener la actual":""}),t.jsx(l,{eRef:v,label:"Confirmar contraseña",type:"password",col:"col-md-6",required:!C})]})})]})};i((e,a)=>{r.createRoot(e).render(t.jsx(o,{...a,title:"Usuarios",children:t.jsx(j,{...a})}))});

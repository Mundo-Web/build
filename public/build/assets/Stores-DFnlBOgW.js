import{j as i}from"./AboutSimple-Cf8x2fCZ.js";import{r as t}from"./index-BOnQTV8N.js";import{c as ee}from"./ReactAppend-QR5TrZfj.js";import{s as ie}from"./server.browser-Bf4gQIc7.js";import{L as re,G as oe,M as ne}from"./esm-Brp_9RVN.js";import{S as le}from"./StoresRest-C-Zz0WQC.js";import{C as se,F as a}from"./CreateReactScript-Dz3UpYPP.js";import{B as te}from"./Base-NbtpFRZL.js";import{T as ae}from"./Table-C0bje_JZ.js";import{M as ce}from"./Modal-BYL-UsqM.js";import{I as p}from"./InputFormGroup-iZIO11ZN.js";import{T as de}from"./TextareaFormGroup-CliirJM1.js";import{I as pe}from"./ImageFormGroup-DkVgPNU5.js";import{S as q}from"./SelectFormGroup-X8WqJHHl.js";import{D as Y}from"./DxButton-DV0H-ZcL.js";import{S as u}from"./ProductCard-D_AgkLlk.js";import{G as ue}from"./Global-DWbVqTT_.js";import{R as me}from"./ReactAppend-Vm5G2nof.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./index-pSueRYGM.js";import"./BasicRest-BqhZrBN0.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CardProductKatya-ncpmQ0JU.js";import"./index.esm-D6GvEWn_.js";import"./index-BQJyKPGC.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./CanAccess-DgL4m2bH.js";import"./tippy-react.esm-DmkRJDEW.js";import"./Logout-BpuTJ_83.js";import"./MenuItemContainer-DwXwpKCn.js";const j=new le,fe=({ubigeos:N=[]})=>{const g=t.useRef(),S=t.useRef(),h=t.useRef(),w=t.useRef(),E=t.useRef(),F=t.useRef(),C=t.useRef(),D=t.useRef(),R=t.useRef(),x=t.useRef(),v=t.useRef(),c=t.useRef();t.useRef();const T=t.useRef(),k=t.useRef(),b=t.useRef(),A=t.useRef(),[z,B]=t.useState(!1),[K,_]=t.useState({lat:-12.046374,lng:-77.042793}),[G,y]=t.useState(null),[M,L]=t.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),V=e=>{if(console.log(e),e!=null&&e.id?B(!0):B(!1),h.current.value=(e==null?void 0:e.id)??"",w.current.value=(e==null?void 0:e.name)??"",E.current.value=(e==null?void 0:e.address)??"",F.current.value=(e==null?void 0:e.phone)??"",C.current.value=(e==null?void 0:e.email)??"",D.current.value=(e==null?void 0:e.description)??"",x.current.value=(e==null?void 0:e.latitude)??"",v.current.value=(e==null?void 0:e.longitude)??"",T.current.value=(e==null?void 0:e.manager)??"",k.current.value=(e==null?void 0:e.capacity)??"",c.resetDeleteFlag&&c.resetDeleteFlag(),c.current&&(c.image.src=e!=null&&e.image?`/storage/images/store/${e.image}`:""),$(R.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),e!=null&&e.id?j.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(r=>{console.log("Verificando tiendas principales para edición:",r);const o=$(b.current);if(r!=null&&r.data&&Array.isArray(r.data)&&r.data.length>0){const n=r.data.find(s=>s.id!==e.id);n?(console.log("Existe otra tienda principal:",n),e.type!=="tienda_principal"?o.find('option[value="tienda_principal"]').prop("disabled",!0):o.find('option[value="tienda_principal"]').prop("disabled",!1)):(console.log("No existe otra tienda principal"),o.find('option[value="tienda_principal"]').prop("disabled",!1))}else console.log("No hay tiendas principales"),o.find('option[value="tienda_principal"]').prop("disabled",!1);o.val((e==null?void 0:e.type)??"tienda").trigger("change")}).catch(r=>{console.error("Error al verificar tiendas principales:",r),$(b.current).val((e==null?void 0:e.type)??"tienda").trigger("change")}):j.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(r=>{console.log("Verificando tiendas principales existentes:",r);const o=(r==null?void 0:r.data)&&Array.isArray(r.data)&&r.data.length>0,n=$(b.current);o?(console.log("Se encontraron tiendas principales:",r.data),n.find('option[value="tienda_principal"]').prop("disabled",!0)):(console.log("No se encontraron tiendas principales"),n.find('option[value="tienda_principal"]').prop("disabled",!1)),n.val((e==null?void 0:e.type)??"tienda").trigger("change")}).catch(r=>{console.error("Error al verificar tiendas principales:",r)}),e!=null&&e.business_hours)try{const r=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours;L(r)}catch(r){console.error("Error parsing business hours:",r)}else L([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);if(e!=null&&e.latitude&&(e!=null&&e.longitude)){const r=parseFloat(e.latitude),o=parseFloat(e.longitude);if(!isNaN(r)&&!isNaN(o)){const n={lat:r,lng:o};_(n),y(n)}}else _({lat:-12.046374,lng:-77.042793}),y(null);$(S.current).modal("show")},Q=async e=>{if(e.preventDefault(),b.current.value==="tienda_principal")try{const d=h.current.value,f=await j.paginate({filter:JSON.stringify({type:"tienda_principal"})});if(console.log("Respuesta de validación tienda principal:",f),f!=null&&f.data&&Array.isArray(f.data)&&f.data.length>0)if(d){const H=f.data.find(Z=>Z.id!==d);if(H){console.log("Ya existe otra tienda principal:",H),u.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});return}}else{console.log("Tiendas principales encontradas:",f.data),u.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});return}}catch(d){console.error("Error al verificar tienda principal:",d),u.fire({title:"Error",text:"Error al verificar si existe una tienda principal",icon:"error"});return}const r=x.current.value.trim(),o=v.current.value.trim();let n=null,s=null;if(r){if(n=parseFloat(r),console.log("Latitud procesada:",n,"desde:",r),n<-18.5||n>-.1){u.fire({title:"Error de validación",text:"La latitud debe estar entre -18.5 y -0.1 para ubicaciones en Perú",icon:"error"});return}if(!U(n,10,8)){u.fire({title:"Error de validación",text:"La latitud excede el formato permitido (máximo 10 dígitos con 8 decimales)",icon:"error"});return}n=Math.round(n*1e8)/1e8,console.log("Latitud truncada:",n)}if(o){if(s=parseFloat(o),console.log("Longitud procesada:",s,"desde:",o),s<-81.5||s>-68.5){u.fire({title:"Error de validación",text:"La longitud debe estar entre -81.5 y -68.5 para ubicaciones en Perú",icon:"error"});return}if(!U(s,11,8)){u.fire({title:"Error de validación",text:"La longitud excede el formato permitido (máximo 11 dígitos con 8 decimales)",icon:"error"});return}s=Math.round(s*1e8)/1e8,console.log("Longitud truncada:",s)}N.find(d=>d.reniec==R.current.value);const l=new FormData,m=h.current.value;console.log("DEBUG ID - Valor del ID a enviar:",m,"Tipo:",typeof m,"Vacío?:",!m),h.current.value?(l.append("id",h.current.value),console.log("DEBUG ID - ID agregado al FormData:",h.current.value)):console.log("DEBUG ID - No se agrega ID al FormData (valor vacío)"),l.append("name",w.current.value),l.append("address",E.current.value),l.append("phone",F.current.value),l.append("email",C.current.value),l.append("description",D.current.value),l.append("ubigeo",R.current.value),l.append("latitude",n!==null?n.toString():""),l.append("longitude",s!==null?s.toString():""),l.append("manager",T.current.value),l.append("capacity",k.current.value),l.append("type",b.current.value),l.append("link",A.current.value),l.append("business_hours",JSON.stringify(M)),c.current&&c.current.files[0]&&l.append("image",c.current.files[0]),c.getDeleteFlag&&c.getDeleteFlag()&&l.append("image_delete","DELETE"),console.log("Datos a enviar:"),console.log("- Latitud:",n),console.log("- Longitud:",s);for(let d of l.entries())console.log(d[0]+": "+d[1]);await j.save(l)&&(a.has("stores","image")&&c.resetDeleteFlag&&c.resetDeleteFlag(),$(g.current).dxDataGrid("instance").refresh(),$(S.current).modal("hide"))},W=async e=>{const{isConfirmed:r}=await u.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await j.delete(e)||$(g.current).dxDataGrid("instance").refresh()},I=(e,r,o)=>{const n=[...M];n[e][r]=o,L(n)},X=e=>{const r=e.latLng.lat(),o=e.latLng.lng();console.log("Coordenadas seleccionadas:",{lat:r,lng:o}),y({lat:r,lng:o}),x.current&&(x.current.value=r.toFixed(8)),v.current&&(v.current.value=o.toFixed(8)),u.fire({title:"Ubicación seleccionada",text:`Coordenadas: ${r.toFixed(6)}, ${o.toFixed(6)}`,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})},O=()=>{var o,n;const e=parseFloat((o=x.current)==null?void 0:o.value),r=parseFloat((n=v.current)==null?void 0:n.value);if(!isNaN(e)&&!isNaN(r)){const s={lat:e,lng:r};_(s),y(s)}},U=(e,r,o)=>{if(e==null||isNaN(e))return!1;const s=Math.abs(e).toString().split("."),l=s[0],m=s[1]||"";console.log(`Validando coordenada: ${e}`),console.log(`Parte entera: ${l} (${l.length} dígitos)`),console.log(`Parte decimal: ${m} (${m.length} dígitos)`),console.log(`Total permitido: ${r}, decimales permitidos: ${o}`),m.length>o&&console.log(`Advertencia: Truncando decimales de ${m.length} a ${o} dígitos`);const P=r-o;return l.length>P?(console.log(`Error: Excede dígitos enteros permitidos (${l.length} > ${P})`),!1):(console.log("Coordenada válida (se truncará automáticamente si es necesario)"),!0)},J=e=>$(ie.renderToString(i.jsxs("span",{children:[i.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),i.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]})));return i.jsxs(i.Fragment,{children:[i.jsx(ae,{gridRef:g,title:"Tiendas / Sucursales",rest:j,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(g.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>V()}})},columns:[{dataField:"id",caption:"ID",visible:!1},a.has("stores","image")&&{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{me(e,i.jsx("img",{src:`/storage/images/store/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:o=>o.target.src="/api/cover/thumbnail/null"}))}},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:r})=>{const o={tienda_principal:"Tienda Principal",tienda:"Tienda",oficina:"Oficina",almacen:"Almacén",showroom:"Showroom",otro:"Otro"},n={tienda_principal:"danger",tienda:"success",oficina:"primary",almacen:"warning",showroom:"info",otro:"secondary"},s=o[r.type]||"No especificado",l=n[r.type]||"secondary";e.append(`<span class="badge bg-${l}">${s}</span>`)}},{dataField:"address",caption:"Dirección",width:"250px"},a.has("stores","phone")&&{dataField:"phone",caption:"Teléfono",width:"120px"},a.has("stores","email")&&{dataField:"email",caption:"Email",width:"180px"},a.has("stores","link")&&{dataField:"link",caption:"Enlace",cellTemplate:(e,{data:r})=>{r.link?e.html(`<a href="${r.link}" target="_blank" class="text-primary">
                                        ${r.link.length>30?r.link.substring(0,30)+"...":r.link}
                                    </a>`):e.text("Sin enlace")}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(Y({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>V(r)})),e.append(Y({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>W(r.id)}))},allowFiltering:!1,allowExporting:!1}].filter(Boolean)}),i.jsxs(ce,{modalRef:S,title:z?"Editar Tienda":"Agregar Tienda",onSubmit:Q,size:"lg",children:[i.jsx("input",{ref:h,type:"hidden"}),i.jsxs("div",{id:"form-container",className:"row",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:w,label:"Nombre de la tienda",col:"col-12",required:!0})}),i.jsx("div",{className:"col-md-6",children:i.jsxs(q,{eRef:b,label:"Tipo de establecimiento",col:"col-12",required:!0,dropdownParent:"#form-container",children:[i.jsx("option",{value:"tienda_principal",children:"Tienda Principal"}),i.jsx("option",{value:"tienda",children:"Tienda"}),i.jsx("option",{value:"oficina",children:"Oficina"}),i.jsx("option",{value:"almacen",children:"Almacén"}),i.jsx("option",{value:"showroom",children:"Showroom"}),i.jsx("option",{value:"otro",children:"Otro"})]})}),a.has("stores","manager")&&i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:T,label:"Encargado",col:"col-12"})}),i.jsx("div",{className:"col-12",children:i.jsx(p,{eRef:E,label:"Dirección completa",col:"col-12",required:!0})}),i.jsx("div",{className:"col-12",children:i.jsx(q,{eRef:R,label:"Distrito/Ubigeo",col:"col-12",templateResult:J,templateSelection:J,dropdownParent:"#form-container",required:!0,children:N.map((e,r)=>i.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))})}),a.has("stores","phone")&&i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:F,label:"Teléfono",col:"col-12",type:"tel"})}),a.has("stores","email")&&i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:C,label:"Email",col:"col-12",type:"email"})}),i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"card",children:[i.jsx("div",{className:"card-header",children:i.jsxs("h5",{className:"card-title mb-0",children:[i.jsx("i",{className:"fas fa-map-marker-alt me-2"}),"Ubicación de la Tienda"]})}),i.jsxs("div",{className:"card-body",children:[i.jsx("div",{className:"mb-3",children:i.jsx(re,{googleMapsApiKey:ue.GMAPS_API_KEY,children:i.jsx(oe,{mapContainerStyle:{width:"100%",height:"400px",borderRadius:"8px"},center:K,zoom:15,onClick:X,options:{streetViewControl:!0,mapTypeControl:!0,fullscreenControl:!0},children:G&&i.jsx(ne,{position:G,title:"Ubicación de la tienda"})})})}),i.jsxs("div",{className:"row",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:x,label:"Latitud",col:"col-12",type:"number",step:"0.00000001",min:"-18.5",max:"-0.1",placeholder:"Ej: -12.042626777544823",onChange:O})}),i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:v,label:"Longitud",col:"col-12",type:"number",step:"0.00000001",min:"-81.5",max:"-68.5",placeholder:"Ej: -77.04753389161506",onChange:O})})]}),i.jsx("div",{className:"row mt-3",children:i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"d-flex gap-2 flex-wrap",children:i.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{y(null),x.current.value="",v.current.value=""},children:[i.jsx("i",{className:"fas fa-eraser me-1"}),"Limpiar"]})})})})]})]})}),a.has("stores","capacity")&&i.jsx("div",{className:"col-md-6",children:i.jsx(p,{eRef:k,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),a.has("stores","link")&&i.jsxs("div",{className:"col-12",children:[i.jsx(p,{eRef:A,label:"Enlace personalizado (opcional)",col:"col-12",type:"url",placeholder:"https://ejemplo.com"}),i.jsx("small",{className:"text-muted",children:"Si se especifica, al hacer clic en la tienda redirigirá a este enlace en lugar del perfil de la tienda."})]}),a.has("stores","image")&&i.jsx("div",{className:"col-12",children:i.jsx(pe,{eRef:c,name:"image",label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),a.has("stores","description")&&i.jsx("div",{className:"col-12",children:i.jsx(de,{eRef:D,label:"Descripción",rows:3})}),a.has("stores","business_hours")&&i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Horarios de atención"}),i.jsx("div",{className:"table-responsive",children:i.jsxs("table",{className:"table table-sm",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Día"}),i.jsx("th",{children:"Apertura"}),i.jsx("th",{children:"Cierre"}),i.jsx("th",{children:"Cerrado"})]})}),i.jsx("tbody",{children:M.map((e,r)=>i.jsxs("tr",{children:[i.jsx("td",{className:"align-middle",children:i.jsx("strong",{children:e.day})}),i.jsx("td",{children:i.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:o=>I(r,"open",o.target.value),disabled:e.closed})}),i.jsx("td",{children:i.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:o=>I(r,"close",o.target.value),disabled:e.closed})}),i.jsx("td",{children:i.jsxs("div",{className:"form-check",children:[i.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:o=>I(r,"closed",o.target.checked)}),i.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},r))})]})})]})})]})]})]})};se((N,g)=>{ee.createRoot(N).render(i.jsx(te,{...g,title:"Tiendas / Sucursales",children:i.jsx(fe,{...g})}))});

var K=Object.defineProperty;var Q=(i,c,l)=>c in i?K(i,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[c]=l;var M=(i,c,l)=>Q(i,typeof c!="symbol"?c+"":c,l);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as h}from"./index-BH53Isel.js";import{c as U}from"./ReactAppend-DTVVXReZ.js";import{B as X}from"./Base-BPm4Iu1I.js";import{C as Z}from"./CreateReactScript-Cjkvtz8d.js";import{T as L}from"./Table-DitbKwtZ.js";import{D as q}from"./DxButton-DV0H-ZcL.js";import{R as V}from"./ReactAppend-D7S498fx.js";import{S as Y}from"./ProductCard-C2H10lUi.js";import{B as tt}from"./BasicRest-B7R7ttyn.js";import{G as z}from"./Global-ErywZRdd.js";import{N as o}from"./Number2Currency-e57Tgsuk.js";import{M as et}from"./Modal-DYPPCNUR.js";import{i as rt}from"./tippy-react.esm-BWiGTO87.js";import{S as nt}from"./SaleStatusesRest-9Ba7jbtw.js";import{S as ct}from"./SelectFormGroup-BmhC2uob.js";import{s as it}from"./server.browser-Bf4gQIc7.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-jUU_tfUq.js";import"./main-BSEyQEJW.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-CBYtjt96.js";import"./index.esm-BLChrSU_.js";import"./index-t--hEgTQ.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";class st extends tt{constructor(){super(...arguments);M(this,"path","admin/sales")}}const p=new st;new nt;const lt=({statuses:i=[]})=>{var _,w,S,k,C,T,R,E,D,F,B,A,P,G,O,I;const c=h.useRef(),l=h.useRef(),d=h.useRef(),[t,b]=h.useState(null),[u,f]=h.useState([]),[y,N]=h.useState(!1),W=async(r,n)=>{console.log({sale:n,saleLoaded:t});const s=i.find(a=>a.id==r.target.value);if(s.reversible==0){const{isConfirmed:a}=await Y.fire({title:"Cambiar estado",text:`¬øEstas seguro de cambiar el estado a ${s.name}?
Esta acci√≥n no se puede revertir`,icon:"warning",showCancelButton:!0});if(!a)return}N(!0);const m=await p.save({id:n.id,status_id:s.id,notify_client:l.current.checked});if(N(!1),!m)return;const x=await p.get(n.id);b(x.data),f(x.data.tracking.sort((a,j)=>new Date(j.created_at)-new Date(a.created_at))),$(c.current).dxDataGrid("instance").refresh()},H=async r=>{const{isConfirmed:n}=await Y.fire({title:"Anular pedido",text:"¬øEstas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!n||!await p.delete(r)||$(c.current).dxDataGrid("instance").refresh()},g=async r=>{l.current.checked=!0;const n=await p.get(r);console.log("Sale data loaded:",n.data),b(n.data),f(n.data.tracking.sort((s,m)=>new Date(m.created_at)-new Date(s.created_at))),$(d.current).modal("show")};h.useEffect(()=>{},[t]);const v=r=>{const n=$(r.element).data("status");if(r.id)return $(it.renderToString(e.jsxs("span",{title:n.description,children:[e.jsx("i",{className:`${(n==null?void 0:n.icon)||"mdi mdi-circle"} me-1`}),r.text]})))},J=Number(t==null?void 0:t.amount)+Number((t==null?void 0:t.delivery)||0)-Number((t==null?void 0:t.bundle_discount)||0)-Number((t==null?void 0:t.renewal_discount)||0)-Number((t==null?void 0:t.coupon_discount)||0);return e.jsxs(e.Fragment,{children:[e.jsx(L,{gridRef:c,title:"Pedidos",rest:p,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(r,{data:n})=>{r.css("cursor","pointer"),r.on("click",()=>{g(n.id)}),V(r,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block",children:[n.name," ",n.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",z.APP_CORRELATIVE,"-",n.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(r,{data:n})=>{r.text(moment(n.created_at).subtract(5,"hours").format("LLL"))}},{dataField:"status.name",caption:"Estado",cellTemplate:(r,{data:n})=>{V(r,e.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e",color:n.status.color??"#333"},children:n.status.name}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(r,{data:n})=>{const s=Number(n.amount)||0,m=Number(n.delivery)||0,x=Number(n.bundle_discount)||0,a=Number(n.renewal_discount)||0,j=Number(n.coupon_discount)||0;r.text(`S/. ${o(s+m-x-a-j)}`)}},{caption:"Acciones",cellTemplate:(r,{data:n})=>{r.append(q({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>g(n.id)})),r.append(q({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>H(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(et,{modalRef:d,title:`Detalles del pedido #${z.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsx("div",{className:"card-body p-2",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[(t==null?void 0:t.payment_method)&&e.jsxs("tr",{children:[e.jsx("th",{children:"M√©todo de pago:"}),e.jsx("td",{children:t==null?void 0:t.payment_method})]}),(t==null?void 0:t.culqi_charge_id)&&e.jsxs("tr",{children:[e.jsx("th",{children:"ID de transacci√≥n:"}),e.jsx("td",{children:t==null?void 0:t.culqi_charge_id})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsx("td",{children:t==null?void 0:t.fullname})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Tel√©fono:"}),e.jsx("td",{children:t==null?void 0:t.phone})]}),((t==null?void 0:t.document_type)||(t==null?void 0:t.documentType))&&e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo de documento:"}),e.jsx("td",{children:(t==null?void 0:t.document_type)||(t==null?void 0:t.documentType)})]}),(t==null?void 0:t.document)&&e.jsxs("tr",{children:[e.jsx("th",{children:"N√∫mero de documento:"}),e.jsx("td",{children:t==null?void 0:t.document})]}),(t==null?void 0:t.delivery_type)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo de entrega:"}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:(t==null?void 0:t.delivery_type)==="store_pickup"?"Retiro en Tienda":(t==null?void 0:t.delivery_type)==="free"?"Env√≠o Gratis":(t==null?void 0:t.delivery_type)==="express"?"Env√≠o Express":(t==null?void 0:t.delivery_type)==="standard"?"Env√≠o Est√°ndar":(t==null?void 0:t.delivery_type)==="agency"?"Entrega en Agencia":t==null?void 0:t.delivery_type})})]}),(t==null?void 0:t.delivery_type)==="store_pickup"&&(t==null?void 0:t.store)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Tienda para retiro:"}),e.jsxs("td",{children:[e.jsx("strong",{children:(_=t==null?void 0:t.store)==null?void 0:_.name}),e.jsxs("small",{className:"text-muted d-block",children:[(w=t==null?void 0:t.store)==null?void 0:w.address,((S=t==null?void 0:t.store)==null?void 0:S.district)&&e.jsxs(e.Fragment,{children:[", ",(k=t==null?void 0:t.store)==null?void 0:k.district]}),((C=t==null?void 0:t.store)==null?void 0:C.province)&&e.jsxs(e.Fragment,{children:[", ",(T=t==null?void 0:t.store)==null?void 0:T.province]})]}),((R=t==null?void 0:t.store)==null?void 0:R.phone)&&e.jsxs("small",{className:"text-info d-block",children:["üìû ",(E=t==null?void 0:t.store)==null?void 0:E.phone]}),((D=t==null?void 0:t.store)==null?void 0:D.schedule)&&e.jsxs("small",{className:"text-success d-block",children:["üïí ",(F=t==null?void 0:t.store)==null?void 0:F.schedule]})]})]}),(t==null?void 0:t.delivery_type)&&(t==null?void 0:t.delivery_type)!=="store_pickup"&&e.jsxs("tr",{children:[e.jsx("th",{children:"Direcci√≥n de entrega:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[t==null?void 0:t.district,","," ",t==null?void 0:t.province,","," ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["-"," ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.coupon_code)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Cup√≥n aplicado:"}),e.jsxs("td",{children:[e.jsx("span",{className:"badge bg-success",children:t==null?void 0:t.coupon_code}),e.jsxs("small",{className:"text-success d-block",children:["Descuento: S/ ",o((t==null?void 0:t.coupon_discount)||0)]})]})]}),(t==null?void 0:t.invoiceType)&&e.jsxs("tr",{children:[e.jsxs("th",{children:[t==null?void 0:t.invoiceType,":"]}),e.jsxs("td",{children:[t==null?void 0:t.documentType," - ",t==null?void 0:t.document," ",e.jsx("br",{})," ",(t==null?void 0:t.document)&&(t==null?void 0:t.businessName)]})]}),(t==null?void 0:t.payment_proof)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante de pago:"}),e.jsx("td",{children:e.jsx(rt,{content:"Ver comprobante de pago",placement:"top",children:e.jsx("a",{href:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,target:"_blank",children:e.jsx("img",{src:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"150px",cursor:"pointer"}})})})})]})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Art√≠culos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-20",children:"Imagen"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(B=t==null?void 0:t.details)==null?void 0:B.map((r,n)=>{const s=r.quantity*100/100,m=r.price*r.quantity;return e.jsxs("tr",{children:[e.jsx("td",{className:"max-w-20 p-0",children:r.image?e.jsx("img",{className:"object-scale-down mx-auto block",src:`/storage/images/item/${r.image}`,alt:r.name,style:{height:"5rem",width:"5rem",objectFit:"scale-down"}}):null}),e.jsxs("td",{children:[r.name,r.colors?" - "+r.colors:""]}),e.jsx("td",{align:"right",children:e.jsxs("span",{className:"text-nowrap",children:["S/"," ",o(r.price)]})}),e.jsx("td",{align:"center",children:s}),e.jsx("td",{align:"right",children:e.jsxs("span",{className:"text-nowrap",children:["S/"," ",o(m)]})})]},n)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/"," ",o((t==null?void 0:t.amount)*1)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Env√≠o:"}),e.jsxs("span",{children:["S/"," ",o(t==null?void 0:t.delivery)]})]}),(t==null?void 0:t.coupon_discount)>0&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Descuento por cupon:"}),e.jsxs("span",{children:["- S/"," ",o(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",o(J)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsxs("div",{className:"card-body p-2 position-relative",id:"statusSelectContainer",children:[y&&e.jsx("div",{className:"position-absolute d-flex align-items-center justify-content-center",style:{top:0,left:0,right:0,bottom:0,zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.125)",backdropFilter:"blur(2px)",cursor:"not-allowed"},children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),e.jsx("div",{children:e.jsx(ct,{label:"Estado actual",dropdownParent:"#statusSelectContainer",minimumResultsForSearch:-1,templateResult:v,templateSelection:v,onChange:r=>W(r,t),value:t==null?void 0:t.status_id,changeWith:[t],disabled:y||((A=t==null?void 0:t.status)==null?void 0:A.reversible)==0,children:i.map((r,n)=>e.jsx("option",{value:r.id,"data-status":JSON.stringify(r),children:r.name},n))})}),e.jsxs("div",{className:"form-check",style:{cursor:((P=t==null?void 0:t.status)==null?void 0:P.reversible)==0?"not-allowed":"pointer"},children:[e.jsx("input",{ref:l,className:"form-check-input",type:"checkbox",id:"notifyClient",defaultChecked:!0,disabled:((G=t==null?void 0:t.status)==null?void 0:G.reversible)==0,style:{cursor:((O=t==null?void 0:t.status)==null?void 0:O.reversible)==0?"not-allowed":"pointer"}}),e.jsx("label",{className:"form-check-label",htmlFor:"notifyClient",style:{cursor:((I=t==null?void 0:t.status)==null?void 0:I.reversible)==0?"not-allowed":"pointer"},children:"Notificar al cliente"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",children:u==null?void 0:u.map((r,n)=>e.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.color?`${r.color}2e`:"#3333332e"},children:[e.jsx("i",{className:`${r.icon||"mdi mdi-circle"} left-2`,style:{color:r.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:r.color||"#333"},children:r==null?void 0:r.name}),e.jsxs("small",{className:"d-block text-truncate",children:[r==null?void 0:r.user_name," ",r==null?void 0:r.user_lastname]}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},n))})]})]})]})})]})};Z((i,c)=>{U.createRoot(i).render(e.jsx(X,{...c,title:"Pedidos",children:e.jsx(lt,{...c})}))});

var ve=Object.defineProperty;var Se=(t,o,r)=>o in t?ve(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r;var ne=(t,o,r)=>Se(t,typeof o!="symbol"?o+"":o,r);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BOnQTV8N.js";import{L as we}from"./loader-circle-CSFYLd5m.js";import{S as Q}from"./sparkles-DvmvZ6mJ.js";import{a as Ne}from"./index-ngrFHoWO.js";import{C as se,N as je}from"./Number2Currency-jIsa99f9.js";import{X as Ee}from"./x-fof_H3Vv.js";import{c as Ae}from"./createLucideIcon-DfjclApS.js";import{a as _e,b as q,h as Pe,c as Z,d as De,u as Ie,S as Re,_ as ke}from"./useStateManager-7e1e8489.esm-ByDthEnc.js";import"./index-pSueRYGM.js";import{m as _}from"./main-B6F2O9-U.js";import{t as j}from"./CardProductKatya-ncpmQ0JU.js";import{G as l}from"./Global-Bz6gVLc5.js";import{G as oe}from"./General-apRuNwp7.js";import{S as Oe}from"./StoresRest-Bb6TODpG.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=Ae("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),lr=({children:t,className:o="",loading:r=!1,disabled:a=!1,...i})=>e.jsxs("button",{type:"button",disabled:a||r,className:`w-full bg-primary font-bold  py-3 px-4 hover:opacity-90 hover:shadow-md transition-all duration-300 focus:outline-none active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl flex items-center justify-center gap-2 ${o}`,...i,children:[r&&e.jsx(we,{className:"w-4 h-4 animate-spin"}),t]}),cr=({children:t,className:o="",...r})=>e.jsx("a",{className:`w-full block border-primary cursor-pointer border-2 text-center font-bold customtext-primary py-3 px-4  hover:opacity-90 hover:shadow-md transition-all duration-300 focus:outline-none active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl ${o}`,...r,children:t});function dr({onClick:t,className:o=""}){return e.jsxs("div",{className:`relative ${o}`,children:[e.jsx(Q,{size:12,className:"absolute -top-1 -left-1 text-yellow-400 animate-ping",style:{animationDelay:"0s"}}),e.jsx(Q,{size:10,className:"absolute -top-2 -right-1 text-pink-400 animate-ping",style:{animationDelay:"0.5s"}}),e.jsx(Q,{size:8,className:"absolute -bottom-1 -left-2 text-blue-400 animate-ping",style:{animationDelay:"1s"}}),e.jsx(Q,{size:14,className:"absolute -bottom-2 -right-2 text-purple-400 animate-ping",style:{animationDelay:"1.5s"}}),e.jsxs("button",{onClick:t,className:"relative group bg-primary p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 animate-bounce cursor-pointer",style:{animationDuration:"2s",animationIterationCount:"infinite"},children:[e.jsx("div",{className:"absolute inset-0 bg-primary rounded-xl opacity-0 group-hover:opacity-50 transition-opacity duration-300 blur-lg"}),e.jsx(ee,{size:24,className:"text-white relative z-10 drop-shadow-sm"}),e.jsx("div",{className:"absolute inset-0 bg-primary rounded-xl animate-pulse opacity-30"})]}),e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20",children:"¬°Promoci√≥n disponible!"})]})}const qe="/api";class ur{static async applyToCart(o,r,a=null){var i;try{if(console.log("üõí Applying discount rules to cart:",{cartItems:o,totalAmount:r,customerEmail:a}),!Array.isArray(o)||o.length===0)return{success:!1,error:"Carrito vac√≠o o inv√°lido",data:null};const n={cart_items:o.map(c=>{const f={item_id:String(c.item_id||c.id||""),quantity:parseInt(c.quantity)||1,price:parseFloat(c.price||c.final_price||0),name:String(c.name||c.description||"Producto sin nombre"),category_id:c.category_id?String(c.category_id):null,type:c.type||"item",combo_id:c.type==="combo"?c.id:null};return console.log("üì¶ Processing cart item:",f),f}),total_amount:parseFloat(r)||0,customer_email:a||null};console.log("üì§ Sending payload to API:",n);const h=await Ne.post(`${qe}/discount-rules/apply-to-cart`,n);return h.data.status===200?{success:!0,data:h.data.data,message:h.data.message}:{success:!1,error:h.data.message||"Error al aplicar descuentos",data:null}}catch(n){return console.error("Error applying discount rules:",n),(i=n.response)!=null&&i.data?{success:!1,error:n.response.data.message||"Error del servidor",data:n.response.data.data||null}:{success:!1,error:"Error de conexi√≥n",data:null}}}static formatDiscounts(o){return!o||!Array.isArray(o)?[]:o.map(r=>({id:r.rule_id,name:r.rule_name||"Descuento autom√°tico",description:r.description||"",amount:parseFloat(r.discount_amount||0),type:r.discount_type||"fixed",promotion_type:r.promotion_type||null,free_items:r.free_items||[],formatted_amount:r.discount_type==="percentage"?`${r.discount_amount}%`:`${se()} ${parseFloat(r.discount_amount||0).toFixed(2)}`}))}static getFreeItems(o){if(!o||!Array.isArray(o))return[];const r=[];return o.forEach(a=>{a.free_items&&Array.isArray(a.free_items)&&r.push(...a.free_items)}),r}static calculateTotalDiscount(o){return!o||!Array.isArray(o)?0:o.reduce((r,a)=>r+parseFloat(a.discount_amount||0),0)}}function pr({isOpen:t,onClose:o,suggestion:r,onAddToCart:a,productName:i}){const[n,h]=m.useState(!1);if(!t||!r)return null;const c=async()=>{h(!0);try{await a(r),o()}catch(f){console.error("Error adding promotional item:",f)}finally{h(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity duration-300",onClick:o}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto transform transition-all duration-300 scale-100",children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100",children:e.jsx(Ee,{size:20})}),e.jsxs("div",{className:"text-center pt-8 pb-6 px-6",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"animate-bounce",children:e.jsx(ee,{size:48,className:"customtext-primary mx-auto"})}),e.jsx(Q,{size:20,className:"absolute -top-2 -right-2 text-yellow-400 animate-pulse"}),e.jsx(Q,{size:16,className:"absolute -bottom-1 -left-2 text-yellow-400 animate-pulse delay-300"})]}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-2",children:"üéâ ¬°Promoci√≥n Especial!"}),e.jsx("p",{className:"text-gray-600",children:"Tienes un producto que califica para una promoci√≥n"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Al tener  ",e.jsxs("span",{className:"font-semibold customtext-primary",children:[r.current_quantity," ",i]})," en tu carrito"]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("p",{className:"font-bold text-lg customtext-primary mb-1",children:r.rule_name}),e.jsx("p",{className:"text-sm customtext-neutral-light",children:r.description||"Obt√©n un producto gratis"})]})]})}),e.jsx("div",{className:"border-2 border-dashed rounded-xl p-4 mb-6 bg-green-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 w-9/12",children:[e.jsx("div",{className:"w-12 h-12  rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"customtext-primary",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold customtext-neutral-dark",children:r.item_name}),e.jsxs("p",{className:"text-sm customtext-primary",children:["Cantidad: ",r.suggested_quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold customtext-primary",children:"¬°GRATIS!"}),e.jsxs("p",{className:"text-xs text-gray-500 line-through",children:[se()," ",Number(r.value||0).toFixed(2)]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:c,disabled:n,className:"w-full bg-primary text-white font-semibold py-3 px-6 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:transform-none shadow-lg",children:n?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Agregando..."})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(ee,{size:20}),e.jsx("span",{children:"¬°Agregar Regalo!"})]})}),e.jsx("button",{onClick:o,className:"w-full bg-gray-100 customtext-neutral-light font-medium py-3 px-6 rounded-xl hover:bg-gray-200 transition-colors duration-200",children:"Tal vez despu√©s"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"* Promoci√≥n v√°lida mientras tengas los productos requeridos en tu carrito"})]})]})})]})}var Le=["defaultOptions","cacheOptions","loadOptions","options","isLoading","onInputChange","filterOption"];function Me(t){var o=t.defaultOptions,r=o===void 0?!1:o,a=t.cacheOptions,i=a===void 0?!1:a,n=t.loadOptions;t.options;var h=t.isLoading,c=h===void 0?!1:h,f=t.onInputChange,B=t.filterOption,P=B===void 0?null:B,N=_e(t,Le),z=N.inputValue,D=m.useRef(void 0),s=m.useRef(!1),d=m.useState(Array.isArray(r)?r:void 0),x=q(d,2),y=x[0],M=x[1],C=m.useState(typeof z<"u"?z:""),S=q(C,2),U=S[0],I=S[1],F=m.useState(r===!0),G=q(F,2),V=G[0],A=G[1],J=m.useState(void 0),K=q(J,2),L=K[0],T=K[1],p=m.useState([]),E=q(p,2),R=E[0],g=E[1],k=m.useState(!1),b=q(k,2),v=b[0],O=b[1],X=m.useState({}),ie=q(X,2),H=ie[0],le=ie[1],pe=m.useState(void 0),ce=q(pe,2),me=ce[0],ge=ce[1],he=m.useState(void 0),de=q(he,2),fe=de[0],xe=de[1];i!==fe&&(le({}),xe(i)),r!==me&&(M(Array.isArray(r)?r:void 0),ge(r)),m.useEffect(function(){return s.current=!0,function(){s.current=!1}},[]);var te=m.useCallback(function(W,Y){if(!n)return Y();var w=n(W,Y);w&&typeof w.then=="function"&&w.then(Y,function(){return Y()})},[n]);m.useEffect(function(){r===!0&&te(U,function(W){s.current&&(M(W||[]),A(!!D.current))})},[]);var ye=m.useCallback(function(W,Y){var w=Pe(W,Y,f);if(!w){D.current=void 0,I(""),T(""),g([]),A(!1),O(!1);return}if(i&&H[w])I(w),T(w),g(H[w]),A(!1),O(!1);else{var Ce=D.current={};I(w),A(!0),O(!L),te(w,function(ae){s&&Ce===D.current&&(D.current=void 0,A(!1),T(w),g(ae||[]),O(!1),le(ae?Z(Z({},H),{},De({},w,ae)):H))})}},[i,te,L,H,f]),be=v?[]:U&&L?R:y||[];return Z(Z({},N),{},{options:be,isLoading:V||c,onInputChange:ye,filterOption:P})}var Ue=m.forwardRef(function(t,o){var r=Me(t),a=Ie(r);return m.createElement(Re,ke({ref:o},a))}),mr=Ue;class ue{}ne(ue,"getShippingCost",async o=>{try{const{status:r,result:a}=await _.Fetch("./api/delivery-prices",{method:"POST",body:JSON.stringify(o)});if(!r)throw new Error((a==null?void 0:a.message)||"Error al obtener datos");return a}catch{return!1}}),ne(ue,"getCosts",async o=>{try{const{status:r,result:a}=await _.Fetch("./api/prices-type",{method:"POST"});if(!r)throw new Error((a==null?void 0:a.message)||"Error al obtener datos");return a}catch{return!1}});class gr{static async validateCoupon(o){try{const{status:r,result:a}=await _.Fetch("./api/coupons/validate",{method:"POST",body:JSON.stringify(o)});if(!r)throw new Error((a==null?void 0:a.message)||"Error al validar cup√≥n");return a}catch(r){throw r}}static async generateCode(){try{const{status:o,result:r}=await _.Fetch("./api/coupons/generate-code",{method:"GET"});if(!o)throw new Error((r==null?void 0:r.message)||"Error al generar c√≥digo");return r}catch(o){throw o}}}const $={initialized:!1,deviceFingerPrint:null,isAvailable(){return typeof window.Culqi3DS<"u"},async init(t){if(!this.isAvailable())return console.warn("‚ö†Ô∏è Culqi3DS no est√° cargado"),!1;try{return window.Culqi3DS.publicKey=l.CULQI_PUBLIC_KEY,window.Culqi3DS.settings={charge:{totalAmount:t.amount,returnUrl:window.location.href,currency:t.currency||"PEN"},card:{email:t.email}},window.Culqi3DS.options={showModal:!0,showLoading:!0,showIcon:!0,closeModalAction:()=>{console.log("üîê Modal 3DS cerrado")},style:{btnColor:l.APP_COLOR_PRIMARY||"#000000",btnTextColor:"#FFFFFF"}},this.initialized=!0,console.log("‚úÖ Culqi3DS inicializado correctamente"),!0}catch(o){return console.error("‚ùå Error al inicializar Culqi3DS:",o),!1}},async generateDeviceFingerPrint(){if(!this.isAvailable())return console.warn("‚ö†Ô∏è Culqi3DS no disponible para generar device fingerprint"),null;try{return this.deviceFingerPrint=await window.Culqi3DS.generateDevice(),console.log("üîê Device Fingerprint generado:",this.deviceFingerPrint),this.deviceFingerPrint}catch(t){return console.error("‚ùå Error al generar device fingerprint:",t),null}},initAuthentication(t){return new Promise((o,r)=>{if(!this.isAvailable()){r(new Error("Culqi3DS no est√° disponible"));return}console.log("üîê Iniciando autenticaci√≥n 3DS para token:",t);const a=i=>{const n=i.data;!n||typeof n!="object"||(n.loading!==void 0&&console.log("üîê 3DS Loading:",n.loading),n.parameters3DS&&(console.log("‚úÖ Autenticaci√≥n 3DS exitosa:",n.parameters3DS),window.removeEventListener("message",a),o({success:!0,parameters3DS:n.parameters3DS})),n.error&&(console.error("‚ùå Error en autenticaci√≥n 3DS:",n.error),window.removeEventListener("message",a),r(new Error(n.error))))};window.addEventListener("message",a,!1);try{window.Culqi3DS.initAuthentication(t)}catch(i){window.removeEventListener("message",a),r(i)}})},reset(){this.isAvailable()&&typeof window.Culqi3DS.reset=="function"&&(window.Culqi3DS.reset(),this.deviceFingerPrint=null,this.initialized=!1,console.log("üîÑ Culqi3DS reseteado"))}},Fe={async createOrder(t,o){try{console.log("üîÑ Creando orden en Culqi API...");const{status:r,result:a}=await _.Fetch("/api/culqi/order",{method:"POST",body:JSON.stringify({sale:t,details:o})});if(!r)throw console.error("‚ùå Error al crear orden en Culqi:",a),new Error((a==null?void 0:a.message)||"Error al crear orden en Culqi");return console.log("‚úÖ Orden creada en Culqi:",a),a}catch(r){throw console.error("‚ùå Exception al crear orden:",r),r}},async createCheckoutOrder(t){try{console.log("üîÑ Creando orden de checkout en Culqi...",t);const{status:o,result:r}=await _.Fetch("/api/culqi/checkout-order",{method:"POST",body:JSON.stringify(t)});if(!o)throw console.error("‚ùå Error al crear orden de checkout:",r),new Error((r==null?void 0:r.message)||"Error al crear orden de checkout en Culqi");return console.log("‚úÖ Orden de checkout creada:",r),r}catch(o){throw console.error("‚ùå Exception al crear orden de checkout:",o),o}}};function Te(){let t="";for(let o=0;o<12;o++){const r=Math.floor(Math.random()*10);t+=r}return t}function re(){return l.CULQI_SUPPORTS_USD===!0}function $e(){const t=oe.get("currency")||"pen";return re()&&t.toLowerCase()==="usd"?"USD":(t.toLowerCase()==="pen","PEN")}function Be(){return $e()==="USD"?"$":"S/"}function ze(){const t=l.EXCHANGE_RATE||oe.get("exchange_rate_usd_pen")||3.75;return parseFloat(t)}function Ke(t){const o=oe.get("currency")||"pen";if(o.toLowerCase()==="pen")return{amount:t,currency:"PEN",wasConverted:!1,exchangeRate:1,originalAmount:t,originalCurrency:"PEN"};if(o.toLowerCase()==="usd"&&re())return console.log("üíµ Culqi soporta USD - procesando pago directamente en d√≥lares"),{amount:t,currency:"USD",wasConverted:!1,exchangeRate:1,originalAmount:t,originalCurrency:"USD"};if(o.toLowerCase()==="usd"&&!re()){const r=ze(),a=t*r;return console.log("üí± Conversi√≥n de moneda (Culqi no soporta USD):"),console.log(`   - Monto original: USD ${t.toFixed(2)}`),console.log(`   - Tipo de cambio: 1 USD = ${r} PEN`),console.log(`   - Monto convertido: PEN ${a.toFixed(2)}`),{amount:a,currency:"PEN",wasConverted:!0,exchangeRate:r,originalAmount:t,originalCurrency:"USD"}}return{amount:t,currency:o.toUpperCase(),wasConverted:!1,exchangeRate:1,originalAmount:t,originalCurrency:o.toUpperCase()}}let u=null;function Ye(){const t=l.CULQI_RSA_ID,o=l.CULQI_RSA_PUBLIC_KEY;if(console.log("üîê Verificando configuraci√≥n RSA..."),console.log("   - RSA ID presente:",!!t),console.log("   - RSA Public Key presente:",!!o),!t||!o)return console.warn("‚ö†Ô∏è RSA no configurado - Usando encriptaci√≥n est√°ndar de Culqi"),{valid:!0,hasRSA:!1,warning:"RSA no configurado - Usando encriptaci√≥n est√°ndar de Culqi (segura)"};if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t))return console.warn("‚ö†Ô∏è RSA ID no tiene formato UUID v√°lido:",t),console.warn("‚ö†Ô∏è Deshabilitando RSA - Usando encriptaci√≥n est√°ndar"),{valid:!0,hasRSA:!1,warning:"RSA ID inv√°lido - Usando encriptaci√≥n est√°ndar de Culqi"};const a=o.includes("-----BEGIN PUBLIC KEY-----"),i=o.includes("-----END PUBLIC KEY-----");return!a||!i?(console.warn("‚ö†Ô∏è RSA Public Key no tiene formato PEM v√°lido"),console.warn("‚ö†Ô∏è Deshabilitando RSA - Usando encriptaci√≥n est√°ndar"),{valid:!0,hasRSA:!1,warning:"RSA Public Key formato inv√°lido - Usando encriptaci√≥n est√°ndar de Culqi"}):(console.log("   - RSA Key length:",o.length,"caracteres"),o.includes("MIGf")?console.log("   - Tipo de clave: RSA 1024-bit (formato MIGf)"):o.includes("MIIBIj")?console.log("   - Tipo de clave: RSA 2048-bit (formato MIIBIj)"):console.log("   - Tipo de clave: Formato RSA est√°ndar"),console.log("‚úÖ RSA configurado correctamente"),console.log("   - RSA ID:",t),console.log("   - RSA Key length:",o.length),{valid:!0,hasRSA:!0,info:"RSA configurado correctamente para encriptaci√≥n adicional"})}const hr=async(t,o={})=>{if(!o.orderId&&!o.skipOrderCreation)try{console.log("üîÑ Intentando crear orden de Culqi para habilitar todos los m√©todos de pago...");const r=await Fe.createCheckoutOrder({amount:t.amount,email:t.email,name:t.name,lastname:t.lastname,phone:t.phone});console.log("üì¶ Respuesta de createCheckoutOrder:",r);const a=(r==null?void 0:r.data)||r,i=a==null?void 0:a.order_id;i?(console.log("‚úÖ Orden de checkout creada con ID:",i),o.orderId=i,o.orderData=a):(console.warn("‚ö†Ô∏è No se pudo obtener order_id de la respuesta:",r),console.warn("‚ö†Ô∏è Continuando solo con tarjeta"))}catch(r){console.warn("‚ö†Ô∏è Error al crear orden de checkout, continuando solo con tarjeta:",r.message)}return new Promise((r,a)=>{var i,n,h,c;try{console.log("üîÑ Iniciando proceso de pago con Culqi Custom Checkout...",t),console.log("üìã Opciones recibidas:",o);const{orderId:f,orderData:B}=o,P=!!f;if(P?(console.log("‚úÖ Flujo con Order ID - M√©todos adicionales habilitados (Yape, etc.)"),console.log("   - Order ID:",f)):console.log("‚ÑπÔ∏è Flujo sin Order - Solo pago con tarjeta disponible"),!l.CULQI_ENABLED){console.error("‚ùå Error: Culqi no est√° habilitado en la configuraci√≥n"),a("M√©todo de pago no disponible: Culqi est√° deshabilitado");return}if(typeof window.CulqiCheckout>"u"){console.error("‚ùå Error: CulqiCheckout no est√° definido. Verifique que el script de Culqi est√© cargado."),console.error("   Script esperado: https://js.culqi.com/checkout-js"),a("Error en la integraci√≥n con Culqi: Script no cargado");return}if(!l.CULQI_PUBLIC_KEY){console.error("‚ùå Error: CULQI_PUBLIC_KEY no est√° configurado"),a("Error de configuraci√≥n: Clave p√∫blica de Culqi no encontrada");return}const N=Ye();N.warning&&console.warn("‚ö†Ô∏è RSA:",N.warning),N.hasRSA?console.log("üîê RSA validado correctamente - Encriptaci√≥n adicional activada"):console.log("üîì RSA no disponible - Usando encriptaci√≥n est√°ndar de Culqi (segura)"),console.log("üîß Configuraci√≥n de Culqi:"),console.log("   - Public Key:",l.CULQI_PUBLIC_KEY),console.log("   - Public Key comienza con pk_:",(i=l.CULQI_PUBLIC_KEY)==null?void 0:i.startsWith("pk_")),console.log("   - RSA disponible:",N.hasRSA),N.hasRSA&&(console.log("   - RSA ID:",l.CULQI_RSA_ID),console.log("   - RSA ID length:",(n=l.CULQI_RSA_ID)==null?void 0:n.length));const z=(h=l.CULQI_PUBLIC_KEY)==null?void 0:h.startsWith("pk_test_"),D=(c=l.CULQI_PUBLIC_KEY)==null?void 0:c.startsWith("pk_live_");console.log("   - Modo de Culqi:",z?"PRUEBAS (test)":D?"PRODUCCI√ìN (live)":"DESCONOCIDO");const s=oe.get("currency")||"pen";console.log("üí± Moneda del sistema:",s.toUpperCase()),console.log("üíµ Culqi soporta USD:",re());const d=Ke(t.amount);d.wasConverted?(console.log("üí± Se realizar√° conversi√≥n autom√°tica de moneda:"),console.log(`   - Monto original: ${d.originalCurrency} ${d.originalAmount.toFixed(2)}`),console.log(`   - Tipo de cambio: 1 ${d.originalCurrency} = ${d.exchangeRate} PEN`),console.log(`   - Monto a cobrar: PEN ${d.amount.toFixed(2)}`),j.info("Conversi√≥n de moneda",{description:`Tu pago de $${d.originalAmount.toFixed(2)} USD ser√° procesado como S/${d.amount.toFixed(2)} PEN (TC: ${d.exchangeRate})`,duration:5e3})):d.currency==="USD"&&console.log("üíµ Pago directo en USD - Sin conversi√≥n");const x=Te();console.log("üìù N√∫mero de orden generado:",x);const y=d.currency,M=Be(),C=parseFloat(d.amount.toFixed(2)),S=Math.round(C*100),U=y==="USD"?100:300,I=y==="USD"?"$1.00":"S/ 3.00";if(S<U){console.error(`‚ùå Error: El monto m√≠nimo para Culqi es ${I}`),a(`El monto m√≠nimo para pago con tarjeta es ${I}`);return}console.log("üí∞ Configurando Culqi Custom Checkout:"),console.log("   - Monto original:",t.amount,s.toUpperCase()),console.log("   - Monto a procesar:",C,"PEN"),console.log("   - Moneda Culqi:",y),console.log("   - Monto en c√©ntimos:",S),console.log("   - Email:",t.email),console.log("   - CULQI_NAME:",l.CULQI_NAME),console.log("   - RSA configurado:",!!l.CULQI_RSA_ID);const F={title:l.CULQI_NAME||l.APP_NAME||"Pago",currency:y,amount:S};!!0&&N.hasRSA||console.log("üîì RSA deshabilitado - usando encriptaci√≥n est√°ndar de Culqi");const V={email:t.email||""},A=P?{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!1}:{tarjeta:!0,yape:!1,bancaMovil:!1,agente:!1,billetera:!1,cuotealo:!1};console.log("üí≥ M√©todos de pago habilitados:",A);const J={lang:"auto",installments:!1,modal:!0,paymentMethods:A,paymentMethodsSort:P?["tarjeta","yape","bancaMovil","billetera","agente"]:["tarjeta"]},K={theme:"default",hiddenCulqiLogo:!1,hiddenBannerContent:!1,hiddenBanner:!1,hiddenToolBarAmount:!1,menuType:"sidebar",buttonCardPayText:"Pagar",logo:l.APP_URL+"/assets/resources/icon.png",defaultStyle:{bannerColor:l.APP_COLOR_PRIMARY||"#000000",buttonBackground:l.APP_COLOR_PRIMARY||"#000000",menuColor:l.APP_COLOR_PRIMARY||"#000000",linksColor:l.APP_COLOR_PRIMARY||"#000000",buttonTextColor:"#FFFFFF",priceColor:l.APP_COLOR_PRIMARY||"#000000"}};P&&(F.order=f,console.log("üì¶ Order ID agregado a settings:",f));const L={settings:F,client:V,options:J,appearance:K};console.log("üìã Configuraci√≥n de Culqi Custom Checkout:",L);try{u=new window.CulqiCheckout(l.CULQI_PUBLIC_KEY,L),console.log("‚úÖ Instancia de CulqiCheckout creada exitosamente")}catch(p){console.error("‚ùå Error al crear instancia de CulqiCheckout:",p),a("Error en la integraci√≥n con Culqi: "+p.message);return}let T=!1;u.culqi=async function(){try{if(console.log("üì• Callback de Culqi ejecutado"),console.log("   - culqiInstance.token:",u.token),console.log("   - culqiInstance.charge:",u.charge),console.log("   - culqiInstance.order:",u.order),console.log("   - culqiInstance.error:",u.error),u.error){console.error("‚ùå Error de Culqi:",u.error);const p=u.error.user_message||u.error.merchant_message||"Error al procesar el pago";j.error("Error en el pago",{description:p,duration:5e3,position:"top-right",richColors:!0}),a(p);return}if(u.charge){T=!0;const p=u.charge;console.log("‚úÖ Cargo completado por Culqi (3DS incluido):",p);const E={...t,chargeId:p.id,orderNumber:x,chargeData:p,paymentType:"charge_completed"};console.log("üì§ Enviando cargo completado al backend:",E);const{status:R,result:g}=await _.Fetch("./api/pago/charge-completed",{method:"POST",body:JSON.stringify(E)});try{u.close()}catch(k){console.warn("‚ö†Ô∏è No se pudo cerrar el modal de Culqi:",k)}if(!R){console.error("‚ùå Error en respuesta del servidor:",g),j.error("Error al registrar el pago",{description:(g==null?void 0:g.message)||"Error al registrar el pago",duration:5e3,position:"top-right",richColors:!0}),a((g==null?void 0:g.message)||"Error al registrar el pago");return}j.success("¬°Pago exitoso!",{description:"Tu pago se proces√≥ correctamente con autenticaci√≥n 3DS.",duration:3e3,position:"top-right",richColors:!0}),r(g);return}if(u.token){T=!0;const p=u.token.id,E=u.token;console.log("‚úÖ Token generado:",p),console.log("   - Token completo:",E);let R=null;$.isAvailable()&&(await $.init({amount:S,currency:y,email:t.email}),R=await $.generateDeviceFingerPrint(),console.log("üîê Device Fingerprint para 3DS:",R));const g={...t,token:p,orderNumber:x,tokenData:E,deviceFingerPrint:R};console.log("üì§ Enviando pago al backend:",g);let{status:k,result:b}=await _.Fetch("./api/pago",{method:"POST",body:JSON.stringify(g)});if(!k&&(b!=null&&b.requires_3ds)){console.log("üîê El pago requiere autenticaci√≥n 3DS");try{console.log("üîê Cerrando modal de Culqi para mostrar 3DS..."),u.close()}catch(v){console.warn("‚ö†Ô∏è No se pudo cerrar modal de Culqi:",v)}if(!$.isAvailable()){j.error("Error en autenticaci√≥n",{description:"El servicio de autenticaci√≥n 3DS no est√° disponible. Por favor recarga la p√°gina.",duration:5e3,position:"top-right",richColors:!0}),a("Servicio 3DS no disponible");return}try{j.info("Autenticaci√≥n requerida",{description:"Por favor completa la verificaci√≥n de seguridad de tu banco.",duration:5e3,position:"top-right",richColors:!0}),await new Promise(O=>setTimeout(O,300));const v=await $.initAuthentication(p);if(v.success&&v.parameters3DS){console.log("‚úÖ Autenticaci√≥n 3DS completada:",v.parameters3DS);const O={...g,authentication_3DS:v.parameters3DS};console.log("üì§ Enviando cargo con autenticaci√≥n 3DS:",O);const X=await _.Fetch("./api/pago/3ds",{method:"POST",body:JSON.stringify(O)});k=X.status,b=X.result,$.reset()}}catch(v){console.error("‚ùå Error en autenticaci√≥n 3DS:",v),$.reset(),j.error("Error en autenticaci√≥n",{description:v.message||"No se pudo completar la autenticaci√≥n 3DS",duration:5e3,position:"top-right",richColors:!0}),a(v.message||"Error en autenticaci√≥n 3DS");return}}if(!k){console.error("‚ùå Error en respuesta del servidor:",b),j.error("Error en el pago",{description:(b==null?void 0:b.message)||"Error al procesar el pago",duration:5e3,position:"top-right",richColors:!0}),a((b==null?void 0:b.message)||"Error en el pago");return}try{u.close()}catch(v){console.warn("‚ö†Ô∏è No se pudo cerrar el modal de Culqi:",v)}j.success("¬°Pago exitoso!",{description:"Tu pago se proces√≥ correctamente. Pronto recibir√°s la confirmaci√≥n.",duration:3e3,position:"top-right",richColors:!0}),r(b);return}if(u.order){T=!0,console.log("‚úÖ Orden creada:",u.order);const p=u.order,E={...t,orderId:p.id,orderNumber:x,orderData:p,paymentType:"order"};console.log("üì§ Enviando orden al backend:",E);const{status:R,result:g}=await _.Fetch("./api/pago/order",{method:"POST",body:JSON.stringify(E)});try{u.close()}catch(k){console.warn("‚ö†Ô∏è No se pudo cerrar el modal de Culqi:",k)}if(R)j.success("¬°Orden creada!",{description:"Tu orden ha sido registrada. Completa el pago seg√∫n las instrucciones.",duration:5e3,position:"top-right",richColors:!0}),r(g);else throw new Error((g==null?void 0:g.message)||"Error al procesar la orden");return}console.warn("‚ö†Ô∏è Callback ejecutado sin token, orden ni error"),a("No se recibi√≥ respuesta del procesador de pagos")}catch(p){console.error("‚ùå Error en callback de Culqi:",p),j.error("¬°Error en el Pago!",{description:p.message||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),a(p.message||"Error en el pago")}},console.log("üöÄ Abriendo Culqi Custom Checkout..."),u.open()}catch(f){console.error("‚ùå Error general en processCulqiPayment:",f),j.error("¬°Error en la integraci√≥n con Culqi!",{description:f.message||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),a("Error en la integraci√≥n con Culqi: "+f.message)}})},fr=({title:t,description:o,price:r,selected:a,className:i,onSelect:n,disabled:h,paymentOnDelivery:c=!1})=>e.jsxs("div",{className:`flex w-full items-center justify-between gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all duration-300 customtext-neutral-dark ${a?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"} ${h?"opacity-50 cursor-not-allowed":""} ${i}`,onClick:h?void 0:n,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-5 h-5 border-2 rounded-full flex items-center justify-center flex-shrink-0 ${a?"border-primary":"border-gray-300"}`,children:a&&e.jsx("div",{className:"w-3 h-3 bg-primary rounded-full"})}),e.jsxs("div",{className:"customtext-neutral-light flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"text-sm font-medium",children:t})}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:o})]})]}),e.jsx("div",{className:"flex-shrink-0",children:c?e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Pagas al recoger"})}):r!==void 0?e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-sm font-bold customtext-primary",children:r===0?"GRATIS":`${se()} ${je(r)}`})}):null})]}),xr=({ubigeoCode:t,ubigeo:o,onStoreSelect:r,selectedStore:a=null,specificStores:i=null,className:n=""})=>{const[h,c]=m.useState([]),[f,B]=m.useState(!1),[P,N]=m.useState(null);m.useEffect(()=>{z()},[i]);const z=async()=>{B(!0),N(null);try{const d=await new Oe().paginate({status:!0,visible:!0});let x=(d==null?void 0:d.data)||[];x=x.filter(y=>{const M=y.type==="tienda"||y.type==="tienda_principal",C=y.visible===!0||y.visible===1,S=y.status===!0||y.status===1;return M&&C&&S}),i&&Array.isArray(i)&&i.length>0?x=x.filter(y=>i.includes(y.id)):console.log("üè™ Mostrando TODAS las tiendas disponibles:",x.length),c(x)}catch(s){console.error("‚ùå Error cargando tiendas:",s),N("No se pudieron cargar las tiendas disponibles"),c([])}finally{B(!1)}},D=s=>{r(s)};return f?e.jsxs("div",{className:`text-center p-6 ${n}`,children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary/10 rounded-full mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark mb-2",children:"Cargando tiendas..."}),e.jsx("p",{className:"customtext-neutral-light text-sm",children:"Buscando tiendas disponibles en tu ubicaci√≥n"})]}):P?e.jsxs("div",{className:`bg-red-50 border border-red-200 rounded-xl p-4 md:p-6 ${n}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 text-center mb-2",children:"Error al cargar tiendas"}),e.jsx("p",{className:"text-red-600 text-center text-sm",children:P})]}):h.length===0?e.jsxs("div",{className:`bg-secondary/30 border border-secondary rounded-xl p-4 md:p-6 ${n}`,children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-secondary rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-6 h-6 customtext-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark text-center mb-2",children:"Sin tiendas disponibles"}),e.jsx("p",{className:"customtext-neutral-light text-center text-sm",children:"No hay tiendas disponibles para retiro en esta ubicaci√≥n. Por favor, selecciona otra opci√≥n de env√≠o."})]}):e.jsxs("div",{className:n,children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold customtext-neutral-dark mb-2",children:"Selecciona una tienda para retiro"}),e.jsx("p",{className:"customtext-neutral-light text-sm md:text-base",children:"Elige la tienda m√°s conveniente para retirar tu pedido"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-4",children:h.map(s=>e.jsxs("div",{className:`relative border-2 rounded-xl cursor-pointer transition-all duration-200 hover:shadow-lg ${(a==null?void 0:a.id)===s.id?"border-primary bg-primary/5 shadow-md":"border-gray-200 bg-white hover:border-primary/50 hover:shadow-md"}`,onClick:()=>D(s),children:[e.jsx("div",{className:"absolute top-3 right-3 z-10",children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${(a==null?void 0:a.id)===s.id?"border-primary bg-primary":"border-gray-300 bg-white"}`,children:(a==null?void 0:a.id)===s.id&&e.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-full"})})}),e.jsxs("div",{className:"p-4 pr-10",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:`/storage/images/store/${s.image}`,alt:s.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-200",onError:d=>d.target.src="/api/cover/thumbnail/null"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold customtext-neutral-dark text-base mb-1 truncate",children:s.name}),e.jsx("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium bg-primary/10 customtext-primary",children:s.type==="tienda"?"Tienda":s.type==="tienda_principal"?"Tienda Principal":s.type||"Tienda"})]})]}),e.jsx("p",{className:"text-sm customtext-neutral-light mb-3 line-clamp-2",children:s.address}),e.jsxs("div",{className:"space-y-2 text-sm customtext-neutral-light mb-3",children:[s.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:s.phone})]}),s.manager&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{className:"truncate",children:["Encargado: ",s.manager]})]})]}),s.business_hours&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium customtext-neutral-dark mb-1",children:"Horario de hoy:"}),e.jsx("div",{className:"text-xs",children:(()=>{try{const d=typeof s.business_hours=="string"?JSON.parse(s.business_hours):s.business_hours,x=new Date().toLocaleDateString("es-PE",{weekday:"long"}),M={lunes:"Lunes",martes:"Martes",mi√©rcoles:"Mi√©rcoles",jueves:"Jueves",viernes:"Viernes",s√°bado:"S√°bado",domingo:"Domingo"}[x.toLowerCase()]||x,C=d.find(S=>S.day.toLowerCase()===M.toLowerCase());if(C){const S=C.closed?"Cerrado":`${C.open} - ${C.close}`,U=!C.closed&&(()=>{const I=new Date,F=I.getHours()*60+I.getMinutes(),[G,V]=C.open.split(":").map(Number),[A,J]=C.close.split(":").map(Number),K=G*60+V,L=A*60+J;return F>=K&&F<=L})();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"customtext-neutral-light",children:S}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${U?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:U?"Abierto":"Cerrado"})]})}return e.jsx("span",{className:"customtext-neutral-light",children:"Horarios disponibles"})}catch{return e.jsx("span",{className:"customtext-neutral-light",children:"Horarios disponibles"})}})()})]})]})]},s.id))})]})};export{dr as A,lr as B,gr as C,ur as D,fr as O,pr as P,xr as S,cr as a,ue as b,mr as c,hr as p};

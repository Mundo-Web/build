const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Banner-Cc97GFG_.js","assets/preload-helper-DAHR15QK.js","assets/vendor-react-DD0uBW7s.js","assets/vendor-swiper-BQwfPLwm.js","vendor-swiper.css","vendor-react.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,a)=>((t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a)(t,"symbol"!=typeof n?n+"":n,a);import{_ as n}from"./preload-helper-DAHR15QK.js";import{r as a,c as i,j as r,s as o}from"./vendor-react-DD0uBW7s.js";import{B as s}from"./Base-DQk4WKCZ.js";import{T as l}from"./TextareaFormGroup-4KXpt4Nc.js";import{S as c}from"./CartKuchara-BG_NtHiU.js";import{B as d}from"./BasicRest-BuuGWTMX.js";import{S as m}from"./SystemRest-CvOK_sd1.js";import{I as u}from"./ImageFormGroup-DBShHzxF.js";import{S as p}from"./SwitchFormGroup-Dk6WRclX.js";import{S as f}from"./SelectFormGroup-BpYEBv3v.js";import{M as b}from"./Modal-CfnJHMl_.js";import{T as g}from"./Table-DZEQ91iP.js";import{D as h}from"./DxButton-C6FT_beP.js";import{I as x}from"./InputFormGroup-DY-ZEW8l.js";import{C as v}from"./CreateReactScript-C92mMLGn.js";import{R as j}from"./ReactAppend-D5wf6JB3.js";import{S as y}from"./SortByAfterField-DzAI86wF.js";import{r as B}from"./bannerUtils-FB4i6ekV.js";import"./vendor-swiper-BQwfPLwm.js";import"./Global-BAGAPG-V.js";import"./TippyButton-BXJTBPrK.js";import"./Logout-CJj-4dQc.js";import"./MenuItemContainer--0h9gV_W.js";import"./Menu-Cmvatiox.js";import"./GoogleSignInButton-BciphYP2.js";import"./BooleanLimit-q2Ad9fGY.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";const w=new class extends d{constructor(){super(...arguments),t(this,"path","admin/banners"),t(this,"hasFiles",!0)}},R=new m,S=1600,k=900,_=360,F=a.lazy(()=>n(()=>import("./Banner-Cc97GFG_.js"),__vite__mapDeps([0,1,2,3,4,5]))),C=(e={})=>{const t={name:"",description:"",button_text:"",button_link:"",contenedor:"relativo",type:"BannerSimple",background:"",image:"",items:[]};return{...e,name:e?.name??t.name,description:e?.description??t.description,button_text:e?.button_text??t.button_text,button_link:e?.button_link??t.button_link,contenedor:e?.contenedor??t.contenedor,type:e?.type||t.type,background:e?.background??t.background,image:e?.image??t.image,items:Array.isArray(e?.items)?e.items:t.items}},E=({pages:e,systems:t=[]})=>{const n=a.useRef(),s=a.useRef(),d=a.useRef(),m=a.useRef(),v=a.useRef(),E=a.useRef(),N=a.useRef(),L=a.useRef(),P=a.useRef(),T=a.useRef(),D=a.useRef(),A=a.useRef(),U=a.useRef(),[O,M]=a.useState(!1),[I,W]=a.useState(t),[z,G]=a.useState([]),[H,q]=a.useState(""),[K,V]=a.useState(null),[Q,Y]=a.useState(!1),[J,X]=a.useState(()=>({name:"",description:"",button_text:"",button_link:"",contenedor:"relativo",type:"BannerSimple",background:"",image:"",items:[]})),Z=a.useRef({background:null,image:null}),ee=a.useRef(null),te=a.useRef(null),ne=a.useRef(null),ae=a.useRef(null),ie=a.useRef(null),re=a.useRef(1),[oe,se]=a.useState(1),[le,ce]=a.useState(_),[de,me]=a.useState(!1),ue=J.type||"BannerSimple",pe=a.useCallback(()=>{const e=ee.current,t=ne.current,n=te.current,a=ie.current;if(!(e&&t&&n&&a))return;const i=e.clientWidth||S,r=a.documentElement,o=Math.max(S,n.scrollWidth||0,n.offsetWidth||0,r?.scrollWidth||0,a.body?.scrollWidth||0),s=Math.max(k,n.scrollHeight||0,n.offsetHeight||0,r?.scrollHeight||0,a.body?.scrollHeight||0),l=i/o,c=900/s,d=Math.min(l,c,1),m=s*d,u=Math.max(Math.min(m,900),_);Math.abs(re.current-d)>.001?(re.current=d,se(d)):re.current=d,ce(e=>Math.abs(e-u)<.5?e:u),t.style.height=`${s}px`},[]),fe=a.useCallback(()=>{const e=["/build/app.css"];if("undefined"!=typeof document){const t=document.querySelector("script[src*='@vite/client']");if(t?.src){const n=t.src.replace(/@vite\/client.*$/,"");e.push(`${n}resources/css/app.css`)}}return e},[]),be=a.useCallback(e=>{if(!e)return;const t=e.head||e.getElementsByTagName("head")[0];if(!t)return;if(t.querySelector("link[data-banner-preview='tailwind']"))return;const n=fe(),a=n=>{const[i,...r]=n;if(!i)return;const o=e.createElement("link");o.rel="stylesheet",o.href=i,o.dataset.bannerPreview="tailwind",o.onload=()=>{requestAnimationFrame(()=>pe())},o.onerror=()=>{o.remove(),a(r)},t.appendChild(o)};a(n)},[fe,pe]),ge=a.useCallback(()=>{const e=ne.current;if(!e)return;if(me(!1),ae.current){try{ae.current.unmount()}catch(a){}ae.current=null}const t=e.contentDocument;if(!t)return void setTimeout(()=>ge(),0);t.open(),t.write("<!DOCTYPE html><html><head><base target='_blank' /></head><body></body></html>"),t.close(),t.documentElement.style.fontSize="16px",t.documentElement.style.background="transparent",t.body.style.margin="0",t.body.style.padding="0",t.body.style.background="transparent",be(t);document.querySelectorAll('script[type="module"]').forEach(e=>{if(e.src&&(e.src.includes("@vite/client")||e.src.includes("app.js"))){const n=t.createElement("script");n.type="module",n.src=e.src,t.head.appendChild(n)}});const n=t.createElement("div");n.id="banner-preview-root",n.style.width="1600px",n.style.minHeight="900px",n.style.boxSizing="border-box",n.style.margin="0 auto",t.body.appendChild(n),ie.current=t,te.current=n,ae.current=i.createRoot(n),re.current=1,se(1),ce(_),me(!0)},[be]),he=a.useCallback(()=>{const e=ae.current,t=ie.current;e&&t&&e.render(r.jsx("div",{style:{minHeight:"900px"},children:r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"d-flex align-items-center justify-content-center text-muted small",style:{minHeight:"900px"},children:"Cargando vista previa..."}),children:r.jsx(F,{which:ue,data:J,items:J.items||[]},ue)})}))},[J,ue]);a.useEffect(()=>{if(!de)return;he();const e=requestAnimationFrame(pe);return()=>cancelAnimationFrame(e)},[de,he,pe]),a.useEffect(()=>()=>{ae.current&&ae.current.unmount(),ae.current=null,ie.current=null,te.current=null},[]);const xe=a.useCallback(()=>{Object.entries(Z.current).forEach(([,e])=>{e&&"string"==typeof e&&e.startsWith("blob:")&&"undefined"!=typeof URL&&"function"==typeof URL.revokeObjectURL&&URL.revokeObjectURL(e)}),Z.current={background:null,image:null}},[]),ve=a.useCallback((e={})=>{xe(),X(C(e))},[xe]),je=a.useCallback((e,t)=>{X(n=>({...n,[e]:t}))},[]),ye=a.useCallback(e=>t=>{const n=t?.target?.files?.[0],a=Z.current[e];if(n){const t="undefined"!=typeof window&&window.File&&"function"==typeof window.File.toURL?window.File.toURL:"undefined"!=typeof URL&&"function"==typeof URL.createObjectURL?e=>URL.createObjectURL(e):null;if(!t)return Z.current[e]=null,void X(t=>({...t,[e]:""}));const i=t(n);return a&&a.startsWith("blob:")&&"undefined"!=typeof URL&&"function"==typeof URL.revokeObjectURL&&URL.revokeObjectURL(a),Z.current[e]=i,X(t=>({...t,[e]:i})),void requestAnimationFrame(()=>{pe()})}a&&a.startsWith("blob:")&&"undefined"!=typeof URL&&"function"==typeof URL.revokeObjectURL&&URL.revokeObjectURL(a),Z.current[e]=null,X(t=>({...t,[e]:""}))},[pe]),Be=a.useCallback(e=>{const t=e?.target??U.current;if(!t)return;const n=$(t).val(),a=Array.isArray(n)?n[0]:n;je("type",a||"BannerSimple")},[je]),we=a.useCallback(e=>{je("contenedor",e.target.checked?"absoluto":"relativo")},[je]);a.useEffect(()=>{const e=s.current;if(!e)return;const t=$(e),n=()=>{if(xe(),X({name:"",description:"",button_text:"",button_link:"",contenedor:"relativo",type:"BannerSimple",background:"",image:"",items:[]}),V(null),M(!1),ae.current){try{ae.current.unmount()}catch(e){}ae.current=null}ie.current=null,te.current=null,re.current=1,se(1),ce(_),me(!1)};return t.on("hidden.bs.modal",n),()=>{t.off("hidden.bs.modal",n)}},[xe]),a.useEffect(()=>()=>xe(),[xe]),a.useEffect(()=>{const e=requestAnimationFrame(pe);return()=>cancelAnimationFrame(e)},[ue,J,pe]),a.useEffect(()=>{const e=()=>pe();return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[pe]),a.useEffect(()=>{if("undefined"==typeof ResizeObserver)return;const e=new ResizeObserver(()=>pe());return ee.current&&e.observe(ee.current),te.current&&e.observe(te.current),()=>e.disconnect()},[pe,de]);const Re=[{id:"BannerSimple",name:"Banner Simple",icon:"mdi mdi-image-size-select-large"},{id:"BannerAd",name:"Banner Ad",icon:"mdi mdi-google-ads"},{id:"BannerFullWidth",name:"Banner Full Width",icon:"mdi mdi-view-carousel"},{id:"BannerIbergruas",name:"Banner Ibergruas",icon:"mdi mdi-image-size-select-large"},{id:"BannerFlex",name:"Banner Flex",icon:"mdi mdi-view-split-vertical"},{id:"BannerPublicitario",name:"Banner Publicitario",icon:"mdi mdi-bullhorn"},{id:"BannerPublicitarioPaani",name:"Banner Publicitario Paani",icon:"mdi mdi-bullhorn-variant"},{id:"BannerPostSuscriptionPaani",name:"Banner Post Suscripción Paani",icon:"mdi mdi-email-newsletter"},{id:"BannerStatic",name:"Banner Static",icon:"mdi mdi-image-frame"},{id:"BannerStaticSecond",name:"Banner Static Second",icon:"mdi mdi-image-multiple"},{id:"BannerSimpleSF",name:"Banner Simple SF",icon:"mdi mdi-image-outline"},{id:"BannerSimpleD2",name:"Banner Simple D2",icon:"mdi mdi-image"},{id:"BannerBananaLab",name:"Banner Banana Lab",icon:"mdi mdi-fruit-grapes"},{id:"BannerCTAMakita",name:"Banner CTA Makita",icon:"mdi mdi-call-to-action"},{id:"BannerContactMakita",name:"Banner Contact Makita",icon:"mdi mdi-contact-mail"},{id:"BannerPidelo",name:"Banner Pidelo",icon:"mdi mdi-shopping"},{id:"BannerMultivet",name:"Banner Multivet",icon:"mdi mdi-medical-bag"},{id:"BannerPublicitarioKatya",name:"Banner Publicitario Katya",icon:"mdi mdi-account-star"},{id:"BannerBlogSectionKatya",name:"Banner Blog Section Katya",icon:"mdi mdi-post"},{id:"BannerMobileApp",name:"Banner Mobile App - FirstClass",icon:"mdi mdi-cellphone-link"},{id:"BannerAboutStats",name:"About con Estadísticas - WebQuirurgica",icon:"mdi mdi-chart-box"},{id:"BannerAboutStatsPanelPro",name:"About con Estadísticas - PanelPro",icon:"mdi mdi-chart-box"}],Se=e=>null==e||""===e?null:e,ke=({pageId:e,baseSystems:t=[],insertedSystem:n=null})=>{const a=Se(e);let i=y(t.map(e=>({...e})));if(n){const e={...n,page_id:a},t=e.after_component??null;if(t){const n=i.findIndex(e=>e.id===t);i=-1===n?[...i,e]:[...i.slice(0,n+1),e,...i.slice(n+1)]}else i=[e,...i]}const r={};return{ordered:i.map((e,t)=>{const n=(0===t?null:i[t-1].id)??null;return(e.after_component??null)!==n&&(r[e.id]=n),{...e,page_id:a,after_component:n}}),updates:r}},_e=e=>{const t=Se(e),n=I.filter(e=>Se(e.page_id)===t),a=y(n);G(a)};a.useEffect(()=>{_e()},[]),a.useEffect(()=>{_e(H)},[H,I]);const Fe=e=>{ge(),e?.id?(M(!0),V({id:e.id,page_id:Se(e.page_id),after_component:e.after_component??null})):(M(!1),V(null));const t=C(e?.data||{});ve(t),d.current.value=e?.id??"",m.current.value=t.name,v.current.value=t.description,L.current.value=t.button_text,P.current.value=t.button_link;const n=B(t.background),a=B(t.image);E.image&&(E.image.src=n||""),E.current.value=null,N.image&&(N.image.src=a||""),N.current.value=null,E.resetDeleteFlag&&E.resetDeleteFlag(),N.resetDeleteFlag&&N.resetDeleteFlag(),T.current&&(T.current.checked="absoluto"===t.contenedor),$(D.current).val(e?.page_id||"").trigger("change");const i=e?.page_id||"";q(i),_e(i),setTimeout(()=>{const t=e?.after_component||"";$(A.current).val(t).trigger("change")},100),$(U.current).val(t.type||"BannerSimple").trigger("change"),$(s.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(g,{gridRef:n,title:"Banners",rest:w,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo banner",hint:"Nuevo banner",onClick:()=>Fe()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Información",cellTemplate:(t,{data:n})=>{const a=e.find(e=>e.id==n?.page_id),i=Re.find(e=>e.id===n?.data?.type);t.html(o.renderToString(r.jsx(r.Fragment,{children:r.jsx("div",{className:"d-flex align-items-center",children:r.jsxs("div",{children:[r.jsx("b",{className:"d-block",children:n?.name}),r.jsxs("small",{className:"text-muted d-block",children:["Tipo: ",i?.name||"Banner Simple"]}),r.jsxs("small",{className:"text-muted",children:["Página: ",a?.name||"Base Template"]})]})})})))}},{dataField:"after_component",caption:"Después de",cellTemplate:(e,{data:t})=>{if(!t.after_component)return void e.text("Al inicio");const n=I.find(e=>e.id===t.after_component);e.text(n?n.name:"Componente eliminado")}},{dataField:"background",caption:"Fondo",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{j(e,r.jsx("img",{src:`/storage/images/system/${t?.data?.background}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{j(e,r.jsx("img",{src:`/storage/images/system/${t?.data?.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),j(e,r.jsx(p,{checked:1==t.visible,onChange:()=>(async({id:e,value:t})=>{await w.boolean({id:e,field:"visible",value:t})&&W(n=>n.map(n=>n.id===e?{...n,visible:t}:n))})({id:t.id,value:!t.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(h({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>Fe(t)})),e.append(h({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async e=>{const{isConfirmed:t}=await c.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});if(!t)return;await w.delete(e)&&W(t=>t.filter(t=>t.id!=e))})(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(b,{modalRef:s,title:O?"Editar banner":"Agregar banner",onSubmit:async e=>{if(e.preventDefault(),!Q){Y(!0);try{const e=d.current.value,t=$(D.current).val(),a=Se(t),i=$(A.current).val()||null,r=J.type||"BannerSimple",o={name:`Banner - ${m.current.value}`,component:"banner",value:r,page_id:a,after_component:i,visible:!0};e&&(o.id=e);const l=await R.save(o);if(!l)return;const c={...K?.id&&I.find(e=>e.id===K.id)?.data||{},name:m.current.value,description:v.current.value,button_text:L.current.value,button_link:P.current.value,contenedor:T.current?.checked?"absoluto":"relativo",type:r},u=new FormData;u.append("id",l.id),Object.entries(c).forEach(([e,t])=>u.append(e,t));const p=E.current.files[0];p&&u.append("background",p);const f=N.current.files[0];f&&u.append("image",f),E.getDeleteFlag&&E.getDeleteFlag()&&u.append("background_delete","DELETE"),N.getDeleteFlag&&N.getDeleteFlag()&&u.append("image_delete","DELETE");if(!(await w.save(u)))return;E.resetDeleteFlag&&E.resetDeleteFlag(),N.resetDeleteFlag&&N.resetDeleteFlag();let b={...l,page_id:a,after_component:i??null,data:{...l.data||{},...c}};const g=Se(K?.page_id),h=Se(b.page_id),x={};if(K?.id&&g!==h){const e=I.filter(e=>Se(e.page_id)===g&&e.id!==b.id).map(e=>({...e})),{updates:t}=ke({pageId:g,baseSystems:e});Object.assign(x,t)}const j=I.filter(e=>Se(e.page_id)===h&&e.id!==b.id).map(e=>({...e})),{ordered:y,updates:B}=ke({pageId:h,baseSystems:j,insertedSystem:b});Object.assign(x,B);const S=y.find(e=>e.id===b.id);if(S&&(b={...b,after_component:S.after_component??null}),Object.keys(x).length>0){if(!(await R.updateOrder(x)))return}W(e=>[...e.filter(e=>e.id!==b.id).map(e=>Object.prototype.hasOwnProperty.call(x,e.id)?{...e,after_component:x[e.id]??null}:e),b]),q(h??""),(()=>{if(!n.current)return;const e=$(n.current);if("function"!=typeof e.dxDataGrid)return;const t=e.dxDataGrid("instance");t?.refresh()})(),$(s.current).modal("hide"),V(null),M(!1)}finally{Y(!1)}}},size:"xl",children:[r.jsx("input",{ref:d,type:"hidden"}),r.jsxs("div",{className:"row g-3",id:"banner-container",children:[r.jsx("div",{className:"col-12 col-lg-5 order-1 order-lg-2",children:r.jsxs("div",{className:"card shadow-sm border-0 h-100",children:[r.jsxs("div",{className:"card-header bg-white border-0 pb-0",children:[r.jsx("h6",{className:"mb-1 fw-semibold",children:"Vista previa"}),r.jsx("small",{className:"text-muted",children:"Se actualiza automáticamente con los cambios."})]}),r.jsx("div",{className:"card-body",children:r.jsx("div",{ref:ee,className:"banner-preview-stage border rounded bg-light p-3",style:{minHeight:_,height:le,maxHeight:900,overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"flex-start",transition:"height 150ms ease, min-height 150ms ease, max-height 150ms ease"},children:r.jsxs("div",{className:"banner-preview-frame position-relative",style:{width:"1600px",minWidth:"1600px",maxWidth:"1600px",transform:`scale(${oe})`,transformOrigin:"top center",transition:"transform 150ms ease, width 150ms ease"},children:[r.jsx("iframe",{ref:ne,title:"Vista previa del banner",style:{width:"1600px",height:"900px",border:"0",pointerEvents:"none",backgroundColor:"transparent",display:"block"},scrolling:"no"}),!de&&r.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center text-muted small bg-white bg-opacity-75",children:"Cargando vista previa..."})]})})})]})}),r.jsxs("div",{className:"col-12 col-lg-7 order-2 order-lg-1",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(f,{eRef:U,label:"Tipo de Banner",dropdownParent:"#banner-container",onChange:Be,children:Re.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))})}),r.jsx("div",{className:"col-md-6",children:r.jsxs(f,{eRef:D,label:"Página",onChange:e=>{const t=$(e.target).val();q(t),setTimeout(()=>{$(A.current).val("").trigger("change")},100)},dropdownParent:"#banner-container",children:[r.jsx("option",{value:"",children:"Base Template"}),e.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})})]}),r.jsxs(f,{eRef:A,label:"Posición (después de)",dropdownParent:"#banner-container",changeWith:[H],children:[r.jsx("option",{value:"",children:"Al inicio"}),z.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]}),r.jsx(u,{eRef:E,name:"background",label:"Fondo",onChange:ye("background")}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-sm-6",children:r.jsx(u,{eRef:N,name:"image",label:"Imagen",aspect:1,onChange:ye("image")})}),r.jsxs("div",{className:"col-sm-6",children:[r.jsx(l,{eRef:m,label:"Titulo",rows:2,onChange:e=>je("name",e.target.value)}),r.jsx(l,{eRef:v,label:"Descripción",rows:2,onChange:e=>je("description",e.target.value)}),r.jsx(x,{eRef:L,label:"Texto botón",onChange:e=>je("button_text",e.target.value)})]})]}),r.jsx(x,{eRef:P,label:"URL botón",onChange:e=>je("button_link",e.target.value)}),r.jsxs("div",{className:"form-group row",children:[r.jsx("label",{className:"col-sm-3 col-form-label",children:"Posición"}),r.jsxs("div",{className:"col-sm-9",children:[r.jsxs("div",{className:"custom-control custom-switch",children:[r.jsx("input",{type:"checkbox",className:"custom-control-input",id:"absoluteSwitch",ref:T,onChange:we}),r.jsx("label",{className:"custom-control-label",htmlFor:"absoluteSwitch",children:"Imagen absoluta"})]}),r.jsx("small",{className:"form-text text-muted",children:"Marca esta opción para posicionamiento absoluto de la imagen"})]})]})]})]})]})]})};v((e,t)=>{i.createRoot(e).render(r.jsx(s,{...t,title:"Banners",children:r.jsx(E,{...t})}))});

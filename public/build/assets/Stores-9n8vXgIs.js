import{c as e,j as a,r as t,L as i,A as l,G as s,M as r,s as n}from"./vendor-react-CZUvQwNQ.js";import{S as o}from"./StoresRest-BmAz5O4t.js";import{C as c,F as d}from"./CreateReactScript-DMiuD_MQ.js";import{B as p}from"./Base-BE1X8Lb3.js";import{T as u}from"./Table-Cynp-rvu.js";import{M as m}from"./Modal-MmI0jF6v.js";import{I as h}from"./InputFormGroup-BuXn3s3l.js";import{T as x}from"./TextareaFormGroup-dfKTDx8M.js";import{I as f}from"./ImageFormGroup-DlJufE2S.js";import{S as b}from"./SwitchFormGroup-CA4b2Uj0.js";import{S as g}from"./SelectFormGroup-CuRVgWYg.js";import{D as v}from"./DxButton-C6FT_beP.js";import{S as j}from"./CartKuchara-C7vqSevl.js";import{G as y}from"./Footer-DAm0kDL9.js";import{R as N}from"./ReactAppend-Db2K6xCH.js";import"./vendor-swiper-Cr_RrIb_.js";import"./BasicRest-K-34csnH.js";import"./OpenPayCardModal-BHkRoVZ6.js";import"./BooleanLimit-q2Ad9fGY.js";import"./TippyButton-Gia9IjJq.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./Menu-DboRETzC.js";import"./Logout-D6byb_Ua.js";import"./MenuItemContainer-BaCqn8PU.js";const R=["places"],w=new o,k=({ubigeos:e=[]})=>{const o=t.useRef(),c=t.useRef(),p=t.useRef(),k=t.useRef(),F=t.useRef(),S=t.useRef(),C=t.useRef(),T=t.useRef(),_=t.useRef(),E=t.useRef(),D=t.useRef(),B=t.useRef();t.useRef();const L=t.useRef(),A=t.useRef(),M=t.useRef(),G=t.useRef(),[P,I]=t.useState(!1),[O,J]=t.useState({lat:-12.046374,lng:-77.042793}),[U,W]=t.useState(null),[q,z]=t.useState(null),[K,V]=t.useState(""),[H,Y]=t.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),Q=e=>{if(I(!!e?.id),p.current.value=e?.id??"",k.current.value=e?.name??"",F.current.value=e?.address??"",S.current.value=e?.phone??"",C.current.value=e?.email??"",T.current.value=e?.description??"",E.current.value=e?.latitude??"",D.current.value=e?.longitude??"",L.current.value=e?.manager??"",A.current.value=e?.capacity??"",G.current.value=e?.link??"",d.has("stores","image")&&(B.resetDeleteFlag&&B.resetDeleteFlag(),B.current&&(B.image.src=e?.image?`/storage/images/store/${e.image}`:"")),$(_.current).val(e?.ubigeo??null).trigger("change"),e?.id?w.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(a=>{const t=$(M.current);if(a?.data&&Array.isArray(a.data)&&a.data.length>0){a.data.find(a=>a.id!==e.id)&&"tienda_principal"!==e.type?t.find('option[value="tienda_principal"]').prop("disabled",!0):t.find('option[value="tienda_principal"]').prop("disabled",!1)}else t.find('option[value="tienda_principal"]').prop("disabled",!1);t.val(e?.type??"tienda").trigger("change")}).catch(a=>{$(M.current).val(e?.type??"tienda").trigger("change")}):w.paginate({filter:JSON.stringify({type:"tienda_principal"})}).then(a=>{const t=a?.data&&Array.isArray(a.data)&&a.data.length>0,i=$(M.current);t?i.find('option[value="tienda_principal"]').prop("disabled",!0):i.find('option[value="tienda_principal"]').prop("disabled",!1),i.val(e?.type??"tienda").trigger("change")}).catch(e=>{}),e?.business_hours)try{const a="string"==typeof e.business_hours?JSON.parse(e.business_hours):e.business_hours;Y(a)}catch(a){}else Y([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);if(e?.latitude&&e?.longitude){const a=parseFloat(e.latitude),t=parseFloat(e.longitude);if(!isNaN(a)&&!isNaN(t)){const e={lat:a,lng:t};J(e),W(e)}}else{J({lat:-12.046374,lng:-77.042793}),W(null)}$(c.current).modal("show")},X=(e,a,t)=>{const i=[...H];i[e][a]=t,Y(i)},Z=()=>{const e=parseFloat(E.current?.value),a=parseFloat(D.current?.value);if(!isNaN(e)&&!isNaN(a)){const t={lat:e,lng:a};J(t),W(t)}},ee=(e,a,t)=>{if(null==e||isNaN(e))return!1;const i=Math.abs(e).toString().split("."),l=i[0];(i[1]||"").length;const s=a-t;return!(l.length>s)},ae=e=>$(n.renderToString(a.jsxs("span",{children:[a.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),a.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]})));return a.jsxs(a.Fragment,{children:[a.jsx(u,{gridRef:o,title:"Tiendas / Sucursales",rest:w,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>Q()}})},columns:[{dataField:"id",caption:"ID",visible:!1},d.has("stores","image")&&{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{N(e,a.jsx("img",{src:`/storage/images/store/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:a})=>{const t={tienda_principal:"Tienda Principal",tienda:"Tienda",oficina:"Oficina",almacen:"Almacén",showroom:"Showroom",otro:"Otro"}[a.type]||"No especificado",i={tienda_principal:"danger",tienda:"success",oficina:"primary",almacen:"warning",showroom:"info",otro:"secondary"}[a.type]||"secondary";e.append(`<span class="badge bg-${i}">${t}</span>`)}},{dataField:"address",caption:"Dirección",width:"250px"},d.has("stores","phone")&&{dataField:"phone",caption:"Teléfono",width:"120px"},d.has("stores","email")&&{dataField:"email",caption:"Email",width:"180px"},d.has("stores","link")&&{dataField:"link",caption:"Enlace",cellTemplate:(e,{data:a})=>{a.link?e.html(`<a href="${a.link}" target="_blank" class="text-primary">\n                                        ${a.link.length>30?a.link.substring(0,30)+"...":a.link}\n                                    </a>`):e.text("Sin enlace")}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),N(e,a.jsx(b,{checked:1==t.visible,onChange:()=>(async({id:e,value:a})=>{await w.boolean({id:e,field:"visible",value:a})&&$(o.current).dxDataGrid("instance").refresh()})({id:t.id,value:!t.visible})}))}},{dataField:"pickup_available",caption:"Recojo",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),N(e,a.jsx(b,{checked:!0===t.pickup_available||1===t.pickup_available,onChange:()=>(async({id:e,value:a})=>{await w.boolean({id:e,field:"pickup_available",value:a})&&$(o.current).dxDataGrid("instance").refresh()})({id:t.id,value:!t.pickup_available})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:a})=>{e.css("text-overflow","unset"),e.append(v({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>Q(a)})),e.append(v({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async e=>{const{isConfirmed:a}=await j.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!a)return;await w.delete(e)&&$(o.current).dxDataGrid("instance").refresh()})(a.id)}))},allowFiltering:!1,allowExporting:!1}].filter(Boolean)}),a.jsxs(m,{modalRef:c,title:P?"Editar Tienda":"Agregar Tienda",onSubmit:async a=>{if(a.preventDefault(),"tienda_principal"===M.current.value)try{const e=p.current.value,a=await w.paginate({filter:JSON.stringify({type:"tienda_principal"})});if(a?.data&&Array.isArray(a.data)&&a.data.length>0){if(!e)return void j.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"});if(a.data.find(a=>a.id!==e))return void j.fire({title:"Error",text:"Ya existe una Tienda Principal. Solo puede haber una tienda de este tipo.",icon:"error"})}}catch(n){return void j.fire({title:"Error",text:"Error al verificar si existe una tienda principal",icon:"error"})}const t=E.current.value.trim(),i=D.current.value.trim();let l=null,s=null;if(t){if(l=parseFloat(t),l<-18.5||l>-.1)return void j.fire({title:"Error de validación",text:"La latitud debe estar entre -18.5 y -0.1 para ubicaciones en Perú",icon:"error"});if(!ee(l,10,8))return void j.fire({title:"Error de validación",text:"La latitud excede el formato permitido (máximo 10 dígitos con 8 decimales)",icon:"error"});l=Math.round(1e8*l)/1e8}if(i){if(s=parseFloat(i),s<-81.5||s>-68.5)return void j.fire({title:"Error de validación",text:"La longitud debe estar entre -81.5 y -68.5 para ubicaciones en Perú",icon:"error"});if(!ee(s,11,8))return void j.fire({title:"Error de validación",text:"La longitud excede el formato permitido (máximo 11 dígitos con 8 decimales)",icon:"error"});s=Math.round(1e8*s)/1e8}e.find(e=>e.reniec==_.current.value);const r=new FormData;p.current.value,p.current.value&&r.append("id",p.current.value),r.append("name",k.current.value),r.append("address",F.current.value),r.append("phone",S.current.value),r.append("email",C.current.value),r.append("description",T.current.value),r.append("ubigeo",_.current.value),r.append("latitude",null!==l?l.toString():""),r.append("longitude",null!==s?s.toString():""),r.append("manager",L.current.value),r.append("capacity",A.current.value),r.append("type",M.current.value),r.append("link",G.current.value),r.append("business_hours",JSON.stringify(H)),d.has("stores","image")&&(B.current&&B.current.files[0]&&r.append("image",B.current.files[0]),B.getDeleteFlag&&B.getDeleteFlag()&&r.append("image_delete","DELETE"));for(let e of r.entries());await w.save(r)&&(d.has("stores","image")&&B.resetDeleteFlag&&B.resetDeleteFlag(),$(o.current).dxDataGrid("instance").refresh(),$(c.current).modal("hide"))},size:"xl",children:[a.jsx("input",{ref:p,type:"hidden"}),a.jsxs("div",{id:"form-container",children:[a.jsxs("ul",{className:"nav nav-pills mb-4",id:"storeTabs",role:"tablist",style:{gap:"10px",flexWrap:"wrap",backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"8px"},children:[a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link active",id:"basic-info-tab","data-bs-toggle":"pill","data-bs-target":"#basic-info",type:"button",role:"tab","aria-controls":"basic-info","aria-selected":"true",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[a.jsx("i",{className:"fas fa-info-circle me-2"}),"Información Básica"]})}),a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"location-tab","data-bs-toggle":"pill","data-bs-target":"#location",type:"button",role:"tab","aria-controls":"location","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[a.jsx("i",{className:"fas fa-map-marker-alt me-2"}),"Ubicación"]})}),a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"contact-tab","data-bs-toggle":"pill","data-bs-target":"#contact",type:"button",role:"tab","aria-controls":"contact","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[a.jsx("i",{className:"fas fa-phone me-2"}),"Contacto"]})}),a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"schedule-tab","data-bs-toggle":"pill","data-bs-target":"#schedule",type:"button",role:"tab","aria-controls":"schedule","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[a.jsx("i",{className:"fas fa-clock me-2"}),"Horarios"]})}),a.jsx("li",{className:"nav-item",role:"presentation",children:a.jsxs("button",{className:"nav-link",id:"multimedia-tab","data-bs-toggle":"pill","data-bs-target":"#multimedia",type:"button",role:"tab","aria-controls":"multimedia","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease",padding:"10px 20px"},children:[a.jsx("i",{className:"fas fa-images me-2"}),"Multimedia"]})})]}),a.jsxs("div",{className:"tab-content",style:{padding:"20px 0"},children:[a.jsx("div",{className:"tab-pane fade show active",id:"basic-info",role:"tabpanel","aria-labelledby":"basic-info-tab",children:a.jsxs("div",{className:"row g-3",children:[a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:k,label:"Nombre de la tienda",col:"col-12",required:!0})}),a.jsx("div",{className:"col-md-6",children:a.jsxs(g,{eRef:M,label:"Tipo de establecimiento",col:"col-12",required:!0,dropdownParent:"#form-container",children:[a.jsx("option",{value:"tienda_principal",children:"Tienda Principal"}),a.jsx("option",{value:"tienda",children:"Tienda"}),a.jsx("option",{value:"oficina",children:"Oficina"}),a.jsx("option",{value:"almacen",children:"Almacén"}),a.jsx("option",{value:"showroom",children:"Showroom"}),a.jsx("option",{value:"otro",children:"Otro"})]})}),d.has("stores","manager")&&a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:L,label:"Encargado",col:"col-12"})}),d.has("stores","capacity")&&a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:A,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),a.jsx("div",{className:"col-12",children:a.jsx(h,{eRef:F,label:"Dirección completa",col:"col-12",required:!0})}),a.jsx("div",{className:"col-12",children:a.jsx(g,{eRef:_,label:"Distrito/Ubigeo",col:"col-12",templateResult:ae,templateSelection:ae,dropdownParent:"#form-container",required:!0,children:e.map((e,t)=>a.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},t))})})]})}),a.jsx("div",{className:"tab-pane fade",id:"location",role:"tabpanel","aria-labelledby":"location-tab",children:a.jsx(i,{googleMapsApiKey:y.GMAPS_API_KEY,libraries:R,children:a.jsx("div",{className:"row g-3",children:a.jsxs("div",{className:"col-12",children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"form-label",children:[a.jsx("i",{className:"fas fa-search me-2"}),"Buscar ubicación"]}),a.jsx(l,{onLoad:e=>{z(e),setTimeout(()=>{document.querySelectorAll(".pac-container").forEach(e=>{e.style.zIndex="9999"})},100)},onPlaceChanged:()=>{if(null!==q){const e=q.getPlace();if(e.geometry&&e.geometry.location){const a=e.geometry.location.lat(),t=e.geometry.location.lng();J({lat:a,lng:t}),W({lat:a,lng:t}),E.current&&(E.current.value=a.toFixed(8)),D.current&&(D.current.value=t.toFixed(8)),V(e.formatted_address||e.name||""),j.fire({title:"Ubicación encontrada",text:e.formatted_address||e.name,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}}},options:{componentRestrictions:{country:"pe"},fields:["formatted_address","geometry","name"],strictBounds:!1},children:a.jsx("input",{type:"text",className:"form-control",placeholder:"Busca la dirección o nombre del lugar...",value:K,onChange:e=>V(e.target.value),style:{position:"relative",zIndex:1}})}),a.jsx("small",{className:"form-text text-muted",children:"Escribe el nombre o dirección de la tienda para centrar el mapa automáticamente."})]}),a.jsx("div",{className:"mb-3",children:a.jsx(s,{mapContainerStyle:{width:"100%",height:"400px",borderRadius:"8px"},center:O,zoom:15,onClick:e=>{const a=e.latLng.lat(),t=e.latLng.lng();W({lat:a,lng:t}),E.current&&(E.current.value=a.toFixed(8)),D.current&&(D.current.value=t.toFixed(8)),j.fire({title:"Ubicación seleccionada",text:`Coordenadas: ${a.toFixed(6)}, ${t.toFixed(6)}`,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})},options:{streetViewControl:!0,mapTypeControl:!0,fullscreenControl:!0},children:U&&a.jsx(r,{position:U,title:"Ubicación de la tienda"})})}),a.jsxs("div",{className:"row mt-3",children:[a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:E,label:"Latitud",col:"col-12",type:"number",step:"0.00000001",min:"-18.5",max:"-0.1",placeholder:"Ej: -12.042626777544823",onChange:Z})}),a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:D,label:"Longitud",col:"col-12",type:"number",step:"0.00000001",min:"-81.5",max:"-68.5",placeholder:"Ej: -77.04753389161506",onChange:Z})})]}),a.jsx("div",{className:"row mt-3",children:a.jsx("div",{className:"col-12",children:a.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{W(null),E.current.value="",D.current.value=""},children:[a.jsx("i",{className:"fas fa-eraser me-1"}),"Limpiar Ubicación"]})})})]})})})}),a.jsx("div",{className:"tab-pane fade",id:"contact",role:"tabpanel","aria-labelledby":"contact-tab",children:a.jsxs("div",{className:"row g-3",children:[d.has("stores","phone")&&a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:S,label:"Teléfono",col:"col-12",type:"tel"})}),d.has("stores","email")&&a.jsx("div",{className:"col-md-6",children:a.jsx(h,{eRef:C,label:"Email",col:"col-12",type:"email"})}),d.has("stores","link")&&a.jsxs("div",{className:"col-12",children:[a.jsx(h,{eRef:G,label:"Enlace personalizado (opcional)",col:"col-12",type:"url",placeholder:"https://ejemplo.com"}),a.jsx("small",{className:"text-muted",children:"Si se especifica, al hacer clic en la tienda redirigirá a este enlace en lugar del perfil de la tienda."})]})]})}),a.jsx("div",{className:"tab-pane fade",id:"schedule",role:"tabpanel","aria-labelledby":"schedule-tab",children:d.has("stores","business_hours")&&a.jsx("div",{className:"row g-3",children:a.jsxs("div",{className:"col-12",children:[a.jsx("label",{className:"form-label",children:"Horarios de atención"}),a.jsx("div",{className:"table-responsive",children:a.jsxs("table",{className:"table table-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Día"}),a.jsx("th",{children:"Apertura"}),a.jsx("th",{children:"Cierre"}),a.jsx("th",{children:"Cerrado"})]})}),a.jsx("tbody",{children:H.map((e,t)=>a.jsxs("tr",{children:[a.jsx("td",{className:"align-middle",children:a.jsx("strong",{children:e.day})}),a.jsx("td",{children:a.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:e=>X(t,"open",e.target.value),disabled:e.closed})}),a.jsx("td",{children:a.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:e=>X(t,"close",e.target.value),disabled:e.closed})}),a.jsx("td",{children:a.jsxs("div",{className:"form-check",children:[a.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:e=>X(t,"closed",e.target.checked)}),a.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},t))})]})})]})})}),a.jsx("div",{className:"tab-pane fade",id:"multimedia",role:"tabpanel","aria-labelledby":"multimedia-tab",children:a.jsxs("div",{className:"row g-3",children:[d.has("stores","image")&&a.jsx("div",{className:"col-12",children:a.jsx(f,{eRef:B,name:"image",label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),d.has("stores","description")&&a.jsx("div",{className:"col-12",children:a.jsx(x,{eRef:T,label:"Descripción",rows:3})})]})})]})]})]})]})};c((t,i)=>{e.createRoot(t).render(a.jsx(p,{...i,title:"Tiendas / Sucursales",children:a.jsx(k,{...i})}))});

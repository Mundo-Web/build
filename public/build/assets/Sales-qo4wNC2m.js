var e=Object.defineProperty,s=(s,a,t)=>((s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t)(s,"symbol"!=typeof a?a+"":a,t);import{c as a,j as t,r,i as l}from"./vendor-react-CWR92fp6.js";import{B as i}from"./Base-720R7P2J.js";import{C as c}from"./CreateReactScript-DEkx_UD4.js";import{T as d}from"./Table-ZhWgDs5U.js";import{D as n}from"./DxButton-C6FT_beP.js";import{R as o}from"./ReactAppend-BcjZMe63.js";import"./CartKuchara-Dv4IzV1I.js";import{B as m}from"./BasicRest-Bgh-G8ac.js";import{G as h}from"./Global-BAGAPG-V.js";import{C as x,N as j}from"./Number2Currency-BX4epFEo.js";import{M as p}from"./Modal-BDEftn0t.js";import{S as u}from"./SaleStatusesRest-BfwJl-DQ.js";import"./vendor-swiper-T7yreVnW.js";import"./TippyButton-BozxD_uD.js";import"./Logout-D1lX4Eka.js";import"./MenuItemContainer-BN3ovvaX.js";import"./Menu-BoHY91ba.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";import"./GoogleSignInButton-DPrMhoxG.js";const b=new class extends m{constructor(){super(...arguments),s(this,"path","customer/sales")}};new u;const f=({statuses:e=[]})=>{const s=r.useRef(),a=r.useRef(),[i,c]=r.useState(null),[m,u]=r.useState([]),f=async e=>{const s=await b.get(e);c(s.data),$(a.current).modal("show")};r.useEffect(()=>{},[i]);const N=Number(i?.amount)+Number(i?.delivery||0)+Number(i?.seguro_importacion_total||0)+Number(i?.derecho_arancelario_total||0)+Number(i?.flete_total||0)-Number(i?.bundle_discount||0)-Number(i?.renewal_discount||0)-Number(i?.coupon_discount||0);return t.jsxs(t.Fragment,{children:[t.jsx(d,{gridRef:s,title:"Pedidos",rest:b,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(e,{data:s})=>{e.css("cursor","pointer"),e.on("click",()=>{f(s.id)}),o(e,t.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[t.jsxs("b",{className:"d-block",children:[s.name," ",s.lastname]}),t.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",h.APP_CORRELATIVE,"-",s.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(e,{data:s})=>{e.text(moment(s.created_at).format("LLL"))}},{dataField:"status.name",caption:"Estado",cellTemplate:(e,{data:s})=>{o(e,t.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:s.status.color?`${s.status.color}2e`:"#3333332e",color:s.status.color??"#333"},children:s.status.name}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(e,{data:s})=>{const a=Number(s.amount)||0,t=Number(s.delivery)||0,r=Number(s.seguro_importacion_total)||0,l=Number(s.derecho_arancelario_total)||0,i=Number(s.flete_total)||0,c=Number(s.bundle_discount)||0,d=Number(s.renewal_discount)||0,n=Number(s.coupon_discount)||0;e.text(`${x()} ${j(a+t+r+l+i-c-d-n)}`)}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.append(n({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>f(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(p,{modalRef:a,title:`Detalles del pedido #${h.APP_CORRELATIVE}-${i?.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-8",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),t.jsx("div",{className:"card-body p-2",children:t.jsx("table",{className:"table table-borderless table-sm mb-0",children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("th",{children:"Nombres:"}),t.jsx("td",{children:i?.fullname})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Email:"}),t.jsx("td",{children:i?.email})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"TelÃ©fono:"}),t.jsx("td",{children:i?.phone})]}),"express"==i?.delivery_type&&t.jsxs("tr",{children:[t.jsx("th",{children:"DirecciÃ³n:"}),t.jsxs("td",{children:[i?.address," ",i?.number,t.jsxs("small",{className:"text-muted d-block",children:[i?.province??i?.district,","," ",i?.department,", ",i?.country," ",i?.zip_code&&t.jsxs(t.Fragment,{children:["-"," ",i?.zip_code]})]})]})]}),i?.reference&&t.jsxs("tr",{children:[t.jsx("th",{children:"Referencia:"}),t.jsx("td",{children:i?.reference})]}),i?.comment&&t.jsxs("tr",{children:[t.jsx("th",{children:"Comentario:"}),t.jsx("td",{children:i?.comment})]}),i?.payment_proof&&t.jsxs("tr",{children:[t.jsx("th",{children:"Comprobante de pago:"}),t.jsx("td",{children:t.jsx(l,{content:"Ver comprobante de pago",placement:"top",children:t.jsx("a",{href:`/storage/images/sale/${i?.payment_proof}`,target:"_blank",children:t.jsx("img",{src:`/storage/images/sale/${i?.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"150px",cursor:"pointer"}})})})})]})]})})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"ArtÃ­culos"})}),t.jsx("div",{className:"card-body p-2 table-responsive",children:t.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Precio"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Subtotal"})]})}),t.jsx("tbody",{children:i?.details?.map((e,s)=>{const a=100*e.quantity/100,r=e.price*e.quantity;return t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("div",{children:[t.jsx("strong",{children:e.name}),("combo"===e.type||e.combo_id)&&t.jsxs("div",{className:"mt-1",children:[t.jsxs("small",{className:"text-muted d-block",children:[t.jsx("span",{className:"badge bg-info me-1",children:"COMBO"}),"Contiene:"]}),e.combo_data&&e.combo_data.items&&e.combo_data.items.length>0?t.jsx("small",{className:"text-muted",children:e.combo_data.items.map((s,a)=>t.jsxs("span",{children:[s.quantity,"x ",s.name,a<e.combo_data.items.length-1?", ":""]},a))}):t.jsx("small",{className:"text-muted text-warning",children:"ðŸ“‹ InformaciÃ³n de combo no disponible"})]})]})}),t.jsx("td",{align:"right",children:t.jsxs("span",{className:"text-nowrap",children:[x()," ",j(e.price)]})}),t.jsx("td",{align:"center",children:a}),t.jsx("td",{align:"right",children:t.jsxs("span",{className:"text-nowrap",children:[x()," ",j(r)]})})]},s)})})]})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),t.jsxs("div",{className:"card-body p-2",children:[t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Subtotal:"}),t.jsxs("span",{children:[x()," ",j(1*i?.amount)]})]}),t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"EnvÃ­o:"}),t.jsxs("span",{children:[x()," ",j(i?.delivery)]})]}),(i?.seguro_importacion_total>0||i?.derecho_arancelario_total>0||i?.flete_total>0)&&t.jsxs(t.Fragment,{children:[i?.seguro_importacion_total>0&&t.jsxs("div",{className:"d-flex justify-content-between text-info",children:[t.jsx("b",{children:"Seguro de ImportaciÃ³n:"}),t.jsxs("span",{children:[x()," ",j(i?.seguro_importacion_total)]})]}),i?.derecho_arancelario_total>0&&t.jsxs("div",{className:"d-flex justify-content-between text-info",children:[t.jsx("b",{children:"Derecho Arancelario:"}),t.jsxs("span",{children:[x()," ",j(i?.derecho_arancelario_total)]})]}),i?.flete_total>0&&t.jsxs("div",{className:"d-flex justify-content-between text-info",children:[t.jsx("b",{children:"Flete:"}),t.jsxs("span",{children:[x()," ",j(i?.flete_total)]})]})]}),t.jsx("hr",{className:"my-2"}),t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Total:"}),t.jsx("span",{children:t.jsxs("strong",{children:[x()," ",j(N)]})})]})]})]})]}),t.jsxs("div",{className:"col-md-4",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),t.jsx("div",{className:"card-body p-2",children:t.jsxs("div",{className:"",children:[t.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),t.jsx("select",{className:"form-select",id:"statusSelect",value:i?.status_id,onChange:async e=>{const a=await b.save({id:i.id,status_id:e.target.value});a&&(c(a),$(s.current).dxDataGrid("instance").refresh())},disabled:!0,children:e.map((e,s)=>t.jsx("option",{value:e.id,children:e.name}))})]})})]}),t.jsxs("div",{className:"card",hidden:!0,children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),t.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",children:m?.map((e,s)=>t.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:e.status.color?`${e.status.color}2e`:"#3333332e"},children:[t.jsx("i",{className:"mdi mdi-circle left-2",style:{color:e.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),t.jsx("b",{style:{color:e.status.color||"#333"},children:e?.status?.name}),t.jsxs("small",{className:"d-block text-truncate",children:[e?.user?.name," ",e?.user?.lastname]}),t.jsx("small",{className:"d-block text-muted",children:moment(e.created_at).format("YYYY-MM-DD HH:mm")})]},s))})]})]})]})})]})};c((e,s)=>{a.createRoot(e).render(t.jsx(i,{...s,title:"Pedidos",children:t.jsx(f,{...s})}))});

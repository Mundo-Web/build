var O=Object.defineProperty;var A=(r,n,p)=>n in r?O(r,n,{enumerable:!0,configurable:!0,writable:!0,value:p}):r[n]=p;var N=(r,n,p)=>A(r,typeof n!="symbol"?n+"":n,p);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{B}from"./Base-C1Y36PX1.js";import{S as D}from"./SwitchFormGroup-DXN0cwVk.js";import{r as l}from"./index-BOnQTV8N.js";import{I as F}from"./ImageFormGroup-40MuGzez.js";import{c as z}from"./ReactAppend-QR5TrZfj.js";import{S as u}from"./ProductCard-D9l7c7at.js";import{B as G}from"./BasicRest-BML1C-ua.js";import{I as _}from"./InputFormGroup-iZIO11ZN.js";import{M as q}from"./Modal-xDw9ufjg.js";import{T as M}from"./Table-Cv1BshIS.js";import{D as E}from"./DxButton-DV0H-ZcL.js";import{C as L,F as i}from"./CreateReactScript-Bqovr-Zn.js";import{R as h}from"./ReactAppend-Vm5G2nof.js";import{G as V}from"./Global-CazroCzF.js";import"./index-yBjzXJbu.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-BlvzCYjQ.js";import"./CardProductKatya-ncpmQ0JU.js";import"./BooleanLimit-D-OsQsek.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";class H extends G{constructor(){super(...arguments);N(this,"path","admin/tags");N(this,"hasFiles",!0)}}const f=new H,K=()=>{const r=l.useRef(),n=l.useRef(),p=l.useRef(),j=l.useRef(),b=l.useRef(),v=l.useRef(),w=l.useRef(),d=l.useRef(),m=l.useRef(),g=l.useRef(),x=l.useRef(),[T,R]=l.useState(!1),y=e=>{e!=null&&e.id?R(!0):R(!1),p.current.value=(e==null?void 0:e.id)??"",j.current.value=(e==null?void 0:e.name)??"",b.current.value=(e==null?void 0:e.description)??"",v.current.value=(e==null?void 0:e.background_color)??V.APP_COLOR_PRIMARY,w.current.value=(e==null?void 0:e.text_color)??"#ffffff",g.current.value=e!=null&&e.start_date?new Date(e.start_date).toISOString().slice(0,16):"",x.current.value=e!=null&&e.end_date?new Date(e.end_date).toISOString().slice(0,16):"",d.image.src=e!=null&&e.icon?`/storage/images/tag/${e.icon}`:"",m.image.src=e!=null&&e.image?`/storage/images/tag/${e.image}`:"",$(n.current).modal("show")},C=async e=>{e.preventDefault();const s=g.current.value,o=x.current.value;if(s&&o&&new Date(s)>=new Date(o)){await u.fire({title:"Error de ValidaciÃ³n",text:"La fecha de inicio debe ser anterior a la fecha de fin",icon:"error"});return}const a=new FormData;a.append("id",p.current.value||""),a.append("name",j.current.value),a.append("description",b.current.value),a.append("background_color",v.current.value),a.append("text_color",w.current.value),a.append("tag_type","item"),g.current.value&&a.append("start_date",g.current.value),x.current.value&&a.append("end_date",x.current.value),d.current.files&&d.current.files[0]&&a.append("icon",d.current.files[0]),m.current.files&&m.current.files[0]&&a.append("image",m.current.files[0]),d.getDeleteFlag&&d.getDeleteFlag()&&a.append("icon_delete","DELETE"),m.getDeleteFlag&&m.getDeleteFlag()&&a.append("image_delete","DELETE"),await f.save(a)&&(m.resetDeleteFlag&&m.resetDeleteFlag(),d.resetDeleteFlag&&d.resetDeleteFlag(),$(r.current).dxDataGrid("instance").refresh(),$(n.current).modal("hide"))},S=async({id:e,value:s})=>{await f.boolean({id:e,field:"visible",value:s})&&$(r.current).dxDataGrid("instance").refresh()},P=async({id:e,value:s})=>{await f.boolean({id:e,field:"menu",value:s})&&$(r.current).dxDataGrid("instance").refresh()},k=async e=>{const{isConfirmed:s}=await u.fire({title:"Eliminar registro",text:"Â¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!s||!await f.delete(e)||$(r.current).dxDataGrid("instance").refresh()},I=async e=>{const s=e.toIndex;try{await f.reorder(e.itemData.id,s)&&await e.component.refresh()}catch(o){console.error("Error reordering tag:",o)}};return t.jsxs(t.Fragment,{children:[t.jsx(M,{gridRef:r,title:"Tags de Productos",rest:f,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"clock",text:"Actualizar Estados",hint:"Actualizar estados promocionales",onClick:async()=>{var o;const{isConfirmed:s}=await u.fire({title:"Actualizar Estados Promocionales",text:"Â¿Deseas actualizar el estado de todas las etiquetas promocionales basado en sus fechas?",icon:"question",showCancelButton:!0,confirmButtonText:"SÃ­, actualizar",cancelButtonText:"Cancelar"});if(s)try{u.fire({title:"Actualizando...",text:"Por favor espera mientras se actualizan los estados",allowOutsideClick:!1,didOpen:()=>u.showLoading()});const c=await(await fetch("/api/admin/tags/update-promotional-status",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).json();if(c.success)await u.fire({title:"Â¡ActualizaciÃ³n completada!",html:`
                      <div class="text-start">
                        <p><strong>ğŸ“Š EstadÃ­sticas:</strong></p>
                        <ul class="list-unstyled">
                          <li>ğŸ”„ Permanentes: ${c.data.permanent||0}</li>
                          <li>âœ… Activos: ${c.data.active||0}</li>
                          <li>âŒ Expirados: ${c.data.expired||0}</li>
                          <li>ğŸ“ Actualizados: ${c.data.updated||0}</li>
                        </ul>
                      </div>
                    `,icon:"success"}),$(r.current).dxDataGrid("instance").refresh();else throw new Error(c.message||"Error al actualizar estados")}catch(a){u.fire({title:"Error",text:a.message||"No se pudieron actualizar los estados",icon:"error"})}}}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo Tag de Producto",hint:"Nuevo Tag de Producto",onClick:()=>y()}})},rowDragging:{allowReordering:!0,onReorder:I,dropFeedbackMode:"push"},sorting:{mode:"single"},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"order_index",caption:"Orden",visible:!1,sortOrder:"asc",sortIndex:0},i.has("tags","name")&&{dataField:"name",caption:"Etiqueta",width:"25%"},i.has("tags","description")&&{dataField:"description",caption:"ToolTip",width:"20%"},i.has("tags","promotional_status")&&{dataField:"promotional_status",caption:"Estado Promocional",width:"15%",allowSorting:!0,allowFiltering:!0,cellTemplate:(e,{data:s})=>{$(e).empty();const a={permanent:{text:"Permanente",class:"success",icon:"fas fa-infinity"},active:{text:"Activo",class:"primary",icon:"fas fa-play-circle"},expired:{text:"Expirado",class:"danger",icon:"fas fa-stop-circle"}}[s.promotional_status]||{text:"Desconocido",class:"secondary",icon:"fas fa-question-circle"},c=t.jsxs("span",{className:`badge bg-${a.class} d-flex align-items-center gap-1`,style:{fontSize:"11px"},children:[t.jsx("i",{className:a.icon}),a.text]});h(e,c)}},i.has("tags","menu")&&{dataField:"preview",caption:"Vista Previa",width:"20%",allowSorting:!1,allowFiltering:!1,cellTemplate:(e,{data:s})=>{$(e).empty();const o={backgroundColor:s.background_color||"#3b82f6",color:s.text_color||"#ffffff",padding:"4px 8px",borderRadius:"12px",fontSize:"12px",display:"inline-flex",alignItems:"center",gap:"4px",maxWidth:"150px"},a=t.jsxs("div",{children:[t.jsxs("span",{style:o,children:[s.icon&&t.jsx("img",{src:`/storage/images/tag/${s.icon}`,style:{width:"16px",height:"16px",borderRadius:"2px"},alt:"icon",onError:c=>c.target.src="/api/cover/thumbnail/null"}),t.jsx("span",{children:s.name})]}),i.has("tags","start_date")&&i.has("tags","end_date")&&(s.start_date||s.end_date)&&t.jsxs("div",{style:{fontSize:"10px",color:"#6c757d",marginTop:"2px"},children:[s.start_date&&t.jsxs("div",{children:["ğŸ“… Inicio: ",new Date(s.start_date).toLocaleDateString()]}),s.end_date&&t.jsxs("div",{children:["ğŸ Fin: ",new Date(s.end_date).toLocaleDateString()]})]})]});h(e,a)}},i.has("tags","image")&&{dataField:"image",caption:"Imagen Principal",width:"15%",allowSorting:!1,allowFiltering:!1,cellTemplate:(e,{data:s})=>{if($(e).empty(),s.image){const o=t.jsx("img",{src:`/storage/images/tag/${s.image}`,style:{width:"40px",height:"24px",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"},alt:"imagen principal"});h(e,o)}else e.text("Sin imagen")}},i.has("tags","menu")&&{dataField:"menu",caption:"MenÃº",dataType:"boolean",cellTemplate:(e,{data:s})=>{$(e).empty(),h(e,t.jsx(D,{checked:s.menu==1,onChange:()=>P({id:s.id,value:!s.menu})}))}},i.has("tags","visible")&&{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:s})=>{$(e).empty(),h(e,t.jsx(D,{checked:s.visible==1,onChange:()=>S({id:s.id,value:!s.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(E({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>y(s)})),e.append(E({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>k(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(q,{modalRef:n,title:T?"Editar Tag de Producto":"Agregar Tag de Producto",onSubmit:C,size:"lg",children:t.jsxs("div",{className:"row",id:"tags-container",children:[t.jsx("input",{ref:p,type:"hidden"}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-8",children:[t.jsx(_,{eRef:j,label:"Nombre del Tag",col:"col-12",required:!0,hidden:!i.has("tags","name")}),t.jsx(_,{eRef:b,label:"ToolTip",col:"col-12",hidden:!i.has("tags","description")})]}),t.jsx(F,{eRef:d,name:"icon",label:"Icono",col:"col-md-4",aspect:"6/5",hidden:!i.has("tags","icon")})]}),i.has("tags","start_date")&&i.has("tags","end_date")&&t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"alert alert-info mb-3",children:[t.jsxs("h6",{className:"alert-heading mb-2",children:[t.jsx("i",{className:"fas fa-calendar-alt me-2"}),"ConfiguraciÃ³n Promocional"]}),t.jsxs("div",{className:"row small",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx("p",{className:"mb-1",children:t.jsx("strong",{children:"ğŸ”„ Etiquetas Permanentes:"})}),t.jsx("p",{className:"mb-2",children:"Sin fechas â†’ Siempre visibles"}),t.jsx("p",{className:"mb-1",children:t.jsx("strong",{children:"ğŸ“… Etiquetas Promocionales:"})}),t.jsx("p",{className:"mb-0",children:"Con fechas â†’ Solo activas en el perÃ­odo especificado"})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx("p",{className:"mb-1",children:t.jsx("strong",{children:"Ejemplos de uso:"})}),t.jsxs("ul",{className:"mb-0 small",children:[t.jsx("li",{children:"Black Friday: 29/11/2024 - 02/12/2024"}),t.jsx("li",{children:"Cyber Monday: 02/12/2024 - 03/12/2024"}),t.jsx("li",{children:"Descuentos NavideÃ±os: 15/12/2024 - 25/12/2024"}),t.jsx("li",{children:"Ofertas de AÃ±o Nuevo: 26/12/2024 - 05/01/2025"})]})]})]})]})}),t.jsx("div",{className:"col-md-6",hidden:!i.has("tags","start_date"),children:t.jsxs("div",{className:"form-group mb-2",children:[t.jsxs("label",{className:"form-label",children:[t.jsx("i",{className:"fas fa-play-circle text-success me-1"}),"Fecha y Hora de Inicio"]}),t.jsx("input",{ref:g,type:"datetime-local",className:"form-control",placeholder:"Opcional: Fecha de inicio de la promociÃ³n"}),t.jsx("small",{className:"text-muted",children:"Opcional: Deja vacÃ­o para etiqueta permanente"})]})}),t.jsx("div",{className:"col-md-6",hidden:!i.has("tags","end_date"),children:t.jsxs("div",{className:"form-group mb-2",children:[t.jsxs("label",{className:"form-label",children:[t.jsx("i",{className:"fas fa-stop-circle text-danger me-1"}),"Fecha y Hora de Fin"]}),t.jsx("input",{ref:x,type:"datetime-local",className:"form-control",placeholder:"Opcional: Fecha de fin de la promociÃ³n"}),t.jsx("small",{className:"text-muted",children:"Opcional: Deja vacÃ­o para etiqueta permanente"})]})}),t.jsxs("div",{className:"row col-md-6",children:[t.jsx("div",{className:"col-md-6",hidden:!i.has("tags","background_color"),children:t.jsxs("div",{className:"form-group mb-2",children:[t.jsx("label",{className:"form-label",children:"Color de Fondo"}),t.jsx("input",{ref:v,type:"color",className:"form-control form-control-color",defaultValue:"#3b82f6"})]})}),t.jsx("div",{className:"col-md-6",hidden:!i.has("tags","text_color"),children:t.jsxs("div",{className:"form-group mb-2",children:[t.jsx("label",{className:"form-label",children:"Color de Texto"}),t.jsx("input",{ref:w,type:"color",className:"form-control form-control-color",defaultValue:"#ffffff"})]})})]}),t.jsx(F,{eRef:m,name:"image",label:"Imagen Principal (para otros fines)",col:"col-md-6",aspect:"16/9",hidden:!i.has("tags","image")})]})})]})};L((r,n)=>{z.createRoot(r).render(t.jsx(B,{...n,title:"Tags de Productos",children:t.jsx(K,{...n})}))});

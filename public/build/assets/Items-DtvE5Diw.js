import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as ke}from"./Base-_z9Mfb-K.js";import{S as T}from"./SwitchFormGroup-B-vmnVqk.js";import{T as Te}from"./TextareaFormGroup-CliirJM1.js";import{r as s}from"./index-BOnQTV8N.js";import{c as $e}from"./ReactAppend-DTVVXReZ.js";import{s as Q}from"./server.browser-Bf4gQIc7.js";import{S as _e}from"./ProductCard-Lp5WfZrB.js";import{I as de}from"./ItemsRest-C_YH-lNL.js";import{M as ce}from"./Modal-DElRB-QF.js";import{T as Ae}from"./Table-CKpi4A13.js";import{I as W}from"./ImageFormGroup-BXNZhx8I.js";import{I as y}from"./InputFormGroup-BRr_So2P.js";import{Q as Ee}from"./QuillFormGroup-ShbNmC_h.js";import{S as ae}from"./SelectAPIFormGroup-C9Lbnwxd.js";import{S as X}from"./SelectFormGroup-D4CwPTpm.js";import{D as ue}from"./DxButton-DV0H-ZcL.js";import{C as Pe}from"./CreateReactScript-BuAKasVo.js";import{N as me}from"./Number2Currency-e57Tgsuk.js";import{R as F}from"./ReactAppend-D7S498fx.js";import{S as pe}from"./SetSelectValue-UxyCmHse.js";import"./main-DKOTUah5.js";import{t as Ge}from"./index-DRg3WPTA.js";import"./index-yBjzXJbu.js";import"./Global-ErywZRdd.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-W0zm0J8x.js";import"./MenuItemContainer-CryEU9TY.js";import"./index.esm-0RgdCKj2.js";import"./index-Dq7h7Pqt.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./BasicRest-BCYKfs4R.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const fe=({label:w,structure:h,value:v=[],onChange:b,typeOptions:S=[]})=>{const[p,d]=s.useState([]),f=typeof h=="object"&&!Array.isArray(h);s.useEffect(()=>{d(f?v.map(i=>{var a,u;return{...i,type:((a=i.type)==null?void 0:a.charAt(0).toUpperCase())+((u=i.type)==null?void 0:u.slice(1).toLowerCase())}}):v.map(i=>typeof i=="object"?i.feature||"":i))},[v]);const N=()=>{const i=f?{...h}:"",a=[...p,i];d(a),b(a)},x=i=>{const a=p.filter((u,c)=>c!==i);d(a),b(a)},j=(i,a,u)=>{const c=[...p];f?c[i][a]=a==="type"?u.charAt(0).toUpperCase()+u.slice(1).toLowerCase():u:c[i]=u,d(c),b(c)},C=(i,a)=>i==="title"&&a==="Icono"?"Url de icono":i;return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:w}),p.map((i,a)=>r.jsx("div",{className:"row g-2 mb-2",children:f?r.jsxs(r.Fragment,{children:[Object.keys(h).map(u=>r.jsx("div",{className:"col",children:u==="type"?r.jsxs("select",{className:"form-select",value:i[u]||"",onChange:c=>j(a,u,c.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),S.map(c=>r.jsx("option",{value:c,children:c},c))]}):r.jsx("input",{type:"text",className:"form-control",value:i[u]||"",onChange:c=>j(a,u,c.target.value),placeholder:C(u,i.type)})},u)),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>x(a),children:"X"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"col",children:r.jsx("input",{type:"text",className:"form-control",value:i,onChange:u=>j(a,null,u.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>x(a),children:"X"})})]})},a)),r.jsx("button",{type:"button",className:"btn btn-primary mt-2",onClick:N,children:"+ Agregar"})]})},Be=new de,Me=({gridRef:w,modalRef:h})=>{const[v,b]=s.useState(null),[S,p]=s.useState(!1),[d,f]=s.useState(""),[N,x]=s.useState(!1),j=i=>{b(i.target.files[0])},C=async()=>{var a,u;if(!v){f("Por favor, selecciona un archivo."),x(!0);return}const i=new FormData;i.append("file",v),p(!0);try{const c=await Be.importData(i);if(console.log(c),c.error){const I=Array.isArray(c.error)?c.error.join(`
`):c.error;f(`Error en la importación:
${I}`),x(!0)}else f(c.message),x(!1),$(w.current).dxDataGrid("instance").refresh(),$(h.current).modal("hide"),Ge.success("Importacion completada con exito",{description:"Todos tus productos han sido importados correctamente.",duration:3e3,position:"bottom-center",richColors:!0})}catch(c){f("Error al importar: "+(((u=(a=c.response)==null?void 0:a.data)==null?void 0:u.error)||c.message)),x(!0)}p(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{className:"mb-1",children:r.jsx("a",{href:"/assets/img/salafabulosa/formato_import_products.xlsx",download:!0,children:"Descargar formato .xlsx"})}),r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:j})}),r.jsx("button",{onClick:C,disabled:S,className:"btn btn-primary mt-2",type:"button",children:S?"Subiendo...":"Subir Archivo"}),d&&r.jsx("div",{className:`alert ${N?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:d})})]})})},_=new de,Oe=({categories:w,brands:h,collections:v})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[b,S]=s.useState([]),p=s.useRef(),d=s.useRef(),f=s.useRef(),N=s.useRef(),x=s.useRef(),j=s.useRef(),C=s.useRef(),i=s.useRef(),a=s.useRef(),u=s.useRef(),c=s.useRef(),I=s.useRef(),B=s.useRef(),M=s.useRef(),A=s.useRef(),E=s.useRef(),O=s.useRef(),L=s.useRef(),U=s.useRef(),H=s.useRef(),q=s.useRef(),V=s.useRef(),ge=s.useRef([]),he=s.useRef([]),[xe,K]=s.useState(!1),[be,je]=s.useState(null),[Le,ve]=s.useState(null),[Y,Z]=s.useState(""),[P,R]=s.useState([]),ee=s.useRef(),Re=e=>{const l=Array.from(e.target.files).map(n=>({file:n,url:URL.createObjectURL(n)}));R(n=>[...n,...l])},ye=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(n=>({file:n,url:URL.createObjectURL(n)}));R(n=>[...n,...l])},we=e=>{e.preventDefault()},Ne=(e,t)=>{e.preventDefault(),P[t].id?R(n=>n.map((o,g)=>g===t?{...o,toDelete:!0}:o)):R(n=>n.filter((o,g)=>g!==t))};s.useEffect(()=>{if(b&&b.images){const e=b.images.map(t=>({id:t.id,url:`/storage/images/item/${t.url}`}));R(e)}},[b]);const re=e=>{var t,l,n;if(S(e||null),e!=null&&e.id?K(!0):K(!1),Z(e!=null&&e.pdf?`/storage/images/item/${e.pdf}`:""),f.current.value=(e==null?void 0:e.id)||"",$(N.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(x.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),pe(j.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(l=e==null?void 0:e.subcategory)==null?void 0:l.name),$(C.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),i.current.value=(e==null?void 0:e.name)||"",U.current.value=(e==null?void 0:e.sku)||"",a.current.value=(e==null?void 0:e.color)||"",u.current.value=(e==null?void 0:e.size)||"",c.current.value=(e==null?void 0:e.summary)||"",V.current.value=(e==null?void 0:e.linkvideo)||"",I.current.value=(e==null?void 0:e.price)||0,B.current.value=(e==null?void 0:e.discount)||0,pe(M.current,(e==null?void 0:e.tags)??[],"id","name"),A.current.value=null,E.current.value=null,A.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,E.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,O.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,Z(e!=null&&e.pdf?`/storage/images/item/${e==null?void 0:e.pdf}`:""),L.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const o=e.images.map(g=>({id:g.id,url:`/storage/images/item/${g.url}`}));R(o)}else R([]);e!=null&&e.specifications?z(e.specifications.map(o=>({type:o.type,title:o.title,description:o.description,image:o.image||""}))):z([]),se(((n=e==null?void 0:e.features)==null?void 0:n.map(o=>typeof o=="object"?o:{feature:o}))||[]),q.current.value=e==null?void 0:e.stock,$(d.current).modal("show")},Ce=async e=>{e.preventDefault();const t=te.filter(m=>{var k;return typeof m=="string"?m.trim()!=="":typeof m=="object"?((k=m.feature)==null?void 0:k.trim())!=="":!1}),l=ne.filter(m=>m.title&&m.title.trim()!==""||m.description&&m.description.trim()!==""),n={id:f.current.value||void 0,category_id:N.current.value,collection_id:x.current.value||null,subcategory_id:j.current.value,brand_id:C.current.value,name:i.current.value,sku:U.current.value,color:a.current.value,size:u.current.value,summary:c.current.value,price:I.current.value,discount:B.current.value,tags:$(M.current).val(),description:L.current.value,stock:q.current.value,features:t,specifications:l,linkvideo:V.current.value},o=new FormData;for(const m in n)m==="features"||m==="specifications"?o.append(m,JSON.stringify(n[m])):o.append(m,n[m]);const g=E.current.files[0];g&&o.append("image",g);const D=O.current.files[0];D&&o.append("texture",D);const oe=A.current.files[0];oe&&o.append("banner",oe);const ie=H.current.files[0];ie&&o.append("pdf",ie),P.forEach((m,k)=>{m.toDelete||(m.file?o.append(`gallery[${k}]`,m.file):o.append(`gallery_ids[${k}]`,m.id))});const le=P.filter(m=>m.toDelete).map(m=>parseInt(m.id,10));le.length>0&&o.append("deleted_images",JSON.stringify(le)),console.log(o),await _.save(o)&&($(p.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"),R([]))},Se=async({id:e,value:t})=>{await _.boolean({id:e,field:"visible",value:t})&&$(p.current).dxDataGrid("instance").refresh()},G=async({id:e,field:t,value:l})=>{await _.boolean({id:e,field:t,value:l})&&$(p.current).dxDataGrid("instance").refresh()},Fe=async e=>{const{isConfirmed:t}=await _e.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await _.delete(e)||$(p.current).dxDataGrid("instance").refresh()},[te,se]=s.useState([]),[ne,z]=s.useState([]),Ie=["Principal","General","Icono"],[Ue,qe]=s.useState(!1),J=s.useRef(),De=()=>{$(J.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Ae,{gridRef:p,title:"Items",rest:_,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>re()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>De()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var l,n,o;e.html(Q.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(l=t.collection)==null?void 0:l.name}),r.jsx("b",{className:"d-block",children:(n=t.category)==null?void 0:n.name}),r.jsx("small",{className:"text-muted",children:(o=t.subcategory)==null?void 0:o.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:t})=>{const n=((o,g)=>{if(!o)return"";const D=o.split(" ");return D.length>g?D.slice(0,g).join(" ")+"...":o})(t.summary,12);e.html(Q.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{children:n})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(Q.renderToString(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",me(t.price)]}),r.jsxs("span",{children:["S/.",me(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{F(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.is_new===1||t.is_new==="1"||t.is_new===!0;F(e,r.jsx(T,{checked:l,onChange:n=>G({id:t.id,field:"is_new",value:n.target.checked?1:0})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.offering===1||t.offering==="1"||t.offering===!0;F(e,r.jsx(T,{checked:l,onChange:n=>G({id:t.id,field:"offering",value:n.target.checked?1:0})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.recommended===1||t.recommended==="1"||t.recommended===!0;F(e,r.jsx(T,{checked:l,onChange:n=>G({id:t.id,field:"recommended",value:n.target.checked?1:0})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.featured===1||t.featured==="1"||t.featured===!0;F(e,r.jsx(T,{checked:l,onChange:n=>G({id:t.id,field:"featured",value:n.target.checked?1:0})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{F(e,r.jsx(T,{checked:t.visible,onChange:l=>Se({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(ue({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>re(t)})),e.append(ue({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Fe(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(ce,{modalRef:d,title:xe?"Editar curso":"Agregar curso",onSubmit:Ce,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:f,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(y,{eRef:U,label:"SKU",required:!0}),r.jsx(X,{eRef:N,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>je(e.target.value),children:w.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(X,{eRef:x,label:"Colección",dropdownParent:"#principal-container",onChange:e=>ve(e.target.value),children:v.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(ae,{eRef:j,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",be],dropdownParent:"#principal-container"}),r.jsx(X,{eRef:C,label:"Marca",dropdownParent:"#principal-container",children:h.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(y,{label:"Stock",eRef:q,type:"number"}),r.jsx(y,{eRef:I,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(y,{eRef:B,label:"Descuento",type:"number",step:"0.01"}),r.jsx(ae,{id:"tags",eRef:M,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-5",children:[r.jsx(y,{eRef:i,label:"Nombre",required:!0}),r.jsx(y,{eRef:a,label:"Color",required:!0}),r.jsx(y,{eRef:u,label:"Talla",required:!0}),r.jsxs("div",{className:"col-12",children:[r.jsx("label",{className:"form-label",children:"Archivo PDF"}),r.jsx("input",{ref:H,type:"file",className:"form-control",accept:".pdf"}),r.jsx("small",{className:"text-muted",children:"Subir documento PDF relacionado al producto"})]}),Y&&r.jsx("div",{className:"my-2",children:r.jsxs("a",{href:Y,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline-primary",children:[r.jsx("i",{className:"fas fa-file-pdf me-1"})," Ver PDF actual"]})}),r.jsx(y,{eRef:V,label:"Link de video"}),r.jsx(W,{eRef:O,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsx(Te,{eRef:c,label:"Resumen",rows:3}),r.jsx(fe,{ref:ge,label:"Características",structure:"",value:te,onChange:se}),r.jsx(fe,{ref:he,label:"Especificaciones",structure:{type:"",title:"",description:""},value:ne,onChange:z,typeOptions:Ie})]}),r.jsx("div",{className:"col-md-4",children:r.jsxs("div",{className:"row",children:[r.jsx(W,{eRef:A,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(W,{eRef:E,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:ee,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Re}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>ee.current.click(),onDrop:ye,onDragOver:we,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:P.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>Ne(l,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Ee,{eRef:L,label:"Descripcion"})]}),r.jsx(ce,{modalRef:J,title:"Importar Datos",size:"sm",children:r.jsx(Me,{gridRef:p,modalRef:J})})]})};Pe((w,h)=>{$e.createRoot(w).render(r.jsx(ke,{...h,title:"Items",children:r.jsx(Oe,{...h})}))});

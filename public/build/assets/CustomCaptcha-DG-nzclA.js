import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as s}from"./index-BOnQTV8N.js";import{a as k}from"./index-ngrFHoWO.js";import{L as I}from"./loader-circle-CSFYLd5m.js";import{R as S}from"./refresh-cw-Dp9ubuxa.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./createLucideIcon-DfjclApS.js";s.forwardRef(({onVerify:o,error:x},L)=>{const[v,A]=s.useState(""),[j,y]=s.useState(""),[b,l]=s.useState(!1),[w,T]=s.useState(""),[i,m]=s.useState(!1),[f,c]=s.useState(""),[h,N]=s.useState(5),[H,E]=s.useState(Date.now()),C=s.useRef(!1),p=async()=>{var r,n,d;m(!0),c(""),y(""),l(!1),N(5),o(!1,null);try{const a=await k.post("/api/captcha/generate"),{token:g,image:u}=a.data;T(g),A(u),E(Date.now())}catch(a){((r=a.response)==null?void 0:r.status)===429?c("Demasiados intentos. Por favor, espera un momento e intenta nuevamente."):c(((d=(n=a.response)==null?void 0:n.data)==null?void 0:d.error)||"Error al cargar CAPTCHA. Intenta nuevamente."),console.error("Error generando CAPTCHA:",a)}finally{m(!1)}};s.useImperativeHandle(L,()=>({reset:p})),s.useEffect(()=>{C.current||(C.current=!0,p())},[]);const R=async r=>{var d,a,g;const n=r.target.value;if(y(n),c(""),n.length===6){m(!0);try{(await k.post("/api/captcha/verify",{token:w,answer:n})).data.success?(l(!0),o(!0,w)):(l(!1),o(!1,null))}catch(u){const t=(d=u.response)==null?void 0:d.data;l(!1),o(!1,null),(t==null?void 0:t.attempts_remaining)!==void 0&&N(t.attempts_remaining),c((t==null?void 0:t.error)||"Error al verificar CAPTCHA"),((a=u.response)==null?void 0:a.status)===400&&((g=t==null?void 0:t.error)!=null&&g.includes("expirado"))&&setTimeout(()=>p(),2e3)}finally{m(!1)}}else l(!1),o(!1,null)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark mb-2",children:"Verificación de seguridad"}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative min-w-[300px]",children:i&&!v?e.jsx("div",{className:"bg-gray-100 border-2 border-gray-300 rounded-lg px-6 py-4 h-[100px] flex items-center justify-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-gray-400"})}):e.jsx("img",{src:v,alt:"CAPTCHA",className:"border-2 border-gray-300 rounded-lg select-none pointer-events-none",draggable:"false",onContextMenu:r=>r.preventDefault()})}),e.jsx("button",{type:"button",onClick:p,disabled:i,className:"flex items-center justify-center p-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",title:"Generar nuevo código",children:e.jsx(S,{className:`w-5 h-5 text-gray-600 group-hover:rotate-180 transition-transform duration-300 ${i?"animate-spin":""}`})})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",value:j,onChange:R,disabled:i,placeholder:"Ingresa el código de 6 caracteres",maxLength:6,className:`w-full px-4 py-3 border rounded-xl font-mono text-lg tracking-wider focus:ring-2 focus:outline-none transition-all duration-300 uppercase disabled:bg-gray-50 disabled:cursor-not-allowed ${b?"border-primary customtext-primary":x||f?"border-red-500 bg-red-50 focus:ring-red-200":"border-gray-300 focus:ring-blue-200"}`}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:i&&j.length===6?e.jsx(I,{className:"w-6 h-6 animate-spin text-gray-400"}):b?e.jsx("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}):null})]}),(x||f)&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),x||f]}),h<5&&h>0&&e.jsxs("p",{className:"text-orange-600 text-xs",children:["Intentos restantes: ",h]})]})]})]}),e.jsx("p",{className:"text-xs customtext-neutral-light",children:"Ingresa exactamente el código que aparece en la imagen. No distingue entre mayúsculas y minúsculas."})]})});

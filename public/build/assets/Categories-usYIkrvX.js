var e=Object.defineProperty,a=(a,s,t)=>((a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t)(a,"symbol"!=typeof s?s+"":s,t);import{r as s,j as t,P as r,I as n,b as i,d as l,T as c,c as o}from"./vendor-react-CZUvQwNQ.js";import{B as d}from"./Base-BE1X8Lb3.js";import{S as m}from"./SwitchFormGroup-CA4b2Uj0.js";import{T as u}from"./TextareaFormGroup-dfKTDx8M.js";import{S as g}from"./CartKuchara-C7vqSevl.js";import{B as b}from"./BasicRest-K-34csnH.js";import{I as p}from"./ImageFormGroup-DlJufE2S.js";import{S as h}from"./SelectAPIFormGroup-Dmb18ATV.js";import{M as f}from"./Modal-MmI0jF6v.js";import{T as x}from"./Table-Cynp-rvu.js";import{D as j}from"./DxButton-C6FT_beP.js";import{C as v,F as N,h as y}from"./CreateReactScript-DMiuD_MQ.js";import{R as w}from"./ReactAppend-Db2K6xCH.js";import{B as R}from"./BooleanLimit-q2Ad9fGY.js";import{I as F}from"./InputFormGroup-BuXn3s3l.js";import{S as C}from"./SetSelectValue-DCHQOIKz.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-DAm0kDL9.js";import"./TippyButton-Gia9IjJq.js";import"./Logout-D6byb_Ua.js";import"./MenuItemContainer-BaCqn8PU.js";import"./Menu-DboRETzC.js";import"./OpenPayCardModal-BHkRoVZ6.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";const B=s.forwardRef(({name:e="banners",label:a="Banners",initialValue:o=[],model:d="category"},m)=>{const[u,b]=s.useState([]),[h,f]=s.useState({}),x=s.useRef({});s.useImperativeHandle(m,()=>({getValue:()=>JSON.stringify(u),setValue:e=>{try{const a="string"==typeof e?JSON.parse(e):e;if(b(Array.isArray(a)?a:[]),Array.isArray(a)&&a.length>0){const e={};a.forEach((a,s)=>{e[s]=!0}),f(e)}}catch(a){b([])}},reset:()=>{b([]),x.current={}},getImageRefs:()=>x.current,getImageFiles:()=>{const e={};return Object.keys(x.current).forEach(a=>{const s=x.current[a];s?.current?.files?.[0]&&(e[`banner_image_${a}`]=s.current.files[0])}),e}}));const j=(e,a)=>{const s="up"===a?e-1:e+1;if(s<0||s>=u.length)return;const t=[...u];[t[e],t[s]]=[t[s],t[e]],b(t);const r=x.current[e];x.current[e]=x.current[s],x.current[s]=r;const n=h[e],i=h[s];f({...h,[e]:i,[s]:n})},v=(e,a,s)=>{const t=[...u];t[e]={...t[e],[a]:s},b(t)};return t.jsxs("div",{className:"form-group",children:[t.jsx("label",{className:"font-weight-bold mb-2",children:a}),t.jsxs("div",{className:"border rounded p-3 bg-light",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsxs("small",{className:"text-muted",children:[u.length," banner",1!==u.length?"s":""," configurado",1!==u.length?"s":""]}),t.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{const e=[...u,{image:"",title:"",description:"",button_text:"",button_link:""}];b(e),f({...h,[e.length-1]:!0}),x.current[e.length-1]={current:null}},children:[t.jsx(r,{size:16,className:"mr-1"}),"Agregar Banner"]})]}),0===u.length?t.jsxs("div",{className:"text-center py-4 text-muted",children:[t.jsx(n,{size:48,className:"mb-2 opacity-50",style:{display:"block",margin:"0 auto"}}),t.jsx("p",{className:"mb-0",children:"No hay banners configurados"}),t.jsx("small",{children:'Haz clic en "Agregar Banner" para comenzar'})]}):t.jsx("div",{className:"space-y-2",children:u.map((e,a)=>t.jsxs("div",{className:"card mb-2 shadow-sm",children:[t.jsxs("div",{className:"card-header bg-white d-flex justify-content-between align-items-center p-2",children:[t.jsxs("button",{type:"button",className:"btn btn-link text-left flex-grow-1 text-decoration-none p-2",onClick:()=>(e=>{f({...h,[e]:!h[e]})})(a),children:[t.jsxs("strong",{children:["Banner ",a+1]}),e.title&&t.jsxs("small",{className:"text-muted ml-2",children:["- ",e.title]})]}),t.jsxs("div",{className:"d-flex gap-1",children:[a>0&&t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>j(a,"up"),title:"Mover arriba",children:t.jsx(i,{size:14})}),a<u.length-1&&t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>j(a,"down"),title:"Mover abajo",children:t.jsx(l,{size:14})}),t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>(async e=>{const{isConfirmed:a}=await g.fire({title:"¿Eliminar banner?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(a){const a=u.filter((a,s)=>s!==e);b(a),delete x.current[e];const s={};Object.keys(x.current).forEach(a=>{const t=parseInt(a);t>e?s[t-1]=x.current[a]:t<e&&(s[t]=x.current[a])}),x.current=s;const t={};Object.keys(h).forEach(a=>{const s=parseInt(a);s<e?t[s]=h[a]:s>e&&(t[s-1]=h[a])}),f(t)}})(a),title:"Eliminar",children:t.jsx(c,{size:14})})]})]}),h[a]&&t.jsx("div",{className:"card-body p-3",children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx(p,{eRef:(x.current[a]||(x.current[a]={current:null}),x.current[a]),name:`banner_image_${a}`,label:"Imagen del Banner",col:"col-12",aspect:16/9,onChange:e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];v(a,"image",s.name)}}}),e.image&&t.jsxs("small",{className:"text-muted d-block mt-2",children:["Archivo actual: ",t.jsx("strong",{children:e.image})]})]}),t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Título"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Título del banner",value:e.title||"",onChange:e=>v(a,"title",e.target.value)})]}),t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Descripción"}),t.jsx("textarea",{className:"form-control form-control-sm",rows:"3",placeholder:"Descripción del banner",value:e.description||"",onChange:e=>v(a,"description",e.target.value)})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Texto del Botón"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Ver más",value:e.button_text||"",onChange:e=>v(a,"button_text",e.target.value)})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Link del Botón"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"/ruta-destino",value:e.button_link||"",onChange:e=>v(a,"button_link",e.target.value)})]})]})})]},`banner-${a}-${e.image||"new"}`))})]}),t.jsx("input",{type:"hidden",name:e,value:JSON.stringify(u)})]})});B.displayName="BannersJsonEditor";const k=new class extends b{constructor(){super(...arguments),a(this,"path","admin/categories"),a(this,"hasFiles",!0)}},D=()=>{const e=s.useRef(),a=s.useRef(),r="categories",n=s.useRef(),i=s.useRef(),l=s.useRef(),c=s.useRef(),o=s.useRef(),d=s.useRef(),b=s.useRef(),v=s.useRef(),[D,E]=s.useState(!1),T=e=>{if(E(!!e?.id),n.current.value=e?.id??"",i.current.value=e?.name??"",l.current.value=e?.alias??"",c.current.value=e?.description??"",o.current&&o.image&&(o.image.src=e?.banner?`/storage/images/category/${e.banner}`:"",o.current.value=null,o.resetDeleteFlag&&o.resetDeleteFlag()),d.current&&d.image&&(d.image.src=e?.image?`/storage/images/category/${e.image}`:"",d.current.value=null,d.resetDeleteFlag&&d.resetDeleteFlag()),b.current&&N.has("categories","banners")){let a=e?.banners||[];if("string"==typeof a)try{a=JSON.parse(a)}catch(s){a=[]}b.current.setValue(a);const t=(e=1)=>{const s=b.current.getImageRefs();let r=!0;a.forEach((e,a)=>{if(e.image){const t=s[a];t?.image?t.image.src=`/storage/images/category/${e.image}`:r=!1}}),!r&&e<5&&setTimeout(()=>t(e+1),300)};setTimeout(()=>t(),500)}v.current&&N.has("categories","stores")&&C(v.current,e?.stores??[],"id","name"),$(a.current).modal("show")};return t.jsxs(t.Fragment,{children:[t.jsx(x,{gridRef:e,title:"Categorías",rest:k,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>T()}})},rowDragging:{allowReordering:!0,onReorder:async e=>{const a=e.toIndex;try{await k.reorder(e.itemData.id,a)&&await e.component.refresh()}catch(s){}},dropFeedbackMode:"push"},sorting:{mode:"single"},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"order_index",caption:"Orden",visible:!1,sortOrder:"asc",sortIndex:0},{dataField:"name",caption:"Categoría",width:"30%"},{dataField:"description",caption:"Descripción",width:"50%"},N.has("categories","image")&&{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:a})=>{w(e,t.jsx("img",{src:`/storage/images/category/${a.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},N.has("categories","banner")&&{dataField:"banner",caption:"Banner",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:a})=>{w(e,t.jsx("img",{src:`/storage/images/category/${a.banner}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:e=>e.target.src="/api/cover/thumbnail/null"}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(a,{data:s})=>{$(a).empty();const n=1==s.featured,i=R.has(r,"featured")&&R.shouldBlock(r,"featured",n),l=i?R.getMessage(r,"featured"):null;l?$(a).attr("title",l):$(a).removeAttr("title"),w(a,t.jsx(m,{checked:n,disabled:i,onChange:()=>(async({id:a,value:s,previous:t})=>{if(s&&R.shouldBlock(r,"featured",t)){const e=R.get(r,"featured");let a=e?.message??"Se alcanzó el límite de categorías destacadas.";return e&&(a+=` Actualmente hay ${e.active??0} de ${e.max??0} categorías activas.`,y("Root")&&e.general_key&&(a+=` Puedes ajustar el límite en Generales usando la clave ${e.general_key}.`)),void g.fire({icon:"warning",title:"Límite alcanzado",text:a})}const n=await k.boolean({id:a,field:"featured",value:s});n&&(R.has(r,"featured")&&("object"==typeof n&&n?.limit?R.updateFromServer(r,n):R.applyChange(r,"featured",{previous:t,next:s})),$(e.current).dxDataGrid("instance").refresh())})({id:s.id,value:!n,previous:n})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(a,{data:s})=>{$(a).empty(),w(a,t.jsx(m,{checked:1==s.visible,onChange:()=>(async({id:a,value:s})=>{await k.boolean({id:a,field:"visible",value:s})&&$(e.current).dxDataGrid("instance").refresh()})({id:s.id,value:!s.visible})}))}},{caption:"Acciones",cellTemplate:(a,{data:s})=>{a.css("text-overflow","unset"),a.append(j({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>T(s)})),a.append(j({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async a=>{const{isConfirmed:s}=await g.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});if(!s)return;await k.delete(a.id)&&(R.has(r,"featured")&&a.featured&&R.applyChange(r,"featured",{previous:!0,next:!1}),$(e.current).dxDataGrid("instance").refresh())})(s)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(f,{modalRef:a,title:D?"Editar categoría":"Agregar categoría",onSubmit:async s=>{s.preventDefault();const t={id:n.current.value||void 0,name:i.current.value,alias:l.current.value,description:c.current.value},r=new FormData;for(const e in t)r.append(e,t[e]);if(d.current&&N.has("categories","image")){const e=d.current.files[0];e&&r.append("image",e),d.getDeleteFlag&&d.getDeleteFlag()&&r.append("image_delete","DELETE")}if(o.current&&N.has("categories","banner")){const e=o.current.files[0];e&&r.append("banner",e),o.getDeleteFlag&&o.getDeleteFlag()&&r.append("banner_delete","DELETE")}if(b.current&&N.has("categories","banners")){r.append("banners",b.current.getValue());const e=b.current.getImageFiles();Object.keys(e).forEach(a=>{r.append(a,e[a])})}if(v.current&&N.has("categories","stores")){const e=$(v.current).val();e&&e.length>0?r.append("stores",JSON.stringify(e)):r.append("stores",JSON.stringify([]))}for(let[e,a]of r.entries());await k.save(r)&&(o.current&&o.resetDeleteFlag&&o.resetDeleteFlag(),d.current&&d.resetDeleteFlag&&d.resetDeleteFlag(),$(e.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},size:"xl",children:[t.jsx("input",{ref:n,type:"hidden"}),t.jsxs("div",{id:"categories-container",children:[t.jsxs("ul",{className:"nav nav-pills nav-justified mb-4",role:"tablist",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",padding:"4px",border:"1px solid #e9ecef"},children:[t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:"nav-link active",id:"basic-info-tab","data-bs-toggle":"pill","data-bs-target":"#basic-info",type:"button",role:"tab","aria-controls":"basic-info","aria-selected":"true",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[t.jsx("i",{className:"fas fa-info-circle me-2"}),"Información Básica"]})}),(N.has("categories","banner")||N.has("categories","image"))&&t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:"nav-link",id:"multimedia-tab","data-bs-toggle":"pill","data-bs-target":"#multimedia",type:"button",role:"tab","aria-controls":"multimedia","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[t.jsx("i",{className:"fas fa-images me-2"}),"Multimedia"]})}),N.has("categories","banners")&&t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:"nav-link",id:"banners-tab","data-bs-toggle":"pill","data-bs-target":"#banners",type:"button",role:"tab","aria-controls":"banners","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[t.jsx("i",{className:"fas fa-panorama me-2"}),"Banners del Catálogo"]})}),N.has("categories","stores")&&t.jsx("li",{className:"nav-item",role:"presentation",children:t.jsxs("button",{className:"nav-link",id:"stores-tab","data-bs-toggle":"pill","data-bs-target":"#stores",type:"button",role:"tab","aria-controls":"stores","aria-selected":"false",style:{borderRadius:"6px",fontWeight:"500",transition:"all 0.3s ease"},children:[t.jsx("i",{className:"fas fa-store me-2"}),"Ubicaciones"]})})]}),t.jsxs("div",{className:"tab-content",children:[t.jsx("div",{className:"tab-pane fade show active",id:"basic-info",role:"tabpanel","aria-labelledby":"basic-info-tab",children:t.jsx("div",{className:"row g-3",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card border-0 shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"fas fa-tag me-2 text-primary"}),"Identificación"]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-md-6",children:t.jsx(F,{eRef:i,label:"Nombre de la Categoría",placeholder:"Ej: Electrónica",required:!0})}),t.jsx("div",{className:"col-md-6",children:t.jsx(F,{eRef:l,label:"Alias (Nombre para mostrar)",placeholder:"Ej: Tecnología y Electrónica"})}),t.jsx("div",{className:"col-12",children:t.jsx(u,{eRef:c,label:"Descripción",rows:4,placeholder:"Descripción detallada de la categoría..."})})]})})]})})})}),(N.has("categories","banner")||N.has("categories","image"))&&t.jsx("div",{className:"tab-pane fade",id:"multimedia",role:"tabpanel","aria-labelledby":"multimedia-tab",children:t.jsx("div",{className:"row g-3",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card border-0 shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"fas fa-images me-2 text-success"}),"Imágenes Principales"]})}),t.jsx("div",{className:"card-body",children:t.jsxs("div",{className:"row g-3",children:[N.has("categories","banner")&&t.jsxs("div",{className:"col-md-6",children:[t.jsx(p,{eRef:o,name:"banner",label:"Banner Principal",col:"col-12",aspect:16/9}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"fas fa-info-circle me-1"}),"Recomendado: 1600x900px (proporción 16:9)"]})]}),N.has("categories","image")&&t.jsxs("div",{className:"col-md-6",children:[t.jsx(p,{eRef:d,name:"image",label:"Imagen de Portada",col:"col-12",aspect:16/9}),t.jsxs("small",{className:"text-muted",children:[t.jsx("i",{className:"fas fa-info-circle me-1"}),"Recomendado: 1600x900px (proporción 16:9)"]})]})]})})]})})})}),N.has("categories","banners")&&t.jsx("div",{className:"tab-pane fade",id:"banners",role:"tabpanel","aria-labelledby":"banners-tab",children:t.jsx("div",{className:"row g-3",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card border-0 shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"fas fa-panorama me-2 text-info"}),"Banners Personalizados del Catálogo"]})}),t.jsx("div",{className:"card-body",children:t.jsx(B,{ref:b,name:"banners",label:"Banners del Catálogo",initialValue:[],model:"category"})})]})})})}),N.has("categories","stores")&&t.jsx("div",{className:"tab-pane fade",id:"stores",role:"tabpanel","aria-labelledby":"stores-tab",children:t.jsx("div",{className:"row g-3",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card border-0 shadow-sm",children:[t.jsx("div",{className:"card-header bg-light",children:t.jsxs("h6",{className:"mb-0",children:[t.jsx("i",{className:"fas fa-store me-2 text-warning"}),"Ubicaciones y Tiendas"]})}),t.jsxs("div",{className:"card-body",children:[t.jsx(h,{id:"stores",eRef:v,searchAPI:"/api/admin/stores/paginate",searchBy:"name",label:"Ubicaciones (Tiendas)",dropdownParent:"#categories-container",tags:!0,multiple:!0}),t.jsxs("small",{className:"text-muted mt-2 d-block",children:[t.jsx("i",{className:"fas fa-info-circle me-1"}),"Selecciona las tiendas donde esta categoría estará disponible"]})]})]})})})})]})]})]})]})};v((e,a)=>{o.createRoot(e).render(t.jsx(d,{...a,title:"Categorías",children:t.jsx(D,{...a})}))});

import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as l}from"./index-BH53Isel.js";import{c as I}from"./ReactAppend-DTVVXReZ.js";import{s as a}from"./server.browser-Bf4gQIc7.js";import{S as _}from"./StoresRest-B0mOUL_h.js";import{C as H}from"./CreateReactScript-BoGwggCx.js";import{B as A}from"./Base-CK06_Hp4.js";import{T as J}from"./Table-DitbKwtZ.js";import{M as L}from"./Modal-CIqmjseY.js";import{I as i}from"./InputFormGroup-D5I6zpZc.js";import{T as q}from"./TextareaFormGroup-DVzYJtLM.js";import{I as O}from"./ImageFormGroup-BPR9pDAU.js";import{S as U}from"./SwitchFormGroup-CGYpv_4Q.js";import{S as V}from"./SelectFormGroup-YqB1XVb8.js";import{D as k}from"./DxButton-DV0H-ZcL.js";import{S as z}from"./ProductCard-Ap6bpF1Q.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./BasicRest-B3rfI5GY.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";import"./Global-ErywZRdd.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-C_dOKkRB.js";const E=new _,P=({ubigeos:c=[]})=>{const n=l.useRef(),f=l.useRef(),d=l.useRef(),h=l.useRef(),x=l.useRef(),g=l.useRef(),b=l.useRef(),j=l.useRef(),m=l.useRef(),v=l.useRef(),R=l.useRef(),u=l.useRef(),p=l.useRef();l.useRef();const N=l.useRef(),y=l.useRef(),[B,F]=l.useState(!1),[w,S]=l.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),C=e=>{if(console.log(e),e!=null&&e.id?F(!0):F(!1),d.current.value=(e==null?void 0:e.id)??"",h.current.value=(e==null?void 0:e.name)??"",x.current.value=(e==null?void 0:e.address)??"",g.current.value=(e==null?void 0:e.phone)??"",b.current.value=(e==null?void 0:e.email)??"",j.current.value=(e==null?void 0:e.description)??"",v.current.value=(e==null?void 0:e.latitude)??"",R.current.value=(e==null?void 0:e.longitude)??"",N.current.value=(e==null?void 0:e.manager)??"",y.current.value=(e==null?void 0:e.capacity)??"",$(m.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),p.current&&(p.current.checked=(e==null?void 0:e.status)??!0),e!=null&&e.business_hours)try{const r=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours;S(r)}catch(r){console.error("Error parsing business hours:",r)}else S([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);$(f.current).modal("show")},G=async e=>{e.preventDefault(),c.find(t=>t.reniec==m.current.value);const r=new FormData;d.current.value&&r.append("id",d.current.value),r.append("name",h.current.value),r.append("address",x.current.value),r.append("phone",g.current.value),r.append("email",b.current.value),r.append("description",j.current.value),r.append("ubigeo",m.current.value),r.append("latitude",v.current.value),r.append("longitude",R.current.value),r.append("manager",N.current.value),r.append("capacity",y.current.value),r.append("status",p.current.checked?1:0),r.append("business_hours",JSON.stringify(w)),u.current&&u.current.files[0]&&r.append("image",u.current.files[0]),await E.save(r)&&($(n.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},M=async e=>{const{isConfirmed:r}=await z.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await E.delete(e)||$(n.current).dxDataGrid("instance").refresh()},T=(e,r,o)=>{const t=[...w];t[e][r]=o,S(t)},D=e=>$(a.renderToString(s.jsxs("span",{children:[s.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),s.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]})));return s.jsxs(s.Fragment,{children:[s.jsx(J,{gridRef:n,title:"Tiendas / Sucursales",rest:E,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>C()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",cellTemplate:(e,{data:r})=>{r.image?e.html(a.renderToString(s.jsx("img",{src:`/storage/images/stores/${r.image}`,alt:r.name,className:"img-thumbnail",style:{width:"50px",height:"50px",objectFit:"cover"}}))):e.html(a.renderToString(s.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:s.jsx("i",{className:"fas fa-store text-muted"})})))},allowExporting:!1},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"address",caption:"Dirección",width:"250px"},{dataField:"phone",caption:"Teléfono",width:"120px"},{dataField:"email",caption:"Email",width:"180px"},{dataField:"manager",caption:"Encargado",width:"150px"},{dataField:"ubigeo",caption:"Ubicación",width:"150px",cellTemplate:(e,{data:r})=>{const o=c.find(t=>t.reniec==r.ubigeo);o?e.html(a.renderToString(s.jsxs("div",{children:[s.jsx("small",{className:"d-block",children:o.distrito}),s.jsxs("small",{className:"text-muted",children:[o.provincia,", ",o.departamento]})]}))):e.text(r.ubigeo||"Sin ubicación")}},{dataField:"status",caption:"Estado",width:"100px",cellTemplate:(e,{data:r})=>{e.html(a.renderToString(s.jsx("span",{className:`badge ${r.status?"bg-success":"bg-danger"}`,children:r.status?"Activa":"Inactiva"})))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(k({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>C(r)})),e.append(k({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>M(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsxs(L,{modalRef:f,title:B?"Editar Tienda":"Agregar Tienda",onSubmit:G,size:"lg",children:[s.jsx("input",{ref:d,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:h,label:"Nombre de la tienda",col:"col-12",required:!0})}),s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:N,label:"Encargado",col:"col-12"})}),s.jsx("div",{className:"col-12",children:s.jsx(i,{eRef:x,label:"Dirección completa",col:"col-12",required:!0})}),s.jsx(V,{eRef:m,label:"Distrito/Ubigeo",templateResult:D,templateSelection:D,dropdownParent:"#form-container",required:!0,children:c.map((e,r)=>s.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))}),s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:g,label:"Teléfono",col:"col-12",type:"tel"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:b,label:"Email",col:"col-12",type:"email"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:v,label:"Latitud (Google Maps)",col:"col-12",type:"number",step:"any",placeholder:"Ej: -12.0464"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:R,label:"Longitud (Google Maps)",col:"col-12",type:"number",step:"any",placeholder:"Ej: -77.0428"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(i,{eRef:y,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(U,{eRef:p,label:"Tienda activa",col:"col-12"})}),s.jsx("div",{className:"col-12",children:s.jsx(O,{eRef:u,label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),s.jsx("div",{className:"col-12",children:s.jsx(q,{eRef:j,label:"Descripción",rows:3})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Horarios de atención"}),s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table table-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Día"}),s.jsx("th",{children:"Apertura"}),s.jsx("th",{children:"Cierre"}),s.jsx("th",{children:"Cerrado"})]})}),s.jsx("tbody",{children:w.map((e,r)=>s.jsxs("tr",{children:[s.jsx("td",{className:"align-middle",children:s.jsx("strong",{children:e.day})}),s.jsx("td",{children:s.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:o=>T(r,"open",o.target.value),disabled:e.closed})}),s.jsx("td",{children:s.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:o=>T(r,"close",o.target.value),disabled:e.closed})}),s.jsx("td",{children:s.jsxs("div",{className:"form-check",children:[s.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:o=>T(r,"closed",o.target.checked)}),s.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},r))})]})})]})})]})]})]})};H((c,n)=>{I.createRoot(c).render(s.jsx(A,{...n,title:"Tiendas / Sucursales",children:s.jsx(P,{...n})}))});

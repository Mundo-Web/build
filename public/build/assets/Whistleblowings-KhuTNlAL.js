var e=Object.defineProperty,a=(a,s,i)=>((a,s,i)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[s]=i)(a,"symbol"!=typeof s?s+"":s,i);import{c as s,j as i,r as t}from"./vendor-react-DD0uBW7s.js";import{B as n}from"./Base-DQk4WKCZ.js";import{C as r}from"./CreateReactScript-C92mMLGn.js";import{T as c}from"./Table-CLY50rKz.js";import{D as d}from"./DxButton-C6FT_beP.js";import{R as o}from"./ReactAppend-D5wf6JB3.js";import{B as l}from"./BasicRest-BuuGWTMX.js";import{M as m}from"./Modal-DUl7LQD_.js";import{S as h}from"./CartKuchara-BG_NtHiU.js";import"./vendor-swiper-BQwfPLwm.js";import"./Global-BAGAPG-V.js";import"./TippyButton-BXJTBPrK.js";import"./Logout-CJj-4dQc.js";import"./MenuItemContainer--0h9gV_W.js";import"./Menu-Cmvatiox.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";import"./GoogleSignInButton-BciphYP2.js";const p=new class extends l{constructor(){super(...arguments),a(this,"path","admin/whistleblowings")}},x=()=>{const e=t.useRef(),a=t.useRef(),[s,n]=t.useState(null),[r,l]=t.useState(""),x=e=>{n(e),l(e.notas_admin||""),$(a.current).modal("show")},j=async(a,s)=>{await p.save({id:a,estado:s})&&$(e.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(c,{gridRef:e,title:"Denuncias",rest:p,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"nombre",caption:"Nombre",cellTemplate:(e,{data:a})=>{o(e,i.jsx("span",{style:{cursor:"pointer",color:"#007bff",textDecoration:"underline"},onClick:()=>x(a),children:a.nombre}))}},{dataField:"email",caption:"Email"},{dataField:"ambito",caption:"Ámbito",cellTemplate:(e,{data:a})=>{const s={Laboral:"primary","Ético":"warning","Técnico u operativo":"info","Comercial o ventas":"success",Seguridad:"danger","Discriminación o acoso":"dark",Otro:"secondary"}[a.ambito]||"secondary";o(e,i.jsx("span",{className:`badge bg-${s} rounded-pill`,children:a.ambito}))}},{dataField:"relacion_compania",caption:"Relación",width:120},{dataField:"departamento",caption:"Departamento",width:120},{dataField:"estado",caption:"Estado",cellTemplate:(e,{data:a})=>{const s=`\n                            <select class="form-select form-select-sm bg-${{Pendiente:"warning","En revisión":"info",Resuelta:"success",Archivada:"secondary"}[a.estado]||"secondary"} text-white border-0" \n                                    onchange="window.handleStatusChange('${a.id}', this.value)"\n                                    style="cursor: pointer; font-weight: 500;">\n                                <option value="Pendiente" ${"Pendiente"===a.estado?"selected":""}>Pendiente</option>\n                                <option value="En revisión" ${"En revisión"===a.estado?"selected":""}>En revisión</option>\n                                <option value="Resuelta" ${"Resuelta"===a.estado?"selected":""}>Resuelta</option>\n                                <option value="Archivada" ${"Archivada"===a.estado?"selected":""}>Archivada</option>\n                            </select>\n                        `;e.html(s),window.handleStatusChange=j}},{dataField:"created_at",caption:"Fecha",dataType:"datetime",format:"yyyy-MM-dd HH:mm",sortOrder:"desc",width:150},{caption:"Acciones",width:120,cellTemplate:(a,{data:s})=>{a.append(d({className:"btn btn-xs btn-soft-primary",title:"Ver denuncia",icon:"fa fa-eye",onClick:()=>x(s)})),a.append(d({className:"btn btn-xs btn-soft-danger ms-1",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async a=>{const{isConfirmed:s}=await h.fire({title:"Eliminar denuncia",text:"¿Estas seguro de eliminar esta denuncia?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});if(!s)return;await p.delete(a)&&$(e.current).dxDataGrid("instance").refresh()})(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),i.jsxs(m,{modalRef:a,title:"Detalle de la Denuncia",size:"xl",hideFooter:!0,children:[i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsxs("h6",{className:"mb-3 text-primary",children:[i.jsx("i",{className:"mdi mdi-map-marker me-2"}),"Ubicación del Incidente"]}),i.jsxs("div",{className:"bg-light p-3 rounded mb-3",children:[i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Departamento:"})," ",s?.departamento]}),i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Ciudad:"})," ",s?.ciudad]}),i.jsxs("p",{className:"mb-0",children:[i.jsx("strong",{children:"Dirección:"})," ",s?.direccion_exacta]})]}),i.jsxs("h6",{className:"mb-3 text-primary mt-4",children:[i.jsx("i",{className:"mdi mdi-account me-2"}),"Información de Contacto"]}),i.jsxs("div",{className:"bg-light p-3 rounded",children:[i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Nombre:"})," ",s?.nombre]}),i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Email:"})," ",s?.email]}),i.jsxs("p",{className:"mb-0",children:[i.jsx("strong",{children:"Teléfono:"})," ",s?.telefono||i.jsx("i",{className:"text-muted",children:"No proporcionado"})]})]})]}),i.jsxs("div",{className:"col-md-6",children:[i.jsxs("h6",{className:"mb-3 text-primary",children:[i.jsx("i",{className:"mdi mdi-alert-circle me-2"}),"Detalles del Incidente"]}),i.jsxs("div",{className:"bg-light p-3 rounded mb-3",children:[i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Ámbito:"}),i.jsx("span",{className:"badge bg-primary ms-2",children:s?.ambito})]}),i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Relación:"})," ",s?.relacion_compania]}),i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Empresa:"})," ",s?.empresa||i.jsx("i",{className:"text-muted",children:"No especificada"})]}),i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"Fecha del incidente:"})," ",s?.cuando_ocurrio]}),i.jsxs("p",{className:"mb-0",children:[i.jsx("strong",{children:"Estado:"}),i.jsx("span",{className:`badge bg-${"Pendiente"===s?.estado?"warning":"En revisión"===s?.estado?"info":"Resuelta"===s?.estado?"success":"secondary"} ms-2`,children:s?.estado})]})]}),i.jsxs("h6",{className:"mb-3 text-primary mt-4",children:[i.jsx("i",{className:"mdi mdi-information me-2"}),"Metadata"]}),i.jsxs("div",{className:"bg-light p-3 rounded",children:[i.jsxs("p",{className:"mb-2",children:[i.jsx("strong",{children:"IP:"})," ",i.jsx("code",{children:s?.ip_address})]}),i.jsxs("p",{className:"mb-0",children:[i.jsx("strong",{children:"Fecha de registro:"})," ",new Date(s?.created_at).toLocaleString("es-PE")]})]})]})]}),i.jsx("div",{className:"row mt-4",children:i.jsxs("div",{className:"col-12",children:[i.jsxs("h6",{className:"mb-3 text-primary",children:[i.jsx("i",{className:"mdi mdi-file-document me-2"}),"¿Qué ha sucedido?"]}),i.jsx("div",{className:"border rounded p-3 bg-light",children:s?.que_sucedio})]})}),i.jsxs("div",{className:"row mt-3",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsxs("h6",{className:"mb-3 text-primary",children:[i.jsx("i",{className:"mdi mdi-account-multiple me-2"}),"¿Quién está implicado?"]}),i.jsx("div",{className:"border rounded p-3 bg-light",children:s?.quien_implicado})]}),i.jsxs("div",{className:"col-md-6",children:[i.jsxs("h6",{className:"mb-3 text-primary",children:[i.jsx("i",{className:"mdi mdi-message-text me-2"}),"Diálogo con superior"]}),i.jsx("div",{className:"border rounded p-3 bg-light",children:s?.dialogo_superior||i.jsx("i",{className:"text-muted",children:"No especificado"})})]})]}),i.jsx("div",{className:"row mt-4",children:i.jsxs("div",{className:"col-12",children:[i.jsxs("h6",{className:"mb-3 text-danger",children:[i.jsx("i",{className:"mdi mdi-shield-lock me-2"}),"Notas Internas (Confidencial)"]}),i.jsx("textarea",{className:"form-control",rows:"4",value:r,onChange:e=>l(e.target.value),placeholder:"Agregar notas internas sobre el seguimiento de esta denuncia..."}),i.jsxs("button",{className:"btn btn-primary mt-2",onClick:async()=>{await p.save({id:s.id,notas_admin:r})&&(h.fire("Notas guardadas","","success"),$(a.current).modal("hide"),$(e.current).dxDataGrid("instance").refresh())},children:[i.jsx("i",{className:"mdi mdi-content-save me-1"}),"Guardar Notas"]})]})})]})]})};r((e,a)=>{s.createRoot(e).render(i.jsx(n,{...a,title:"Denuncias",children:i.jsx(x,{...a})}))});

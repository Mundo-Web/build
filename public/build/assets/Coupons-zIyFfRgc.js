import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as z}from"./Base-CwtY5FYH.js";import{S as H}from"./SwitchFormGroup-DXN0cwVk.js";import{T as J}from"./TextareaFormGroup-CliirJM1.js";import{r as s}from"./index-BOnQTV8N.js";import{c as W}from"./ReactAppend-CxMClIhj.js";import{s as m}from"./server.browser-Bf4gQIc7.js";import{S as Y}from"./CartKuchara-CVImXKD8.js";import{B as K}from"./BasicRest-tjV1jpAY.js";import{t as C}from"./CardProductKatya-BPLqIfPk.js";import{m as M}from"./main-iQpBVKTZ.js";import{M as Q}from"./Modal-xDw9ufjg.js";import{T as X}from"./Table-wUpTDdrv.js";import{I as o}from"./InputFormGroup-iZIO11ZN.js";import{S as Z}from"./SelectFormGroup-X8WqJHHl.js";import{D as B}from"./DxButton-DV0H-ZcL.js";import{C as ee}from"./CreateReactScript-B1eM-GvR.js";import{C as N,N as A}from"./Number2Currency-jIsa99f9.js";import{R as re}from"./ReactAppend-C2Knef3a.js";import"./index-yBjzXJbu.js";import"./Global-Bz6gVLc5.js";import"./tippy-react.esm-BGU1pa2o.js";import"./index-B8-haksW.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-BLHw34Di.js";/* empty css              */import"./Logout-DK3gcKZh.js";import"./MenuItemContainer-B4uedZKJ.js";import"./index.esm-BaU9YRy4.js";import"./index-B9ygI19o.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./CanAccess-BFw0ohJq.js";import"./BooleanLimit-D-OsQsek.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";class te extends K{constructor(){super(),this.path="admin/coupons"}async validate(c,l={}){try{const{status:a,result:i}=await M.Fetch(`/api/${this.path}/validate`,{method:"POST",body:JSON.stringify({code:c,cart_total:l.total||0,category_ids:l.category_ids||[],product_ids:l.product_ids||[]}),headers:{"Content-Type":"application/json"}});return i.valid?(C.success("¡Excelente!",{description:i.message,duration:3e3,position:"bottom-center",richColors:!0}),i):(C.error("¡Error!",{description:i.message,duration:3e3,position:"bottom-center",richColors:!0}),null)}catch(a){return C.error("¡Error!",{description:a.message||"Error al validar el cupón",duration:3e3,position:"bottom-center",richColors:!0}),null}}async generateCode(){var c;try{const{status:l,result:a}=await M.Fetch(`/api/${this.path}/generate-code`);return l?((c=a.data)==null?void 0:c.code)||a.code:null}catch{return C.error("¡Error!",{description:"Error al generar código",duration:3e3,position:"bottom-center",richColors:!0}),null}}}const p=new te,se=({categories:T,products:c})=>{const[l,a]=s.useState(!1),i=s.useRef(),S=s.useRef(),d=s.useRef(),u=s.useRef(),f=s.useRef(),h=s.useRef(),x=s.useRef(),g=s.useRef(),v=s.useRef(),b=s.useRef(),j=s.useRef(),y=s.useRef(),R=s.useRef(),w=s.useRef(),_=s.useRef(),[ne,F]=s.useState(!1),D=e=>{e!=null&&e.id?a(!0):a(!1),$(S.current).modal("show"),setTimeout(()=>{d.current&&(d.current.value=(e==null?void 0:e.id)??""),u.current&&(u.current.value=(e==null?void 0:e.code)??""),f.current&&(f.current.value=(e==null?void 0:e.name)??""),h.current&&(h.current.value=(e==null?void 0:e.description)??""),g.current&&(g.current.value=(e==null?void 0:e.value)??""),v.current&&(v.current.value=(e==null?void 0:e.minimum_amount)??""),b.current&&(b.current.value=(e==null?void 0:e.usage_limit)??""),j.current&&(j.current.value=(e==null?void 0:e.usage_limit_per_user)??1),w.current&&(w.current.value=(e==null?void 0:e.maximum_discount)??""),y.current&&(y.current.value=e!=null&&e.starts_at?k(new Date(e.starts_at)):""),R.current&&(R.current.value=e!=null&&e.expires_at?k(new Date(e.expires_at)):""),_.current&&(_.current.checked=(e==null?void 0:e.first_purchase_only)??!1);const t=(e==null?void 0:e.type)||"percentage";x.current&&($(x.current).val(t).trigger("change"),F(t==="percentage"))},100)},k=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),E=String(e.getDate()).padStart(2,"0"),U=String(e.getHours()).padStart(2,"0"),V=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${E}T${U}:${V}`},G=async e=>{e.preventDefault();const t={id:d.current.value||void 0,code:u.current.value,name:f.current.value,description:h.current.value,type:x.current.value,value:g.current.value,minimum_amount:v.current.value||0,usage_limit:b.current.value||null,usage_limit_per_user:j.current.value,starts_at:y.current.value,expires_at:R.current.value,maximum_discount:w.current.value||null,first_purchase_only:_.current.checked?1:0};await p.save(t)&&($(i.current).dxDataGrid("instance").refresh(),$(S.current).modal("hide"))},q=async({id:e,value:t})=>{await p.boolean({id:e,field:"active",value:t})&&$(i.current).dxDataGrid("instance").refresh()},O=async e=>{const{isConfirmed:t}=await Y.fire({title:"Eliminar cupón",text:"¿Estás seguro de eliminar este cupón?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await p.delete(e)||$(i.current).dxDataGrid("instance").refresh()},P=e=>{F(e.target.value==="percentage")},I=async()=>{const e=await p.generateCode();e&&u.current&&(u.current.value=e)},L=e=>({active:"badge-success",expired:"badge-danger",pending:"badge-warning",exhausted:"badge-secondary",inactive:"badge-dark"})[e]||"badge-secondary";return r.jsxs(r.Fragment,{children:[r.jsx(X,{gridRef:i,title:"Cupones",rest:p,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar cupón",onClick:()=>D()}})},exportable:!0,exportableName:"Cupones",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Código",width:"120px",cellTemplate:(e,{data:t})=>{e.html(m.renderToString(r.jsxs("div",{children:[r.jsx("strong",{className:"font-monospace",children:t.code}),r.jsx("br",{}),r.jsx("span",{className:`badge ${L(t.status)} badge-sm`,children:t.status_text})]})))}},{dataField:"name",caption:"Nombre",minWidth:"200px",cellTemplate:(e,{data:t})=>{e.html(m.renderToString(r.jsxs("div",{children:[r.jsx("strong",{children:t.name}),t.description&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),r.jsx("small",{className:"text-muted",children:t.description.length>50?t.description.substring(0,50)+"...":t.description})]})]})))}},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:t})=>{const n=t.type==="percentage"?"Porcentaje":"Monto Fijo",E=t.type==="percentage"?"badge-info":"badge-primary";e.html(m.renderToString(r.jsx("span",{className:`badge ${E}`,children:n})))}},{dataField:"value",caption:"Valor",width:"100px",cellTemplate:(e,{data:t})=>{const n=t.type==="percentage"?`${t.value}%`:`${N()} ${A(t.value)}`;e.html(m.renderToString(r.jsx("strong",{children:n})))}},{dataField:"minimum_amount",caption:"Mín. Compra",width:"110px",cellTemplate:(e,{data:t})=>{e.html(m.renderToString(r.jsxs("span",{children:[N()," ",A(t.minimum_amount)]})))}},{dataField:"usage_limit",caption:"Usos",width:"80px",cellTemplate:(e,{data:t})=>{const n=t.usage_limit?`${t.used_count}/${t.usage_limit}`:`${t.used_count}/∞`;e.html(m.renderToString(r.jsx("span",{children:n})))}},{dataField:"starts_at",caption:"Inicio",dataType:"datetime",width:"110px",format:"dd/MM/yyyy"},{dataField:"expires_at",caption:"Expiración",dataType:"datetime",width:"110px",format:"dd/MM/yyyy"},{dataField:"active",caption:"Activo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{re(e,r.jsx(H,{checked:t.active,onChange:n=>q({id:t.id,value:n.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(B({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>D(t)})),e.append(B({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>O(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(Q,{modalRef:S,title:l?"Editar cupón":"Agregar cupón",onSubmit:G,size:"xl",children:r.jsxs("div",{className:"row",id:"coupons-form",children:[r.jsx("input",{ref:d,type:"hidden"}),r.jsxs("div",{className:"col-md-6",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-8",children:r.jsx(o,{eRef:u,label:"Código del cupón",required:!0,placeholder:"Ej: DESCUENTO20"})}),r.jsxs("div",{className:"col-md-4",children:[r.jsx("label",{className:"form-label",children:" "}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary d-block",onClick:I,children:"Generar"})]})]}),r.jsx(o,{eRef:f,label:"Nombre",required:!0,placeholder:"Nombre descriptivo del cupón"}),r.jsx(J,{eRef:h,label:"Descripción",rows:3,placeholder:"Descripción del cupón"}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsxs(Z,{eRef:x,label:"Tipo de descuento",required:!0,onChange:P,dropdownParent:"#coupons-form",children:[r.jsx("option",{value:"percentage",children:"Porcentaje"}),r.jsx("option",{value:"fixed",children:"Monto fijo"})]})}),r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:g,label:"Valor",type:"number",step:"0.01",min:"0",required:!0,placeholder:"Ej: 20 o 50.00"})})]}),r.jsx(o,{eRef:w,label:`Descuento máximo (${N()})`,type:"number",step:"0.01",min:"0",placeholder:"Opcional - límite máximo de descuento"}),r.jsx(o,{eRef:v,label:`Monto mínimo de compra (${N()})`,type:"number",step:"0.01",min:"0",placeholder:"0.00"})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:b,label:"Límite de usos",type:"number",min:"1",placeholder:"Dejar vacío para ilimitado"})}),r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:j,label:"Usos por usuario",type:"number",min:"1",defaultValue:"1",required:!0})})]}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:y,label:"Fecha de inicio",type:"datetime-local",required:!0})}),r.jsx("div",{className:"col-md-6",children:r.jsx(o,{eRef:R,label:"Fecha de expiración",type:"datetime-local",required:!0})})]}),r.jsxs("div",{className:"form-check mb-3",children:[r.jsx("input",{ref:_,className:"form-check-input",type:"checkbox",id:"firstPurchaseOnly"}),r.jsx("label",{className:"form-check-label",htmlFor:"firstPurchaseOnly",children:"Solo primera compra"})]})]})]})})]})};ee((T,c)=>{W.createRoot(T).render(r.jsx(z,{...c,title:"Cupones",children:r.jsx(se,{...c})}))});

import{j as jsxRuntimeExports}from"./AboutSimple-Cf8x2fCZ.js";import{r as reactExports}from"./index-BOnQTV8N.js";import{R as ReactModal}from"./PolicyModal-C80IvD61.js";import{H as HtmlContent}from"./HtmlContent-ghmllTyl.js";import{C as CurrencySymbol,N as Number2Currency}from"./Number2Currency-jIsa99f9.js";import{D as DiscountRulesRest,C as CardItem,B as ButtonPrimary,a as ButtonSecondary,P as PromotionModal,b as DeliveryPricesRest,A as AsyncSelect$1,O as OptionCard,S as StorePickupSelector,c as CouponsRest,I as Info}from"./StorePickupSelector-CViwAm7k.js";import{m as mainExports}from"./main-B6F2O9-U.js";import{t as toast}from"./CardProductKatya-ncpmQ0JU.js";import{G as Global}from"./Global-CazroCzF.js";import{I as InputForm}from"./InputForm-Dmyom2PO.js";import{s as server_browserExports}from"./server.browser-Bf4gQIc7.js";import{l as lodashExports}from"./ShippingStep-C6i134TO.js";import{S as StateManagedSelect$1}from"./react-select.esm-H4wpMl-h.js";import{G as General}from"./General-apRuNwp7.js";import{U as UploadVoucherModalYape,a as UploadVoucherModalBancs}from"./ShippingStepSF-ez4yFGpt.js";import{C as CircleX}from"./circle-x-5vreeYph.js";import{C as CircleCheckBig}from"./circle-check-big-CYWUGR3Z.js";import{T as TriangleAlert}from"./triangle-alert-CK-9Xb7r.js";import"./ProductNavigation-DQ1LQk6t.js";import"./ProductCard-D_AgkLlk.js";/* empty css              */import"./BlogCarousel-DCQ9UYu0.js";/* empty css               */import"./BlogCarrusel-klwTVD05.js";import{X}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./index-Chjiymov.js";import"./createLucideIcon-DfjclApS.js";import"./sparkles-DvmvZ6mJ.js";import"./package-DBFPPBi1.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./index-BQJyKPGC.js";import"./useStateManager-7e1e8489.esm-C6DnWqDr.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./index-pSueRYGM.js";import"./floating-ui.dom-CID5cQpR.js";import"./StoresRest-Bb6TODpG.js";import"./BasicRest-BML1C-ua.js";import"./BooleanLimit-D-OsQsek.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./tippy-react.esm-DmkRJDEW.js";import"./VoucherUpload-iBnD6lhN.js";import"./filepond-plugin-image-preview-DB1AqTVz.js";import"./SalesRest-1IeJ_u4b.js";import"./chevron-up-Mt3xll-e.js";import"./chevron-down-uIVDLcM-.js";import"./ItemsRest-Dp5IKigO.js";import"./HeaderSearch-j9L8kXPt.js";import"./CartItemRow-Dd2JdCJX.js";import"./proxy-B0QLMKEh.js";import"./index-BZvh78jk.js";import"./eye-ScgfreHn.js";function CartStepSF({data:d,cart:h,setCart:j,onContinue:a,subTotal:n,envio:e,igv:t,totalFinal:s,openModal:i,automaticDiscounts:r,setAutomaticDiscounts:o,automaticDiscountTotal:c,setAutomaticDiscountTotal:u,totalWithoutDiscounts:y}){const[D,E]=reactExports.useState(r||[]),[v,l]=reactExports.useState(c||0),[f,g]=reactExports.useState(!1),[N,k]=reactExports.useState([]),[_,P]=reactExports.useState([]),[p,b]=reactExports.useState(!1),[T,I]=reactExports.useState(null),[L,A]=reactExports.useState(null),O=h.length===0;reactExports.useEffect(()=>{if(h.length>0&&n>0)M();else{const m=[];E(m),l(0),k([]),P([]),o&&o(m),u&&u(0)}},[h,n]);const M=async()=>{g(!0);try{const m=h.reduce((w,C)=>w+(C.quantity||0),0),x=await DiscountRulesRest.applyToCart(h,y);if(x.success&&x.data){const w=DiscountRulesRest.formatDiscounts(x.data.applied_discounts),C=x.data.total_discount||0,F=DiscountRulesRest.getFreeItems(x.data.applied_discounts),S=[];x.data.applied_discounts.forEach(R=>{R.suggested_items&&Array.isArray(R.suggested_items)&&S.push(...R.suggested_items)}),E(w),l(C),k(F),P(S),o&&o(w),u&&u(C)}else{console.error("❌ Discount application failed:",{error:x.error,success:x.success,data:x.data,fullResult:x});const w=[],C=0;E(w),l(C),k([]),P([]),o&&o(w),u&&u(C)}}catch(m){console.error("Error applying discount rules:",m);const x=[],w=0;E(x),l(w),k([]),P([]),o&&o(x),u&&u(w)}finally{g(!1)}},U=m=>_.some(x=>x.item_id===m||x.triggering_item_id===m),q=m=>_.find(x=>x.item_id===m||x.triggering_item_id===m),z=m=>{const x=q(m.id);x&&(I(x),A(m),b(!0))},V=async m=>{try{j(x=>{const w=x.findIndex(C=>(C.item_id||C.id)===m.item_id);if(w!==-1){const C=[...x],F=m.quantity||m.suggested_quantity||1;return C[w].quantity+=F,C}else{const C={id:m.item_id,name:m.item_name,quantity:m.quantity||m.suggested_quantity||1,price:m.value||0,final_price:m.value||0,image:m.item_image||"default.jpg",brand:{name:m.item_brand||"N/A"},sku:m.item_sku||"PROMO",stock:999};return[...x,C]}}),setTimeout(()=>{M()},100)}catch(x){console.error("Error adding promotional item:",x)}};return jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:O?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[jsxRuntimeExports.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito está vacío"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"¡Explora nuestros productos y encuentra algo especial!"})]}):h.map((m,x)=>jsxRuntimeExports.jsx(CardItem,{...m,setCart:j,hasPromotion:U(m.id),onPromotionClick:z},x))}),jsxRuntimeExports.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 md:space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(n)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(t)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(e)]})]}),f&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!f&&D.length>0&&jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 customtext-neutral-dark mb-2",children:"🎉 Descuentos aplicados:"}),D.map((m,x)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark",children:[m.name,m.description&&jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold block",children:m.description})]}),jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark font-semibold",children:["-",CurrencySymbol()," ",Number2Currency(m.amount)]})]},x)),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm font-semibold customtext-neutral-dark pt-1",children:[jsxRuntimeExports.jsx("span",{children:"Total descuentos:"}),jsxRuntimeExports.jsxs("span",{children:["-",CurrencySymbol()," ",Number2Currency(v)]})]})]}),jsxRuntimeExports.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," ",Number2Currency(s)]})]}),v>0&&jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[jsxRuntimeExports.jsxs("span",{className:"line-through",children:[CurrencySymbol()," ",Number2Currency(y||s+v)]}),jsxRuntimeExports.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras ",CurrencySymbol()," ",Number2Currency(v)]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[jsxRuntimeExports.jsx(ButtonPrimary,{onClick:a,disabled:O,className:`w-full py-3 px-6 font-semibold focus:outline-none outline-none focus:border-0 text-lg transition-all duration-300 hover:opacity-90 bg-primary  rounded-2xl xl:rounded-3xl ${(d==null?void 0:d.class_button)||" text-white"}`,children:O?"Carrito Vacío":"Continuar Compra"}),jsxRuntimeExports.jsx(ButtonSecondary,{href:"/",className:"w-full rounded-2xl xl:rounded-3xl",children:O?"Ir a Comprar":"Cancelar"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>i&&i(1),className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>i&&i(0),className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]}),jsxRuntimeExports.jsx(PromotionModal,{isOpen:p,onClose:()=>b(!1),suggestion:T,onAddToCart:V,productName:(L==null?void 0:L.name)||""})]})}const processMercadoPagoPayment=d=>new Promise(async(h,j)=>{try{console.log("Datos para MercadoPago:",d);const{status:a,result:n}=await mainExports.Fetch("./api/mercadopago/preference",{method:"POST",body:JSON.stringify(d)});if(!a||!n.preference_id){mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(n==null?void 0:n.message)||"Error al crear la preferencia de pago",type:"danger"}),j((n==null?void 0:n.message)||"Error al crear la preferencia de pago");return}console.log("✅ Preferencia creada:",n);const e=new window.MercadoPago(n.public_key,{locale:"es-PE"});setTimeout(()=>{window.location.href=n.redirect_url},500),h(n)}catch(a){console.error("Error en processMercadoPagoPayment:",a),mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message||"Error en la integración con MercadoPago",type:"danger"}),j(a.message||"Error en la integración con MercadoPago")}});function generarNumeroOrdenConPrefijoYFecha(){let d="";for(let h=0;h<12;h++){const j=Math.floor(Math.random()*10);d+=j}return d}const processOpenPayPayment=d=>new Promise(async(h,j)=>{try{if(console.log("🔄 Iniciando proceso de pago con OpenPay...",d),typeof window.OpenPay>"u"){console.error("❌ Error: OpenPay no está definido. Verifique que el script de OpenPay esté cargado."),j("Error en la integración con OpenPay: Script no cargado");return}const a=window.OPENPAY_MERCHANT_ID||Global.OPENPAY_MERCHANT_ID,n=window.OPENPAY_PUBLIC_KEY||Global.OPENPAY_PUBLIC_KEY,e=window.OPENPAY_SANDBOX_MODE!==void 0?window.OPENPAY_SANDBOX_MODE:Global.OPENPAY_SANDBOX_MODE||!1;if(!a||!n){console.error("❌ Error: Credenciales de OpenPay no están configuradas"),console.error("   window.OPENPAY_MERCHANT_ID:",window.OPENPAY_MERCHANT_ID),console.error("   Global.OPENPAY_MERCHANT_ID:",Global.OPENPAY_MERCHANT_ID),j("Error de configuración: Credenciales de OpenPay no encontradas");return}console.log("✅ Credenciales de OpenPay encontradas:"),console.log("   Merchant ID:",a),console.log("   Public Key:",n?n.substring(0,10)+"...":"N/A"),console.log("   Sandbox Mode:",e);const t=generarNumeroOrdenConPrefijoYFecha();if(console.log("📝 Número de orden generado:",t),!d.source_id&&!d.token){console.error("❌ Error: Token de tarjeta no proporcionado"),j("Error: Token de tarjeta no proporcionado");return}if(!d.device_session_id){console.error("❌ Error: device_session_id no proporcionado"),j("Error: device_session_id no proporcionado (requerido para antifraude)");return}console.log("✅ Datos de tokenización verificados:"),console.log("   - Token (source_id):",d.source_id||d.token),console.log("   - Device Session ID:",d.device_session_id),console.log("   - Monto:",d.amount);const s={...d,orderNumber:t,method:"card",source_id:d.source_id||d.token,device_session_id:d.device_session_id};console.log("📤 Enviando solicitud de cargo al servidor:",s);const{status:i,result:r}=await mainExports.Fetch("./api/openpay/charge",{method:"POST",body:JSON.stringify(s)});if(!i){console.error("❌ Error al procesar el pago:",r),toast.error("Error en el pago",{description:(r==null?void 0:r.message)||"No se pudo procesar el pago",duration:3e3,position:"top-right",richColors:!0}),j((r==null?void 0:r.message)||"Error al procesar el pago");return}console.log("✅ Pago procesado exitosamente:",r),toast.success("¡Pago exitoso!",{description:"Tu pago se procesó correctamente. Pronto recibirás la confirmación de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),h(r)}catch(a){console.error("❌ Error en processOpenPayPayment:",a),toast.error("Error en el pago",{description:a.message||"Error en la integración con OpenPay",duration:3e3,position:"top-right",richColors:!0}),j(a.message||"Error en la integración con OpenPay")}});function PaymentModal({isOpen:d,onClose:h,onPaymentComplete:j,contacts:a=[]}){const[n,e]=reactExports.useState(null),[t,s]=reactExports.useState(!1);reactExports.useEffect(()=>{d||(s(!1),e(null))},[d]);const i=()=>{n&&(s(!0),j(n))},r=t||!n,o=a==null?void 0:a.find(u=>u.correlative==="checkout_mercadopago"),c=a==null?void 0:a.find(u=>u.correlative==="checkout_openpay");return jsxRuntimeExports.jsx(ReactModal,{isOpen:d,onRequestClose:h,className:"absolute left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-lg w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:h-[85vh] lg:min-h-[85vh]   lg:max-h-[85vh]  ",children:[jsxRuntimeExports.jsx("div",{className:"hidden md:block bg-[#f8f5f2] h-full",children:jsxRuntimeExports.jsx("img",{src:`/assets/resources/payments.png?v=${crypto.randomUUID()}`,alt:Global.APP_NAME,className:"h-full w-full object-cover",onError:u=>{u.target.onerror=null,u.target.src="/assets/img/logo-bk.svg"}})}),jsxRuntimeExports.jsxs("div",{className:"p-6 max-h-[90vh] md:max-h-[100vh] flex flex-col justify-center ",children:[jsxRuntimeExports.jsxs("div",{className:"mb-0 md:mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl md:text-2xl 2xl:text-3xl font-bold customtext-primary",children:"¿Cómo deseas pagar tu pedido?"}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm 2xl:text-base",children:"Elige una de las opciones disponibles para completar tu pago de forma segura."})]}),(o==null?void 0:o.description)!=="true"&&(c==null?void 0:c.description)!=="true"&&General.get("checkout_dwallet")!=="true"&&General.get("checkout_transfer")!=="true"?jsxRuntimeExports.jsx("div",{className:"text-gray-500 text-center py-4",children:"Sin opciones de pago"}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"mt-3 space-y-3",children:[(o==null?void 0:o.description)=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${n==="tarjeta"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>e("tarjeta"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"tarjeta",name:"paymentMethod",checked:n==="tarjeta",onChange:()=>e("tarjeta"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"tarjeta",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Renueva tus espacios con estilo: Fundas exclusivas para cada temporada."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${n==="tarjeta"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${n==="tarjeta"?"bg-white":""}`})})})]})}),(c==null?void 0:c.description)=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${n==="openpay"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>e("openpay"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"openpay",name:"paymentMethod",checked:n==="openpay",onChange:()=>e("openpay"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"openpay",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta (OpenPay)"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Paga de forma segura con tu tarjeta de crédito o débito."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${n==="openpay"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${n==="openpay"?"bg-white":""}`})})})]})}),General.get("checkout_dwallet")=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${n==="yape"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>e("yape"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"yape",name:"paymentMethod",checked:n==="yape",onChange:()=>e("yape"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"yape",className:"font-medium text-base 2xl:text-lg",children:"Yape / Plin"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Realiza el pago desde tu celular sin comisiones."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${n==="yape"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${n==="yape"?"bg-white":""}`})})})]})}),General.get("checkout_transfer")=="true"&&jsxRuntimeExports.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${n==="transferencia"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-primary"}`,onClick:()=>e("transferencia"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"transferencia",name:"paymentMethod",checked:n==="transferencia",onChange:()=>e("transferencia"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"transferencia",className:"font-medium text-base 2xl:text-lg",children:"Pago por Transferencia"}),jsxRuntimeExports.jsx("p",{className:"text-neutral-light text-sm 2xl:text-base ml-7 mt-1",children:"Haz una transferencia bancaria desde tu app o banca por internet."})]}),jsxRuntimeExports.jsx("div",{className:"min-w-5 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${n==="transferencia"?"bg-primary":"border-2 border-[#d0ccca]"}`,children:jsxRuntimeExports.jsx("div",{className:`h-2 w-2 rounded-full ${n==="transferencia"?"bg-white":""}`})})})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-4 space-y-3",children:[((o==null?void 0:o.description)==="true"||(c==null?void 0:c.description)==="true"||General.get("checkout_dwallet")==="true"||General.get("checkout_transfer")==="true")&&jsxRuntimeExports.jsx("button",{className:`w-full bg-primary hover:bg-primary text-white py-3 rounded-3xl text-base 2xl:text-lg leading-normal font-medium transition-colors 
                            ${r?"opacity-70 cursor-not-allowed":""}`,onClick:i,disabled:t,children:t?"Procesando...":"Confirmar pago"}),jsxRuntimeExports.jsx("button",{className:"w-full border border-primary text-primary hover:bg-[#f8f5f2] py-3 text-base 2xl:text-lg leading-normal rounded-3xl font-medium transition-colors",onClick:h,disabled:t,children:"Volver"})]})]})]})})}function OpenPayCardModal({isOpen:d,onClose:h,onTokenCreated:j}){const[a,n]=reactExports.useState({card_number:"",holder_name:"",expiration_month:"",expiration_year:"",cvv2:""}),[e,t]=reactExports.useState(!1),[s,i]=reactExports.useState({}),[r,o]=reactExports.useState(null);reactExports.useRef(null),reactExports.useEffect(()=>{d?c():(n({card_number:"",holder_name:"",expiration_month:"",expiration_year:"",cvv2:""}),i({}),o(null))},[d]);const c=()=>{try{if(typeof window.OpenPay>"u")throw new Error("OpenPay no está disponible. Por favor, recarga la página.");const l=window.OPENPAY_MERCHANT_ID,f=window.OPENPAY_PUBLIC_KEY,g=window.OPENPAY_SANDBOX_MODE!==void 0?window.OPENPAY_SANDBOX_MODE:!0;if(!l||!f)throw new Error("Configuración de OpenPay incompleta. Verifica Merchant ID y Public Key en Admin.");console.log("🔧 Configurando OpenPay:",{merchantId:l,sandboxMode:g}),window.OpenPay.setId(l),window.OpenPay.setApiKey(f),window.OpenPay.setSandboxMode(g);const N=window.OpenPay.deviceData.setup();o(N),console.log("✅ Device Session ID generado:",N)}catch(l){console.error("❌ Error inicializando OpenPay:",l),toast.error(l.message||"Error al inicializar OpenPay",{duration:4e3,position:"top-right"})}},u=()=>{const l={};(!a.card_number||a.card_number.replace(/\s/g,"").length<13)&&(l.card_number="Número de tarjeta inválido"),(!a.holder_name||a.holder_name.trim().length<3)&&(l.holder_name="Nombre del titular requerido"),(!a.expiration_month||parseInt(a.expiration_month)<1||parseInt(a.expiration_month)>12)&&(l.expiration_month="Mes inválido");const f=new Date().getFullYear().toString().slice(-2);return(!a.expiration_year||parseInt(a.expiration_year)<parseInt(f))&&(l.expiration_year="Año inválido"),(!a.cvv2||a.cvv2.length<3)&&(l.cvv2="CVV inválido"),i(l),Object.keys(l).length===0},y=l=>{const g=l.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),N=g&&g[0]||"",k=[];for(let _=0,P=N.length;_<P;_+=4)k.push(N.substring(_,_+4));return k.length?k.join(" "):l},D=l=>{const f=y(l.target.value);n({...a,card_number:f}),s.card_number&&i({...s,card_number:null})},E=(l,f)=>{n({...a,[l]:f}),s[l]&&i({...s,[l]:null})},v=async l=>{if(l.preventDefault(),!u()){toast.error("Por favor, completa todos los campos correctamente",{duration:3e3,position:"top-right"});return}if(!r){toast.error("Sistema antifraude no inicializado. Por favor, cierra y vuelve a abrir el modal.",{duration:4e3,position:"top-right"});return}t(!0);try{if(typeof window.OpenPay>"u")throw new Error("OpenPay no está disponible. Por favor, recarga la página.");const f={card_number:a.card_number.replace(/\s/g,""),holder_name:a.holder_name.toUpperCase(),expiration_year:a.expiration_year.length===2?a.expiration_year:a.expiration_year.slice(-2),expiration_month:a.expiration_month.padStart(2,"0"),cvv2:a.cvv2};console.log("🔄 Creando token de OpenPay con device_session_id:",r),window.OpenPay.token.create(f,g=>{console.log("✅ Token creado exitosamente:",g),toast.success("Tarjeta validada correctamente",{duration:2e3,position:"top-right"}),t(!1),j({token:g.data.id,device_session_id:r,card_info:{brand:g.data.brand||"card",card_number:g.data.card_number||`****${a.card_number.slice(-4)}`,holder_name:a.holder_name}}),h()},g=>{console.error("❌ Error al crear token:",g),t(!1);let N="Error al validar la tarjeta";g.data&&g.data.description?N=g.data.description:g.message&&(N=g.message),g.status===400?N="Datos de tarjeta inválidos. Verifica los datos ingresados.":g.status===401?N="Error de autenticación. Verifica la configuración de OpenPay.":g.status===412&&(N="Error en sistema antifraude. Por favor, recarga la página e intenta nuevamente."),toast.error(N,{duration:4e3,position:"top-right"})})}catch(f){console.error("❌ Error en handleSubmit:",f),t(!1),toast.error(f.message||"Error al procesar la tarjeta",{duration:3e3,position:"top-right"})}};return jsxRuntimeExports.jsx(ReactModal,{isOpen:d,onRequestClose:h,className:"absolute left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold customtext-primary",children:"Datos de Tarjeta"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Ingresa los datos de tu tarjeta de crédito o débito"})]}),jsxRuntimeExports.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:e,children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("form",{onSubmit:v,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Tarjeta *"}),jsxRuntimeExports.jsx("input",{type:"text",value:a.card_number,onChange:D,placeholder:"1234 5678 9012 3456",maxLength:"19",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${s.card_number?"border-red-500":"border-gray-300"}`,disabled:e}),s.card_number&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.card_number})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Titular *"}),jsxRuntimeExports.jsx("input",{type:"text",value:a.holder_name,onChange:l=>E("holder_name",l.target.value.toUpperCase()),placeholder:"JUAN PEREZ",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${s.holder_name?"border-red-500":"border-gray-300"}`,disabled:e}),s.holder_name&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.holder_name})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mes *"}),jsxRuntimeExports.jsx("input",{type:"text",value:a.expiration_month,onChange:l=>{const f=l.target.value.replace(/\D/g,"");f.length<=2&&E("expiration_month",f)},placeholder:"MM",maxLength:"2",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${s.expiration_month?"border-red-500":"border-gray-300"}`,disabled:e}),s.expiration_month&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.expiration_month})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Año *"}),jsxRuntimeExports.jsx("input",{type:"text",value:a.expiration_year,onChange:l=>{const f=l.target.value.replace(/\D/g,"");f.length<=2&&E("expiration_year",f)},placeholder:"YY",maxLength:"2",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${s.expiration_year?"border-red-500":"border-gray-300"}`,disabled:e}),s.expiration_year&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.expiration_year})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CVV *"}),jsxRuntimeExports.jsx("input",{type:"text",value:a.cvv2,onChange:l=>{const f=l.target.value.replace(/\D/g,"");f.length<=4&&E("cvv2",f)},placeholder:"123",maxLength:"4",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${s.cvv2?"border-red-500":"border-gray-300"}`,disabled:e}),s.cvv2&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cvv2})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-blue-800",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Transacción segura"}),jsxRuntimeExports.jsx("p",{className:"text-xs",children:"Tus datos están protegidos con encriptación de nivel bancario. No almacenamos información de tu tarjeta."})]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:h,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors",disabled:e,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-primary text-white rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",disabled:e,children:e?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Procesando..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Continuar",jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})]})]})})}function ShippingStepSF({cart,setSale,setCode,setDelivery,setCart,onContinue,noContinue,subTotal,igv,totalFinal,user,setEnvio,envio,prefixes,ubigeos=[],contacts,totalPrice,descuentofinal,setDescuentoFinal,data,openModal,setCouponDiscount:setParentCouponDiscount,setCouponCode:setParentCouponCode,automaticDiscounts=[],automaticDiscountTotal=0,totalWithoutDiscounts,conversionScripts,setConversionScripts,onPurchaseComplete}){var d,h,j,a,n;const formatPhoneNumber=(e,t)=>t?t.startsWith(e)?t:`${e}${t}`:"",cleanPhoneNumber=(e,t)=>e?e.startsWith(t)?e.substring(t.length):e:"";reactExports.useRef(null);const[coupon,setCoupon]=reactExports.useState(null),[selectedUbigeo,setSelectedUbigeo]=reactExports.useState(null),[defaultUbigeoOption,setDefaultUbigeoOption]=reactExports.useState(null),[autoDiscounts,setAutoDiscounts]=reactExports.useState([]),[autoDiscountTotal,setAutoDiscountTotal]=reactExports.useState(0);autoDiscounts.reduce((e,t)=>t.free_items&&Array.isArray(t.free_items)?e.concat(t.free_items):e,[]);const calculateAutomaticDiscounts=async(e,t)=>{if(!e||e.length===0)return{discounts:[],total:0};try{const s=await DiscountRulesRest.applyToCart(e,totalWithoutDiscounts);if(s.success&&s.data){const i=DiscountRulesRest.formatDiscounts(s.data.applied_discounts),r=s.data.total_discount||0;return{discounts:s.data.applied_discounts,total:r}}}catch(s){console.error("❌ Error calculating automatic discounts:",s)}return{discounts:[],total:0}};reactExports.useEffect(()=>{cart&&cart.length>0&&totalWithoutDiscounts?calculateAutomaticDiscounts(cart).then(e=>{setAutoDiscounts(e.discounts),setAutoDiscountTotal(e.total)}):(setAutoDiscounts([]),setAutoDiscountTotal(0))},[cart,automaticDiscounts,totalWithoutDiscounts]);const[formData,setFormData]=reactExports.useState(()=>{var s;const e=(user==null?void 0:user.phone_prefix)||"51",t=cleanPhoneNumber((user==null?void 0:user.phone)||"",e);return{name:(user==null?void 0:user.name)||"",lastname:(user==null?void 0:user.lastname)||"",email:(user==null?void 0:user.email)||"",phone_prefix:e,phone:t,documentType:((s=user==null?void 0:user.document_type)==null?void 0:s.toLowerCase())||"dni",document:(user==null?void 0:user.document_number)||"",department:(user==null?void 0:user.department)||"",province:(user==null?void 0:user.province)||"",district:(user==null?void 0:user.district)||"",address:(user==null?void 0:user.address)||"",number:(user==null?void 0:user.number)||"",comment:(user==null?void 0:user.comment)||"",reference:(user==null?void 0:user.reference)||"",shippingOption:"delivery",ubigeo:(user==null?void 0:user.ubigeo)||null,invoiceType:(user==null?void 0:user.invoiceType)||"boleta",businessName:(user==null?void 0:user.businessName)||""}});reactExports.useEffect(()=>{if(user){const e=user.phone_prefix||"51",t=cleanPhoneNumber(user.phone||"",e);setFormData(s=>{var i;return{...s,name:user.name||"",lastname:user.lastname||"",email:user.email||"",phone_prefix:e,phone:t,documentType:((i=user.document_type)==null?void 0:i.toLowerCase())||"dni",document:user.document_number||"",department:user.department||"",province:user.province||"",district:user.district||"",address:user.address||"",number:user.number||"",comment:user.comment||"",reference:user.reference||"",ubigeo:user.ubigeo||null,invoiceType:user.invoiceType||"boleta",businessName:user.businessName||""}})}},[user]),reactExports.useEffect(()=>{if(user!=null&&user.ubigeo)if(!(user!=null&&user.district)||!(user!=null&&user.province)||!(user!=null&&user.department))fetch(`/api/ubigeo/find/${user.ubigeo}`).then(e=>e.json()).then(e=>{if(e&&e.distrito){const t={value:user.ubigeo,label:`${e.distrito}, ${e.provincia}, ${e.departamento}`,data:{reniec:user.ubigeo,departamento:e.departamento,provincia:e.provincia,distrito:e.distrito}};setDefaultUbigeoOption(t),setSelectedUbigeo(t),handleUbigeoChange(t)}else console.log("❌ ShippingStepSF - No se encontró ubicación para ubigeo:",user.ubigeo)}).catch(e=>{console.error("❌ ShippingStepSF - Error al buscar ubicación:",e)});else{const e={value:user.ubigeo,label:`${user.district}, ${user.province}, ${user.department}`,data:{reniec:user.ubigeo,departamento:user.department,provincia:user.province,distrito:user.district}};setDefaultUbigeoOption(e),setSelectedUbigeo(e),handleUbigeoChange(e)}else console.log("❌ ShippingStepSF - Usuario sin ubigeo registrado")},[user]);const getContact=e=>{var t;return((t=contacts.find(s=>s.correlative===e))==null?void 0:t.description)||""},handleChange=e=>{const{name:t,value:s}=e.target;setFormData(i=>({...i,[t]:s})),t==="invoiceType"&&setFormData(i=>({...i,documentType:s==="factura"?"ruc":"dni",document:"",businessName:s==="factura"?i.businessName:""}))},[loading,setLoading]=reactExports.useState(!1),[paymentLoading,setPaymentLoading]=reactExports.useState(!1),[shippingOptions,setShippingOptions]=reactExports.useState([]),[selectedOption,setSelectedOption]=reactExports.useState(null),[costsGet,setCostsGet]=reactExports.useState(null),[errors,setErrors]=reactExports.useState({}),[searchInput,setSearchInput]=reactExports.useState(""),[expandedCharacteristics,setExpandedCharacteristics]=reactExports.useState(!1),[couponCode,setCouponCode]=reactExports.useState(""),[appliedCoupon,setAppliedCoupon]=reactExports.useState(null),[couponDiscount,setCouponDiscount]=reactExports.useState(0),[couponLoading,setCouponLoading]=reactExports.useState(!1),[couponError,setCouponError]=reactExports.useState(""),[selectedStore,setSelectedStore]=reactExports.useState(null),[showStoreSelector,setShowStoreSelector]=reactExports.useState(!1),[showLoginModal,setShowLoginModal]=reactExports.useState(!1);parseFloat(getContact("shipping_free"));const validateForm=()=>{const e={};return formData.name||(e.name="Nombre es requerido"),formData.lastname||(e.lastname="Apellido es requerido"),formData.email||(e.email="Email es requerido"),formData.phone||(e.phone="Teléfono es requerido"),formData.ubigeo||(e.ubigeo="Ubicación es requerida"),formData.address||(e.address="Dirección es requerida"),formData.number||(e.number="Número es requerido"),formData.document||(e.document="Documento es requerido"),formData.email&&!/\S+@\S+\.\S+/.test(formData.email)&&(e.email="Email inválido"),formData.document&&(formData.documentType==="dni"&&formData.document.length!==8?e.document="DNI debe tener 8 dígitos":formData.documentType==="ruc"&&formData.document.length!==11&&(e.document="RUC debe tener 11 dígitos")),formData.invoiceType==="factura"&&!formData.businessName&&(e.businessName="Razón social es requerida para factura"),setErrors(e),Object.keys(e).length===0},handleStoreSelect=e=>{setSelectedStore(e),setFormData(t=>({...t,shippingOption:"pickup",address:e.address,department:e.department,province:e.province,district:e.district}))},focusFirstError=e=>{const t=Object.keys(e)[0];setTimeout(()=>{var i;let s=null;t==="ubigeo"?s=document.getElementById("ubigeo-select-container"):t==="phone_prefix"?s=(i=document.querySelector(".select2-prefix-selector"))==null?void 0:i.parentElement:s=document.querySelector(`[name="${t}"]`),s&&(highlightElement(s),s.scrollIntoView({behavior:"smooth",block:"center"}),["INPUT","SELECT","TEXTAREA"].includes(s.tagName)&&s.focus())},100)},highlightElement=e=>{e.classList.add("highlight-error"),setTimeout(()=>e.classList.remove("highlight-error"),2e3)},handleUbigeoChange=async e=>{var s,i;if(!e)return;setErrors(r=>({...r,ubigeo:""}));const{data:t}=e;setFormData(r=>({...r,department:t.departamento,province:t.provincia,district:t.distrito,ubigeo:t.reniec||t.inei})),setLoading(!0);try{const r=cart.reduce((u,y)=>u+y.final_price*y.quantity,0),o=await DeliveryPricesRest.getShippingCost({ubigeo:t.reniec||t.inei,cart_total:r}),c=[];if(o.data.is_free&&o.data.qualifies_free_shipping&&c.push({type:"free",price:0,description:o.data.standard.description,deliveryType:o.data.standard.type,characteristics:o.data.standard.characteristics}),o.data.standard&&(!o.data.is_free||o.data.is_free&&!o.data.qualifies_free_shipping)){let u=o.data.standard.description;o.data.is_free||(u=u.replace(/envío gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),u||(u="Delivery a domicilio")),c.push({type:"standard",price:o.data.standard.price,description:u,deliveryType:o.data.standard.type,characteristics:o.data.standard.characteristics})}if(o.data.express&&o.data.express.price>0&&c.push({type:"express",price:o.data.express.price,description:o.data.express.description,deliveryType:o.data.express.type,characteristics:o.data.express.characteristics}),o.data.is_agency&&o.data.agency){const u=o.data.agency.price||0,y=o.data.agency.payment_on_delivery||!1;c.push({type:"agency",price:u,description:o.data.agency.description,deliveryType:o.data.agency.type,characteristics:o.data.agency.characteristics,paymentOnDelivery:y})}if(o.data.is_store_pickup&&o.data.store_pickup&&c.push({type:"store_pickup",price:0,description:o.data.store_pickup.description,deliveryType:o.data.store_pickup.type,characteristics:o.data.store_pickup.characteristics,selectedStores:o.data.store_pickup.selected_stores}),c.length===0)throw new Error("No hay opciones de envío disponibles");setShippingOptions(c),setSelectedOption(((s=c[0])==null?void 0:s.type)||null),setEnvio(((i=c[0])==null?void 0:i.price)||0)}catch(r){console.error("Error al obtener precios de envío:",r),toast.error("Sin cobertura",{description:"No realizamos envíos a esta ubicación",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"}),setShippingOptions([]),setSelectedOption(null),setEnvio(0)}setLoading(!1)};reactExports.useEffect(()=>{selectedUbigeo&&handleUbigeoChange(selectedUbigeo)},[cart,subTotal,descuentofinal]);const loadOptions=reactExports.useCallback(lodashExports.debounce((e,t)=>{if(e.length<3){t([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(e)}`).then(s=>{if(!s.ok)throw new Error("Error en la respuesta");return s.json()}).then(s=>{const i=s.map(r=>({value:r.reniec,label:`${r.distrito}, ${r.provincia}, ${r.departamento}`,data:{inei:r.inei,reniec:r.reniec,departamento:r.departamento,provincia:r.provincia,distrito:r.distrito}}));t(i)}).catch(s=>{console.error("Error:",s),t([])})},300),[]);reactExports.useEffect(()=>{const e=t=>{const s=t.element.dataset.code,i=t.element.dataset.flag;return server_browserExports.renderToString(jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-8 font-emoji text-center",children:i}),jsxRuntimeExports.jsx("b",{className:"me-1",children:t.text}),jsxRuntimeExports.jsx("span",{className:"text-sm text-opacity-20",children:s})]}))};$(".select2-prefix-selector").select2({dropdownCssClass:"py-1",containerCssClass:"!border !border-gray-300 !rounded p-2 !h-[42px]",arrowCssClass:'!text-primary top-1/2 -translate-y-1/2"',templateResult:function(t){if(!t.id)return t.text;var s=$(e(t));return s},templateSelection:function(t){if(!t.id)return t.text;var s=$(e(t));return s},matcher:function(t,s){if(!t.term||!s.element)return s;const i=s.element.dataset.country||"",r=s.text||"";return i.toLowerCase().includes(t.term.toLowerCase())||r.toLowerCase().includes(t.term.toLowerCase())?s:null}})},[formData.phone_prefix]);const[showPaymentModal,setShowPaymentModal]=reactExports.useState(!1),[showOpenPayModal,setShowOpenPayModal]=reactExports.useState(!1),[openPayTokenData,setOpenPayTokenData]=reactExports.useState(null),[showVoucherModal,setShowVoucherModal]=reactExports.useState(!1),[showVoucherModalBancs,setShowVoucherModalBancs]=reactExports.useState(!1),[currentPaymentMethod,setCurrentPaymentMethod]=reactExports.useState(null),[paymentRequest,setPaymentRequest]=reactExports.useState(null),handleContinueClick=e=>{if(e.preventDefault(),e&&e.preventDefault&&e.preventDefault(),!user){setShowLoginModal(!0);return}if(!validateForm()){focusFirstError(errors);return}if(!selectedOption){toast.error("Seleccione envío",{description:"Debe elegir un método de envío",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"});return}setShowPaymentModal(!0)},handlePaymentComplete=async paymentMethod=>{try{if(setShowPaymentModal(!1),setCurrentPaymentMethod(paymentMethod),paymentMethod==="openpay"){setShowOpenPayModal(!0);return}if(paymentMethod==="tarjeta"){if(!window.MercadoPago){console.error("❌ MercadoPago aún no se ha cargado.");return}const selectedShippingOption=shippingOptions.find(e=>e.type===selectedOption),deliveryType=selectedShippingOption?selectedShippingOption.deliveryType:"domicilio",request={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Perú",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:finalTotalWithCoupon||0,delivery:envio,delivery_type:deliveryType,cart,invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:finalTotalWithCoupon||0};try{const response=await processMercadoPagoPayment(request),data=response;data.status?(setSale(data.sale),setDelivery(data.delivery),setCode(data.code),conversionScripts&&Array.isArray(conversionScripts)&&conversionScripts.forEach(script=>{try{eval(script)}catch(e){console.error("Error executing conversion script:",e)}}),onPurchaseComplete&&onPurchaseComplete(data)):toast.error("Error en el Pago",{description:"El pago ha sido rechazado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(e){toast.error("Error en el Pago",{description:"No se llegó a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}}else if(paymentMethod==="yape"){const e=shippingOptions.find(i=>i.type===selectedOption),t=e?e.deliveryType:"domicilio",s={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Perú",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:finalTotalWithCoupon||0,delivery:envio,delivery_type:t,details:JSON.stringify(cart.map(i=>({id:i.id,quantity:i.quantity}))),invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,payment_proof:null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:finalTotalWithCoupon||0};setPaymentRequest(s),setShowVoucherModal(!0)}else if(paymentMethod==="transferencia"){const e=shippingOptions.find(i=>i.type===selectedOption),t=e?e.deliveryType:"domicilio",s={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Perú",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:finalTotalWithCoupon||0,delivery:envio,delivery_type:t,details:JSON.stringify(cart.map(i=>({id:i.id,quantity:i.quantity}))),invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,payment_proof:null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:finalTotalWithCoupon||0};setPaymentRequest(s),setShowVoucherModalBancs(!0)}}catch(e){console.error("Error en el pago:",e),toast.error("Error en el Pago",{description:"No se llegó a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}},handleOpenPayTokenCreated=async tokenData=>{try{console.log("💳 Token de OpenPay recibido:",tokenData),setOpenPayTokenData(tokenData),setShowOpenPayModal(!1),setPaymentLoading(!0);const selectedShippingOption=shippingOptions.find(e=>e.type===selectedOption),deliveryType=selectedShippingOption?selectedShippingOption.deliveryType:"domicilio",request={user_id:(user==null?void 0:user.id)||"",name:(formData==null?void 0:formData.name)||"",lastname:(formData==null?void 0:formData.lastname)||"",fullname:`${formData==null?void 0:formData.name} ${formData==null?void 0:formData.lastname}`,phone_prefix:(formData==null?void 0:formData.phone_prefix)||"51",email:(formData==null?void 0:formData.email)||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"Perú",department:(formData==null?void 0:formData.department)||"",province:(formData==null?void 0:formData.province)||"",district:(formData==null?void 0:formData.district)||"",ubigeo:(formData==null?void 0:formData.ubigeo)||"",address:(formData==null?void 0:formData.address)||"",number:(formData==null?void 0:formData.number)||"",comment:(formData==null?void 0:formData.comment)||"",reference:(formData==null?void 0:formData.reference)||"",amount:finalTotalWithCoupon||0,delivery:envio,delivery_type:deliveryType,cart,invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:"openpay",source_id:tokenData.token,device_session_id:tokenData.device_session_id,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:finalTotalWithCoupon||0};console.log("📤 Enviando request al backend:",request);const response=await processOpenPayPayment(request);console.log("📥 Respuesta del backend:",response),response&&response.status?(setSale(response.sale),setDelivery(response.delivery),setCode(response.code),setCart([]),localStorage.removeItem("cart"),conversionScripts&&Array.isArray(conversionScripts)&&conversionScripts.forEach(script=>{try{eval(script)}catch(e){console.error("Error executing conversion script:",e)}}),onPurchaseComplete&&onPurchaseComplete(response),toast.success("¡Pago exitoso!",{description:"Tu pedido ha sido procesado correctamente",icon:jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-5 w-5 text-green-500"}),duration:2e3,position:"bottom-center"}),setTimeout(()=>{onContinue()},1500)):(console.error("❌ Error: Respuesta sin status true",response),toast.error("Error en el Pago",{description:(response==null?void 0:response.message)||"El pago ha sido rechazado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"}),setPaymentLoading(!1))}catch(e){console.error("❌ Error en OpenPay handleOpenPayTokenCreated:",e),toast.error("Error en el Pago",{description:e.message||e||"No se llegó a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"}),setPaymentLoading(!1)}};reactExports.useEffect(()=>{setErrors(e=>{const t={...e};return Object.keys(formData).forEach(s=>{formData[s]&&delete t[s]}),t})},[formData]);const validateCoupon=async()=>{var e,t;if(!couponCode.trim()){setCouponError("Ingrese un código de cupón");return}setCouponLoading(!0),setCouponError("");try{couponCode.toUpperCase()==="TEST50"&&subTotal<100&&toast.warning("Información importante",{description:`El cupón TEST50 requiere un monto mínimo de ${CurrencySymbol()} 100.00. Tu carrito actual: ${CurrencySymbol()} ${Number2Currency(subTotal)}`,icon:jsxRuntimeExports.jsx(TriangleAlert,{className:"h-5 w-5 text-yellow-500"}),duration:5e3,position:"bottom-center"});const s=[...new Set(cart.map(c=>c.category_id).filter(Boolean))],i=[...new Set(cart.map(c=>c.id||c.item_id).filter(Boolean))],r=await CouponsRest.validateCoupon({code:couponCode.trim(),cart_total:subTotal,category_ids:s,product_ids:i}),o=r.data||r;if(o&&o.valid){setAppliedCoupon(o.coupon);const c=Math.round(o.discount*100)/100;setCouponDiscount(c),setCouponCode(""),setParentCouponCode&&setParentCouponCode(o.coupon.code),setParentCouponDiscount&&setParentCouponDiscount(c),toast.success("Cupón aplicado",{description:`Descuento de ${CurrencySymbol()} ${Number2Currency(c)} aplicado`,icon:jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-5 w-5 text-green-500"}),duration:3e3,position:"bottom-center"})}else{const c=(o==null?void 0:o.message)||"Cupón inválido o no aplicable a estos productos";setCouponError(c);let u=c;c.includes("monto mínimo")&&(u=`${c} Tu carrito actual: ${CurrencySymbol()} ${Number2Currency(subTotal)}`),toast.error("Cupón inválido",{description:u,icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"})}}catch(s){console.error("Error validating coupon:",s);const i=((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"Error al validar el cupón";setCouponError(i),toast.error("Error de validación",{description:i,icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{setCouponLoading(!1)}},removeCoupon=()=>{setAppliedCoupon(null),setCouponCode(""),setCouponDiscount(0),setCouponError(""),setParentCouponCode&&setParentCouponCode(""),setParentCouponDiscount&&setParentCouponDiscount(0),toast.success("Cupón removido",{description:"El cupón ha sido removido del pedido",icon:jsxRuntimeExports.jsx(Info,{className:"h-5 w-5 text-blue-500"}),duration:2e3,position:"bottom-center"})},roundToTwoDecimals=e=>Math.round((parseFloat(e)+Number.EPSILON)*100)/100,totalBase=roundToTwoDecimals(subTotal)+roundToTwoDecimals(igv)+roundToTwoDecimals(envio)-roundToTwoDecimals(autoDiscountTotal);let calculatedCouponDiscount=couponDiscount||0;reactExports.useEffect(()=>{setParentCouponDiscount&&setParentCouponDiscount(calculatedCouponDiscount)},[appliedCoupon,couponDiscount,setParentCouponDiscount]);const finalTotalWithCoupon=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),LoginModal=()=>jsxRuntimeExports.jsx(ReactModal,{isOpen:showLoginModal,onRequestClose:()=>setShowLoginModal(!1),className:"modal-content max-w-md mx-auto mt-20 bg-white rounded-lg p-6",overlayClassName:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Iniciar Sesión Requerido"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"Debe iniciar sesión para continuar con su compra"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 justify-center",children:[jsxRuntimeExports.jsx("button",{onClick:()=>setShowLoginModal(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancelar"}),jsxRuntimeExports.jsx("button",{onClick:()=>{setShowLoginModal(!1),window.location.href="/login"},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Iniciar Sesión"})]})]})}),selectStyles=e=>({control:t=>({...t,border:`1px solid ${e?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:e?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:t=>({...t,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:t=>({...t,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})});return reactExports.useEffect(()=>{if(coupon){let e=0;coupon.type==="percentage"?e=totalPrice*(coupon.amount/100):e=coupon.amount,setDescuentoFinal(e)}else setDescuentoFinal(0)},[totalPrice,coupon]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{jsx:!0,children:`
                .highlight-error {
                    animation: highlight 2s ease-in-out;
                    border: 2px solid #ef4444 !important;
                    box-shadow: 0 0 10px rgba(239, 68, 68, 0.3) !important;
                }
                
                @keyframes highlight {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                    100% { transform: scale(1); }
                }
                
                .modal-overlay {
                    z-index: 9999;
                }
                
                .modal-content {
                    max-height: 90vh;
                    overflow-y: auto;
                }
            `}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 lg:gap-8 ",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-3",children:jsxRuntimeExports.jsxs("form",{className:"space-y-6 bg-[#f9f9f9] py-6 px-4 sm:px-6 rounded-2xl font-paragraph",onSubmit:e=>e.preventDefault(),children:[jsxRuntimeExports.jsxs("div",{className:"sectionInformation space-y-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark ",children:"Información del contacto"}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(InputForm,{type:"text",label:"Nombres",name:"name",value:formData.name,error:errors.name,onChange:handleChange,placeholder:"Nombres",required:!0}),jsxRuntimeExports.jsx(InputForm,{label:"Apellidos",type:"text",name:"lastname",value:formData.lastname,error:errors.lastname,onChange:handleChange,placeholder:"Apellidos",required:!0})]}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 ",children:[jsxRuntimeExports.jsx(InputForm,{label:"Correo electrónico",type:"email",name:"email",value:formData.email,error:errors.email,onChange:handleChange,placeholder:"Ej. hola@gmail.com",required:!0}),jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsxs("label",{htmlFor:"phone",className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark",children:["Celular ",jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 w-full",children:[jsxRuntimeExports.jsx("div",{className:"max-w-[120px]",children:jsxRuntimeExports.jsx(StateManagedSelect$1,{name:"phone_prefix",value:prefixes.find(e=>e.realCode===formData.phone_prefix)?{value:prefixes.find(e=>e.realCode===formData.phone_prefix).realCode,label:`${prefixes.find(e=>e.realCode===formData.phone_prefix).beautyCode}`,flag:prefixes.find(e=>e.realCode===formData.phone_prefix).flag,code:prefixes.find(e=>e.realCode===formData.phone_prefix).beautyCode,country:prefixes.find(e=>e.realCode===formData.phone_prefix).country}:null,onChange:e=>setFormData(t=>({...t,phone_prefix:(e==null?void 0:e.value)||""})),options:prefixes.sort((e,t)=>e.country.localeCompare(t.country)).map(e=>({value:e.realCode,label:e.beautyCode,flag:e.flag,code:e.beautyCode,country:e.country})),formatOptionLabel:({flag:e,code:t,country:s})=>{var y,D;const i=prefixes.find(E=>E.country===s),r=((D=(y=i==null?void 0:i.isoCode)==null?void 0:y.ISO1)==null?void 0:D.toLowerCase())||s.toLowerCase().substring(0,2),o=[`https://flagsapi.com/${r.toUpperCase()}/flat/24.png`,`https://flagcdn.com/${r}.svg`,`https://purecatamphetamine.github.io/country-flag-icons/3x2/${r.toUpperCase()}.svg`,`https://cdn.jsdelivr.net/gh/hampusborgos/country-flags@main/svg/${r}.svg`,`https://raw.githubusercontent.com/lipis/flag-icons/main/flags/4x3/${r}.svg`];let c=0;const u=E=>{if(c++,c<o.length)E.target.src=o[c];else{E.target.style.display="none";const v=E.target.nextElementSibling;v&&v.classList.contains("flag-fallback")&&(v.style.display="flex")}};return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("img",{src:o[0],alt:`Bandera de ${s}`,className:"w-6 h-4 object-cover rounded-sm flex-shrink-0 border border-gray-200",onError:u,style:{minWidth:"24px",minHeight:"16px"}}),jsxRuntimeExports.jsx("div",{className:"flag-fallback w-6 h-4 bg-gray-200 rounded-sm flex items-center justify-center flex-shrink-0 border border-gray-300",style:{display:"none",minWidth:"24px",minHeight:"16px"},children:jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-500",children:r.toUpperCase()})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-sm",children:t})]})},placeholder:"País",isClearable:!1,isSearchable:!0,styles:{control:e=>({...e,minHeight:"48px",border:"1px solid #d1d5db",borderRadius:"0.75rem",fontSize:"14px","&:hover":{borderColor:"#9ca3af"},"&:focus-within":{borderColor:"#3b82f6",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.1)"}}),option:(e,t)=>({...e,backgroundColor:t.isSelected?"#3b82f6":t.isFocused?"#f3f4f6":"white",color:t.isSelected?"white":"#374151",padding:"8px 12px"}),singleValue:e=>({...e,display:"flex",alignItems:"center",gap:"6px"}),menu:e=>({...e,zIndex:9999})},filterOption:(e,t)=>e.data.country.toLowerCase().includes(t.toLowerCase())||e.data.code.toLowerCase().includes(t.toLowerCase())})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx(InputForm,{type:"text",id:"phone",name:"phone",value:formData.phone,error:errors.phone,onChange:handleChange,placeholder:"000 000 000"})})]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),jsxRuntimeExports.jsxs("div",{className:"sectionDelivery space-y-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark",children:"Dirección de envío"}),jsxRuntimeExports.jsxs("div",{id:"ubigeo-select-container",className:"form-group",children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark ",children:["Distrito / Provincia / Departamento (Ubicación de entrega)",jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),jsxRuntimeExports.jsx(AsyncSelect$1,{name:"ubigeo",cacheOptions:!0,value:selectedUbigeo,loadOptions,onChange:e=>{setSelectedUbigeo(e),handleUbigeoChange(e),setSearchInput("")},inputValue:searchInput,onInputChange:(e,{action:t})=>{t==="input-change"&&setSearchInput(e)},onFocus:()=>{setSelectedUbigeo(null),setSearchInput("")},onMenuOpen:()=>{selectedUbigeo&&(setSelectedUbigeo(null),setSearchInput(""))},placeholder:"Buscar por distrito | provincia | departamento ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:e})=>e.length<3?"Buscar por distrito | provincia | departamento ...":"No se encontraron resultados",isLoading:loading,styles:selectStyles(!!errors.ubigeo),formatOptionLabel:({data:e})=>jsxRuntimeExports.jsxs("div",{className:"text-sm py-1",children:[jsxRuntimeExports.jsx("div",{className:"font-medium",children:e.distrito}),jsxRuntimeExports.jsxs("div",{className:"text-gray-500",children:[e.provincia,", ",e.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),errors.ubigeo&&jsxRuntimeExports.jsx("div",{className:"text-red-500 text-sm mt-1",children:errors.ubigeo})]}),jsxRuntimeExports.jsx(InputForm,{label:"Avenida / Calle / Jirón",type:"text",name:"address",value:formData.address,error:errors.address,onChange:handleChange,placeholder:"Ingresa el nombre de la calle",required:!0}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(InputForm,{label:"Número",type:"text",name:"number",value:formData.number,error:errors.number,onChange:handleChange,placeholder:"Ingresa el número de la calle",required:!0}),jsxRuntimeExports.jsx(InputForm,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque",type:"text",name:"comment",value:formData.comment,onChange:handleChange,placeholder:"Ej. Casa 3, Dpto 101"})]}),shippingOptions.length>0&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark",children:"Método de envío"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:shippingOptions.map(e=>jsxRuntimeExports.jsx(OptionCard,{title:e.deliveryType,price:e.price,description:e.description,selected:selectedOption===e.type,paymentOnDelivery:e.paymentOnDelivery||!1,onSelect:()=>{setSelectedOption(e.type),setEnvio(e.price),e.type==="store_pickup"?setShowStoreSelector(!0):(setShowStoreSelector(!1),setSelectedStore(null))}},e.type))}),selectedOption&&shippingOptions.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-4 mt-4",children:(h=(d=shippingOptions.find(e=>e.type===selectedOption))==null?void 0:d.characteristics)==null?void 0:h.map((e,t)=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4 bg-[#F7F9FB] p-4 rounded-xl",children:[jsxRuntimeExports.jsx("div",{className:"w-5 flex-shrink-0",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info customtext-primary",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("path",{d:"M12 16v-4"}),jsxRuntimeExports.jsx("path",{d:"M12 8h.01"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:e})})]},`char-${t}`))}),showStoreSelector&&selectedOption==="store_pickup"&&jsxRuntimeExports.jsx(StorePickupSelector,{ubigeo:((j=selectedUbigeo==null?void 0:selectedUbigeo.data)==null?void 0:j.reniec)||((a=selectedUbigeo==null?void 0:selectedUbigeo.data)==null?void 0:a.inei),onStoreSelect:handleStoreSelect,selectedStore,specificStores:(n=shippingOptions.find(e=>e.type==="store_pickup"))==null?void 0:n.selectedStores})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"Tipo de comprobante"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"radio",className:"sr-only",name:"invoiceType",value:"boleta",checked:formData.invoiceType==="boleta",onChange:handleChange}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 border-2 rounded-full transition-all duration-200 ${formData.invoiceType==="boleta"?"border-primary bg-primary":"border-gray-300 bg-white group-hover:border-gray-400"}`,children:formData.invoiceType==="boleta"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})})]}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-sm font-medium customtext-neutral-dark",children:"Boleta"})]}),jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"radio",className:"sr-only",name:"invoiceType",value:"factura",checked:formData.invoiceType==="factura",onChange:handleChange}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 border-2 rounded-full transition-all duration-200 ${formData.invoiceType==="factura"?"border-primary bg-primary":"border-gray-300 bg-white group-hover:border-gray-400"}`,children:formData.invoiceType==="factura"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})})]}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-sm font-medium customtext-neutral-dark",children:"Factura"})]})]})]}),jsxRuntimeExports.jsx(InputForm,{label:formData.documentType==="dni"?"DNI":"RUC",type:"text",name:"document",value:formData.document,error:errors.document,onChange:handleChange,placeholder:`Ingrese su ${formData.documentType==="dni"?"DNI":"RUC"}`,maxLength:formData.documentType==="dni"?"8":"11",required:!0}),formData.invoiceType==="factura"&&jsxRuntimeExports.jsx(InputForm,{label:"Razón Social",type:"text",name:"businessName",value:formData.businessName,onChange:handleChange,placeholder:"Ingrese la razón social"})]})}),jsxRuntimeExports.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max font-paragraph",children:[jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold pb-6 customtext-neutral-dark",children:"Resumen de compra"}),jsxRuntimeExports.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:cart.map((e,t)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white p-0 rounded-xl",children:jsxRuntimeExports.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover rounded  "})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold customtext-neutral-dark text-base 2xl:text-lg mb-2",children:e.name}),(e==null?void 0:e.color)&&jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color:"," ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:e.color})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark",children:[e.quantity," "]})]})]})]})},e.id))}),jsxRuntimeExports.jsx("div",{className:"mt-6",children:appliedCoupon?jsxRuntimeExports.jsx("div",{className:"bg-secondary border  rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium customtext-neutral-dark   ",children:["Cupón aplicado: ",appliedCoupon.code]}),jsxRuntimeExports.jsxs("p",{className:"text-xs customtext-neutral-light",children:["Descuento: ",appliedCoupon.type==="percentage"?`${appliedCoupon.value}%`:`${CurrencySymbol()} ${Number2Currency(appliedCoupon.value)}`]})]})]}),jsxRuntimeExports.jsx("button",{onClick:removeCoupon,className:"text-red-600 hover:text-red-700 transition-colors",title:"Remover cupón",children:jsxRuntimeExports.jsx(CircleX,{})})]})}):jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Código de cupón",className:`w-full rounded-l-md border py-3 px-4 text-sm outline-none uppercase focus:border-[#C5B8D4] ${couponError?"border-red-500":"border-gray-300"}`,value:couponCode,onChange:e=>{setCouponCode(e.target.value),setCouponError("")},onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),validateCoupon())},disabled:couponLoading}),jsxRuntimeExports.jsx("button",{className:`rounded-r-md px-4 py-2 text-sm text-white transition-all duration-300 hover:opacity-90 ${couponLoading?"bg-gray-400 cursor-not-allowed":data!=null&&data.gradient?"bg-gradient":"bg-primary"}`,type:"button",onClick:validateCoupon,disabled:couponLoading,children:couponLoading?"...":"Aplicar"})]})})}),couponError&&jsxRuntimeExports.jsx("div",{className:"mt-2 text-red-500 text-sm",children:couponError}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(subTotal)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(igv)]})]}),autoDiscountTotal>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-green-600",children:[jsxRuntimeExports.jsx("span",{children:"Descuentos automáticos"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["-",CurrencySymbol()," ",Number2Currency(autoDiscountTotal)]})]}),appliedCoupon&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-blue-600",children:[jsxRuntimeExports.jsxs("span",{children:["Descuento cupón (",appliedCoupon.code,")"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["-",CurrencySymbol()," ",Number2Currency(calculatedCouponDiscount)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:selectedOption==="free"||selectedOption==="store_pickup"||envio===0?jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Gratis"}):`${CurrencySymbol()} ${Number2Currency(envio)}`})]}),jsxRuntimeExports.jsx("div",{className:"py-3 border-y-2 mt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," ",Number2Currency(appliedCoupon?finalTotalWithCoupon:totalFinal)]})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-4",children:[jsxRuntimeExports.jsx("button",{className:`w-full py-3 px-6 rounded-full font-semibold text-lg transition-all duration-300 hover:opacity-90 bg-primary ${(data==null?void 0:data.class_button)||" text-white"}`,onClick:handleContinueClick,children:"Continuar"}),jsxRuntimeExports.jsx("div",{id:"mercadopago-button-container"}),jsxRuntimeExports.jsx(ButtonSecondary,{className:"!rounded-full",onClick:noContinue,children:"Cancelar"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>openModal&&openModal(1),className:"customtext-primary font-bold",children:" Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>openModal&&openModal(0),className:"customtext-primary font-bold",children:" Política de Privacidad"}),"."]})})]})]})]}),jsxRuntimeExports.jsx(PaymentModal,{isOpen:showPaymentModal,contacts,onClose:()=>setShowPaymentModal(!1),onPaymentComplete:handlePaymentComplete}),jsxRuntimeExports.jsx(OpenPayCardModal,{isOpen:showOpenPayModal,onClose:()=>setShowOpenPayModal(!1),onTokenCreated:handleOpenPayTokenCreated}),jsxRuntimeExports.jsx(UploadVoucherModalYape,{isOpen:showVoucherModal,cart,subTotal,igv,totalFinal:appliedCoupon?finalTotalWithCoupon:totalFinal,envio,request:paymentRequest,onClose:()=>setShowVoucherModal(!1),paymentMethod:currentPaymentMethod,coupon:appliedCoupon,descuentofinal:calculatedCouponDiscount,autoDiscounts,autoDiscountTotal}),jsxRuntimeExports.jsx(UploadVoucherModalBancs,{isOpen:showVoucherModalBancs,cart,subTotal,igv,totalFinal:appliedCoupon?finalTotalWithCoupon:totalFinal,envio,contacts,request:paymentRequest,onClose:()=>setShowVoucherModalBancs(!1),paymentMethod:currentPaymentMethod,coupon:appliedCoupon,descuentofinal:calculatedCouponDiscount,autoDiscounts,autoDiscountTotal}),jsxRuntimeExports.jsx(LoginModal,{})]})}const recoveryOrderData=({code:d})=>new Promise(async(h,j)=>{try{console.log("Codigo de venta:",d);const{status:a,result:n}=await mainExports.Fetch("./api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d})});if(!a||!n.order){mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(n==null?void 0:n.message)||"Error no se pudo cargar la orden",type:"danger"}),j((n==null?void 0:n.message)||"Error no se pudo cargar la orde");return}h(n)}catch(a){console.error("Error en processMercadoPagoPayment:",a),mainExports.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:a.message||"Error en la integración con MercadoPago",type:"danger"}),j(a.message||"Error en la integración con MercadoPago")}});function ConfirmationStepSF({setCart:d,cart:h,code:j,delivery:a,data:n,automaticDiscounts:e=[],automaticDiscountTotal:t=0,couponDiscount:s=0,couponCode:i=null}){var P;const[r,o]=reactExports.useState(null),[c,u]=reactExports.useState(!0),[y,D]=reactExports.useState(null);if(reactExports.useEffect(()=>{j&&((async()=>{try{const b=await recoveryOrderData({code:j});o(b.order)}catch(b){D(b.message)}finally{u(!1)}})(),mainExports.Local.delete(`${Global.APP_CORRELATIVE}_cart`),mainExports.Local.set(`${Global.APP_CORRELATIVE}_cart`,[]))},[j]),c)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph text-center",children:jsxRuntimeExports.jsx("p",{children:"Cargando detalles de la orden..."})})});if(y)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph text-center text-red-500",children:jsxRuntimeExports.jsxs("p",{children:["Error al cargar la orden: ",y]})})});if(!r)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph text-center",children:jsxRuntimeExports.jsx("p",{children:"No se encontraron datos de la orden"})})});const E=((P=r==null?void 0:r.items)==null?void 0:P.reduce((p,b)=>{let T=0;b.type==="combo"?T=b.final_price||b.price||0:T=b.price||0;const I=b.quantity||0;return p+T*I},0))||0,v=parseFloat((E/1.18).toFixed(2)),l=parseFloat((E-v).toFixed(2)),f=parseFloat(r.delivery||0),g=parseFloat(r.coupon_discount||0),N=parseFloat(r.automatic_discount_total||0),_=parseFloat(v)+parseFloat(l)+f-g-N;return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-paragraph",children:jsxRuntimeExports.jsxs("div",{className:"text-center space-y-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-base xl:text-xl customtext-neutral-light",children:"Gracias por tu compra 🎉"}),jsxRuntimeExports.jsx("p",{className:"customtext-neutral-dark text-2xl xl:text-5xl font-semibold",children:"Tu orden ha sido recibida"}),jsxRuntimeExports.jsxs("div",{className:"py-4",children:[jsxRuntimeExports.jsx("div",{className:" customtext-neutral-light",children:"Código de pedido"}),jsxRuntimeExports.jsxs("div",{className:"customtext-neutral-dark text-lg font-semibold",children:["#",r.code]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6 border-b-2 pb-6",children:[r.items.map((p,b)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white rounded-xl w-max",children:jsxRuntimeExports.jsx("img",{src:p.image?`/storage/images/item/${p.image}`:"/assets/img/noimage/no_img.jpg",alt:p.name,className:"w-20 h-20 object-cover rounded",onError:T=>T.target.src="/assets/img/noimage/no_img.jpg"})}),jsxRuntimeExports.jsxs("div",{className:"text-start",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-lg",children:[p.name,p.is_free&&jsxRuntimeExports.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"¡GRATIS!"})]}),(p==null?void 0:p.color)&&jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color: ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:p.color})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:parseInt(p.quantity)})," - Precio: ",jsxRuntimeExports.jsxs("span",{className:"customtext-neutral-dark",children:[" ",CurrencySymbol()," ",Number2Currency(p.price)]}),p.is_free&&jsxRuntimeExports.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:"(Promoción)"})]})]})]})},b)),r.free_items&&r.free_items.length>0&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"pt-4 border-t border-dashed border-green-300",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-green-600 mb-3",children:"🎁 Productos gratuitos por promociones:"}),r.free_items.map((p,b)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white rounded-xl w-max border-2 border-green-200",children:jsxRuntimeExports.jsx("img",{src:p.image?`/storage/images/item/${p.image}`:"/assets/img/noimage/no_img.jpg",alt:p.name,className:"w-20 h-20 object-cover rounded",onError:T=>T.target.src="/assets/img/noimage/no_img.jpg"})}),jsxRuntimeExports.jsxs("div",{className:"text-start",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-lg",children:[p.name,jsxRuntimeExports.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"¡GRATIS!"})]}),(p==null?void 0:p.color)&&jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color: ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:p.color})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:parseInt(p.quantity)}),jsxRuntimeExports.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:'- Por promoción "Compra X Lleva Y"'})]})]})]})},`free-${b}`))]})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(v)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(l)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(r.delivery)]})]}),r.coupon_id&&jsxRuntimeExports.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[jsxRuntimeExports.jsxs("span",{children:["Cupón aplicado"," "]}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," -",Number2Currency(r.coupon_discount)]})]}),r.automatic_discounts&&r.automatic_discounts.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-2 mt-2 border-b pb-2",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-bold text-green-600 mb-1",children:"Descuentos automáticos aplicados:"}),r.automatic_discounts.map((p,b)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-green-700",children:[p.rule_name||p.name||"Descuento automático",jsxRuntimeExports.jsx("small",{className:"block text-xs font-light text-gray-600",children:p.description||"Promoción especial"})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-green-600",children:[CurrencySymbol()," -",Number2Currency(p.discount_amount||p.amount||0)]})]},b)),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[jsxRuntimeExports.jsx("span",{children:"Total descuentos automáticos:"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," -",Number2Currency(r.automatic_discount_total||0)]})]})]}),jsxRuntimeExports.jsx("div",{className:"py-3 border-y-2 mt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," ",Number2Currency(_)]})]})})]}),jsxRuntimeExports.jsx("div",{className:"pt-3",children:jsxRuntimeExports.jsx(ButtonPrimary,{href:"/catalogo",className:` !rounded-full ${n==null?void 0:n.class_button} `,children:"  Seguir Comprando"})})]})]})})})}function CheckoutStepsSF({cart:d,setCart:h,user:j,prefixes:a,ubigeos:n,items:e,contacts:t,data:s,generals:i=[]}){const[r,o]=reactExports.useState(1),[c,u]=reactExports.useState(0),y=d.reduce((S,R)=>{const B=R.type==="combo"?R.final_price||R.price:R.final_price;return S+B*R.quantity},0),[D,E]=reactExports.useState(0),v=parseFloat((y/1.18).toFixed(2)),l=parseFloat((y-v).toFixed(2)),[f,g]=reactExports.useState(0),[N,k]=reactExports.useState(null),[_,P]=reactExports.useState([]),[p,b]=reactExports.useState(0),[T,I]=reactExports.useState(null),L=S=>I(S),A=()=>I(null),O={privacy_policy:"Políticas de privacidad",terms_conditions:"Términos y condiciones",saleback_policy:"Políticas de devolucion y cambio"},M=v+l+parseFloat(D),U=f+p+c,q=Math.max(0,M-U),[z,V]=reactExports.useState([]),[m,x]=reactExports.useState([]),[w,C]=reactExports.useState([]);reactExports.useEffect(()=>{const R=new URLSearchParams(window.location.search).get("code");R&&(x(R),o(3))},[window.location.search]),reactExports.useEffect(()=>{m&&mainExports.Local.delete(`${Global.APP_CORRELATIVE}_cart`)},[m]),reactExports.useEffect(()=>{(()=>{const R=document.createElement("script");R.src="https://sdk.mercadopago.com/js/v2",R.async=!0,document.body.appendChild(R)})()},[]);const F=S=>{o(S),window.scrollTo({top:0,behavior:"smooth"})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"mb-4 md:mb-8",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${r>=1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[jsxRuntimeExports.jsx("span",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm bg-primary text-white border-primary",children:"1"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),jsxRuntimeExports.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:jsxRuntimeExports.jsx("div",{className:"absolute inset-0 transition-all duration-500 bg-primary",style:{width:r>1?"100%":"0%"}})}),jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${r>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[jsxRuntimeExports.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${r>1?"bg-primary text-white border-transparent":"bg-white customtext-primary  border-primary"}`,children:"2"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Envío"})]}),jsxRuntimeExports.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:jsxRuntimeExports.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${s!=null&&s.gradient?"bg-gradient":"bg-primary"}`,style:{width:r>2?"100%":"0%"}})}),jsxRuntimeExports.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${r===3?`${s!=null&&s.gradient?"customtext-gradient":"customtext-primary"} font-medium`:"customtext-neutral-dark"}`,children:[jsxRuntimeExports.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${r===3?s!=null&&s.gradient?"bg-gradient text-white border-transparent":"bg-primary text-white border-primary":s!=null&&s.gradient?"bg-white customtext-gradient border-gradient":"bg-white customtext-primary border-primary"}`,children:"3"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmación"})]})]})}),r===1&&jsxRuntimeExports.jsx(CartStepSF,{data:s,cart:d,setCart:h,onContinue:()=>F(2),subTotal:v,totalPrice:y,envio:D,igv:l,totalFinal:q,openModal:L,automaticDiscounts:_,setAutomaticDiscounts:P,automaticDiscountTotal:p,setAutomaticDiscountTotal:b,totalWithoutDiscounts:M}),r===2&&jsxRuntimeExports.jsx(ShippingStepSF,{data:s,setCode:x,setDelivery:C,cart:d,setSale:V,setCart:h,onContinue:()=>F(3),noContinue:()=>F(1),subTotal:v,totalPrice:y,envio:D,setEnvio:E,igv:l,totalFinal:q,user:j,prefixes:a,contacts:t,ubigeos:n,items:e,descuentofinal:c,setDescuentoFinal:u,openModal:L,setCouponDiscount:g,setCouponCode:k,automaticDiscounts:_,setAutomaticDiscounts:P,automaticDiscountTotal:p,setAutomaticDiscountTotal:b,totalWithoutDiscounts:M}),r===3&&jsxRuntimeExports.jsx(ConfirmationStepSF,{data:s,code:m,setCart:h,delivery:w,cart:z,subTotal:v,totalPrice:y,envio:D,igv:l,totalFinal:q,descuentofinal:c,setDescuentoFinal:u,couponDiscount:f,couponCode:N,automaticDiscounts:_,automaticDiscountTotal:p,totalWithoutDiscounts:M})]}),Object.keys(O).map((S,R)=>{var G;const B=O[S],W=((G=i.find(Y=>Y.correlative==S))==null?void 0:G.description)??"";return jsxRuntimeExports.jsx(ReactModal,{isOpen:T===R,onRequestClose:A,contentLabel:B,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:B}),jsxRuntimeExports.jsx("button",{onClick:A,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:jsxRuntimeExports.jsx(X,{size:24,strokeWidth:2})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsx("div",{className:"prose prose-gray max-w-none",children:jsxRuntimeExports.jsx(HtmlContent,{html:W})})}),jsxRuntimeExports.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:jsxRuntimeExports.jsx("button",{onClick:A,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},R)})]})}export{CheckoutStepsSF as default};

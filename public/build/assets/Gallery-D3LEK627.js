import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BOnQTV8N.js";import{c as X}from"./ReactAppend-QR5TrZfj.js";import{B as Y}from"./Base-BtKyxfJk.js";import{C as Z}from"./CreateReactScript-BVFa7_vB.js";import{G as J}from"./GalleryRest-Crk-WQDr.js";import{B as ee}from"./BasicRest-BML1C-ua.js";import{T as ae,t as r}from"./CardProductKatya-ncpmQ0JU.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./Global-Bz6gVLc5.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-BOTQKW2g.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";import"./BooleanLimit-D-OsQsek.js";class se extends ee{constructor(){super(),this.path="admin/gallery/config"}}function le(x){return x.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")}const E=new J,z=new se,ie=({images:x=[],allImages:u=[],isDevelopment:G=!1,canEdit:_=!1,session:o={},hasRootRole:C=!1,imageVisibilityConfig:te={}})=>{const[h,R]=m.useState(x.map(a=>(a.uuid=crypto.randomUUID(),a))),[T,I]=m.useState(!1),[S,V]=m.useState({}),[y,D]=m.useState(!1),[P,N]=m.useState(!1),[p,F]=m.useState(null),[i,b]=m.useState({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),[c,f]=m.useState(!1),A=m.useRef(),j=m.useCallback(()=>{var l,t;const a=(o==null?void 0:o.roles)||((l=o==null?void 0:o.user)==null?void 0:l.roles),s=C||((a==null?void 0:a.some(d=>d.name==="Root"))??!1);return console.log("ðŸ” hasRootRole ejecutÃ¡ndose:",{backendRootRole:C,session:o,sessionRoles:o==null?void 0:o.roles,userRoles:(t=o==null?void 0:o.user)==null?void 0:t.roles,roles:a,result:s}),s},[C,o]),L=m.useMemo(()=>(console.log("ðŸ“Š visibleImages - usando images directamente (backend ya filtrÃ³):",h),h),[h]),w=(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("local")||window.location.port==="8000")&&(G||_);m.useEffect(()=>{$(".image-popup").magnificPopup({type:"image",closeOnContentClick:!0,mainClass:"mfp-fade",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]}})},[h]),m.useEffect(()=>{if(console.log("ðŸš¨ Gallery Debug - Inicializando visibilidad:",{hasRootRole:j(),allImagesJSON:u,session:o,backendRootRole:C}),j()){const a={};u&&u.length>0&&u.forEach(s=>{if(s){const l=s.filename||s.src;a[l]=s.is_visible!==void 0?s.is_visible:!0,console.log(`ðŸ” Imagen "${s.name}" (${l}):`,{is_visible:s.is_visible,visibility:a[l]})}}),console.log("âœ… Visibilidad inicial configurada:",a),V(a)}else console.log("âŒ Usuario no es Root, no se inicializa visibilidad")},[u,j]);const M=async a=>{var t;const s=((t=a.target.files)==null?void 0:t[0])??null;if(!s)return;a.target.value=null;const l=a.target.name;f(!0);try{const d=new FormData;if(d.append("image",s),d.append("name",l),!await E.save(d))return;R(n=>n.map(g=>(g.src==l&&(g.uuid=crypto.randomUUID()),g))),r.success("Imagen actualizada correctamente")}catch(d){r.error("Error al actualizar la imagen"),console.error("Error updating image:",d)}finally{f(!1)}},U=()=>{b({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),F(null),N(!0)},B=(a,s)=>{b({title:a.name||a.title,filename:a.filename||a.src,description:a.description,src:a.src,fit:"cover",aspect:a.aspect,file:null}),F(s),N(!0)},q=a=>{var l;const s=((l=a.target.files)==null?void 0:l[0])??null;if(s){if(!s.type.startsWith("image/")){r.error("Por favor selecciona un archivo de imagen vÃ¡lido"),a.target.value=null;return}b(t=>({...t,file:s,src:s.name,filename:t.filename||s.name.split(".")[0]}))}},W=async()=>{var a;if(!i.title){r.error("Por favor completa el tÃ­tulo de la imagen");return}if(!i.filename){r.error("Por favor completa el nombre del archivo");return}if(p===null&&!i.file){r.error("Por favor selecciona un archivo de imagen");return}f(!0);try{let s=i.src;if(i.file){const n=new FormData;n.append("image",i.file);const g=`${i.filename.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}.png`;if(n.append("name",g),n.append("convert_to_png","true"),!await E.save(n)){r.error("Error al subir la imagen");return}s=g}if((a=A.current)!=null&&a.getDeleteFlag&&A.current.getDeleteFlag()){const n=new FormData;if(n.append("image_delete","DELETE"),!await E.save(n)){r.error("Error al eliminar la imagen");return}s=null}const l=[...h],t={name:i.title,title:i.title,filename:i.filename,description:i.description,src:s,fit:"cover",aspect:i.aspect,uuid:crypto.randomUUID()};p!==null?l[p]=t:l.push(t);const d=l.filter(n=>!n.is_system).map(n=>{const{uuid:g,is_system:k,...Q}=n;return Q});await z.save(d)&&(R(l),N(!1),r.success(p!==null?"Imagen actualizada correctamente":"Nueva imagen agregada correctamente"))}catch(s){r.error("Error al guardar la configuraciÃ³n de la imagen"),console.error("Error saving image config:",s)}finally{f(!1)}},H=a=>{V(s=>({...s,[a]:!s[a]}))},K=async()=>{D(!0);try{if(Object.keys(S).length===0){r.error("No hay imÃ¡genes para actualizar");return}const a=await E.updateVisibility(S);a.success?(r.success("ConfiguraciÃ³n de visibilidad guardada correctamente"),I(!1),setTimeout(()=>{window.location.reload()},1e3)):r.error(a.message||"Error al guardar la configuraciÃ³n de visibilidad")}catch(a){console.error("Error saving visibility:",a),r.error("Error al guardar la configuraciÃ³n de visibilidad: "+a.message)}finally{D(!1)}},O=async a=>{if(h[a].is_system){r.error("No se pueden eliminar las imÃ¡genes del sistema");return}if(confirm("Â¿EstÃ¡s seguro de que quieres eliminar esta imagen?")){f(!0);try{const l=h.filter((v,n)=>n!==a),t=l.filter(v=>!v.is_system).map(v=>{const{uuid:n,is_system:g,...k}=v;return k});await z.save(t)&&(R(l),r.success("Imagen eliminada correctamente"))}catch(l){r.error("Error al eliminar la imagen"),console.error("Error deleting image:",l)}finally{f(!1)}}};return e.jsxs("div",{className:"port",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"GalerÃ­a de ImÃ¡genes"}),e.jsx("small",{className:"text-muted",children:j()?"Administrador Root - Vista completa":"Vista de usuario"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[(()=>{const a=j();return console.log("ðŸŽ¯ Renderizando botÃ³n de visibilidad:",{isRoot:a}),a&&e.jsxs("button",{type:"button",className:"btn btn-info",onClick:()=>I(!0),disabled:c,children:[e.jsx("i",{className:"mdi mdi-eye-settings me-1"}),"Gestionar Visibilidad"]})})(),w&&e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:U,disabled:c,children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Agregar Nueva Imagen"]})]})]}),e.jsx("div",{className:"row portfolioContainer",children:L.map((a,s)=>{const l=le(a.name),t=a.is_system===!0;return e.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 natural personal",children:e.jsxs("div",{className:"gal-detail thumb",children:[t&&e.jsx("div",{style:{position:"absolute",top:"8px",left:"8px",zIndex:10,backgroundColor:"rgba(13, 110, 253, 0.9)",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"bold"},children:"SISTEMA"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:`/assets/resources/${a.src}?v=${a.uuid}`,className:"thumb-img img-fluid",alt:"work-thumbnail",onError:d=>d.target.src="/assets/resources/cover-404.svg",style:{aspectRatio:a.aspect,objectFit:"cover",objectPosition:"center",width:"100%"}}),e.jsxs("div",{className:"d-flex px-2 py-1 justify-content-center gap-1",style:{backgroundColor:"rgba(0, 0, 0, .25)",position:"absolute",bottom:0,width:"100%",borderRadius:"0 0 3px 3px"},children:[e.jsxs("a",{href:`/assets/resources/${a.src}`,className:"btn btn-xs btn-primary image-popup",title:a.name,children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"Abrir"]}),e.jsx("input",{type:"file",name:a.src,id:`image-${l}`,onChange:M,hidden:!0,accept:"image/*",disabled:c}),e.jsxs("label",{htmlFor:`image-${l}`,className:`btn btn-xs btn-dark ${c?"disabled":""}`,children:[e.jsx("i",{className:"mdi mdi-image-edit me-1"}),"Cambiar"]}),w&&!t&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"btn btn-xs btn-info",onClick:()=>B(a,s),disabled:c,children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Editar"]}),e.jsxs("button",{type:"button",className:"btn btn-xs btn-danger",onClick:()=>O(s),disabled:c,children:[e.jsx("i",{className:"mdi mdi-delete me-1"}),"Eliminar"]})]}),w&&t&&e.jsxs("button",{type:"button",className:"btn btn-xs btn-secondary",title:"Imagen del sistema - Solo se puede cambiar el archivo",disabled:!0,children:[e.jsx("i",{className:"mdi mdi-information me-1"}),"Sistema"]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{children:[a.name,t&&e.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"10px"},children:"SISTEMA"})]}),e.jsx("p",{className:"font-13 text-muted mb-2",children:a.description}),w&&e.jsxs("small",{className:"text-muted",children:["Aspect: ",a.aspect," | Archivo: ",a.filename||a.src,t&&e.jsx("span",{className:"text-primary",children:" | Imagen del sistema"})]})]})]})},s)})}),w&&P&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:p!==null?"Editar Imagen":"Agregar Nueva Imagen"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>N(!1),disabled:c})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"TÃ­tulo de la imagen *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Logo de login, Imagen de signup, etc.",value:i.title,onChange:a=>b({...i,title:a.target.value}),disabled:c}),e.jsx("small",{className:"text-muted",children:"Este es el nombre que se mostrarÃ¡ en el card"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del archivo *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: logo-login, bg-signup, header-email",value:i.filename,onChange:a=>b({...i,filename:a.target.value}),disabled:c}),e.jsx("small",{className:"text-muted",children:"Solo letras, nÃºmeros y guiones (sin espacios ni caracteres especiales)"})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Seleccionar imagen ",p===null&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"file",className:"form-control",accept:"image/*",onChange:q,disabled:c}),e.jsx("small",{className:"text-muted",children:p===null?"Selecciona un archivo de imagen (JPG, PNG, GIF, SVG, etc.)":"Opcional: Selecciona una nueva imagen para reemplazar la actual"}),i.file&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Archivo seleccionado: ",i.file.name]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"DescripciÃ³n"}),e.jsx("textarea",{className:"form-control",rows:"4",placeholder:"DescripciÃ³n de dÃ³nde y cÃ³mo se usa esta imagen",value:i.description,onChange:a=>b({...i,description:a.target.value}),disabled:c})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Aspect Ratio"}),e.jsxs("select",{className:"form-select",value:i.aspect,onChange:a=>b({...i,aspect:a.target.value}),disabled:c,children:[e.jsx("optgroup",{label:"Cuadrados",children:e.jsx("option",{value:"1",children:"1:1 (Cuadrado)"})}),e.jsxs("optgroup",{label:"Horizontales (Landscape)",children:[e.jsx("option",{value:"4/3",children:"4:3 (EstÃ¡ndar)"}),e.jsx("option",{value:"16/9",children:"16:9 (PanorÃ¡mico)"}),e.jsx("option",{value:"3/2",children:"3:2 (FotografÃ­a)"}),e.jsx("option",{value:"21/9",children:"21:9 (Ultrawide)"}),e.jsx("option",{value:"5/3",children:"5:3 (Ancho)"}),e.jsx("option",{value:"2/1",children:"2:1 (Banner)"})]}),e.jsxs("optgroup",{label:"Verticales (Portrait)",children:[e.jsx("option",{value:"3/4",children:"3:4 (Vertical estÃ¡ndar)"}),e.jsx("option",{value:"9/16",children:"9:16 (Vertical mÃ³vil)"}),e.jsx("option",{value:"2/3",children:"2:3 (FotografÃ­a vertical)"}),e.jsx("option",{value:"3/5",children:"3:5 (Vertical estrecho)"}),e.jsx("option",{value:"1/2",children:"1:2 (Vertical banner)"})]}),e.jsx("optgroup",{label:"Otros",children:e.jsx("option",{value:"auto",children:"Auto (Original)"})})]})]})})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>N(!1),disabled:c,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:W,disabled:c||!i.title||!i.filename||p===null&&!i.file,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),p!==null?"Actualizar":"Agregar"]})})]})]})})}),j()&&T&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"mdi mdi-eye-settings me-2"}),"Gestionar Visibilidad de ImÃ¡genes"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>I(!1),disabled:y})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"mdi mdi-information me-2"}),"Configura quÃ© imÃ¡genes serÃ¡n visibles para los usuarios que no tienen rol Root. Las imÃ¡genes desmarcadas solo serÃ¡n visibles para administradores Root."]}),e.jsx("div",{className:"row",children:(u||h).map((a,s)=>{const l=a.filename||a.src,t=a.is_system===!0;return e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"form-check form-switch me-3",children:e.jsx("input",{className:"form-check-input",type:"checkbox",id:`visibility-${l}`,checked:S[l]||!1,onChange:()=>H(l),disabled:y})}),e.jsx("div",{className:"flex-grow-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:`/assets/resources/${a.src}?v=${a.uuid}`,alt:a.name,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px",marginRight:"10px"},onError:d=>d.target.src="/assets/resources/cover-404.svg"}),e.jsxs("div",{children:[e.jsxs("div",{className:"fw-bold",children:[a.name,t&&e.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"9px"},children:"SISTEMA"})]}),e.jsx("small",{className:"text-muted",children:a.filename||a.src})]})]})})]})})})},s)})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>I(!1),disabled:y,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:K,disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),"Guardar ConfiguraciÃ³n"]})})]})]})})}),e.jsx(ae,{})]})};Z((x,u)=>{X.createRoot(x).render(e.jsx(Y,{...u,title:"Galeria",children:e.jsx(ie,{...u})}))});

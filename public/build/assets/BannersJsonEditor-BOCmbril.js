import{r as e,j as t,P as n,I as s,b as a,d as r,T as l}from"./vendor-react-CtPXetfm.js";import{S as c}from"./CartKuchara-Bi-J8T1O.js";import{I as i}from"./ImageFormGroup-Cr7oEweG.js";import"./vendor-swiper-Cr_RrIb_.js";e.forwardRef(({name:o="banners",label:m="Banners",initialValue:d=[],model:u="category"},b)=>{const[h,x]=e.useState([]),[g,j]=e.useState({}),p=e.useRef({});e.useImperativeHandle(b,()=>({getValue:()=>JSON.stringify(h),setValue:e=>{try{const t="string"==typeof e?JSON.parse(e):e;if(x(Array.isArray(t)?t:[]),Array.isArray(t)&&t.length>0){const e={};t.forEach((t,n)=>{e[n]=!0}),j(e)}}catch(t){x([])}},reset:()=>{x([]),p.current={}},getImageRefs:()=>p.current,getImageFiles:()=>{const e={};return Object.keys(p.current).forEach(t=>{const n=p.current[t];n?.current?.files?.[0]&&(e[`banner_image_${t}`]=n.current.files[0])}),e}}));const f=(e,t)=>{const n="up"===t?e-1:e+1;if(n<0||n>=h.length)return;const s=[...h];[s[e],s[n]]=[s[n],s[e]],x(s);const a=p.current[e];p.current[e]=p.current[n],p.current[n]=a;const r=g[e],l=g[n];j({...g,[e]:l,[n]:r})},N=(e,t,n)=>{const s=[...h];s[e]={...s[e],[t]:n},x(s)};return t.jsxs("div",{className:"form-group",children:[t.jsx("label",{className:"font-weight-bold mb-2",children:m}),t.jsxs("div",{className:"border rounded p-3 bg-light",children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsxs("small",{className:"text-muted",children:[h.length," banner",1!==h.length?"s":""," configurado",1!==h.length?"s":""]}),t.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{const e=[...h,{image:"",title:"",description:"",button_text:"",button_link:""}];x(e),j({...g,[e.length-1]:!0}),p.current[e.length-1]={current:null}},children:[t.jsx(n,{size:16,className:"mr-1"}),"Agregar Banner"]})]}),0===h.length?t.jsxs("div",{className:"text-center py-4 text-muted",children:[t.jsx(s,{size:48,className:"mb-2 opacity-50",style:{display:"block",margin:"0 auto"}}),t.jsx("p",{className:"mb-0",children:"No hay banners configurados"}),t.jsx("small",{children:'Haz clic en "Agregar Banner" para comenzar'})]}):t.jsx("div",{className:"space-y-2",children:h.map((e,n)=>t.jsxs("div",{className:"card mb-2 shadow-sm",children:[t.jsxs("div",{className:"card-header bg-white d-flex justify-content-between align-items-center p-2",children:[t.jsxs("button",{type:"button",className:"btn btn-link text-left flex-grow-1 text-decoration-none p-2",onClick:()=>(e=>{j({...g,[e]:!g[e]})})(n),children:[t.jsxs("strong",{children:["Banner ",n+1]}),e.title&&t.jsxs("small",{className:"text-muted ml-2",children:["- ",e.title]})]}),t.jsxs("div",{className:"d-flex gap-1",children:[n>0&&t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>f(n,"up"),title:"Mover arriba",children:t.jsx(a,{size:14})}),n<h.length-1&&t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>f(n,"down"),title:"Mover abajo",children:t.jsx(r,{size:14})}),t.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>(async e=>{const{isConfirmed:t}=await c.fire({title:"¿Eliminar banner?",text:"Esta acción no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(t){const t=h.filter((t,n)=>n!==e);x(t),delete p.current[e];const n={};Object.keys(p.current).forEach(t=>{const s=parseInt(t);s>e?n[s-1]=p.current[t]:s<e&&(n[s]=p.current[t])}),p.current=n;const s={};Object.keys(g).forEach(t=>{const n=parseInt(t);n<e?s[n]=g[t]:n>e&&(s[n-1]=g[t])}),j(s)}})(n),title:"Eliminar",children:t.jsx(l,{size:14})})]})]}),g[n]&&t.jsx("div",{className:"card-body p-3",children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx(i,{eRef:(p.current[n]||(p.current[n]={current:null}),p.current[n]),name:`banner_image_${n}`,label:"Imagen del Banner",col:"col-12",aspect:16/9,onChange:e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];N(n,"image",t.name)}}}),e.image&&t.jsxs("small",{className:"text-muted d-block mt-2",children:["Archivo actual: ",t.jsx("strong",{children:e.image})]})]}),t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Título"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Título del banner",value:e.title||"",onChange:e=>N(n,"title",e.target.value)})]}),t.jsxs("div",{className:"col-12 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Descripción"}),t.jsx("textarea",{className:"form-control form-control-sm",rows:"3",placeholder:"Descripción del banner",value:e.description||"",onChange:e=>N(n,"description",e.target.value)})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Texto del Botón"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Ver más",value:e.button_text||"",onChange:e=>N(n,"button_text",e.target.value)})]}),t.jsxs("div",{className:"col-md-6 mb-3",children:[t.jsx("label",{className:"font-weight-semibold small",children:"Link del Botón"}),t.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"/ruta-destino",value:e.button_link||"",onChange:e=>N(n,"button_link",e.target.value)})]})]})})]},`banner-${n}-${e.image||"new"}`))})]}),t.jsx("input",{type:"hidden",name:o,value:JSON.stringify(h)})]})}).displayName="BannersJsonEditor";

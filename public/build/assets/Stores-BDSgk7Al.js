import{j as o}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BOnQTV8N.js";import{c as W}from"./ReactAppend-DTVVXReZ.js";import{s as v}from"./server.browser-Bf4gQIc7.js";import{L as X,G as Z,M as ee}from"./esm-B3ahtdks.js";import{S as oe}from"./StoresRest-BUao0AM_.js";import{C as se}from"./CreateReactScript-Dt4tYlBy.js";import{B as re}from"./Base-BNMLY1YZ.js";import{T as ne}from"./Table-CB_M07BQ.js";import{M as le}from"./Modal-BYL-UsqM.js";import{I as a}from"./InputFormGroup-iZIO11ZN.js";import{T as ie}from"./TextareaFormGroup-CliirJM1.js";import{I as te}from"./ImageFormGroup-Brimgjsn.js";import{S as ce}from"./SwitchFormGroup-B-vmnVqk.js";import{S as H}from"./SelectFormGroup-D63EMIiA.js";import{D as q}from"./DxButton-DV0H-ZcL.js";import{S as h}from"./ProductCard-bzTeLWJW.js";import{G as ae}from"./Global-DWbVqTT_.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";import"./index-C0Swrixi.js";import"./BasicRest-Cu63-zcZ.js";import"./main-DKOTUah5.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./index-Do2fMH7A.js";import"./index.esm-BNsoPXs8.js";import"./index-NIGUFBhG.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./CanAccess-BY08P6cn.js";import"./tippy-react.esm-Ce0cOK54.js";import"./Logout-W0zm0J8x.js";import"./MenuItemContainer-CEON2wjZ.js";const B=new oe,de=({ubigeos:g=[]})=>{const d=i.useRef(),y=i.useRef(),p=i.useRef(),R=i.useRef(),w=i.useRef(),S=i.useRef(),C=i.useRef(),T=i.useRef(),b=i.useRef(),u=i.useRef(),m=i.useRef(),f=i.useRef(),j=i.useRef();i.useRef();const E=i.useRef(),F=i.useRef(),D=i.useRef(),[J,P]=i.useState(!1),[z,k]=i.useState({lat:-12.046374,lng:-77.042793}),[A,x]=i.useState(null),[L,M]=i.useState([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]),V=e=>{if(console.log(e),e!=null&&e.id?P(!0):P(!1),p.current.value=(e==null?void 0:e.id)??"",R.current.value=(e==null?void 0:e.name)??"",w.current.value=(e==null?void 0:e.address)??"",S.current.value=(e==null?void 0:e.phone)??"",C.current.value=(e==null?void 0:e.email)??"",T.current.value=(e==null?void 0:e.description)??"",u.current.value=(e==null?void 0:e.latitude)??"",m.current.value=(e==null?void 0:e.longitude)??"",E.current.value=(e==null?void 0:e.manager)??"",F.current.value=(e==null?void 0:e.capacity)??"",f.current&&(f.image.src=`/storage/images/store/${(e==null?void 0:e.image)??"undefined"}`),$(b.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),$(D.current).val((e==null?void 0:e.type)??"tienda").trigger("change"),j.current&&(j.current.checked=(e==null?void 0:e.status)??!0),e!=null&&e.business_hours)try{const s=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours;M(s)}catch(s){console.error("Error parsing business hours:",s)}else M([{day:"Lunes",open:"09:00",close:"18:00",closed:!1},{day:"Martes",open:"09:00",close:"18:00",closed:!1},{day:"Miércoles",open:"09:00",close:"18:00",closed:!1},{day:"Jueves",open:"09:00",close:"18:00",closed:!1},{day:"Viernes",open:"09:00",close:"18:00",closed:!1},{day:"Sábado",open:"09:00",close:"15:00",closed:!1},{day:"Domingo",open:"09:00",close:"15:00",closed:!0}]);if(e!=null&&e.latitude&&(e!=null&&e.longitude)){const s=parseFloat(e.latitude),r=parseFloat(e.longitude);if(!isNaN(s)&&!isNaN(r)){const n={lat:s,lng:r};k(n),x(n)}}else k({lat:-12.046374,lng:-77.042793}),x(null);$(y.current).modal("show")},K=async e=>{e.preventDefault();const s=u.current.value.trim(),r=m.current.value.trim();let n=null,t=null;if(s){if(n=parseFloat(s),console.log("Latitud procesada:",n,"desde:",s),n<-18.5||n>-.1){h.fire({title:"Error de validación",text:"La latitud debe estar entre -18.5 y -0.1 para ubicaciones en Perú",icon:"error"});return}if(!_(n,10,8)){h.fire({title:"Error de validación",text:"La latitud excede el formato permitido (máximo 10 dígitos con 8 decimales)",icon:"error"});return}n=Math.round(n*1e8)/1e8,console.log("Latitud truncada:",n)}if(r){if(t=parseFloat(r),console.log("Longitud procesada:",t,"desde:",r),t<-81.5||t>-68.5){h.fire({title:"Error de validación",text:"La longitud debe estar entre -81.5 y -68.5 para ubicaciones en Perú",icon:"error"});return}if(!_(t,11,8)){h.fire({title:"Error de validación",text:"La longitud excede el formato permitido (máximo 11 dígitos con 8 decimales)",icon:"error"});return}t=Math.round(t*1e8)/1e8,console.log("Longitud truncada:",t)}g.find(N=>N.reniec==b.current.value);const l=new FormData,c=p.current.value;console.log("DEBUG ID - Valor del ID a enviar:",c,"Tipo:",typeof c,"Vacío?:",!c),p.current.value?(l.append("id",p.current.value),console.log("DEBUG ID - ID agregado al FormData:",p.current.value)):console.log("DEBUG ID - No se agrega ID al FormData (valor vacío)"),l.append("name",R.current.value),l.append("address",w.current.value),l.append("phone",S.current.value),l.append("email",C.current.value),l.append("description",T.current.value),l.append("ubigeo",b.current.value),l.append("latitude",n!==null?n.toString():""),l.append("longitude",t!==null?t.toString():""),l.append("manager",E.current.value),l.append("capacity",F.current.value),l.append("type",D.current.value),l.append("status",j.current.checked?1:0),l.append("business_hours",JSON.stringify(L)),f.current&&f.current.files[0]&&l.append("image",f.current.files[0]),console.log("Datos a enviar:"),console.log("- Latitud:",n),console.log("- Longitud:",t);for(let N of l.entries())console.log(N[0]+": "+N[1]);await B.save(l)&&($(d.current).dxDataGrid("instance").refresh(),$(y.current).modal("hide"))},Y=async e=>{const{isConfirmed:s}=await h.fire({title:"Eliminar tienda",text:"¿Estás seguro de eliminar esta tienda?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await B.delete(e)||$(d.current).dxDataGrid("instance").refresh()},I=(e,s,r)=>{const n=[...L];n[e][s]=r,M(n)},Q=e=>{const s=e.latLng.lat(),r=e.latLng.lng();console.log("Coordenadas seleccionadas:",{lat:s,lng:r}),x({lat:s,lng:r}),u.current&&(u.current.value=s.toFixed(8)),m.current&&(m.current.value=r.toFixed(8)),h.fire({title:"Ubicación seleccionada",text:`Coordenadas: ${s.toFixed(6)}, ${r.toFixed(6)}`,icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})},U=()=>{var r,n;const e=parseFloat((r=u.current)==null?void 0:r.value),s=parseFloat((n=m.current)==null?void 0:n.value);if(!isNaN(e)&&!isNaN(s)){const t={lat:e,lng:s};k(t),x(t)}},_=(e,s,r)=>{if(e==null||isNaN(e))return!1;const t=Math.abs(e).toString().split("."),l=t[0],c=t[1]||"";console.log(`Validando coordenada: ${e}`),console.log(`Parte entera: ${l} (${l.length} dígitos)`),console.log(`Parte decimal: ${c} (${c.length} dígitos)`),console.log(`Total permitido: ${s}, decimales permitidos: ${r}`),c.length>r&&console.log(`Advertencia: Truncando decimales de ${c.length} a ${r} dígitos`);const G=s-r;return l.length>G?(console.log(`Error: Excede dígitos enteros permitidos (${l.length} > ${G})`),!1):(console.log("Coordenada válida (se truncará automáticamente si es necesario)"),!0)},O=e=>$(v.renderToString(o.jsxs("span",{children:[o.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),o.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]})));return o.jsxs(o.Fragment,{children:[o.jsx(ne,{gridRef:d,title:"Tiendas / Sucursales",rest:B,exportable:!0,exportableName:"stores",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nueva tienda",hint:"Nueva tienda",onClick:()=>V()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",cellTemplate:(e,{data:s})=>{s.image?e.html(v.renderToString(o.jsx("img",{src:`/storage/images/store/${s.image}`,alt:s.name,className:"img-thumbnail",style:{width:"50px",height:"50px",objectFit:"cover"}}))):e.html(v.renderToString(o.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:o.jsx("i",{className:"fas fa-store text-muted"})})))},allowExporting:!1},{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{data:s})=>{const r={tienda:"Tienda",oficina:"Oficina",almacen:"Almacén",showroom:"Showroom",otro:"Otro"},n={tienda:"success",oficina:"primary",almacen:"warning",showroom:"info",otro:"secondary"},t=r[s.type]||"No especificado",l=n[s.type]||"secondary";e.append(`<span class="badge bg-${l}">${t}</span>`)}},{dataField:"address",caption:"Dirección",width:"250px"},{dataField:"phone",caption:"Teléfono",width:"120px"},{dataField:"email",caption:"Email",width:"180px"},{dataField:"manager",caption:"Encargado",width:"150px"},{dataField:"ubigeo",caption:"Ubicación",width:"150px",cellTemplate:(e,{data:s})=>{const r=g.find(n=>n.reniec==s.ubigeo);r?e.html(v.renderToString(o.jsxs("div",{children:[o.jsx("small",{className:"d-block",children:r.distrito}),o.jsxs("small",{className:"text-muted",children:[r.provincia,", ",r.departamento]})]}))):e.text(s.ubigeo||"Sin ubicación")}},{dataField:"status",caption:"Estado",width:"100px",cellTemplate:(e,{data:s})=>{e.html(v.renderToString(o.jsx("span",{className:`badge ${s.status?"bg-success":"bg-danger"}`,children:s.status?"Activa":"Inactiva"})))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>V(s)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Y(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),o.jsxs(le,{modalRef:y,title:J?"Editar Tienda":"Agregar Tienda",onSubmit:K,size:"lg",children:[o.jsx("input",{ref:p,type:"hidden"}),o.jsxs("div",{id:"form-container",className:"row",children:[o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:R,label:"Nombre de la tienda",col:"col-12",required:!0})}),o.jsx("div",{className:"col-md-6",children:o.jsxs(H,{eRef:D,label:"Tipo de establecimiento",col:"col-12",required:!0,dropdownParent:"#form-container",children:[o.jsx("option",{value:"tienda",children:"Tienda"}),o.jsx("option",{value:"oficina",children:"Oficina"}),o.jsx("option",{value:"almacen",children:"Almacén"}),o.jsx("option",{value:"showroom",children:"Showroom"}),o.jsx("option",{value:"otro",children:"Otro"})]})}),o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:E,label:"Encargado",col:"col-12"})}),o.jsx("div",{className:"col-12",children:o.jsx(a,{eRef:w,label:"Dirección completa",col:"col-12",required:!0})}),o.jsx("div",{className:"col-12",children:o.jsx(H,{eRef:b,label:"Distrito/Ubigeo",col:"col-12",templateResult:O,templateSelection:O,dropdownParent:"#form-container",required:!0,children:g.map((e,s)=>o.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},s))})}),o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:S,label:"Teléfono",col:"col-12",type:"tel"})}),o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:C,label:"Email",col:"col-12",type:"email"})}),o.jsx("div",{className:"col-12",children:o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"card-header",children:o.jsxs("h5",{className:"card-title mb-0",children:[o.jsx("i",{className:"fas fa-map-marker-alt me-2"}),"Ubicación de la Tienda"]})}),o.jsxs("div",{className:"card-body",children:[o.jsx("div",{className:"mb-3",children:o.jsx(X,{googleMapsApiKey:ae.GMAPS_API_KEY,children:o.jsx(Z,{mapContainerStyle:{width:"100%",height:"400px",borderRadius:"8px"},center:z,zoom:15,onClick:Q,options:{streetViewControl:!0,mapTypeControl:!0,fullscreenControl:!0},children:A&&o.jsx(ee,{position:A,title:"Ubicación de la tienda"})})})}),o.jsxs("div",{className:"row",children:[o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:u,label:"Latitud",col:"col-12",type:"number",step:"0.00000001",min:"-18.5",max:"-0.1",placeholder:"Ej: -12.042626777544823",onChange:U})}),o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:m,label:"Longitud",col:"col-12",type:"number",step:"0.00000001",min:"-81.5",max:"-68.5",placeholder:"Ej: -77.04753389161506",onChange:U})})]}),o.jsx("div",{className:"row mt-3",children:o.jsx("div",{className:"col-12",children:o.jsx("div",{className:"d-flex gap-2 flex-wrap",children:o.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{x(null),u.current.value="",m.current.value=""},children:[o.jsx("i",{className:"fas fa-eraser me-1"}),"Limpiar"]})})})})]})]})}),o.jsx("div",{className:"col-md-6",children:o.jsx(a,{eRef:F,label:"Capacidad de atención (personas/día)",col:"col-12",type:"number",placeholder:"Ej: 50"})}),o.jsx("div",{className:"col-md-6",children:o.jsx(ce,{eRef:j,label:"Tienda activa",col:"col-12"})}),o.jsx("div",{className:"col-12",children:o.jsx(te,{eRef:f,label:"Imagen de la tienda",col:"col-12",accept:"image/*"})}),o.jsx("div",{className:"col-12",children:o.jsx(ie,{eRef:T,label:"Descripción",rows:3})}),o.jsx("div",{className:"col-12",children:o.jsxs("div",{className:"mb-3",children:[o.jsx("label",{className:"form-label",children:"Horarios de atención"}),o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{className:"table table-sm",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Día"}),o.jsx("th",{children:"Apertura"}),o.jsx("th",{children:"Cierre"}),o.jsx("th",{children:"Cerrado"})]})}),o.jsx("tbody",{children:L.map((e,s)=>o.jsxs("tr",{children:[o.jsx("td",{className:"align-middle",children:o.jsx("strong",{children:e.day})}),o.jsx("td",{children:o.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.open,onChange:r=>I(s,"open",r.target.value),disabled:e.closed})}),o.jsx("td",{children:o.jsx("input",{type:"time",className:"form-control form-control-sm",value:e.close,onChange:r=>I(s,"close",r.target.value),disabled:e.closed})}),o.jsx("td",{children:o.jsxs("div",{className:"form-check",children:[o.jsx("input",{type:"checkbox",className:"form-check-input",checked:e.closed,onChange:r=>I(s,"closed",r.target.checked)}),o.jsx("label",{className:"form-check-label",children:"Cerrado"})]})})]},s))})]})})]})})]})]})]})};se((g,d)=>{W.createRoot(g).render(o.jsx(re,{...d,title:"Tiendas / Sucursales",children:o.jsx(de,{...d})}))});

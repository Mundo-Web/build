import{r as e,j as s,q as t,i as a,bx as l,m as r,N as n,C as c}from"./vendor-react-DD0uBW7s.js";import{t as o}from"./GoogleSignInButton-BciphYP2.js";import"./ShippingStep-6aPVmI67.js";import{G as i}from"./Global-BAGAPG-V.js";import{C as d,N as m}from"./Number2Currency-BX4epFEo.js";import"./VoucherUpload-oFHePJeI.js";import{G as x}from"./General-ClVW7qxN.js";import{S as p}from"./SalesRest-C0CynmQb.js";import"./vendor-swiper-BQwfPLwm.js";import"./filepond-plugin-image-preview-DXJLhvZS.js";import"./CartKuchara-BG_NtHiU.js";import"./BasicRest-BuuGWTMX.js";import"./BooleanLimit-q2Ad9fGY.js";const u=new p;function h({isOpen:n,onClose:c,onUpload:p,paymentMethod:h,cart:j=[],subTotal:f,igv:b,envio:g,totalFinal:N,request:v,coupon:y=null,descuentofinal:w=0,autoDiscounts:k=[],autoDiscountTotal:C=0}){const[E,_]=e.useState(null),[$,S]=e.useState(!1),[R,O]=e.useState(""),A=e.useRef(null),D=async()=>{if(!$)if(R){S(!0);try{const e={...v,payment_proof:R,delivery_type:v.delivery_type||"domicilio",applied_promotions:v.applied_promotions?"string"==typeof v.applied_promotions?v.applied_promotions:JSON.stringify(v.applied_promotions):null},s=new FormData;Object.keys(e).forEach(t=>{null!==e[t]&&void 0!==e[t]&&s.append(t,e[t])});const t=await u.save(s);t&&(r.Local.delete(`${i.APP_CORRELATIVE}_cart`),location.href=`${location.origin}/cart?code=${t.code}`)}catch(e){o.error("Error al procesar el pago:",{description:"Ocurrió un error al procesar tu pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}finally{S(!1)}}else o.error("Error al subir comprobante",{description:"Por favor, sube tu comprobante de pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})};return e.useEffect(()=>(document.body.style.overflow=n?"hidden":"",()=>{document.body.style.overflow=""}),[n]),s.jsx(t,{isOpen:n,onRequestClose:c,className:"absolute left-1/2 -translate-x-1/2 bg-[#f5f5f5] rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden font-paragraph",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:s.jsxs("div",{className:"py-6 px-10 flex flex-col gap-3 max-h-[90vh] md:max-h-[95vh] overflow-y-auto",children:[s.jsx("div",{className:"flex justify-center items-center z-40",children:s.jsx("a",{href:"/",className:"flex items-center gap-2",children:s.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:i.APP_NAME,className:"h-14 object-contain object-center",onError:e=>{e.target.onerror=null,e.target.src="/assets/img/logo-bk.svg"}})})}),s.jsx("h2",{className:"text-xl 2xl:text-2xl font-bold customtext-primary text-center mt-3",children:x.get("checkout_dwallet_name")}),s.jsx("p",{className:"customtext-primary text-sm 2xl:text-base text-center",children:x.get("checkout_dwallet_description")}),s.jsx("div",{className:"w-full flex flex-row items-center justify-center my-1",children:s.jsx(a,{content:"Escanee codigo QR",children:s.jsx("img",{src:`/assets/resources/${x.get("checkout_dwallet_qr")}`,alt:x.get("checkout_dwallet_name"),className:"h-40 w-auto object-cover",onError:e=>{e.currentTarget.src="/assets/img/salafabulosa/logoyape.png"}})})}),s.jsxs("div",{className:"bg-[#EAE8E6] rounded-xl shadow-lg p-6 col-span-2 h-max font-paragraph",children:[s.jsx("h3",{className:"text-xl 2xl:text-2xl font-semibold pb-6 customtext-neutral-dark",children:"Detalle de compras"}),s.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:j.map((e,t)=>s.jsx("div",{className:"rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"bg-white p-0 rounded-xl",children:s.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover rounded  "})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold customtext-neutral-dark text-sm 2xl:text-base mb-1",children:e.name}),e?.color&&s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Color:"," ",s.jsx("span",{className:"customtext-neutral-dark",children:e.color})]}),s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Cantidad:"," ",s.jsxs("span",{className:"customtext-neutral-dark",children:[e.quantity," "]})]})]})]})},e.id))}),s.jsxs("div",{className:"space-y-2 mt-6 bg-white p-4 rounded-xl",children:[s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),s.jsxs("span",{className:"font-semibold",children:[d()," ",m(f)]})]}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),s.jsxs("span",{className:"font-semibold",children:[d()," ",m(b)]})]}),y&&s.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[s.jsxs("span",{children:["Cupón aplicado"," ",s.jsx(a,{content:"Eliminar",children:s.jsx("i",{className:"mdi mdi-close text-red-500 cursor-pointer",onClick:()=>setCoupon(null)})}),s.jsxs("small",{className:"block text-xs font-light",children:[y.code," ",s.jsx(a,{content:y.description,children:s.jsx("i",{className:"mdi mdi-information-outline ms-1"})})," ","(","percentage"===y.type?`${y.value}%`:`${d()} ${m(y.value)}`,")"]})]}),s.jsxs("span",{children:[d()," -",m(w)]})]}),k&&k.length>0&&s.jsx("div",{className:"mb-2 mt-2 border-b pb-2",children:s.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[s.jsx("span",{children:"Total descuentos automáticos:"}),s.jsxs("span",{children:[d()," -",m(C)]})]})}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),s.jsxs("span",{className:"font-semibold",children:[d()," ",m(g)]})]}),s.jsx("div",{className:"py-1 border-y",children:s.jsxs("div",{className:"flex justify-between font-bold text-lg 2xl:text-xl items-center",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:[d()," ",m(N)]})]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("input",{type:"file",ref:A,onChange:e=>{const s=e.target.files[0];s&&O(s)},accept:"image/png, image/jpeg, application/pdf",className:"hidden"}),R&&s.jsxs("div",{className:"bg-[#f1f1f1] p-4 rounded-lg border border-dashed",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm truncate",children:R.name}),s.jsx("button",{onClick:()=>{O(""),A.current&&(A.current.value="")},className:"text-red-500 hover:text-red-700",children:s.jsx(l,{className:"h-5 w-5"})})]}),R.type.startsWith("image/")&&s.jsx("div",{className:"mt-2",children:s.jsx("img",{src:URL.createObjectURL(R),alt:"Voucher preview",className:"max-h-28 mx-auto"})})]}),s.jsxs("div",{className:"pt-2 space-y-3",children:[s.jsx("button",{onClick:()=>{R?D():A.current?.click()},disabled:$,className:"w-full bg-primary text-white text-sm 2xl:text-base py-3 rounded-3xl font-medium "+($?"opacity-70 cursor-not-allowed":""),children:$?"Procesando...":R?"Confirmar pago":"Subir la captura del pago"}),s.jsx("button",{onClick:c,className:"w-full border border-primary text-sm 2xl:text-base py-3 rounded-3xl font-medium",children:"Cancelar"})]})]})]})})}function j({contacts:t}){const[a,l]=e.useState({}),r=t.find(e=>"transfer_accounts"===e.correlative),o=r?JSON.parse(r.description):[];return 0===o.length?s.jsx("div",{className:"max-w-md w-full bg-gray-100 rounded-md p-4",children:s.jsx("p",{className:"text-gray-800",children:"No hay cuentas bancarias registradas"})}):s.jsx("div",{className:"flex flex-col gap-3 w-full",children:o.map((e,t)=>s.jsxs("div",{className:"max-w-md w-full",children:[s.jsx("div",{className:"bg-gray-100 rounded-t-md p-4",children:s.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>(e=>{l(s=>({...s,[e]:!s[e]}))})(t),children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-8  rounded-none flex items-center justify-center overflow-hidden",children:e.image?s.jsx("img",{src:`/assets/resources/${e.image}`,alt:e.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"text-white font-bold text-xl",children:s.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})})}),s.jsx("span",{className:"font-medium text-gray-800 text-base",children:e.name||`Cuenta Bancaria ${t+1}`})]}),a[t]?s.jsx(n,{className:"text-amber-800"}):s.jsx(c,{className:"text-amber-800"})]})}),a[t]&&s.jsx("div",{className:"bg-gray-100 rounded-b-md p-4 pt-0 border-t border-gray-200",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.cc&&s.jsxs("div",{children:[s.jsx("p",{className:"text-amber-800 font-medium text-sm",children:"Número de Cuenta"}),s.jsx("p",{className:"text-gray-800 font-medium text-sm",children:e.cc})]}),e.cci&&s.jsxs("div",{children:[s.jsx("p",{className:"text-amber-800 font-medium text-sm",children:"Código Interbancario"}),s.jsx("p",{className:"text-gray-800 font-medium text-sm",children:e.cci})]}),e.description&&s.jsxs("div",{className:"col-span-2",children:[s.jsx("p",{className:"text-amber-800 font-medium text-sm",children:"Descripción"}),s.jsx("p",{className:"text-gray-800 font-medium text-sm",children:e.description})]})]})})]},t))})}const f=new p;function b({isOpen:n,onClose:c,onUpload:x,paymentMethod:p,cart:u=[],subTotal:h,igv:b,envio:g,totalFinal:N,request:v,contacts:y=[],coupon:w=null,descuentofinal:k=0,autoDiscounts:C=[],autoDiscountTotal:E=0}){const[_,$]=e.useState(null),[S,R]=e.useState(!1),[O,A]=e.useState(""),D=e.useRef(null),P=async()=>{if(!S)if(O){R(!0);try{const e={...v,payment_proof:O},s=new FormData;Object.keys(e).forEach(t=>{s.append(t,e[t])});const t=await f.save(s);t&&(r.Local.delete(`${i.APP_CORRELATIVE}_cart`),location.href=`${location.origin}/cart?code=${t.code}`)}catch(e){o.error("Error al procesar el pago:",{description:"Ocurrió un error al procesar tu pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})}finally{R(!1)}}else o.error("Error al subir comprobante",{description:"Por favor, sube tu comprobante de pago",icon:s.jsx(l,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"})};return e.useEffect(()=>(document.body.style.overflow=n?"hidden":"",()=>{document.body.style.overflow=""}),[n]),s.jsx(t,{isOpen:n,onRequestClose:c,className:"absolute left-1/2 -translate-x-1/2 bg-[#f5f5f5] rounded-2xl shadow-lg w-[95%] max-w-lg top-1/2 -translate-y-1/2 overflow-hidden font-paragraph",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:s.jsxs("div",{className:"py-6 px-10 flex flex-col gap-3 max-h-[90vh] md:max-h-[95vh] overflow-y-auto font-paragraph",children:[s.jsx("div",{className:"flex justify-center items-center z-40",children:s.jsx("a",{href:"/",className:"flex items-center gap-2",children:s.jsx("img",{src:`/assets/resources/logo.png?v=${crypto.randomUUID()}`,alt:i.APP_NAME,className:"h-14 object-contain object-center",onError:e=>{e.target.onerror=null,e.target.src="/assets/img/logo-bk.svg"}})})}),s.jsx("h2",{className:"text-xl 2xl:text-2xl font-bold customtext-primary text-center mt-3",children:"Felicitaciones!"}),s.jsx("p",{className:"customtext-primary mb-1 text-sm 2xl:text-base text-center",children:"Estás a un paso de completar tu compra, realiza la transferencia/depósito a nuestras cuentas."}),s.jsx("div",{className:"p-4 rounded-3xl bg-[#EAE8E6] flex flex-col gap-3 items-center",children:s.jsx("div",{className:"flex flex-col gap-3 w-full",children:s.jsx(j,{contacts:y})})}),s.jsxs("div",{className:"bg-[#EAE8E6] rounded-xl shadow-lg p-6 col-span-2 h-max font-paragraph",children:[s.jsx("h3",{className:"text-xl 2xl:text-2xl font-semibold pb-6 customtext-neutral-dark",children:"Detalle de compras"}),s.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:u.map((e,t)=>s.jsx("div",{className:"rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"bg-white p-0 rounded-xl",children:s.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover rounded  "})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold customtext-neutral-dark text-sm 2xl:text-base mb-1",children:e.name}),s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Color:"," ",s.jsx("span",{className:"customtext-neutral-dark",children:e.color})]}),s.jsxs("p",{className:"text-xs 2xl:text-sm customtext-neutral-light opacity-70",children:["Cantidad:"," ",s.jsxs("span",{className:"customtext-neutral-dark",children:[e.quantity," "]})]})]})]})},e.id))}),s.jsxs("div",{className:"space-y-2 mt-6 bg-white p-4 rounded-xl",children:[s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),s.jsxs("span",{className:"font-semibold",children:[d()," ",m(h)]})]}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),s.jsxs("span",{className:"font-semibold",children:[d()," ",m(b)]})]}),w&&s.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[s.jsxs("span",{children:["Cupón aplicado"," ",s.jsx(a,{content:"Eliminar",children:s.jsx("i",{className:"mdi mdi-close text-red-500 cursor-pointer",onClick:()=>setCoupon(null)})}),s.jsxs("small",{className:"block text-xs font-light",children:[w.name," ",s.jsx(a,{content:w.description,children:s.jsx("i",{className:"mdi mdi-information-outline ms-1"})})," ","(","percentage"===w.type?`-${Math.round(100*w.amount)/100}%`:`${d()} -${m(w.amount)}`,")"]})]}),s.jsxs("span",{children:[d()," -",m(k)]})]}),C&&C.length>0&&s.jsxs("div",{className:"mb-2 mt-2 border-b pb-2",children:[s.jsx("div",{className:"text-sm font-bold text-green-600 mb-1",children:"Descuentos automáticos aplicados:"}),C.map((e,t)=>s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsxs("span",{className:"text-green-700",children:[e.rule_name||e.name||"Descuento automático",s.jsx("small",{className:"block text-xs font-light text-gray-600",children:e.description||"Promoción especial"})]}),s.jsxs("span",{className:"font-semibold text-green-600",children:[d()," -",m(e.discount_amount||e.amount||0)]})]},t)),s.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[s.jsx("span",{children:"Total descuentos automáticos:"}),s.jsxs("span",{children:[d()," -",m(E)]})]})]}),s.jsxs("div",{className:"flex justify-between text-sm 2xl:text-base",children:[s.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),s.jsxs("span",{className:"font-semibold",children:[d()," ",m(g)]})]}),s.jsx("div",{className:"py-1 border-y",children:s.jsxs("div",{className:"flex justify-between font-bold text-lg 2xl:text-xl items-center",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:[d()," ",m(N)]})]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("input",{type:"file",ref:D,onChange:e=>{const s=e.target.files[0];s&&A(s)},accept:"image/png, image/jpeg, application/pdf",className:"hidden"}),O&&s.jsxs("div",{className:"bg-[#f1f1f1] p-4 rounded-lg border border-dashed",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm truncate",children:O.name}),s.jsx("button",{onClick:()=>{A(""),D.current&&(D.current.value="")},className:"text-red-500 hover:text-red-700",children:s.jsx(l,{className:"h-5 w-5"})})]}),O.type.startsWith("image/")&&s.jsx("div",{className:"mt-2",children:s.jsx("img",{src:URL.createObjectURL(O),alt:"Voucher preview",className:"max-h-28 mx-auto"})})]}),s.jsxs("div",{className:"pt-2 space-y-3",children:[s.jsx("button",{onClick:()=>{O?P():D.current?.click()},disabled:S,className:"w-full bg-primary text-white text-sm 2xl:text-base py-3 rounded-3xl font-medium "+(S?"opacity-70 cursor-not-allowed":""),children:S?"Procesando...":O?"Confirmar pago":"Subir la captura del pago"}),s.jsx("button",{onClick:c,className:"w-full border border-primary text-sm 2xl:text-base py-3 rounded-3xl font-medium",children:"Cancelar"})]})]})]})})}export{h as U,b as a};

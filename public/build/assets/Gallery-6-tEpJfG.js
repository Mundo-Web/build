import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BOnQTV8N.js";import{c as P}from"./ReactAppend-DTVVXReZ.js";import{B as U}from"./Base-7gkrOv9S.js";import{C as G}from"./CreateReactScript-BXKjjBW1.js";import{G as _}from"./GalleryRest-e3DwqTSB.js";import{B}from"./BasicRest-BCYKfs4R.js";import{T as V,t as d}from"./index-DRg3WPTA.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";import"./Global-DWbVqTT_.js";import"./tippy-react.esm-Ce0cOK54.js";import"./index-C0Swrixi.js";/* empty css              */import"./Logout-W0zm0J8x.js";import"./main-DKOTUah5.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-CEON2wjZ.js";import"./index.esm-BNsoPXs8.js";import"./index-NIGUFBhG.js";import"./CanAccess-CiBvBfVT.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";class q extends B{constructor(){super(),this.path="admin/gallery/config"}}const H=({id:o,col:I,label:D,eRef:c,required:C=!1,onChange:S=()=>{},aspect:b="21/9",hidden:u=!1,name:v})=>{o||(o=`ck-${crypto.randomUUID()}`),c||(c=m.useRef()),v||(v=o);const a=m.useRef(),[x,r]=m.useState(!1),[f,N]=m.useState(!1),y=async p=>{const g=p.target.files[0];if(g){const w=await File.toURL(g);a.current.src=w,r(!0),N(!1)}S(p)},A=()=>{a.current.src="/api/cover/thumbnail/null",c.current.value="",r(!1),N(!0),console.log(`Setting delete flag for ${v}: DELETE`),S({target:{files:[]}})},R=()=>f,k=()=>N(!1);return m.useEffect(()=>{c.image=a.current,c.getDeleteFlag=R,c.resetDeleteFlag=k,console.log(`ImageFormGroup ${v} - Setting up refs`),(()=>{var w;const g=(w=a.current)==null?void 0:w.src;r(g&&g!=="/api/cover/thumbnail/null"&&!g.includes("null"))})()},[f]),e.jsxs("div",{className:`form-group ${I} mb-2`,hidden:u,children:[e.jsxs("label",{htmlFor:o,className:"form-label",children:[D," ",C&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsxs("div",{style:{position:"relative",width:"100%"},children:[e.jsx("label",{htmlFor:o,style:{width:"100%"},children:e.jsx("img",{ref:a,className:"d-block border",src:"",onError:p=>p.target.src="/api/cover/thumbnail/null",onLoad:()=>{var g;const p=(g=a.current)==null?void 0:g.src;r(p&&p!=="/api/cover/thumbnail/null"&&!p.includes("null"))},style:{width:"100%",borderRadius:"4px",cursor:"pointer",aspectRatio:b,objectFit:"cover",objectPosition:"center",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)"}})}),x&&e.jsx("button",{type:"button",onClick:A,className:"btn btn-danger btn-sm",style:{position:"absolute",top:"8px",right:"8px",padding:"4px 8px",fontSize:"12px",borderRadius:"4px",zIndex:10},title:"Eliminar imagen",children:e.jsx("i",{className:"fa fa-trash"})})]}),e.jsx("input",{ref:c,id:o,type:"file",src:"",alt:"",hidden:!0,accept:"image/*",onChange:y})]})};function M(o){return o.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")}const T=new _,L=new q,O=({images:o=[],isDevelopment:I=!1,canEdit:D=!1})=>{const[c,C]=m.useState(o.map(s=>(s.uuid=crypto.randomUUID(),s))),[S,b]=m.useState(!1),[u,v]=m.useState(null),[a,x]=m.useState({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),[r,f]=m.useState(!1),N=m.useRef(),y=(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("local")||window.location.port==="8000")&&(I||D);m.useEffect(()=>{$(".image-popup").magnificPopup({type:"image",closeOnContentClick:!0,mainClass:"mfp-fade",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]}})},[c]);const A=async s=>{var i;const l=((i=s.target.files)==null?void 0:i[0])??null;if(!l)return;s.target.value=null;const t=s.target.name;f(!0);try{const h=new FormData;if(h.append("image",l),h.append("name",t),!await T.save(h))return;C(n=>n.map(j=>(j.src==t&&(j.uuid=crypto.randomUUID()),j))),d.success("Imagen actualizada correctamente")}catch(h){d.error("Error al actualizar la imagen"),console.error("Error updating image:",h)}finally{f(!1)}},R=()=>{x({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),v(null),b(!0)},k=(s,l)=>{x({title:s.name||s.title,filename:s.filename||s.src,description:s.description,src:s.src,fit:"cover",aspect:s.aspect,file:null}),v(l),b(!0)},p=s=>{var t;const l=((t=s.target.files)==null?void 0:t[0])??null;if(l){if(!l.type.startsWith("image/")){d.error("Por favor selecciona un archivo de imagen válido"),s.target.value=null;return}x(i=>({...i,file:l,src:l.name,filename:i.filename||l.name.split(".")[0]}))}},g=async()=>{var s;if(!a.title){d.error("Por favor completa el título de la imagen");return}if(!a.filename){d.error("Por favor completa el nombre del archivo");return}if(u===null&&!a.file){d.error("Por favor selecciona un archivo de imagen");return}f(!0);try{let l=a.src;if(a.file){const n=new FormData;n.append("image",a.file);const j=a.file.name.split(".").pop(),F=`${a.filename.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}.${j}`;if(n.append("name",F),!await T.save(n)){d.error("Error al subir la imagen");return}l=F}if((s=N.current)!=null&&s.getDeleteFlag&&N.current.getDeleteFlag()){const n=new FormData;if(n.append("image_delete","DELETE"),!await T.save(n)){d.error("Error al eliminar la imagen");return}l=null}const t=[...c],i={name:a.title,title:a.title,filename:a.filename,description:a.description,src:l,fit:"cover",aspect:a.aspect,uuid:crypto.randomUUID()};u!==null?t[u]=i:t.push(i);const h=t.filter(n=>!n.is_system).map(n=>{const{uuid:j,is_system:F,...z}=n;return z});await L.save(h)&&(C(t),b(!1),d.success(u!==null?"Imagen actualizada correctamente":"Nueva imagen agregada correctamente"))}catch(l){d.error("Error al guardar la configuración de la imagen"),console.error("Error saving image config:",l)}finally{f(!1)}},w=async s=>{if(c[s].is_system){d.error("No se pueden eliminar las imágenes del sistema");return}if(confirm("¿Estás seguro de que quieres eliminar esta imagen?")){f(!0);try{const t=c.filter((E,n)=>n!==s),i=t.filter(E=>!E.is_system).map(E=>{const{uuid:n,is_system:j,...F}=E;return F});await L.save(i)&&(C(t),d.success("Imagen eliminada correctamente"))}catch(t){d.error("Error al eliminar la imagen"),console.error("Error deleting image:",t)}finally{f(!1)}}};return e.jsxs("div",{className:"port",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:y&&e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:R,disabled:r,children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Agregar Nueva Imagen"]})}),e.jsx("div",{className:"row portfolioContainer",children:c.map((s,l)=>{const t=M(s.name),i=s.is_system===!0;return e.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 natural personal",children:e.jsxs("div",{className:"gal-detail thumb",children:[i&&e.jsx("div",{style:{position:"absolute",top:"8px",left:"8px",zIndex:10,backgroundColor:"rgba(13, 110, 253, 0.9)",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"bold"},children:"SISTEMA"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:`/assets/resources/${s.src}?v=${s.uuid}`,className:"thumb-img img-fluid",alt:"work-thumbnail",onError:h=>h.target.src="/assets/resources/cover-404.svg",style:{aspectRatio:s.aspect,objectFit:"cover",objectPosition:"center",width:"100%"}}),e.jsxs("div",{className:"d-flex px-2 py-1 justify-content-center gap-1",style:{backgroundColor:"rgba(0, 0, 0, .25)",position:"absolute",bottom:0,width:"100%",borderRadius:"0 0 3px 3px"},children:[e.jsxs("a",{href:`/assets/resources/${s.src}`,className:"btn btn-xs btn-primary image-popup",title:s.name,children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"Abrir"]}),e.jsx("input",{type:"file",name:s.src,id:`image-${t}`,onChange:A,hidden:!0,accept:"image/*",disabled:r}),e.jsxs("label",{htmlFor:`image-${t}`,className:`btn btn-xs btn-dark ${r?"disabled":""}`,children:[e.jsx("i",{className:"mdi mdi-image-edit me-1"}),"Cambiar"]}),y&&!i&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"btn btn-xs btn-info",onClick:()=>k(s,l),disabled:r,children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Editar"]}),e.jsxs("button",{type:"button",className:"btn btn-xs btn-danger",onClick:()=>w(l),disabled:r,children:[e.jsx("i",{className:"mdi mdi-delete me-1"}),"Eliminar"]})]}),y&&i&&e.jsxs("button",{type:"button",className:"btn btn-xs btn-secondary",title:"Imagen del sistema - Solo se puede cambiar el archivo",disabled:!0,children:[e.jsx("i",{className:"mdi mdi-information me-1"}),"Sistema"]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{children:[s.name,i&&e.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"10px"},children:"SISTEMA"})]}),e.jsx("p",{className:"font-13 text-muted mb-2",children:s.description}),y&&e.jsxs("small",{className:"text-muted",children:["Aspect: ",s.aspect," | Archivo: ",s.filename||s.src,i&&e.jsx("span",{className:"text-primary",children:" | Imagen del sistema"})]})]})]})},l)})}),y&&S&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:u!==null?"Editar Imagen":"Agregar Nueva Imagen"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>b(!1),disabled:r})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Título de la imagen *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Logo de login, Imagen de signup, etc.",value:a.title,onChange:s=>x({...a,title:s.target.value}),disabled:r}),e.jsx("small",{className:"text-muted",children:"Este es el nombre que se mostrará en el card"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del archivo *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: logo-login, bg-signup, header-email",value:a.filename,onChange:s=>x({...a,filename:s.target.value}),disabled:r}),e.jsx("small",{className:"text-muted",children:"Solo letras, números y guiones (sin espacios ni caracteres especiales)"})]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(H,{ref:N,name:"image",label:u!==null?"Cambiar imagen (opcional)":"Imagen *",aspect:a.aspect,onChange:p,required:u===null})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Descripción"}),e.jsx("textarea",{className:"form-control",rows:"4",placeholder:"Descripción de dónde y cómo se usa esta imagen",value:a.description,onChange:s=>x({...a,description:s.target.value}),disabled:r})]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Aspect Ratio"}),e.jsxs("select",{className:"form-select",value:a.aspect,onChange:s=>x({...a,aspect:s.target.value}),disabled:r,children:[e.jsx("optgroup",{label:"Cuadrados",children:e.jsx("option",{value:"1",children:"1:1 (Cuadrado)"})}),e.jsxs("optgroup",{label:"Horizontales (Landscape)",children:[e.jsx("option",{value:"4/3",children:"4:3 (Estándar)"}),e.jsx("option",{value:"16/9",children:"16:9 (Panorámico)"}),e.jsx("option",{value:"3/2",children:"3:2 (Fotografía)"}),e.jsx("option",{value:"21/9",children:"21:9 (Ultrawide)"}),e.jsx("option",{value:"5/3",children:"5:3 (Ancho)"}),e.jsx("option",{value:"2/1",children:"2:1 (Banner)"})]}),e.jsxs("optgroup",{label:"Verticales (Portrait)",children:[e.jsx("option",{value:"3/4",children:"3:4 (Vertical estándar)"}),e.jsx("option",{value:"9/16",children:"9:16 (Vertical móvil)"}),e.jsx("option",{value:"2/3",children:"2:3 (Fotografía vertical)"}),e.jsx("option",{value:"3/5",children:"3:5 (Vertical estrecho)"}),e.jsx("option",{value:"1/2",children:"1:2 (Vertical banner)"})]}),e.jsx("optgroup",{label:"Otros",children:e.jsx("option",{value:"auto",children:"Auto (Original)"})})]})]})})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Ejemplos de títulos y nombres de archivo:"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("ul",{className:"list-unstyled small text-muted",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Logo de login" → ',e.jsx("strong",{children:"Archivo:"})," logo-login"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Fondo de registro" → ',e.jsx("strong",{children:"Archivo:"})," bg-signup"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Recuperar contraseña" → ',e.jsx("strong",{children:"Archivo:"})," forgot-password"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Header de emails" → ',e.jsx("strong",{children:"Archivo:"})," email-header"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("ul",{className:"list-unstyled small text-muted",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Hero del dashboard" → ',e.jsx("strong",{children:"Archivo:"})," dashboard-hero"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Placeholder de perfil" → ',e.jsx("strong",{children:"Archivo:"})," profile-placeholder"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Página de mantenimiento" → ',e.jsx("strong",{children:"Archivo:"})," maintenance"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Título:"}),' "Error 404" → ',e.jsx("strong",{children:"Archivo:"})," 404-error"]})]})})]}),e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"mdi mdi-information me-1"}),"El archivo se guardará automáticamente en /assets/resources/ con el formato: nombre-archivo.extensión"]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>b(!1),disabled:r,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:g,disabled:r||!a.title||!a.filename||u===null&&!a.file,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),u!==null?"Actualizar":"Agregar"]})})]})]})})}),e.jsx(V,{})]})};G((o,I)=>{P.createRoot(o).render(e.jsx(U,{...I,title:"Galeria",children:e.jsx(O,{...I})}))});

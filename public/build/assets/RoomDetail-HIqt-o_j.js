import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as d}from"./index-BOnQTV8N.js";import{A as v}from"./index.esm-BaU9YRy4.js";import{S as m}from"./CartKuchara-CVImXKD8.js";import{D as w}from"./index.es-Nme5hqeG.js";import"./SearchWidget-D7iHOckK.js";import{e as _}from"./es-QTeD0CGG.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B9ygI19o.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./floating-ui.react-ClVkAjx3.js";import"./floating-ui.dom-CID5cQpR.js";import"./index-B8-haksW.js";import"./index-BLHw34Di.js";import"./format-B6vr9H0z.js";const W=({room:s,searchParams:c,cart:b,setCart:k})=>{var j,y,N;const[i,C]=d.useState(c!=null&&c.check_in?new Date(c.check_in):null),[l,f]=d.useState(c!=null&&c.check_out?new Date(c.check_out):null),[p,T]=d.useState((c==null?void 0:c.guests)||2),[h,g]=d.useState(!1),[t,$]=d.useState(null),[u,I]=d.useState(0),D={standard:"Estándar",suite:"Suite",deluxe:"Deluxe",presidential:"Presidencial",family:"Familiar",executive:"Ejecutiva"},o=i&&l?Math.ceil((l-i)/(1e3*60*60*24)):0;d.useEffect(()=>{i&&l&&S()},[i,l]);const S=async()=>{try{const r=await(await fetch(`/api/hotels/rooms/${s.id}/availability`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({check_in:i.toISOString().split("T")[0],check_out:l.toISOString().split("T")[0]})})).json();r.status===200&&$(r.data)}catch(a){console.error("Error al verificar disponibilidad:",a)}},O=async()=>{if(!i||!l){m.fire({icon:"warning",title:"Fechas requeridas",text:"Por favor selecciona las fechas de check-in y check-out"});return}if(!(t!=null&&t.available)){m.fire({icon:"error",title:"No disponible",text:"Esta habitación no está disponible para las fechas seleccionadas"});return}g(!0);try{if(b.find(n=>n.type==="booking"&&n.id===s.id&&n.check_in===i.toISOString().split("T")[0]&&n.check_out===l.toISOString().split("T")[0])){m.fire({icon:"info",title:"Ya en el carrito",text:"Esta reserva ya está en tu carrito",confirmButtonText:"Ir al carrito",showCancelButton:!0,cancelButtonText:"Continuar viendo"}).then(n=>{n.isConfirmed&&v.visit("/carrito")}),g(!1);return}const r={id:s.id,type:"booking",name:s.name,image:s.image,price:t.price_per_night||s.final_price,final_price:t.price_per_night||s.final_price,discount:s.discount||0,check_in:i.toISOString().split("T")[0],check_out:l.toISOString().split("T")[0],nights:o,guests:p,max_occupancy:s.max_occupancy,beds_count:s.beds_count,room_type:s.room_type,amenities:s.amenities||[],quantity:1,total_price:t.total_price},E=[...b,r];k(E),await m.fire({icon:"success",title:"¡Agregado al carrito!",html:`
                    <p class="mb-2">La reserva ha sido agregada al carrito</p>
                    <p class="text-sm text-gray-600">
                        ${s.name}<br/>
                        ${o} noche${o!==1?"s":""} - ${p} huésped${p!==1?"es":""}<br/>
                        <strong>S/ ${t.total_price.toFixed(2)}</strong>
                    </p>
                `,confirmButtonText:"Ir al carrito",showCancelButton:!0,cancelButtonText:"Continuar viendo"}).then(n=>{n.isConfirmed&&v.visit("/carrito")})}catch(a){m.fire({icon:"error",title:"Error",text:a.message||"Ocurrió un error al procesar la reserva"})}finally{g(!1)}},x=[{url:s.image?`/api/items/media/${s.image}`:"/images/placeholder-room.jpg",alt:s.name}];return s.images&&s.images.length>0&&s.images.forEach(a=>{x.push({url:`/api/items/media/${a.url}`,alt:`${s.name} - Imagen ${x.length}`})}),e.jsxs("div",{className:"py-8 px-[5%] replace-max-w-here mx-auto",children:[e.jsx("nav",{className:"mb-6","aria-label":"breadcrumb",children:e.jsxs("ol",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("li",{children:e.jsx("a",{href:"/",className:"text-gray-600 hover:text-primary transition-colors",children:"Inicio"})}),e.jsx("li",{className:"text-gray-400",children:"/"}),e.jsx("li",{children:e.jsx("a",{href:"/habitaciones",className:"text-gray-600 hover:text-primary transition-colors",children:"Habitaciones"})}),e.jsx("li",{className:"text-gray-400",children:"/"}),e.jsx("li",{className:"text-gray-900 font-medium",children:s.name})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"relative h-[500px]",children:[e.jsx("img",{src:x[u].url,alt:x[u].alt,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"inline-block px-4 py-2 bg-primary text-white rounded-full text-sm font-semibold shadow-lg",children:D[s.room_type]||s.room_type})}),s.discount>0&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("span",{className:"inline-block px-4 py-2 bg-red-600 text-white rounded-full text-sm font-bold shadow-lg",children:["-",s.discount_percent,"%"]})})]}),x.length>1&&e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:x.map((a,r)=>e.jsx("button",{className:`flex-shrink-0 w-24 h-20 rounded-lg overflow-hidden border-2 transition-all ${u===r?"border-primary shadow-md":"border-gray-200 hover:border-gray-300"}`,onClick:()=>I(r),children:e.jsx("img",{src:a.url,alt:a.alt,className:"w-full h-full object-cover"})},r))})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-gray-900",children:"Descripción"}),s.summary&&e.jsx("p",{className:"text-lg text-gray-600 mb-4",children:s.summary}),s.description&&e.jsx("div",{className:"prose max-w-none text-gray-700",dangerouslySetInnerHTML:{__html:s.description}})]}),s.amenities&&s.amenities.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-gray-900",children:"Amenidades"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.amenities.map(a=>e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx("i",{className:`${a.icon||"fas fa-check-circle"} text-green-600 text-xl`}),e.jsx("span",{className:"font-medium",children:a.name})]},a.id))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 sticky top-5",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx("i",{className:"fas fa-users mr-2 text-primary"}),e.jsxs("span",{className:"text-sm",children:[s.max_occupancy," personas"]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx("i",{className:"fas fa-bed mr-2 text-green-600"}),e.jsxs("span",{className:"text-sm",children:[s.beds_count," cama",s.beds_count!==1?"s":""]})]}),s.size_m2>0&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx("i",{className:"fas fa-ruler-square mr-2 text-blue-600"}),e.jsxs("span",{className:"text-sm",children:[s.size_m2," m²"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[s.discount>0&&e.jsxs("span",{className:"text-xl line-through text-gray-400",children:["S/ ",(j=s.price)==null?void 0:j.toFixed(2)]}),e.jsxs("span",{className:"text-4xl font-bold text-primary",children:["S/ ",(y=s.final_price)==null?void 0:y.toFixed(2)]}),e.jsx("span",{className:"text-gray-600",children:"/ noche"})]}),t&&o>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-blue-900",children:[e.jsxs("strong",{children:["Total: S/ ",(N=t.total_price)==null?void 0:N.toFixed(2)]})," ","por ",o," noche",o!==1?"s":""]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-check mr-2 text-green-600"}),"Check-in"]}),e.jsx(w,{selected:i,onChange:a=>{if(C(a),l&&l<=a){const r=new Date(a);r.setDate(r.getDate()+1),f(r)}},minDate:new Date,dateFormat:"dd/MM/yyyy",locale:_,placeholderText:"Selecciona fecha",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-calendar-times mr-2 text-red-600"}),"Check-out"]}),e.jsx(w,{selected:l,onChange:f,minDate:i||new Date,dateFormat:"dd/MM/yyyy",locale:_,placeholderText:"Selecciona fecha",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx("i",{className:"fas fa-users mr-2 text-blue-600"}),"Huéspedes"]}),e.jsx("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",value:p,onChange:a=>T(parseInt(a.target.value)),children:[...Array(s.max_occupancy)].map((a,r)=>e.jsxs("option",{value:r+1,children:[r+1," ",r+1===1?"huésped":"huéspedes"]},r+1))})]}),t&&e.jsxs("div",{className:`rounded-lg p-3 mb-4 ${t.available?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("i",{className:`fas ${t.available?"fa-check-circle text-green-600":"fa-times-circle text-red-600"} mr-2`}),e.jsx("span",{className:t.available?"text-green-800":"text-red-800",children:t.available?`${t.available_rooms} habitación(es) disponible(s)`:"No disponible para estas fechas"})]}),e.jsx("button",{className:`w-full py-3 px-6 rounded-lg font-semibold text-white transition-all ${h||!i||!l||t&&!t.available?"bg-gray-400 cursor-not-allowed":"bg-primary hover:bg-primary-dark shadow-lg hover:shadow-xl"}`,onClick:O,disabled:h||!i||!l||t&&!t.available,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-calendar-check mr-2"}),"Reservar Ahora"]})}),e.jsxs("p",{className:"text-gray-600 text-center text-xs mt-3",children:[e.jsx("i",{className:"fas fa-shield-alt mr-1"}),"Reserva segura - Cancela hasta 24h antes"]})]})})]})]})};export{W as default};

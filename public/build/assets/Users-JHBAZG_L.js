var e=Object.defineProperty,r=(r,a,t)=>((r,a,t)=>a in r?e(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t)(r,"symbol"!=typeof a?a+"":a,t);import{c as a,j as t,r as n}from"./vendor-react-C1oWoR6m.js";import{B as o}from"./Base-DIIKdflX.js";import{C as i}from"./CreateReactScript-BJFDEtj6.js";import{T as s}from"./Table-DCfa5v9F.js";import{I as l}from"./InputFormGroup-l6evfr7v.js";import{R as c}from"./ReactAppend--Pw8l4To.js";import{D as d}from"./DxButton-C6FT_beP.js";import{S as u}from"./SwitchFormGroup-DKMokO1e.js";import{S as m}from"./CartKuchara-BuGNrbqJ.js";import{B as p}from"./BasicRest-DnRFj80Z.js";import{M as f}from"./Modal-CWcezBPC.js";import{S as h}from"./SelectFormGroup-D_s9hddn.js";import"./vendor-swiper-Cr_RrIb_.js";import"./Footer-Cr_V_wDJ.js";import"./TippyButton-BSvqLt5w.js";import"./Logout-CvUqt5iR.js";import"./MenuItemContainer-b-RC8xO_.js";import"./Menu-v3vTXHgl.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./BooleanLimit-q2Ad9fGY.js";import"./OpenPayCardModal-DoDTV5Bn.js";const j=new class extends p{constructor(){super(...arguments),r(this,"path","admin/users"),r(this,"hasFiles",!1)}},x=({})=>{const e=n.useRef(),r=n.useRef(),a=n.useRef(),o=n.useRef(),i=n.useRef(),p=n.useRef(),x=n.useRef(),v=n.useRef(),b=n.useRef(),R=n.useRef(),g=n.useRef(),w=n.useRef(),[C,y]=n.useState(!1),N=e=>{y(!!e?.id),a.current.value=e?.id??"",o.current.value=e?.name??"",i.current.value=e?.lastname??"",p.current.value=e?.email??"",x.current.value="",v.current.value="",b.current.value=e?.phone??"",R.current.value=e?.phone_prefix??"+51",g.current.value=e?.dni??"",e?.roles&&e?.roles.length>0?$(w.current).val(e.roles[0].name).trigger("change"):$(w.current).val("Admin").trigger("change"),$(r.current).modal("show")},S=e=>{if(!e||0===e.length)return"Sin rol";const r=e[0].name;switch(r){case"Root":return"Super Administrador";case"Admin":return"Administrador";default:return r}},B=e=>{if(!e||0===e.length)return"badge-secondary";switch(e[0].name){case"Root":return"badge-danger";case"Admin":return"badge-primary";default:return"badge-secondary"}};return t.jsxs(t.Fragment,{children:[t.jsx(s,{gridRef:e,title:"Usuarios del Sistema",rest:j,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}}),r.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo usuario",hint:"Crear nuevo usuario",onClick:()=>N()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre completo",width:"25%",cellTemplate:(e,{data:r})=>{c(e,t.jsxs("div",{children:[t.jsxs("strong",{children:[r.name," ",r.lastname]}),t.jsx("br",{}),t.jsx("small",{className:"text-muted",children:r.email})]}))}},{dataField:"phone",caption:"Teléfono",cellTemplate:(e,{data:r})=>{r.phone?c(e,t.jsxs("span",{children:[r.phone_prefix||"+51"," ",r.phone]})):c(e,t.jsx("span",{className:"text-muted",children:"- Sin teléfono -"}))}},{dataField:"dni",caption:"DNI",cellTemplate:(e,{data:r})=>{r.dni?c(e,t.jsx("span",{children:r.dni})):c(e,t.jsx("span",{className:"text-muted",children:"- Sin DNI -"}))}},{dataField:"roles",caption:"Rol",allowFiltering:!1,cellTemplate:(e,{data:r})=>{c(e,t.jsx("span",{className:`badge ${B(r.roles)}`,children:S(r.roles)}))}},{dataField:"status",caption:"Estado",dataType:"boolean",width:"120px",cellTemplate:(r,{data:a})=>{c(r,t.jsx(u,{checked:1==a.status,onChange:r=>(async({id:r,value:a})=>{await j.boolean({id:r,field:"status",value:a})&&$(e.current).dxDataGrid("instance").refresh()})({id:a.id,value:r.target.checked})}))}},{caption:"Acciones",cellTemplate:(r,{data:a})=>{r.css("text-overflow","unset"),r.append(d({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>N(a)})),r.append(d({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>(async r=>{const{isConfirmed:a}=await m.fire({title:"Eliminar usuario",text:"¿Estás seguro de eliminar este usuario?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(!a)return;await j.delete(r)&&$(e.current).dxDataGrid("instance").refresh()})(a.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(f,{modalRef:r,title:C?"Editar usuario":"Crear nuevo usuario",onSubmit:async t=>{if(t.preventDefault(),!C||x.current.value){if(x.current.value!==v.current.value)return void m.fire({title:"Error",text:"Las contraseñas no coinciden",icon:"error"});if(x.current.value.length<6)return void m.fire({title:"Error",text:"La contraseña debe tener al menos 6 caracteres",icon:"error"})}const n={id:a.current.value||void 0,name:o.current.value,lastname:i.current.value,email:p.current.value,phone:b.current.value,phone_prefix:R.current.value,dni:g.current.value,role:w.current.value};x.current.value&&(n.password=x.current.value);await j.save(n)&&($(e.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"))},size:"lg",children:t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:a,type:"hidden"}),t.jsx(l,{eRef:o,label:"Nombres",col:"col-md-6",required:!0}),t.jsx(l,{eRef:i,label:"Apellidos",col:"col-md-6",required:!0}),t.jsx(l,{eRef:p,label:"Correo electrónico",type:"email",col:"col-md-6",required:!0}),t.jsx(l,{eRef:g,label:"DNI",col:"col-md-6"}),t.jsx("div",{className:"col-md-3",children:t.jsxs(h,{eRef:R,label:"Prefijo",required:!0,children:[t.jsx("option",{value:"+51",children:"+51 (Perú)"}),t.jsx("option",{value:"+1",children:"+1 (EE.UU.)"}),t.jsx("option",{value:"+34",children:"+34 (España)"}),t.jsx("option",{value:"+52",children:"+52 (México)"}),t.jsx("option",{value:"+57",children:"+57 (Colombia)"})]})}),t.jsx(l,{eRef:b,label:"Teléfono",type:"tel",col:"col-md-9"}),t.jsx("div",{className:"col-md-6",children:t.jsxs(h,{eRef:w,label:"Rol",required:!0,children:[t.jsx("option",{value:"Admin",children:"Administrador"}),("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)&&t.jsx("option",{value:"Root",children:"Super Administrador"})]})}),t.jsxs("div",{className:"col-12",children:[t.jsx("hr",{}),t.jsx("h6",{children:C?"Cambiar contraseña (opcional)":"Contraseña"})]}),t.jsx(l,{eRef:x,label:C?"Nueva contraseña":"Contraseña",type:"password",col:"col-md-6",required:!C,placeholder:C?"Dejar vacío para mantener la actual":""}),t.jsx(l,{eRef:v,label:"Confirmar contraseña",type:"password",col:"col-md-6",required:!C})]})})]})};i((e,r)=>{a.createRoot(e).render(t.jsx(o,{...r,title:"Usuarios",children:t.jsx(x,{...r})}))});

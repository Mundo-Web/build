import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BOnQTV8N.js";import{C as h,N as f}from"./Number2Currency-jIsa99f9.js";import{D as Oe,B as Me,a as He,P as ft,b as bt,c as yt,O as jt,S as vt,p as Nt,C as gt}from"./StorePickupSelector-Bj_AaT_H.js";import{C as wt}from"./CardItem-BEOk91f8.js";import{i as ae}from"./tippy-react.esm-BGU1pa2o.js";import"./main-iQpBVKTZ.js";import{t as ie}from"./CardProductKatya-BPLqIfPk.js";import{l as _t}from"./ShippingStep-D6DV-vFk.js";import{I as _e}from"./InputForm-Dmyom2PO.js";import{S as Ct}from"./SelectForm-BvZde-dr.js";import{G as Z}from"./Global-Bz6gVLc5.js";import{O as Ae,U as kt,u as St}from"./useEcommerceTracking-D1QUo2FX.js";import{I as ot}from"./info-U8866tPJ.js";import{C as pe}from"./circle-x-5vreeYph.js";import{m as Se}from"./proxy-B0QLMKEh.js";import"./ProductNavigation-8UCAW1yb.js";import"./CartKuchara-CVImXKD8.js";/* empty css              */import"./BlogCarousel-RzLTMVtu.js";/* empty css               */import"./BlogCarrusel-YBu8o7AC.js";import{R as Et}from"./PolicyModal-B0WwLYks.js";import{H as Pt}from"./HtmlContent-ghmllTyl.js";import{X as It}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./General-apRuNwp7.js";import"./loader-circle-CSFYLd5m.js";import"./createLucideIcon-DfjclApS.js";import"./sparkles-DvmvZ6mJ.js";import"./index-B9ygI19o.js";import"./useStateManager-7e1e8489.esm-DQDruaan.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./index-B8-haksW.js";import"./index-BLHw34Di.js";import"./floating-ui.dom-VJ4vUqp9.js";import"./StoresRest-Bw2duu-K.js";import"./BasicRest-tjV1jpAY.js";import"./BooleanLimit-D-OsQsek.js";import"./package-DBFPPBi1.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./check-D5vaIe6v.js";import"./ItemsRest-Dta1XbNk.js";import"./HeaderSearch-EXzrx7_V.js";import"./CartItemRow-Coip4t37.js";import"./calendar-BSC6xbA7.js";import"./moon-BU5XInRR.js";import"./users-w-WaEtvX.js";import"./index-BZvh78jk.js";import"./eye-ScgfreHn.js";import"./index-Chjiymov.js";function Lt({data:C,cart:k,setCart:ue,onContinue:xe,subTotal:K,envio:S,igv:Ce,fleteTotal:ee,seguroImportacionTotal:v,derechoArancelarioTotal:G,totalFinal:oe,openModal:M,categorias:re,automaticDiscounts:W,setAutomaticDiscounts:s,automaticDiscountTotal:he,setAutomaticDiscountTotal:D,totalWithoutDiscounts:Ee,generals:m,valorCIF:Ie,advDisplay:O,ipmDisplay:te,subTotalConDescuentos:R}){var J,le,ke,U,Ne,Le,Te,p,L;const[A,E]=c.useState(W||[]),[H,F]=c.useState(he||0),[z,ne]=c.useState(!1),[fe,l]=c.useState([]),[Q,se]=c.useState([]),[ce,Y]=c.useState(!1),[a,$]=c.useState(null),[be,ye]=c.useState(null),B=k.length===0;c.useEffect(()=>{if(k.filter(o=>o.type==="combo"),k.length>0&&K>0)n();else{const o=[];E(o),F(0),l([]),se([]),s&&s(o),D&&D(0)}},[k,K]);const n=async()=>{ne(!0);try{const o=k.reduce((N,T)=>N+(T.quantity||0),0),y=k.filter(N=>N.type==="combo"),g=await Oe.applyToCart(k,Ee);if(g.success&&g.data){const N=Oe.formatDiscounts(g.data.applied_discounts),T=g.data.total_discount||0,ge=Oe.getFreeItems(g.data.applied_discounts),j=[];g.data.applied_discounts.forEach(de=>{de.suggested_items&&Array.isArray(de.suggested_items)&&j.push(...de.suggested_items)}),E(N),F(T),l(ge),se(j),s&&s(N),D&&D(T)}else{console.error("âŒ Discount application failed:",{error:g.error,success:g.success,data:g.data,fullResult:g});const N=[],T=0;E(N),F(T),l([]),se([]),s&&s(N),D&&D(T)}}catch(o){console.error("Error applying discount rules:",o);const y=[],g=0;E(y),F(g),l([]),se([]),s&&s(y),D&&D(g)}finally{ne(!1)}},w=o=>Q.some(y=>y.item_id===o||y.triggering_item_id===o),je=o=>Q.find(y=>y.item_id===o||y.triggering_item_id===o),ve=o=>{const y=je(o.id);y&&($(y),ye(o),Y(!0))},X=async o=>{try{ue(y=>{const g=y.findIndex(N=>(N.item_id||N.id)===o.item_id);if(g!==-1){const N=[...y],T=o.quantity||o.suggested_quantity||1;return N[g].quantity+=T,N}else{const N={id:o.item_id,name:o.item_name,quantity:o.quantity||o.suggested_quantity||1,price:o.value||0,final_price:o.value||0,image:o.item_image||"default.jpg",brand:{name:o.item_brand||"N/A"},sku:o.item_sku||"PROMO",stock:999};return[...y,N]}}),setTimeout(()=>{n()},100)}catch(y){console.error("Error adding promotional item:",y)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:B?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-gray-500",children:"Â¡Explora nuestros productos y encuentra algo especial!"})]}):k.map((o,y)=>e.jsx(wt,{...o,setCart:ue,categorias:re,hasPromotion:w(o.id),onPromotionClick:ve},y))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:[h(),f(K)]})]}),H>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Descuentos aplicados"}),e.jsxs("span",{className:"font-semibold",children:["-",h(),f(H)]})]}),H>0&&e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Subtotal con descuentos"}),e.jsxs("span",{className:"font-semibold",children:[h(),f(R||K-H)]})]}),K>200&&v>0&&Number((J=m==null?void 0:m.find(o=>o.correlative==="importation_seguro"))==null?void 0:J.description)>0&&e.jsxs("div",{hidden:!0,className:"flex justify-between !hidden",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Seguro (",Number(((le=m==null?void 0:m.find(o=>o.correlative==="importation_seguro"))==null?void 0:le.description)||0).toFixed(2),"%)"]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(v)]})]}),K>200&&G>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Impuestos PerÃº (",(ke=m==null?void 0:m.find(o=>o.correlative==="importation_derecho_arancelario"))==null?void 0:ke.description,"%)",((U=m==null?void 0:m.find(o=>o.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:U.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(Ne=m==null?void 0:m.find(o=>o.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:Ne.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(G)]})]}),ee>0&&e.jsxs("div",{className:"flex justify-between ",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Flete de Envio Internacional",((Le=m==null?void 0:m.find(o=>o.correlative==="importation_flete_descripcion"))==null?void 0:Le.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(Te=m==null?void 0:m.find(o=>o.correlative==="importation_flete_descripcion"))==null?void 0:Te.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(ee)]})]}),z&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsxs("span",{children:["Total",((p=m==null?void 0:m.find(o=>o.correlative==="total_descripcion"))==null?void 0:p.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(L=m==null?void 0:m.find(o=>o.correlative==="total_descripcion"))==null?void 0:L.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[h(),f(oe)]})]}),H>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:[h(),f(Ee||oe+H)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras ",h(),f(H)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(Me,{onClick:xe,disabled:B,className:`w-full ${(C==null?void 0:C.class_button)||"text-white"}`,children:B?"Carrito VacÃ­o":"Continuar Compra"}),e.jsx(He,{href:"/",className:"w-full",children:B?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas losÂ ",e.jsx("a",{href:"#",onClick:()=>M(1),className:"customtext-primary font-bold",children:"TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestraÂ ",e.jsx("a",{href:"#",onClick:()=>M(0),className:"customtext-primary font-bold",children:"PolÃ­tica de Privacidad"}),"."]})})]})]}),e.jsx(ft,{isOpen:ce,onClose:()=>Y(!1),suggestion:a,onAddToCart:X,productName:(be==null?void 0:be.name)||""})]})}function Tt({data:C,cart:k,setSale:ue,setCode:xe,setDelivery:K,setCart:S,onContinue:Ce,noContinue:ee,subTotal:v,igv:G,fleteTotal:oe,seguroImportacionTotal:M,derechoArancelarioTotal:re,totalFinal:W,user:s,setEnvio:he,envio:D,ubigeos:Ee=[],openModal:m,categorias:Ie,setCouponDiscount:O,setCouponCode:te,automaticDiscounts:R=[],automaticDiscountTotal:A=0,setAutomaticDiscounts:E,setAutomaticDiscountTotal:H,totalWithoutDiscounts:F,conversionScripts:z,setConversionScripts:ne,onPurchaseComplete:fe,generals:l,valorCIF:Q,advDisplay:se,ipmDisplay:ce,subTotalConDescuentos:Y}){var Ge,We,Ye,Xe,Je,Ze,et,tt,st,it,at;const[a,$]=c.useState(null),[be,ye]=c.useState(null);R.reduce((t,i)=>i.free_items&&Array.isArray(i.free_items)?[...t,...i.free_items]:t,[]);const B=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[n,w]=c.useState({name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",documentType:((Ge=s==null?void 0:s.document_type)==null?void 0:Ge.toLowerCase())||"",document:(s==null?void 0:s.document_number)||"",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:"",reference:(s==null?void 0:s.reference)||"",ubigeo:(s==null?void 0:s.ubigeo)||null});c.useEffect(()=>{if(s!=null&&s.ubigeo&&(s!=null&&s.district)&&(s!=null&&s.province)&&(s!=null&&s.department)){const t={value:s.ubigeo,label:`${s.district}, ${s.province}, ${s.department}`,data:{reniec:s.ubigeo,departamento:s.department,provincia:s.province,distrito:s.district}};ye(t),$(t),Qe(t)}},[s]),c.useEffect(()=>{s&&w(t=>{var i;return{...t,name:s.name||t.name,lastname:s.lastname||t.lastname,email:s.email||t.email,phone:s.phone||t.phone,documentType:((i=s.document_type)==null?void 0:i.toLowerCase())||t.documentType,document:s.document_number||t.document,department:s.department||t.department,province:s.province||t.province,district:s.district||t.district,address:s.address||t.address,number:s.number||t.number,reference:s.reference||t.reference,ubigeo:s.ubigeo||t.ubigeo}})},[s]);const[je,ve]=c.useState(!1),[X,J]=c.useState(!1),[le,ke]=c.useState([]),[U,Ne]=c.useState(null),[Le,Te]=c.useState(null),[p,L]=c.useState({}),[o,y]=c.useState(""),[g,N]=c.useState(!1),[T,ge]=c.useState(""),[j,de]=c.useState(null),[qe,b]=c.useState(0),[P,me]=c.useState(!1),[De,we]=c.useState(""),[Pe,Re]=c.useState(null),[rt,ze]=c.useState(!1),[nt,Be]=c.useState(!1),ct=t=>{Re(t),L(i=>({...i,store:""}))},lt=t=>{var u,I,d;const i=["name","lastname","documentType","document","email","phone","ubigeo","address","shipping"];for(const r of i)if(t[r]){let x=null,q=!1;if(r==="ubigeo"?x=((I=(u=document.querySelector('[name="ubigeo"]'))==null?void 0:u.parentElement)==null?void 0:I.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):r==="shipping"?x=((d=document.querySelector('input[name="shipping"]'))==null?void 0:d.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(x=document.querySelector(`[name="${r}"]`),q=!0),x){x.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),q&&setTimeout(()=>{try{x.focus(),x.tagName==="INPUT"&&x.type==="text"&&x.select()}catch(V){console.warn("No se pudo enfocar el elemento:",V)}},600),dt(x);break}}},dt=t=>{if(!t)return;const i=document.createElement("div");if(i.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const I=document.createElement("style");I.id="error-highlight-styles",I.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(I)}const u=t.style.position;(!u||u==="static")&&(t.style.position="relative"),t.appendChild(i),setTimeout(()=>{i.parentNode&&(i.parentNode.removeChild(i),(!u||u==="static")&&(t.style.position=u))},1200)},Qe=async t=>{var u,I;if(!t)return;L(d=>({...d,ubigeo:""}));const{data:i}=t;w(d=>({...d,department:i.departamento,province:i.provincia,district:i.distrito,ubigeo:i.reniec})),ve(!0);try{const d=k.reduce((V,$e)=>V+$e.final_price*$e.quantity,0),r=await bt.getShippingCost({ubigeo:i.reniec,cart_total:d}),x=[];let q=!1;if(r.data.is_free&&r.data.qualifies_free_shipping&&x.push({type:"free",price:0,description:r.data.standard.description,deliveryType:r.data.standard.type,characteristics:r.data.standard.characteristics}),r.data.standard&&(!r.data.is_free||r.data.is_free&&!r.data.qualifies_free_shipping)){let V=r.data.standard.description;r.data.is_free||(V=V.replace(/envÃ­o gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),V||(V="Delivery a domicilio")),x.push({type:"standard",price:r.data.standard.price,description:V,deliveryType:r.data.standard.type,characteristics:r.data.standard.characteristics})}r.data.express&&r.data.express.price>0&&x.push({type:"express",price:r.data.express.price,description:r.data.express.description,deliveryType:r.data.express.type,characteristics:r.data.express.characteristics}),r.data.is_agency&&r.data.agency&&x.push({type:"agency",price:r.data.agency.price||0,description:r.data.agency.description,deliveryType:r.data.agency.type,characteristics:r.data.agency.characteristics}),r.data.is_store_pickup&&(q=!0),q||r.data.is_store_pickup?(x.some($e=>$e.type==="store_pickup")||(r.data.store_pickup?x.push({type:"store_pickup",price:r.data.store_pickup.price,description:r.data.store_pickup.description,deliveryType:r.data.store_pickup.type,characteristics:r.data.store_pickup.characteristics}):x.push({type:"store_pickup",price:0,description:"Retira tu pedido en una de nuestras tiendas",deliveryType:"Retiro en Tienda",characteristics:["Sin costo de envÃ­o","Horarios flexibles","AtenciÃ³n personalizada"]})),ze(!0)):(ze(!1),Re(null)),ke(x),Ne(((u=x[0])==null?void 0:u.type)||null),he(((I=x[0])==null?void 0:I.price)||0),N(!1)}catch{ie.error("Sin cobertura",{description:"No realizamos envÃ­os a esta ubicaciÃ³n.",icon:e.jsx(Ae,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),ke([]),Ne(null),he(0),N(!1)}ve(!1)},Ve=async t=>{var d,r;if(t.preventDefault(),X)return;if(!s){Be(!0);return}const i={},u=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,I=/^[0-9]{9}$/;if(n.name.trim()||(i.name="Nombre es requerido"),n.lastname.trim()||(i.lastname="Apellido es requerido"),n.documentType.trim()||(i.documentType="Tipo de documento es requerido"),n.document.trim()||(i.document="NÃºmero de documento es requerido"),n.email.trim()?u.test(n.email)||(i.email="Email invÃ¡lido"):i.email="Email es requerido",n.phone.trim()?I.test(n.phone.trim())||(i.phone="TelÃ©fono debe tener exactamente 9 dÃ­gitos"):i.phone="TelÃ©fono es requerido",n.ubigeo||(i.ubigeo="UbicaciÃ³n es requerida"),n.address||(i.address="DirecciÃ³n es requerida"),U||(i.shipping="Seleccione un mÃ©todo de envÃ­o"),Object.keys(i).length>0){L(i);const x=Object.keys(i)[0],q={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",documentType:"Por favor seleccione el tipo de documento",document:"Por favor ingrese su nÃºmero de documento",email:(d=i.email)!=null&&d.includes("invÃ¡lido")?"Por favor ingrese un correo electrÃ³nico vÃ¡lido":"Por favor ingrese su correo electrÃ³nico",phone:(r=i.phone)!=null&&r.includes("9 dÃ­gitos")?"El telÃ©fono debe tener exactamente 9 dÃ­gitos":"Por favor ingrese su nÃºmero de telÃ©fono",ubigeo:"Por favor seleccione su ubicaciÃ³n de entrega",address:"Por favor ingrese su direcciÃ³n de entrega",shipping:"Por favor seleccione un mÃ©todo de envÃ­o"};ie.error("Complete el campo requerido",{description:q[x],icon:e.jsx(pe,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),lt(i);return}J(!0);try{if(!Z.CULQI_ENABLED){ie.error("MÃ©todo de pago no disponible",{description:"El procesamiento de pagos con tarjeta estÃ¡ temporalmente deshabilitado",icon:e.jsx(pe,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),J(!1);return}if(!Z.CULQI_PUBLIC_KEY){ie.error("Error de configuraciÃ³n",{description:"El sistema de pagos no estÃ¡ configurado correctamente",icon:e.jsx(pe,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),J(!1);return}const x={user_id:s.id,...n,fullname:`${n.name} ${n.lastname}`,country:"PerÃº",document_type:n.documentType,amount:_(Ue),delivery:_(D),seguro_importacion_total:v>200?_(M||0):0,derecho_arancelario_total:v>200?_(re||0):0,flete_total:_(oe||0),delivery_type:U,store_id:U==="store_pickup"?Pe==null?void 0:Pe.id:null,cart:k,coupon_id:(j==null?void 0:j.id)||null,coupon_code:(j==null?void 0:j.code)||null,coupon_discount:_(qe||0),applied_promotions:R||[],promotion_discount:_(A||0)},q=await Nt(x);if(q.status){if(ue(q.sale),K(q.delivery),xe(q.code),q.conversion_scripts&&(ne(q.conversion_scripts),fe))try{await fe(q.sale_id,q.conversion_scripts)}catch(V){console.error("âŒ Error en callback onPurchaseComplete:",V)}S([]),Ce()}else ie.error("Error en el pago",{description:q.message||"Pago rechazado",icon:e.jsx(Ae,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(x){console.error("ðŸ’¥ Error completo en handlePayment:",x),console.error("ðŸ’¥ Stack trace:",x.stack),console.error("ðŸ’¥ Error name:",x.name),console.error("ðŸ’¥ Error message:",x.message),ie.error("Lo sentimos, no puede continuar con la compra",{description:`OcurriÃ³ un error al procesar el pedido: ${x.message}`,icon:e.jsx(Ae,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{J(!1)}},mt=c.useCallback(_t.debounce((t,i)=>{if(t.length<3){i([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(t)}`).then(u=>{if(!u.ok)throw new Error("Error en la respuesta");return u.json()}).then(u=>{const I=u.map(d=>({value:d.reniec,label:`${d.distrito}, ${d.provincia}, ${d.departamento}`,data:{inei:d.inei,reniec:d.reniec,departamento:d.departamento,provincia:d.provincia,distrito:d.distrito}}));i(I)}).catch(u=>{i([])})},300),[]);c.useEffect(()=>{L(t=>{const i={...t};return n.name.trim()&&delete i.name,n.lastname.trim()&&delete i.lastname,n.documentType.trim()&&delete i.documentType,n.document.trim()&&delete i.document,n.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&delete i.email,n.phone.trim()&&/^[0-9]{9}$/.test(n.phone.trim())&&delete i.phone,n.address.trim()&&delete i.address,n.ubigeo&&delete i.ubigeo,U&&delete i.shipping,i})},[n,U]);const pt=t=>({control:i=>({...i,border:`1px solid ${t?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:t?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:i=>({...i,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:i=>({...i,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),ut=async()=>{var t;if(!T.trim()){we("Ingrese un cÃ³digo de cupÃ³n");return}me(!0),we("");try{const i=[...new Set(k.map(r=>r.category_id).filter(Boolean))],u=k.map(r=>r.id),I=await gt.validateCoupon({code:T.trim(),cart_total:v,category_ids:i,product_ids:u}),d=I.data||I;if(d&&d.valid){de(d.coupon);const r=Math.round(d.discount*100)/100;b(r),O&&O(r),te&&te(((t=d.coupon)==null?void 0:t.code)||T.trim()),ie.success("CupÃ³n aplicado",{description:d.message||"CupÃ³n aplicado correctamente",duration:3e3,position:"top-center"})}else{const r=(d==null?void 0:d.message)||"CupÃ³n no vÃ¡lido";we(r),ie.error("CupÃ³n no vÃ¡lido",{description:r,icon:e.jsx(pe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(i){console.error("Error al validar cupÃ³n:",i),we("Error al validar el cupÃ³n"),ie.error("Error",{description:i.message||"No se pudo validar el cupÃ³n. Intente nuevamente.",icon:e.jsx(pe,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{me(!1)}},xt=()=>{de(null),b(0),ge(""),we(""),O&&O(0),te&&te(""),ie.success("CupÃ³n removido",{description:"El cupÃ³n ha sido removido de su pedido",duration:2e3,position:"top-center"})},_=t=>{const i=typeof t=="string"?parseFloat(t):t;return parseFloat(i.toFixed(2))},Ke=_(W)-_(A);let Fe=0;j&&(j.type==="percentage"||j.type==="percent"?Fe=Ke*Number(j.value)/100:j.type==="fixed"&&(Fe=Number(j.value))),c.useEffect(()=>{b(_(Fe)),O&&O(_(Fe))},[j,v,G,D,A]);const Ue=Math.max(0,_(Ke-Fe)),ht=()=>{if(!nt)return null;const t=i=>{i.target===i.currentTarget&&Be(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-2xl transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4",children:e.jsx(kt,{className:"h-8 w-8 customtext-primary"})}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-3",children:"Acceso requerido"}),e.jsx("p",{className:"customtext-neutral-light text-sm leading-relaxed",children:"Para continuar con su compra necesita iniciar sesiÃ³n o crear una cuenta nueva."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{window.location.href="/iniciar-sesion"},className:"w-full py-3 px-6 bg-primary text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Iniciar sesiÃ³n"}),e.jsx("button",{onClick:()=>{window.location.href="/crear-cuenta"},className:"w-full py-3 px-6 bg-accent text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Crear cuenta nueva"}),e.jsx("button",{onClick:()=>Be(!1),className:"w-full py-3 px-6 customtext-neutral-light hover:customtext-neutral-dark border border-secondary rounded-lg hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200",children:"Cancelar"})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx(ht,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:Ve,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_e,{name:"name",label:"Nombres",value:n.name,error:p.name,onChange:t=>{w(i=>({...i,name:t.target.value})),t.target.value.trim()&&p.name&&L(i=>({...i,name:""}))},required:!0,className:`border-gray-200 ${p.name?"border-red-500 bg-red-50":""}`}),e.jsx(_e,{name:"lastname",label:"Apellidos",value:n.lastname,error:p.lastname,onChange:t=>{w(i=>({...i,lastname:t.target.value})),t.target.value.trim()&&p.lastname&&L(i=>({...i,lastname:""}))},required:!0,className:`border-gray-200 ${p.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(Ct,{label:"Tipo de documento",options:B,placeholder:"Selecciona tu documento",labelClass:"block text-sm 2xl:!text-base mb-1 customtext-neutral-dark",value:n.documentType,error:p.documentType,onChange:t=>{w(i=>({...i,documentType:t})),t&&p.documentType&&L(i=>({...i,documentType:""}))},required:!0})}),e.jsx(_e,{name:"document",label:"NÃºmero de documento",value:n.document,error:p.document,onChange:t=>{w(i=>({...i,document:t.target.value})),t.target.value.trim()&&p.document&&L(i=>({...i,document:""}))},placeholder:"Ej: 12345678",required:!0,className:`border-gray-200 ${p.document?"border-red-500 bg-red-50":""}`})]}),e.jsx(_e,{name:"email",label:"Correo electrÃ³nico",type:"email",value:n.email,error:p.email,onChange:t=>{w(i=>({...i,email:t.target.value})),t.target.value.trim()&&p.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.target.value)&&L(u=>({...u,email:""}))},required:!0,className:`border-gray-200 ${p.email?"border-red-500 bg-red-50":""}`}),e.jsx(_e,{name:"phone",label:"TelÃ©fono",type:"tel",value:n.phone,error:p.phone,onChange:t=>{const i=t.target.value.replace(/\D/g,"");w(u=>({...u,phone:i})),i.length===9&&p.phone&&L(u=>({...u,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${p.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (UbicaciÃ³n de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(yt,{name:"ubigeo",cacheOptions:!0,value:a,loadOptions:mt,onChange:t=>{$(t),Qe(t),y("")},inputValue:o,onInputChange:(t,{action:i})=>{i==="input-change"&&y(t)},onFocus:()=>{$(null),y("")},onMenuOpen:()=>{a&&($(null),y(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:t})=>t.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:je,styles:pt(!!p.ubigeo),formatOptionLabel:({data:t})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:t.distrito}),e.jsxs("div",{className:"text-gray-500",children:[t.provincia,", ",t.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),p.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:p.ubigeo})]}),e.jsx(_e,{name:"address",label:"DirecciÃ³n ",value:n.address,error:p.address,onChange:t=>{w(i=>({...i,address:t.target.value})),t.target.value.trim()&&p.address&&L(i=>({...i,address:""}))},required:!0,className:`border-gray-200 ${p.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_e,{label:"NÃºmero",value:n.number,onChange:t=>w(i=>({...i,number:t.target.value})),className:"border-gray-200"}),e.jsx(_e,{label:"Referencia",value:n.reference,onChange:t=>w(i=>({...i,reference:t.target.value})),className:"border-gray-200"})]}),le.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"MÃ©todo de envÃ­o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:le.map(t=>e.jsx(jt,{title:t.deliveryType,price:t.price,description:t.description,selected:U===t.type,onSelect:()=>{Ne(t.type),he(t.price),L(i=>({...i,shipping:"",store:""})),N(!1),t.type!=="store_pickup"&&Re(null)}},t.type))}),U&&le.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(()=>{var I;const t=((I=le.find(d=>d.type===U))==null?void 0:I.characteristics)||[],i=t.length>1,u=i&&!g?t.slice(0,1):t;return e.jsxs(e.Fragment,{children:[u.map((d,r)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(ot,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:d})})]},`char-${r}`)),i&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{type:"button",onClick:()=>N(!g),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium customtext-primary hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:g?"Ver menos informaciÃ³n":`Ver mÃ¡s informaciÃ³n (${t.length-1} mÃ¡s)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${g?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})})()})]}),U==="store_pickup"&&rt&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(vt,{ubigeoCode:n.ubigeo,onStoreSelect:ct,selectedStore:Pe,className:"border border-gray-200 rounded-xl p-4"}),p.store&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),p.store]})]}),!ee&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(He,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(Me,{type:"submit",loading:je,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:k.map(t=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t.type==="combo"?`/storage/images/combo/${t.image}`:`/storage/images/item/${t.image}`,alt:t.name,className:"w-16 h-16 object-cover rounded-lg",onError:i=>i.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",t.quantity]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:[h(),f(t.final_price)]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[h(),f(_(v))]})]}),A>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Descuentos aplicados:"}),e.jsxs("span",{children:["-",h(),f(_(A))]})]}),v>200&&M>0&&Number((We=l==null?void 0:l.find(t=>t.correlative==="importation_seguro"))==null?void 0:We.description)>0&&e.jsxs("div",{className:"flex justify-between !hidden",children:[e.jsxs("span",{children:["Seguro (",Number(((Ye=l==null?void 0:l.find(t=>t.correlative==="importation_seguro"))==null?void 0:Ye.description)||0).toFixed(2),"%):"]}),e.jsxs("span",{children:[h(),f(_(M))]})]}),v>200&&re>0&&Number((Xe=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario"))==null?void 0:Xe.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Impuestos PerÃº (",(Je=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario"))==null?void 0:Je.description,"%)",((Ze=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:Ze.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(et=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:et.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[h(),f(_(re))]})]}),oe>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Flete de Envio Internacional",((tt=l==null?void 0:l.find(t=>t.correlative==="importation_flete_descripcion"))==null?void 0:tt.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(st=l==null?void 0:l.find(t=>t.correlative==="importation_flete_descripcion"))==null?void 0:st.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[h(),f(_(oe))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["EnvÃ­o Local",((it=l==null?void 0:l.find(t=>t.correlative==="envio"))==null?void 0:it.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(at=l==null?void 0:l.find(t=>t.correlative==="envio"))==null?void 0:at.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[h(),f(_(D))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"Â¿Tienes un cupÃ³n de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu cÃ³digo de cupÃ³n",value:T,onChange:t=>ge(t.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${De?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":j?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!j||P}),P&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),j?e.jsx("button",{type:"button",onClick:xt,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cupÃ³n",children:e.jsx(pe,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:ut,disabled:P||!T.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:P?"Validando...":"Aplicar"})]}),De&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(pe,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:De})]}),j&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",j.type==="percentage"?`${j.value}%`:`${h()}${f(j.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:j.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-",h(),f(_(qe))]})})]})})]})}),R&&R.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"ðŸŽ‰ Descuentos automÃ¡ticos aplicados:"}),R.map((t,i)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:t.name}),t.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:t.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-",h(),f(t.amount)]})})]})},i)),A>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos automÃ¡ticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-",h(),f(A)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[h(),f(_(j?Ue:W))]})]})}),!Z.CULQI_ENABLED&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ot,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"El procesamiento de pagos con tarjeta estÃ¡ temporalmente deshabilitado"})]})}),Z.CULQI_ENABLED&&!Z.CULQI_PUBLIC_KEY&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:"Error de configuraciÃ³n: Sistema de pagos no configurado"})]})}),e.jsx(Me,{onClick:Ve,disabled:X||!Z.CULQI_ENABLED||!Z.CULQI_PUBLIC_KEY,loading:X,className:`w-full mt-6 ${(C==null?void 0:C.class_button)||"text-white"} ${!Z.CULQI_ENABLED||!Z.CULQI_PUBLIC_KEY?"opacity-50 cursor-not-allowed":""}`,children:X?"Procesando...":Z.CULQI_ENABLED?Z.CULQI_PUBLIC_KEY?`Pagar ${h()}${f(_(j?Ue:W))}`:"ConfiguraciÃ³n pendiente":"Pago no disponible"}),e.jsx(He,{onClick:ee,className:"w-full mt-3",disabled:X,children:"Regresar al carrito"}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas losÂ ",e.jsx("a",{href:"#",onClick:()=>m(1),className:"customtext-primary font-bold",children:"TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestraÂ ",e.jsx("a",{href:"#",onClick:()=>m(0),className:"customtext-primary font-bold",children:"PolÃ­tica de Privacidad"}),"."]})]})]})]})]})}function qt({cart:C,code:k,delivery:ue,subTotal:xe,igv:K,fleteTotal:S=0,seguroImportacionTotal:Ce=0,derechoArancelarioTotal:ee=0,totalFinal:v,couponDiscount:G=0,couponCode:oe=null,conversionScripts:M=null,automaticDiscounts:re=[],automaticDiscountTotal:W=0,generals:s,valorCIF:he,advDisplay:D,ipmDisplay:Ee,subTotalConDescuentos:m}){var E,H,F,z,ne,fe,l,Q,se,ce,Y;const Ie=xe,O=m||xe-(G||0)-(W||0),te=Ce,R=ee,A=v;return c.useEffect(()=>{if(M)try{if(M.head){const a=document.createElement("script");a.innerHTML=M.head,document.head.appendChild(a)}if(M.body){const a=document.createElement("script");a.innerHTML=M.body,document.body.appendChild(a)}}catch(a){console.error("Error executing conversion scripts:",a)}},[M]),e.jsx(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(Se.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(Se.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"âœ“"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"Â¡Gracias por tu compra! ðŸŽ‰"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(Se.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"CÃ³digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${k}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:C.map((a,$)=>{var ye,B;const be=()=>a.type==="combo"?a.final_price||a.price:a.final_price;return e.jsx(Se.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:$*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:(a==null?void 0:a.type)==="combo"?`/storage/images/combo/${a==null?void 0:a.image}`:`/storage/images/item/${a==null?void 0:a.image}`,alt:a==null?void 0:a.name,className:"w-24 h-24 object-cover rounded-lg",onError:n=>n.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsxs("div",{className:"lg:w-8/12",children:[e.jsx("h3",{className:"font-semibold text-xl line-clamp-3 mb-2",children:a==null?void 0:a.name}),a.type==="combo"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full",children:"COMBO"})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contiene:"}),e.jsx("div",{className:"mt-1",children:a.combo_items&&a.combo_items.length>0?a.combo_items.map((n,w)=>e.jsxs("div",{className:"text-xs text-gray-500",children:["â€¢ ",n.quantity||1,"x ",n.name]},w)):a.items&&a.items.length>0?a.items.map((n,w)=>e.jsxs("div",{className:"text-xs text-gray-500",children:["â€¢ ",n.quantity||1,"x ",n.name]},w)):e.jsx("span",{className:"text-xs text-gray-400",children:"InformaciÃ³n de combo no disponible"})})]})]})]}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:[h(),f(be()*(a==null?void 0:a.quantity))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[((ye=a==null?void 0:a.brand)==null?void 0:ye.name)&&e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:((B=a==null?void 0:a.brand)==null?void 0:B.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:a==null?void 0:a.quantity})]}),(a==null?void 0:a.sku)&&e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:(a==null?void 0:a.sku)||"N/A"})]})]})]})]})},$)})}),e.jsxs(Se.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:[h(),f(Ie)]})]}),(G>0||W>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center py-2 text-green-600",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Descuentos aplicados"}),e.jsxs("span",{className:"font-semibold",children:["-",h(),f((G||0)+(W||0))]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-t pt-2",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Subtotal con descuentos"}),e.jsxs("span",{className:"font-semibold",children:[h(),f(O)]})]})]}),Number((E=s==null?void 0:s.find(a=>a.correlative==="importation_seguro"))==null?void 0:E.description)>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Seguro (",Number(((H=s==null?void 0:s.find(a=>a.correlative==="importation_seguro"))==null?void 0:H.description)||0).toFixed(2),"%)"]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(te)]})]}),S>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Flete",((F=s==null?void 0:s.find(a=>a.correlative==="importation_flete_descripcion"))==null?void 0:F.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(z=s==null?void 0:s.find(a=>a.correlative==="importation_flete_descripcion"))==null?void 0:z.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(S)]})]}),Number((ne=s==null?void 0:s.find(a=>a.correlative==="importation_derecho_arancelario"))==null?void 0:ne.description)>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Derecho Arancelario",((fe=s==null?void 0:s.find(a=>a.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:fe.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(l=s==null?void 0:s.find(a=>a.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:l.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(R)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["EnvÃ­o",((Q=s==null?void 0:s.find(a=>a.correlative==="envio_descripcion"))==null?void 0:Q.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(se=s==null?void 0:s.find(a=>a.correlative==="envio_descripcion"))==null?void 0:se.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[h(),f(ue)]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsxs("span",{children:["Total",((ce=s==null?void 0:s.find(a=>a.correlative==="total_descripcion"))==null?void 0:ce.description)&&e.jsx(ae,{content:e.jsx("p",{className:"whitespace-pre-line",children:(Y=s==null?void 0:s.find(a=>a.correlative==="total_descripcion"))==null?void 0:Y.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[h(),f(A)]})]})})]}),e.jsx(Se.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(Me,{href:"/catalogo",className:"w-full mx-auto md:w-auto text-white",children:"Seguir Comprando"})})]})]})})})}function Ms({cart:C,setCart:k,user:ue,ubigeos:xe=[],items:K,generals:S,data:Ce,categorias:ee}){var j,de,qe;const[v,G]=c.useState(1);c.useEffect(()=>{C.filter(P=>P.type==="combo").length===0&&C.length===0&&console.warn("ðŸš¨ ALERT: Cart is empty - this might indicate combos were removed")},[C,v]);const oe=b=>b.type==="combo"?b.final_price||b.price:b.final_price,M=C.reduce((b,P)=>{const me=oe(P);return b+me*P.quantity},0),{trackCheckoutPageView:re,trackInitiateCheckout:W,trackPurchase:s,resetTracking:he}=St(),[D,Ee]=c.useState(0),[m,Ie]=c.useState(null),[O,te]=c.useState([]),[R,A]=c.useState(0),E=M,H=D+R,F=Math.max(0,E-H),[z,ne]=c.useState(0),fe=C.reduce((b,P)=>{const me=Number(P.weight)||0;return b+me*P.quantity},0),l=Number((j=S==null?void 0:S.find(b=>b.correlative==="importation_flete"))==null?void 0:j.description)||0,Q=l>0?fe*l:0,se=E>200?(Number((de=S==null?void 0:S.find(b=>b.correlative==="importation_seguro"))==null?void 0:de.description)||0)/100:0,ce=F*se,Y=parseFloat(F)+parseFloat(Q)+parseFloat(ce),a=E>200?(Number((qe=S==null?void 0:S.find(b=>b.correlative==="importation_derecho_arancelario"))==null?void 0:qe.description)||0)/100:0,$=Y*a,be=0,ye=0,B=E<=200?F+Q+parseFloat(z):F+$+parseFloat(z)+Q,n=E<=200?E+parseFloat(z)+parseFloat(Q):E+parseFloat(z)+parseFloat(ce)+parseFloat($)+parseFloat(Q),w=be,je=Q,ve=ce,X=$,J=ye,[le,ke]=c.useState([]),[U,Ne]=c.useState([]),[Le,Te]=c.useState([]),[p,L]=c.useState(null);c.useEffect(()=>(re(v,C),()=>he()),[]),c.useEffect(()=>{re(v,C),v===2&&W(C,B)},[v]);const o=b=>{G(b),window.scrollTo({top:0,behavior:"smooth"})},y={privacy_policy:"PolÃ­ticas de privacidad",terms_conditions:"TÃ©rminos y condiciones",saleback_policy:"PolÃ­ticas de devolucion y cambio"},[g,N]=c.useState(null),T=b=>N(b),ge=()=>N(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${v===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:v>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${v>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${v>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"EnvÃ­o"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:v>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${v===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${v===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"ConfirmaciÃ³n"})]})]})}),v===1&&e.jsx(Lt,{data:Ce,cart:C,setCart:k,onContinue:()=>G(2),subTotal:E,envio:z,igv:w,fleteTotal:je,seguroImportacionTotal:ve,derechoArancelarioTotal:$,totalFinal:B,openModal:T,categorias:ee,automaticDiscounts:O,setAutomaticDiscounts:te,automaticDiscountTotal:R,setAutomaticDiscountTotal:A,totalWithoutDiscounts:n,generals:S,valorCIF:Y,advDisplay:X,ipmDisplay:J,subTotalConDescuentos:F}),v===2&&e.jsx(Tt,{data:Ce,items:K,setCode:Ne,setDelivery:Te,cart:C,setSale:ke,setCart:k,onContinue:()=>o(3),noContinue:()=>o(1),subTotal:E,envio:z,setEnvio:ne,igv:w,fleteTotal:je,seguroImportacionTotal:ve,derechoArancelarioTotal:$,totalFinal:B,user:ue,ubigeos:xe,categorias:ee,openModal:T,setCouponDiscount:Ee,setCouponCode:Ie,automaticDiscounts:O,setAutomaticDiscounts:te,valorCIF:Y,advDisplay:X,ipmDisplay:J,subTotalConDescuentos:F,automaticDiscountTotal:R,setAutomaticDiscountTotal:A,totalWithoutDiscounts:n,conversionScripts:p,setConversionScripts:L,onPurchaseComplete:(b,P)=>{s(b,P)},generals:S}),v===3&&e.jsx(qt,{code:U,delivery:Le,cart:le,subTotal:E,envio:z,igv:w,fleteTotal:je,seguroImportacionTotal:ve,derechoArancelarioTotal:$,totalFinal:B,couponDiscount:D,couponCode:m,automaticDiscounts:O,automaticDiscountTotal:R,totalWithoutDiscounts:n,conversionScripts:p,setConversionScripts:L,onPurchaseComplete:(b,P)=>{s(b,P)},generals:S,valorCIF:Y,advDisplay:X,ipmDisplay:J,subTotalConDescuentos:F})]}),Object.keys(y).map((b,P)=>{var we;const me=y[b],De=((we=S.find(Pe=>Pe.correlative==b))==null?void 0:we.description)??"";return e.jsx(Et,{isOpen:g===P,onRequestClose:ge,contentLabel:me,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:me}),e.jsx("button",{onClick:ge,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(It,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(Pt,{html:De})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:ge,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},P)})]})}export{Ms as default};

var ue=Object.defineProperty;var de=(l,t,a)=>t in l?ue(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var z=(l,t,a)=>de(l,typeof t!="symbol"?t+"":t,a);import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BH53Isel.js";import{c as me}from"./ReactAppend-DTVVXReZ.js";import{s as o}from"./server.browser-Bf4gQIc7.js";import{D as fe}from"./DeliveryPricesRest-DMD19Dvp.js";import"./main-BvVILmTO.js";import{B as he}from"./BasicRest-B3rfI5GY.js";import{S as xe}from"./StoresRest-B0mOUL_h.js";import{C as ge}from"./CreateReactScript-BoGwggCx.js";import{S as ve}from"./ProductCard-Ap6bpF1Q.js";import{B as be}from"./Base-CK06_Hp4.js";import{D as q}from"./DxButton-CsjWvhyj.js";import{M}from"./Modal-CIqmjseY.js";import{T as Y}from"./Table-DitbKwtZ.js";import{I as v}from"./InputFormGroup-D5I6zpZc.js";import{S as je}from"./SelectFormGroup-YqB1XVb8.js";import{S as P}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as ye}from"./TextareaFormGroup-DVzYJtLM.js";import{N as O}from"./Number2Currency-e57Tgsuk.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";import"./Global-ErywZRdd.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-C_dOKkRB.js";class Ne extends he{constructor(){super(...arguments);z(this,"path","admin/types_delivery");z(this,"hasFiles",!0)}}const w=new fe,Z=new Ne,Re=new xe,ke=({ubigeo:l=[]})=>{const t=i.useRef(),a=i.useRef(),C=i.useRef(),U=i.useRef(),S=i.useRef(),T=i.useRef(),u=i.useRef(),_=i.useRef(),E=i.useRef(),d=i.useRef(),m=i.useRef(),f=i.useRef(),D=i.useRef(),F=i.useRef(),[H,L]=i.useState(!1),[ee,J]=i.useState(!1),[we,se]=i.useState(!1),[x,b]=i.useState(!1),[j,y]=i.useState(!1),[N,R]=i.useState(!1),[V,n]=i.useState(""),[Ce,Se]=i.useState([]),[K,Q]=i.useState([]),W=e=>{console.log(e),e!=null&&e.id?L(!0):L(!1),T.current.value=(e==null?void 0:e.id)??"",$(u.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),se((e==null?void 0:e.price)===null),d.current&&(d.current.checked=(e==null?void 0:e.is_free)??!1,b((e==null?void 0:e.is_free)??!1),e!=null&&e.is_free&&n("El envío gratis tiene costo 0. Puede agregar un costo adicional para delivery express.")),m.current&&(m.current.checked=(e==null?void 0:e.is_agency)??!1,y((e==null?void 0:e.is_agency)??!1),e!=null&&e.is_agency&&n("Este es un envío que se realizará por empresas de envío como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")),f.current&&(f.current.checked=(e==null?void 0:e.is_store_pickup)??!1,R((e==null?void 0:e.is_store_pickup)??!1),e!=null&&e.is_store_pickup&&(n("Retiro en tienda disponible. Los clientes podrán recoger sus pedidos en nuestras sucursales."),B(e==null?void 0:e.ubigeo))),_.current.value=(e==null?void 0:e.price)??0,D.current.value=(e==null?void 0:e.express_price)??0,F.current.value=(e==null?void 0:e.agency_price)??0,E.current.value=(e==null?void 0:e.description)??"",$(C.current).modal("show")},B=async e=>{if(e)try{const r=await Re.simpleGet("/api/admin/stores/paginate",{filters:[{field:"ubigeo",operator:"=",value:e},{field:"status",operator:"=",value:1}]});r&&r.data&&Q(r.data)}catch(r){console.error("Error loading stores:",r),Q([])}},re=async e=>{e.preventDefault();const r=l.find(g=>g.reniec==u.current.value),c={id:T.current.value||void 0,name:`${r.distrito}, ${r.departamento}`.toTitleCase(),price:x?null:_.current.value,is_free:d.current.checked,is_agency:m.current.checked,is_store_pickup:f.current.checked,express_price:D.current.value,agency_price:F.current.value,description:E.current.value,ubigeo:u.current.value};await w.save(c)&&($(t.current).dxDataGrid("instance").refresh(),$(C.current).modal("hide"))},A=i.useRef(),G=i.useRef(),I=i.useRef(),[p,h]=i.useState([{value:""}]),ie=()=>{h([...p,{value:""}])},te=(e,r)=>{const c=[...p];c[e].value=r,h(c)},ce=e=>{if(p.length<=1)return;const r=p.filter((c,k)=>k!==e);h(r)},le=()=>{$(U.current).modal("show")},ne=e=>{e!=null&&e.id?J(!0):J(!1),A.current.value=(e==null?void 0:e.id)??"",G.current.value=(e==null?void 0:e.name)??"",I.current.value=(e==null?void 0:e.description)??"",e!=null&&e.characteristics&&e.characteristics.length>0?h(e.characteristics.map(r=>({value:r}))):h([{value:""}]),$(S.current).modal("show")},oe=async e=>{e.preventDefault();const r=new FormData;r.append("name",G.current.value),r.append("description",I.current.value),ee&&r.append("id",A.current.value);const c=p.map(g=>g.value.trim()).filter(g=>g.length>0);r.append("characteristics",JSON.stringify(c)),await Z.save(r)&&($(a.current).dxDataGrid("instance").refresh(),$(S.current).modal("hide"),h([{value:""}]))},ae=async e=>{const{isConfirmed:r}=await ve.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!r||!await w.delete(e)||$(t.current).dxDataGrid("instance").refresh()},X=e=>$(o.renderToString(s.jsxs("span",{children:[s.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),s.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),pe=async e=>{const r=e.target.files[0];if(!r)return;e.target.value=null;const c=new FormData;c.append("excel",r),await w.upload(c)&&$(t.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx("input",{id:"file-input",type:"file",accept:".xlsx, .xls",style:{display:"none"},onChange:pe}),s.jsx(Y,{gridRef:t,title:"Costos de envío",rest:w,exportable:!0,exportableName:"delivery.prices",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",hint:"Cargar archivo Excel",onClick:()=>document.getElementById("file-input").click()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>W()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",text:"Actualizar datos de Delivery",hint:"Actualizar datos de Delivery",onClick:()=>le()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"ubigeo",caption:"Ubigeo (RENIEC)",width:"150px"},{dataField:"name",caption:"Envío a",width:"200px",allowExporting:!1},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"is_free",dataType:"number",caption:"Tipo Envio",cellTemplate:(e,{data:r})=>{r.is_free?e.html(o.renderToString(s.jsxs("div",{className:"d-flex gap-2",children:[s.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),s.jsx("span",{className:"text-muted font-italic",children:"Delivery Express"}),r.is_store_pickup&&s.jsx("span",{className:"text-primary font-italic",children:"Retiro en Tienda"})]}))):r.is_agency?e.html(o.renderToString(s.jsx("span",{className:"text-muted font-italic",children:"Recojo en agencia"}))):r.is_store_pickup?e.html(o.renderToString(s.jsx("span",{className:"text-primary font-italic",children:"Retiro en Tienda"}))):e.html(o.renderToString(s.jsx("span",{className:"text-muted font-italic",children:"Delivery"})))}},{dataField:"price",caption:"Precio",dataType:"number",width:"150px",cellTemplate:(e,{data:r})=>{r.is_free?e.html(o.renderToString(s.jsxs("div",{className:"row",children:[" ",s.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),s.jsxs("span",{className:"text-muted",children:["Express:"," ",s.jsxs("span",{className:"font-monospace text-reset",children:["S/."," ",O(r.express_price)]})]})]}))):r.price>0?e.html(o.renderToString(s.jsxs("span",{children:["S/. ",O(r.price)]}))):r.is_agency>0?e.html(o.renderToString(s.jsxs("span",{children:["S/. ",O(r.agency_price)]}))):e.text("Gratis")}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>W(r)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ae(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsxs(M,{modalRef:C,title:H?"Editar Costo de envío":"Agregar Costo de envío",onSubmit:re,size:"md",children:[s.jsx("input",{ref:T,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsx(je,{eRef:u,label:"Distrito/Ubigeo",templateResult:X,templateSelection:X,dropdownParent:"#form-container",required:!0,children:l.map((e,r)=>s.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))}),s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tipo de Envío"}),s.jsxs("div",{className:"row",children:[s.jsx(P,{eRef:d,label:"¿Delivery gratis?",col:"col-4",onChange:e=>{b(e.target.checked),e.target.checked?(y(!1),R(!1),m.current.checked=!1,f.current.checked=!1,n("El envío gratis tiene costo 0. Puede agregar un costo adicional para delivery express."),B(u.current.value)):n("")},checked:x,refreshable:[x]}),s.jsx(P,{eRef:m,label:"¿Recojo en agencia?",col:"col-4",onChange:e=>{y(e.target.checked),e.target.checked?(b(!1),R(!1),d.current.checked=!1,f.current.checked=!1,n("Este es un envío que se realizará por empresas de envío como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")):n("")},checked:j,refreshable:[j]}),s.jsx(P,{eRef:f,label:"¿Retiro en tienda?",col:"col-4",onChange:e=>{R(e.target.checked),e.target.checked?(b(!1),y(!1),d.current.checked=!1,m.current.checked=!1,n("Retiro en tienda disponible. Los clientes podrán recoger sus pedidos en nuestras sucursales."),B(u.current.value)):n("")},checked:N,refreshable:[N]})]}),V&&s.jsx("div",{className:"alert alert-info mt-2",children:V})]}),s.jsx("div",{className:"col-12",hidden:x||j||N,children:s.jsx(v,{eRef:_,label:"Costo de envío",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-12",hidden:!x,children:s.jsx(v,{eRef:D,label:"Costo de envío Express",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-12",hidden:!j,children:s.jsx(v,{eRef:F,label:"Costo de envío a Agencia",col:"col-12",type:"number",step:.01,required:!0})}),N&&s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tiendas disponibles en esta ubicación"}),K.length>0?s.jsx("div",{className:"row",children:K.map(e=>s.jsx("div",{className:"col-md-6 mb-2",children:s.jsx("div",{className:"card border",children:s.jsx("div",{className:"card-body p-3",children:s.jsxs("div",{className:"d-flex",children:[s.jsx("div",{className:"flex-shrink-0",children:e.image?s.jsx("img",{src:`/storage/images/stores/${e.image}`,alt:e.name,className:"rounded",style:{width:"40px",height:"40px",objectFit:"cover"}}):s.jsx("div",{className:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"},children:s.jsx("i",{className:"fas fa-store text-muted"})})}),s.jsxs("div",{className:"flex-grow-1 ms-3",children:[s.jsx("h6",{className:"mb-1",children:e.name}),s.jsx("small",{className:"text-muted d-block",children:e.address}),e.phone&&s.jsxs("small",{className:"text-muted d-block",children:["📞 ",e.phone]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:`badge ${e.status?"bg-success":"bg-danger"}`,children:e.status?"Activa":"Inactiva"})})]})})})},e.id))}):s.jsxs("div",{className:"alert alert-warning",children:[s.jsx("i",{className:"fas fa-exclamation-triangle me-2"}),"No hay tiendas disponibles en esta ubicación.",s.jsx("a",{href:"/admin/stores",target:"_blank",className:"alert-link ms-1",children:"Administrar tiendas"})]})]}),s.jsx(ye,{eRef:E,label:"Descripción",rows:2})]})]}),s.jsx(M,{modalRef:U,title:"Tipos de Delivery",size:"lg",children:s.jsx(Y,{gridRef:a,title:"Tipos de Delivery",rest:Z,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"150px",allowExporting:!1},{dataField:"description",caption:"Descripción",width:"300px",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"characteristics",caption:"Caracteristicas",width:"200px",cellTemplate:(e,{data:r})=>{r.characteristics&&r.characteristics.forEach(c=>{e.css("text-overflow","unset"),e.append(o.renderToString(s.jsx("li",{className:"d-flex gap-2",children:s.jsxs("i",{className:"text-muted font-italic d-block",children:["- ",c]})})))})}},{caption:"Acciones",width:"50px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>ne(r)}))},allowFiltering:!1,allowExporting:!1}]})}),s.jsxs(M,{modalRef:S,title:H?"Editar tipo de Delivery":"Agregar tipo de Delivery",onSubmit:oe,size:"sm",children:[s.jsx("input",{ref:A,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsxs("div",{className:"col-12",children:[s.jsx(v,{eRef:G,label:"Nombre",col:"col-12",type:"string"}),s.jsx(v,{eRef:I,label:"descripcion",col:"col-12",type:"string",required:!0})]}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),p.map((e,r)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:c=>te(r,c.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>ce(r),disabled:p.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},r)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:ie,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})})]})]})]})};ge((l,t)=>{me.createRoot(l).render(s.jsx(be,{...t,title:"Costos de envio",children:s.jsx(ke,{...t})}))});

var B=Object.defineProperty;var S=(l,n,c)=>n in l?B(l,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[n]=c;var b=(l,n,c)=>S(l,typeof n!="symbol"?n+"":n,c);import{j as i}from"./AboutSimple-Cf8x2fCZ.js";import{B as G}from"./Base-CHWft3X0.js";import{S as I}from"./SwitchFormGroup-DXN0cwVk.js";import{T as k}from"./TextareaFormGroup-CliirJM1.js";import{r as m}from"./index-BOnQTV8N.js";import{c as w}from"./ReactAppend-QR5TrZfj.js";import{S as q}from"./CartKuchara-D9l7c7at.js";import{B as A}from"./BasicRest-BML1C-ua.js";import{B as _}from"./BasicEditing-TVz-VY9q.js";import"./server.browser-Bf4gQIc7.js";import{I as M}from"./ImageFormGroup-40MuGzez.js";import{I as R}from"./InputFormGroup-iZIO11ZN.js";import{S as P}from"./SelectFormGroup-X8WqJHHl.js";import{M as z}from"./Modal-xDw9ufjg.js";import{T as O}from"./Table-BBh2JpCs.js";import{D as F}from"./DxButton-DV0H-ZcL.js";import{C as H,F as t}from"./CreateReactScript-C-lKJ7Gs.js";import{R as L}from"./ReactAppend-Vm5G2nof.js";import"./index-yBjzXJbu.js";import"./Global-Bz6gVLc5.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DcxtOi47.js";import"./index.esm-C48oHfFw.js";import"./index-ngrFHoWO.js";import"./CanAccess-UkN68hbD.js";import"./CardProductKatya-ncpmQ0JU.js";import"./BooleanLimit-D-OsQsek.js";import"./ArrayDetails2Object-DR0Igcn7.js";import"./em-Dm5QugzS.js";import"./HtmlContent-ghmllTyl.js";import"./WebDetailsRest-DsgeLSDz.js";/* empty css               */import"./General-CE1RDd44.js";import"./LaravelSession-Dz9cpV3l.js";class V extends A{constructor(){super(...arguments);b(this,"path","admin/testimonies");b(this,"hasFiles",!0)}}const u=new V,J=({countries:l,details:n})=>{const c=m.useRef(),f=m.useRef(),h=m.useRef(),g=m.useRef(),x=m.useRef(),j=m.useRef(),v=m.useRef(),r=m.useRef(),p=m.useRef(),[E,N]=m.useState(!1),y=e=>{e!=null&&e.id?N(!0):N(!1),r.current&&r.resetDeleteFlag&&r.resetDeleteFlag(),h.current.value=(e==null?void 0:e.id)??"",g.current.value=(e==null?void 0:e.name)??"",t.has("testimonies","role")&&(x.current.value=(e==null?void 0:e.role)??""),t.has("testimonies","rating")&&(j.current.value=(e==null?void 0:e.rating)??"5"),t.has("testimonies","country_id")&&$(p.current).val((e==null?void 0:e.country_id)??"89").trigger("change"),t.has("testimonies","description")&&(v.current.value=(e==null?void 0:e.description)??""),r.current&&r.image&&t.has("testimonies","image")&&(r.image.src=e!=null&&e.image?`/storage/images/testimony/${e.image}`:"",r.current.value=null),$(f.current).modal("show")},T=async e=>{e.preventDefault();const s={id:h.current.value||void 0,name:g.current.value};t.has("testimonies","country_id")&&(s.country_id=$(p.current).val(),s.country=$(p.current).find("option:selected").text()),t.has("testimonies","role")&&(s.role=x.current.value),t.has("testimonies","rating")&&(s.rating=j.current.value),t.has("testimonies","description")&&(s.description=v.current.value);const o=new FormData;for(const a in s)o.append(a,s[a]);if(r.current&&t.has("testimonies","image")){const a=r.current.files[0];a&&o.append("image",a),r.getDeleteFlag&&r.getDeleteFlag()&&o.append("image_delete","DELETE")}await u.save(o)&&(r.resetDeleteFlag&&r.resetDeleteFlag(),$(c.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},D=async({id:e,value:s})=>{await u.boolean({id:e,field:"visible",value:s})&&$(c.current).dxDataGrid("instance").refresh()},C=async e=>{const{isConfirmed:s}=await q.fire({title:"Eliminar testimonio",text:"¿Estas seguro de eliminar este testimonio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!s||!await u.delete(e)||$(c.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(O,{gridRef:c,title:i.jsx(_,{correlative:"testimonies",details:n}),rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo testimonio",hint:"Nuevo testimonio",onClick:()=>y()}})},columns:[{dataField:"id",caption:"ID",visible:!1},t.has("testimonies","image")&&{dataField:"name",caption:"Autor",cellTemplate:(e,{data:s})=>{const o=e instanceof HTMLElement?e:e.get?e.get(0):e[0];o&&(o.innerHTML="",w.createRoot(o).render(i.jsxs("div",{className:"d-flex align-items-center gap-2",children:[i.jsx("img",{className:"avatar-xs rounded-circle",src:`/storage/images/testimony/${s.image}`,alt:s.name,onError:a=>{a.target.onerror=null,console.error("Image failed to load (admin):",s.image),a.target.src="/api/cover/thumbnail/null"}}),i.jsx("p",{className:"mb-0",style:{fontSize:"14px"},children:s.name})]})))}},!t.has("testimonies","image")&&{dataField:"name",caption:"Autor"},t.has("testimonies","role")&&{dataField:"role",caption:"Cargo/Rol",width:"150px"},t.has("testimonies","country_id")&&{dataField:"country",caption:"País",width:"120px"},t.has("testimonies","rating")&&{dataField:"rating",caption:"Rating",width:"120px",cellTemplate:(e,{data:s})=>{const o="⭐".repeat(s.rating||0);e.html(`<span title="${s.rating}/5">${o}</span>`)}},t.has("testimonies","description")&&{dataField:"description",caption:"Testimonio",minWidth:"300px",cellTemplate:(e,{data:s})=>{const o=(d,a=100)=>d?d.length>a?d.substring(0,a)+"...":d:"";e.html(`<span class="text-muted">${o(s.description)}</span>`)}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:s})=>{$(e).empty(),L(e,i.jsx(I,{checked:s.visible==1,onChange:()=>D({id:s.id,value:!s.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.append(F({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>y(s)})),e.append(F({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>C(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),i.jsxs(z,{modalRef:f,title:E?"Editar testimonio":"Agregar testimonio",onSubmit:T,size:"lg",children:[i.jsx("input",{ref:h,type:"hidden"}),i.jsx("div",{id:"testimony-container",children:i.jsxs("div",{className:"row g-3",children:[i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"card border-0 shadow-sm",children:[i.jsx("div",{className:"card-header bg-light",children:i.jsxs("h6",{className:"mb-0",children:[i.jsx("i",{className:"fas fa-user me-2 text-primary"}),"Información del Autor"]})}),i.jsx("div",{className:"card-body",children:i.jsxs("div",{className:"row g-3",children:[t.has("testimonies","image")&&i.jsxs("div",{className:"col-md-4",children:[i.jsx(M,{eRef:r,name:"image",label:"Foto del Autor",col:"col-12",aspect:1}),i.jsxs("small",{className:"text-muted",children:[i.jsx("i",{className:"fas fa-info-circle me-1"}),"Imagen cuadrada 1:1"]})]}),i.jsx("div",{className:"col-md-8",children:i.jsxs("div",{className:"row ",children:[i.jsx("div",{className:"col-md-12",children:i.jsx(R,{eRef:g,label:"Nombre Completo",placeholder:"Ej: Juan Pérez",required:!0})}),t.has("testimonies","role")&&i.jsx("div",{className:"col-md-12",children:i.jsx(R,{eRef:x,label:"Cargo/Profesión",placeholder:"Ej: Paciente Operado",required:!0})}),t.has("testimonies","country_id")&&i.jsx("div",{className:"col-md-12",children:i.jsx(P,{eRef:p,label:"País de Origen",required:!0,dropdownParent:"#testimony-container",children:l.map((e,s)=>i.jsx("option",{value:e.id,children:e.name},`country-${s}`))})}),t.has("testimonies","rating")&&i.jsx("div",{className:"col-md-12",children:i.jsx(R,{eRef:j,label:"Calificación (1-5 estrellas)",type:"number",min:"1",max:"5",placeholder:"5",required:!0})})]})})]})})]})}),t.has("testimonies","description")&&i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"card border-0 shadow-sm",children:[i.jsx("div",{className:"card-header bg-light",children:i.jsxs("h6",{className:"mb-0",children:[i.jsx("i",{className:"fas fa-comment-dots me-2 text-success"}),"Testimonio"]})}),i.jsxs("div",{className:"card-body",children:[i.jsx(k,{eRef:v,label:"Descripción del Testimonio",rows:5,placeholder:"Escribe aquí la experiencia y opinión...",required:!0}),i.jsxs("small",{className:"text-muted",children:[i.jsx("i",{className:"fas fa-info-circle me-1"}),"Describe la experiencia completa y detallada"]})]})]})})]})})]})]})};H((l,n)=>{w.createRoot(l).render(i.jsx(G,{...n,title:"Testimonios",children:i.jsx(J,{...n})}))});

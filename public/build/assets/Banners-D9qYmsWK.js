var je=Object.defineProperty;var Re=(u,c,v)=>c in u?je(u,c,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[c]=v;var J=(u,c,v)=>Re(u,typeof c!="symbol"?c+"":c,v);import{j as n}from"./AboutSimple-Cf8x2fCZ.js";import{B as Se}from"./Base-NbtpFRZL.js";import{T as ie}from"./TextareaFormGroup-CliirJM1.js";import{r as o}from"./index-BOnQTV8N.js";import{c as we}from"./ReactAppend-QR5TrZfj.js";import{s as Fe}from"./server.browser-Bf4gQIc7.js";import{S as ye}from"./ProductCard-D_AgkLlk.js";import{B as Pe}from"./BasicRest-BML1C-ua.js";import{S as _e}from"./SystemRest-DVRjGh0L.js";import{I as ae}from"./ImageFormGroup-DkVgPNU5.js";import{S as Ce}from"./SwitchFormGroup-DXN0cwVk.js";import{S as Q}from"./SelectFormGroup-X8WqJHHl.js";import{M as ke}from"./Modal-BYL-UsqM.js";import{T as De}from"./Table-BoAJpQpW.js";import{D as oe}from"./DxButton-DV0H-ZcL.js";import{I as se}from"./InputFormGroup-iZIO11ZN.js";import{C as Ie}from"./CreateReactScript-BSTb2hiI.js";import{R as X}from"./ReactAppend-Vm5G2nof.js";import{S as re}from"./SortByAfterField-2AndDudn.js";import"./index-yBjzXJbu.js";import"./Global-DWbVqTT_.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DwXwpKCn.js";import"./index.esm-D6GvEWn_.js";import"./index-BQJyKPGC.js";import"./CanAccess-DgL4m2bH.js";import"./CardProductKatya-ncpmQ0JU.js";import"./BooleanLimit-D-OsQsek.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";class Te extends Pe{constructor(){super(...arguments);J(this,"path","admin/banners");J(this,"hasFiles",!0)}}const D=new Te,le=new _e,Ee=({pages:u,systems:c=[]})=>{const v=o.useRef(),I=o.useRef(),T=o.useRef(),y=o.useRef(),E=o.useRef(),p=o.useRef(),f=o.useRef(),N=o.useRef(),A=o.useRef(),P=o.useRef(),M=o.useRef(),_=o.useRef(),O=o.useRef(),[ce,z]=o.useState(!1),[S,L]=o.useState(c),[de,me]=o.useState([]),[G,U]=o.useState(""),[B,K]=o.useState(null),[ue,Y]=o.useState(!1),Z=[{id:"BannerSimple",name:"Banner Simple",icon:"mdi mdi-image-size-select-large"},{id:"BannerAd",name:"Banner Ad",icon:"mdi mdi-google-ads"},{id:"BannerFullWidth",name:"Banner Full Width",icon:"mdi mdi-view-carousel"},{id:"BannerFlex",name:"Banner Flex",icon:"mdi mdi-view-split-vertical"},{id:"BannerPublicitario",name:"Banner Publicitario",icon:"mdi mdi-bullhorn"},{id:"BannerPublicitarioPaani",name:"Banner Publicitario Paani",icon:"mdi mdi-bullhorn-variant"},{id:"BannerPostSuscriptionPaani",name:"Banner Post Suscripción Paani",icon:"mdi mdi-email-newsletter"},{id:"BannerStatic",name:"Banner Static",icon:"mdi mdi-image-frame"},{id:"BannerStaticSecond",name:"Banner Static Second",icon:"mdi mdi-image-multiple"},{id:"BannerSimpleSF",name:"Banner Simple SF",icon:"mdi mdi-image-outline"},{id:"BannerSimpleD2",name:"Banner Simple D2",icon:"mdi mdi-image"},{id:"BannerBananaLab",name:"Banner Banana Lab",icon:"mdi mdi-fruit-grapes"},{id:"BannerCTAMakita",name:"Banner CTA Makita",icon:"mdi mdi-call-to-action"},{id:"BannerContactMakita",name:"Banner Contact Makita",icon:"mdi mdi-contact-mail"},{id:"BannerPidelo",name:"Banner Pidelo",icon:"mdi mdi-shopping"},{id:"BannerMultivet",name:"Banner Multivet",icon:"mdi mdi-medical-bag"},{id:"BannerPublicitarioKatya",name:"Banner Publicitario Katya",icon:"mdi mdi-account-star"},{id:"BannerBlogSectionKatya",name:"Banner Blog Section Katya",icon:"mdi mdi-post"}],g=e=>e==null||e===""?null:e,ee=({pageId:e,baseSystems:t=[],insertedSystem:i=null})=>{const a=g(e);let s=re(t.map(l=>({...l})));if(i){const l={...i,page_id:a},h=l.after_component??null;if(!h)s=[l,...s];else{const m=s.findIndex(b=>b.id===h);m===-1?s=[...s,l]:s=[...s.slice(0,m+1),l,...s.slice(m+1)]}}const w={};return{ordered:s.map((l,h)=>{const b=(h===0?null:s[h-1].id)??null;return(l.after_component??null)!==b&&(w[l.id]=b),{...l,page_id:a,after_component:b}}),updates:w}},V=e=>{const t=g(e),i=S.filter(r=>g(r.page_id)===t),a=re(i);me(a)};o.useEffect(()=>{V()},[]),o.useEffect(()=>{V(G)},[G,S]);const te=e=>{e!=null&&e.id?(z(!0),K({id:e.id,page_id:g(e.page_id),after_component:e.after_component??null})):(z(!1),K(null));const t=(e==null?void 0:e.data)||{};T.current.value=(e==null?void 0:e.id)??"",y.current.value=t.name??"",E.current.value=t.description??"",p.image.src=t.background?`/storage/images/system/${t.background}`:"",p.current.value=null,f.image.src=t.image?`/storage/images/system/${t.image}`:"",f.current.value=null,p.resetDeleteFlag&&p.resetDeleteFlag(),f.resetDeleteFlag&&f.resetDeleteFlag(),N.current.value=t.button_text??"",A.current.value=t.button_link??"",P.current&&(P.current.checked=t.contenedor==="absoluto"),$(M.current).val((e==null?void 0:e.page_id)||"").trigger("change");const i=(e==null?void 0:e.page_id)||"";U(i),V(i),setTimeout(()=>{const a=(e==null?void 0:e.after_component)||"";$(_.current).val(a).trigger("change")},100),$(O.current).val(t.type||"BannerSimple").trigger("change"),$(I.current).modal("show")},pe=async e=>{var t;if(e.preventDefault(),!ue){Y(!0);try{const i=T.current.value,a=$(M.current).val(),r=g(a),s=$(_.current).val()||null,w=$(O.current).val(),W={name:`Banner - ${y.current.value}`,component:"banner",value:w,page_id:r,after_component:s,visible:!0};i&&(W.id=i);const l=await le.save(W);if(!l)return;const h={name:y.current.value,description:E.current.value,button_text:N.current.value,button_link:A.current.value,contenedor:(t=P.current)!=null&&t.checked?"absoluto":"relativo",type:w},m=new FormData;m.append("id",l.id),Object.entries(h).forEach(([d,k])=>m.append(d,k));const b=p.current.files[0];b&&m.append("background",b);const q=f.current.files[0];if(q&&m.append("image",q),p.getDeleteFlag&&p.getDeleteFlag()&&m.append("background_delete","DELETE"),f.getDeleteFlag&&f.getDeleteFlag()&&m.append("image_delete","DELETE"),!await D.save(m))return;p.resetDeleteFlag&&p.resetDeleteFlag(),f.resetDeleteFlag&&f.resetDeleteFlag();let x={...l,page_id:r,after_component:s??null,data:{...l.data||{},...h}};const H=g(B==null?void 0:B.page_id),C=g(x.page_id),j={};if(B!=null&&B.id&&H!==C){const d=S.filter(F=>g(F.page_id)===H&&F.id!==x.id).map(F=>({...F})),{updates:k}=ee({pageId:H,baseSystems:d});Object.assign(j,k)}const be=S.filter(d=>g(d.page_id)===C&&d.id!==x.id).map(d=>({...d})),{ordered:ve,updates:Be}=ee({pageId:C,baseSystems:be,insertedSystem:x});Object.assign(j,Be);const ne=ve.find(d=>d.id===x.id);if(ne&&(x={...x,after_component:ne.after_component??null}),Object.keys(j).length>0&&!await le.updateOrder(j))return;L(d=>[...d.filter(R=>R.id!==x.id).map(R=>Object.prototype.hasOwnProperty.call(j,R.id)?{...R,after_component:j[R.id]??null}:R),x]),U(C??""),$(I.current).modal("hide"),K(null),z(!1)}finally{Y(!1)}}},fe=e=>{const t=$(e.target).val();U(t),setTimeout(()=>{$(_.current).val("").trigger("change")},100)},ge=async({id:e,value:t})=>{await D.boolean({id:e,field:"visible",value:t})&&L(a=>a.map(r=>r.id===e?{...r,visible:t}:r))},xe=async e=>{const{isConfirmed:t}=await ye.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!t||!await D.delete(e)||L(a=>a.filter(r=>r.id!=e))};return n.jsxs(n.Fragment,{children:[n.jsx(De,{gridRef:v,title:"Banners",rest:D,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(v.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo banner",hint:"Nuevo banner",onClick:()=>te()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Información",cellTemplate:(e,{data:t})=>{const i=u.find(r=>r.id==(t==null?void 0:t.page_id)),a=Z.find(r=>{var s;return r.id===((s=t==null?void 0:t.data)==null?void 0:s.type)});e.html(Fe.renderToString(n.jsx(n.Fragment,{children:n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("i",{className:`${(a==null?void 0:a.icon)||"mdi mdi-image"} me-2`}),n.jsxs("div",{children:[n.jsx("b",{className:"d-block",children:t==null?void 0:t.name}),n.jsxs("small",{className:"text-muted d-block",children:["Tipo: ",(a==null?void 0:a.name)||"Banner Simple"]}),n.jsxs("small",{className:"text-muted",children:["Página: ",(i==null?void 0:i.name)||"Base Template"]})]})]})})))}},{dataField:"after_component",caption:"Después de",cellTemplate:(e,{data:t})=>{if(!t.after_component){e.text("Al inicio");return}const i=S.find(a=>a.id===t.after_component);e.text(i?i.name:"Componente eliminado")}},{dataField:"background",caption:"Fondo",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{var i;X(e,n.jsx("img",{src:`/storage/images/system/${(i=t==null?void 0:t.data)==null?void 0:i.background}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:a=>a.target.src="/api/cover/thumbnail/null"}))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{var i;X(e,n.jsx("img",{src:`/storage/images/system/${(i=t==null?void 0:t.data)==null?void 0:i.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:a=>a.target.src="/api/cover/thumbnail/null"}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),X(e,n.jsx(Ce,{checked:t.visible==1,onChange:()=>ge({id:t.id,value:!t.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(oe({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>te(t)})),e.append(oe({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>xe(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),n.jsxs(ke,{modalRef:I,title:ce?"Editar banner":"Agregar banner",onSubmit:pe,size:"lg",children:[n.jsx("input",{ref:T,type:"hidden"}),n.jsx("div",{className:"row",id:"banner-container",children:n.jsxs("div",{className:"col-12",children:[n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-md-6",children:n.jsx(Q,{eRef:O,label:"Tipo de Banner",dropdownParent:"#banner-container",children:Z.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))})}),n.jsx("div",{className:"col-md-6",children:n.jsxs(Q,{eRef:M,label:"Página",onChange:fe,dropdownParent:"#banner-container",children:[n.jsx("option",{value:"",children:"Base Template"}),u.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))]})})]}),n.jsxs(Q,{eRef:_,label:"Posición (después de)",dropdownParent:"#banner-container",changeWith:[G],children:[n.jsx("option",{value:"",children:"Al inicio"}),de.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))]}),n.jsx(ae,{eRef:p,name:"background",label:"Fondo"}),n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"col-sm-6",children:n.jsx(ae,{eRef:f,name:"image",label:"Imagen",aspect:1})}),n.jsxs("div",{className:"col-sm-6",children:[n.jsx(ie,{eRef:y,label:"Titulo",rows:2}),n.jsx(ie,{eRef:E,label:"Descripción",rows:2}),n.jsx(se,{eRef:N,label:"Texto botón"})]})]}),n.jsx(se,{eRef:A,label:"URL botón"}),n.jsxs("div",{className:"form-group row",children:[n.jsx("label",{className:"col-sm-3 col-form-label",children:"Posición"}),n.jsxs("div",{className:"col-sm-9",children:[n.jsxs("div",{className:"custom-control custom-switch",children:[n.jsx("input",{type:"checkbox",className:"custom-control-input",id:"absoluteSwitch",ref:P}),n.jsx("label",{className:"custom-control-label",htmlFor:"absoluteSwitch",children:"Imagen absoluta"})]}),n.jsx("small",{className:"form-text text-muted",children:"Marca esta opción para posicionamiento absoluto de la imagen"})]})]})]})})]})]})};Ie((u,c)=>{we.createRoot(u).render(n.jsx(Se,{...c,title:"Banners",children:n.jsx(Ee,{...c})}))});

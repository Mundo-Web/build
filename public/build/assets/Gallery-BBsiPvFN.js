import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as p}from"./index-BOnQTV8N.js";import{c as _}from"./ReactAppend-QR5TrZfj.js";import{B as L}from"./Base-C5ShtHRJ.js";import{C as T}from"./CreateReactScript-D2E8lA1t.js";import{G as U}from"./GalleryRest-C7g46JMQ.js";import{B}from"./BasicRest-BML1C-ua.js";import{T as V,t as o}from"./CardProductKatya-ncpmQ0JU.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-B6ujFmsw.js";import"./Global-CazroCzF.js";import"./tippy-react.esm-DmkRJDEW.js";import"./index-pSueRYGM.js";/* empty css              */import"./Logout-BpuTJ_83.js";import"./main-B6F2O9-U.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-DwXwpKCn.js";import"./index.esm-D6GvEWn_.js";import"./index-BQJyKPGC.js";import"./CanAccess-DqqErOtT.js";/* empty css               */import"./General-apRuNwp7.js";import"./LaravelSession-Dz9cpV3l.js";import"./BooleanLimit-D-OsQsek.js";class M extends B{constructor(){super(),this.path="admin/gallery/config"}}function O(g){return g.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")}const I=new U,E=new M,q=({images:g=[],isDevelopment:v=!1,canEdit:S=!1})=>{const[x,N]=p.useState(g.map(a=>(a.uuid=crypto.randomUUID(),a))),[D,b]=p.useState(!1),[m,w]=p.useState(null),[s,u]=p.useState({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),[n,h]=p.useState(!1),C=p.useRef(),j=(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("local")||window.location.port==="8000")&&(v||S);p.useEffect(()=>{$(".image-popup").magnificPopup({type:"image",closeOnContentClick:!0,mainClass:"mfp-fade",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]}})},[x]);const R=async a=>{var r;const t=((r=a.target.files)==null?void 0:r[0])??null;if(!t)return;a.target.value=null;const l=a.target.name;h(!0);try{const c=new FormData;if(c.append("image",t),c.append("name",l),!await I.save(c))return;N(i=>i.map(d=>(d.src==l&&(d.uuid=crypto.randomUUID()),d))),o.success("Imagen actualizada correctamente")}catch(c){o.error("Error al actualizar la imagen"),console.error("Error updating image:",c)}finally{h(!1)}},F=()=>{u({title:"",filename:"",description:"",src:"",fit:"cover",aspect:"1",file:null}),w(null),b(!0)},A=(a,t)=>{u({title:a.name||a.title,filename:a.filename||a.src,description:a.description,src:a.src,fit:"cover",aspect:a.aspect,file:null}),w(t),b(!0)},k=a=>{var l;const t=((l=a.target.files)==null?void 0:l[0])??null;if(t){if(!t.type.startsWith("image/")){o.error("Por favor selecciona un archivo de imagen válido"),a.target.value=null;return}u(r=>({...r,file:t,src:t.name,filename:r.filename||t.name.split(".")[0]}))}},z=async()=>{var a;if(!s.title){o.error("Por favor completa el título de la imagen");return}if(!s.filename){o.error("Por favor completa el nombre del archivo");return}if(m===null&&!s.file){o.error("Por favor selecciona un archivo de imagen");return}h(!0);try{let t=s.src;if(s.file){const i=new FormData;i.append("image",s.file);const d=`${s.filename.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}.png`;if(i.append("name",d),i.append("convert_to_png","true"),!await I.save(i)){o.error("Error al subir la imagen");return}t=d}if((a=C.current)!=null&&a.getDeleteFlag&&C.current.getDeleteFlag()){const i=new FormData;if(i.append("image_delete","DELETE"),!await I.save(i)){o.error("Error al eliminar la imagen");return}t=null}const l=[...x],r={name:s.title,title:s.title,filename:s.filename,description:s.description,src:t,fit:"cover",aspect:s.aspect,uuid:crypto.randomUUID()};m!==null?l[m]=r:l.push(r);const c=l.filter(i=>!i.is_system).map(i=>{const{uuid:d,is_system:y,...P}=i;return P});await E.save(c)&&(N(l),b(!1),o.success(m!==null?"Imagen actualizada correctamente":"Nueva imagen agregada correctamente"))}catch(t){o.error("Error al guardar la configuración de la imagen"),console.error("Error saving image config:",t)}finally{h(!1)}},G=async a=>{if(x[a].is_system){o.error("No se pueden eliminar las imágenes del sistema");return}if(confirm("¿Estás seguro de que quieres eliminar esta imagen?")){h(!0);try{const l=x.filter((f,i)=>i!==a),r=l.filter(f=>!f.is_system).map(f=>{const{uuid:i,is_system:d,...y}=f;return y});await E.save(r)&&(N(l),o.success("Imagen eliminada correctamente"))}catch(l){o.error("Error al eliminar la imagen"),console.error("Error deleting image:",l)}finally{h(!1)}}};return e.jsxs("div",{className:"port",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:j&&e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:F,disabled:n,children:[e.jsx("i",{className:"mdi mdi-plus me-1"}),"Agregar Nueva Imagen"]})}),e.jsx("div",{className:"row portfolioContainer",children:x.map((a,t)=>{const l=O(a.name),r=a.is_system===!0;return e.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 natural personal",children:e.jsxs("div",{className:"gal-detail thumb",children:[r&&e.jsx("div",{style:{position:"absolute",top:"8px",left:"8px",zIndex:10,backgroundColor:"rgba(13, 110, 253, 0.9)",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"10px",fontWeight:"bold"},children:"SISTEMA"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:`/assets/resources/${a.src}?v=${a.uuid}`,className:"thumb-img img-fluid",alt:"work-thumbnail",onError:c=>c.target.src="/assets/resources/cover-404.svg",style:{aspectRatio:a.aspect,objectFit:"cover",objectPosition:"center",width:"100%"}}),e.jsxs("div",{className:"d-flex px-2 py-1 justify-content-center gap-1",style:{backgroundColor:"rgba(0, 0, 0, .25)",position:"absolute",bottom:0,width:"100%",borderRadius:"0 0 3px 3px"},children:[e.jsxs("a",{href:`/assets/resources/${a.src}`,className:"btn btn-xs btn-primary image-popup",title:a.name,children:[e.jsx("i",{className:"mdi mdi-eye me-1"}),"Abrir"]}),e.jsx("input",{type:"file",name:a.src,id:`image-${l}`,onChange:R,hidden:!0,accept:"image/*",disabled:n}),e.jsxs("label",{htmlFor:`image-${l}`,className:`btn btn-xs btn-dark ${n?"disabled":""}`,children:[e.jsx("i",{className:"mdi mdi-image-edit me-1"}),"Cambiar"]}),j&&!r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"btn btn-xs btn-info",onClick:()=>A(a,t),disabled:n,children:[e.jsx("i",{className:"mdi mdi-pencil me-1"}),"Editar"]}),e.jsxs("button",{type:"button",className:"btn btn-xs btn-danger",onClick:()=>G(t),disabled:n,children:[e.jsx("i",{className:"mdi mdi-delete me-1"}),"Eliminar"]})]}),j&&r&&e.jsxs("button",{type:"button",className:"btn btn-xs btn-secondary",title:"Imagen del sistema - Solo se puede cambiar el archivo",disabled:!0,children:[e.jsx("i",{className:"mdi mdi-information me-1"}),"Sistema"]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h4",{children:[a.name,r&&e.jsx("span",{className:"badge bg-primary ms-2",style:{fontSize:"10px"},children:"SISTEMA"})]}),e.jsx("p",{className:"font-13 text-muted mb-2",children:a.description}),j&&e.jsxs("small",{className:"text-muted",children:["Aspect: ",a.aspect," | Archivo: ",a.filename||a.src,r&&e.jsx("span",{className:"text-primary",children:" | Imagen del sistema"})]})]})]})},t)})}),j&&D&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:m!==null?"Editar Imagen":"Agregar Nueva Imagen"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>b(!1),disabled:n})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Título de la imagen *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Logo de login, Imagen de signup, etc.",value:s.title,onChange:a=>u({...s,title:a.target.value}),disabled:n}),e.jsx("small",{className:"text-muted",children:"Este es el nombre que se mostrará en el card"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nombre del archivo *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: logo-login, bg-signup, header-email",value:s.filename,onChange:a=>u({...s,filename:a.target.value}),disabled:n}),e.jsx("small",{className:"text-muted",children:"Solo letras, números y guiones (sin espacios ni caracteres especiales)"})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Seleccionar imagen ",m===null&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"file",className:"form-control",accept:"image/*",onChange:k,disabled:n}),e.jsx("small",{className:"text-muted",children:m===null?"Selecciona un archivo de imagen (JPG, PNG, GIF, SVG, etc.)":"Opcional: Selecciona una nueva imagen para reemplazar la actual"}),s.file&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"mdi mdi-check-circle me-1"}),"Archivo seleccionado: ",s.file.name]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Descripción"}),e.jsx("textarea",{className:"form-control",rows:"4",placeholder:"Descripción de dónde y cómo se usa esta imagen",value:s.description,onChange:a=>u({...s,description:a.target.value}),disabled:n})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Aspect Ratio"}),e.jsxs("select",{className:"form-select",value:s.aspect,onChange:a=>u({...s,aspect:a.target.value}),disabled:n,children:[e.jsx("optgroup",{label:"Cuadrados",children:e.jsx("option",{value:"1",children:"1:1 (Cuadrado)"})}),e.jsxs("optgroup",{label:"Horizontales (Landscape)",children:[e.jsx("option",{value:"4/3",children:"4:3 (Estándar)"}),e.jsx("option",{value:"16/9",children:"16:9 (Panorámico)"}),e.jsx("option",{value:"3/2",children:"3:2 (Fotografía)"}),e.jsx("option",{value:"21/9",children:"21:9 (Ultrawide)"}),e.jsx("option",{value:"5/3",children:"5:3 (Ancho)"}),e.jsx("option",{value:"2/1",children:"2:1 (Banner)"})]}),e.jsxs("optgroup",{label:"Verticales (Portrait)",children:[e.jsx("option",{value:"3/4",children:"3:4 (Vertical estándar)"}),e.jsx("option",{value:"9/16",children:"9:16 (Vertical móvil)"}),e.jsx("option",{value:"2/3",children:"2:3 (Fotografía vertical)"}),e.jsx("option",{value:"3/5",children:"3:5 (Vertical estrecho)"}),e.jsx("option",{value:"1/2",children:"1:2 (Vertical banner)"})]}),e.jsx("optgroup",{label:"Otros",children:e.jsx("option",{value:"auto",children:"Auto (Original)"})})]})]})})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>b(!1),disabled:n,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:z,disabled:n||!s.title||!s.filename||m===null&&!s.file,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),m!==null?"Actualizar":"Agregar"]})})]})]})})}),e.jsx(V,{})]})};T((g,v)=>{_.createRoot(g).render(e.jsx(L,{...v,title:"Galeria",children:e.jsx(q,{...v})}))});

import{c as j}from"./createLucideIcon-DfjclApS.js";import{m as M}from"./main-B6F2O9-U.js";import{G as g}from"./Global-DWbVqTT_.js";import{t as y}from"./CardProductKatya-ncpmQ0JU.js";import{j as o}from"./AboutSimple-Cf8x2fCZ.js";import{r as x}from"./index-BOnQTV8N.js";import{S}from"./store-DCbpAdsr.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=j("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=j("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]);function O(){let c="";for(let m=0;m<12;m++){const i=Math.floor(Math.random()*10);c+=i}return c}const K=c=>new Promise((m,i)=>{var l;try{if(console.log("ðŸ”„ Iniciando proceso de pago con Culqi...",c),!g.CULQI_ENABLED){console.error("âŒ Error: Culqi no estÃ¡ habilitado en la configuraciÃ³n"),i("MÃ©todo de pago no disponible: Culqi estÃ¡ deshabilitado");return}if(typeof window.Culqi>"u"){console.error("âŒ Error: Culqi no estÃ¡ definido. Verifique que el script de Culqi estÃ© cargado."),i("Error en la integraciÃ³n con Culqi: Script no cargado");return}if(!g.CULQI_PUBLIC_KEY){console.error("âŒ Error: CULQI_PUBLIC_KEY no estÃ¡ configurado"),i("Error de configuraciÃ³n: Clave pÃºblica de Culqi no encontrada");return}const d=O(c.email);console.log("ðŸ“ NÃºmero de orden generado:",d);let p=!1;try{window.Culqi.publicKey=g.CULQI_PUBLIC_KEY,console.log("âœ… Clave pÃºblica configurada exitosamente")}catch(t){console.error("âŒ Error al configurar la clave pÃºblica:",t),i("Error en la integraciÃ³n con Culqi: No se pudo configurar la clave pÃºblica");return}const u=parseFloat(c.amount.toFixed(2)),f=Math.round(u*100);console.log("ðŸ’° Configurando Culqi:"),console.log("   - Monto original:",c.amount),console.log("   - Monto redondeado (soles):",u),console.log("   - Monto en cÃ©ntimos:",f),console.log("   - Email:",c.email),window.Culqi.settings({title:g.CULQI_NAME||g.APP_NAME,email:c.email,currency:"PEN",amount:f,order:`${d}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:g.APP_URL+`/assets/resources/icon.png?v=${crypto.randomUUID()}`,bannerColor:g.APP_COLOR_PRIMARY,buttonBackground:g.APP_COLOR_PRIMARY}});const a=(l=window.Culqi)==null?void 0:l.close;a&&(window.Culqi.close=function(){return!window.Culqi.token&&!p&&(console.log("ðŸš« Modal de Culqi cerrado sin completar el pago"),i("Pago cancelado por el usuario")),a.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){i("No se obtuvo un token de Culqi");return}p=!0;const t=window.Culqi.token.id;console.log("âœ… Token generado:",t),c={...c,token:t,orderNumber:d},console.log("_request actualizado",c);const{status:n,result:e}=await M.Fetch("./api/pago",{method:"POST",body:JSON.stringify(c)});n||console.log((e==null?void 0:e.message)||"Error en el pago"),window.Culqi.close(),y.success("Â¡Pago exitoso!",{description:"Tu pago se procesÃ³ correctamente. Pronto recibirÃ¡s la confirmaciÃ³n de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),m(e)}catch(t){y.error("Â¡Error en el Pago!",{description:t.message,duration:3e3,position:"top-right",richColors:!0}),i(t.message||"Error en el pago")}},window.addEventListener("message",function(t){t.data==="culqi_closed"&&i("Pago cancelado por el usuario")});const r=t=>{t.key==="Escape"&&!p&&(console.log("ðŸš« Modal de Culqi cerrado con Escape"),i("Pago cancelado por el usuario"))};document.addEventListener("keydown",r),setTimeout(()=>{document.removeEventListener("keydown",r)},3e5),document.addEventListener("culqi.error",function(t){var n,e;y.error("Â¡Error en Culqi!",{description:((n=t.detail)==null?void 0:n.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),i(((e=t.detail)==null?void 0:e.message)||"Error desconocido")})}catch(d){y.error("Â¡Error en la integraciÃ³n con Culqi!",{description:d.message,duration:3e3,position:"top-right",richColors:!0}),i("Error en la integraciÃ³n con Culqi")}}),X=({ubigeoCode:c,onStoreSelect:m,selectedStore:i=null,className:l=""})=>{const[d,p]=x.useState([]),[u,f]=x.useState(!1),[a,r]=x.useState(null);x.useEffect(()=>{c&&t()},[c]);const t=async()=>{f(!0),r(null);try{const s=await(await fetch("/api/stores")).json();p(s.data||[])}catch{p([])}finally{f(!1)}},n=e=>{m(e)};return u?o.jsxs("div",{className:`text-center p-6 ${l}`,children:[o.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary/10 rounded-full mb-4",children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),o.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark mb-2",children:"Cargando tiendas..."}),o.jsx("p",{className:"customtext-neutral-light text-sm",children:"Buscando tiendas disponibles en tu ubicaciÃ³n"})]}):a?o.jsxs("div",{className:`bg-red-50 border border-red-200 rounded-xl p-4 md:p-6 ${l}`,children:[o.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-4",children:o.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx("h3",{className:"text-lg font-semibold text-red-800 text-center mb-2",children:"Error al cargar tiendas"}),o.jsx("p",{className:"text-red-600 text-center text-sm",children:a})]}):d.length===0?o.jsxs("div",{className:`bg-secondary/30 border border-secondary rounded-xl p-4 md:p-6 ${l}`,children:[o.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-secondary rounded-full mx-auto mb-4",children:o.jsx("svg",{className:"w-6 h-6 customtext-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx("h3",{className:"text-lg font-semibold customtext-neutral-dark text-center mb-2",children:"Sin tiendas disponibles"}),o.jsx("p",{className:"customtext-neutral-light text-center text-sm",children:"No hay tiendas disponibles para retiro en esta ubicaciÃ³n. Por favor, selecciona otra opciÃ³n de envÃ­o."})]}):o.jsxs("div",{className:l,children:[o.jsxs("div",{className:"mb-4 md:mb-6",children:[o.jsx("h3",{className:"text-lg md:text-xl font-semibold customtext-neutral-dark mb-2",children:"Selecciona una tienda para retiro"}),o.jsx("p",{className:"customtext-neutral-light text-sm md:text-base",children:"Elige la tienda mÃ¡s conveniente para retirar tu pedido"})]}),o.jsx("div",{className:"space-y-3 md:space-y-4",children:d.map(e=>o.jsxs("div",{className:`relative border-2 rounded-xl p-3 md:p-4 cursor-pointer transition-all duration-200 hover:shadow-lg ${(i==null?void 0:i.id)===e.id?"border-primary bg-primary/5 shadow-md":"border-secondary bg-white hover:border-primary/50 hover:shadow-md"}`,onClick:()=>n(e),children:[o.jsx("div",{className:"absolute top-3 md:top-4 right-3 md:right-4",children:o.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${(i==null?void 0:i.id)===e.id?"border-primary bg-primary":"border-secondary bg-white"}`,children:(i==null?void 0:i.id)===e.id&&o.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),o.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4 pr-8",children:[o.jsx("div",{className:"flex-shrink-0 hidden lg:block md:mx-0",children:e.image?o.jsx("img",{src:`/storage/images/store/${e.image}`,alt:e.name,className:"w-16 h-16 md:w-20 md:h-20 object-cover rounded-lg border border-secondary"}):o.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-secondary rounded-lg border border-secondary flex items-center justify-center",children:o.jsx(S,{className:"customtext-primary"})})}),o.jsxs("div",{className:"flex-1 min-w-0 text-left md:text-left",children:[o.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-2 mb-2",children:[o.jsx("h4",{className:"font-semibold customtext-neutral-dark text-base md:text-lg truncate",children:e.name}),o.jsx("span",{className:`hidden lg:block px-2 py-1 rounded-full text-xs font-medium ${e.type==="tienda"?"bg-primary/10 customtext-primary":e.type==="oficina"||e.type==="almacen"?"bg-secondary customtext-neutral-dark":e.type==="showroom"?"bg-primary/10 customtext-primary":"bg-secondary customtext-neutral-dark"}`,children:e.type==="tienda"?"Tienda":e.type==="oficina"?"Oficina":e.type==="almacen"?"AlmacÃ©n":e.type==="showroom"?"Showroom":e.type||"Otro"})]}),o.jsx("p",{className:"text-sm customtext-neutral-light mb-3 line-clamp-3",children:e.address}),o.jsxs("div",{className:"flex flex-col md:flex-row md:flex-wrap gap-2 md:gap-4 text-sm customtext-neutral-light mb-3",children:[e.phone&&o.jsxs("div",{className:"flex items-center justify-start md:justify-start gap-1",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),o.jsx("span",{children:e.phone})]}),e.manager&&o.jsxs("div",{className:"flex items-center justify-start md:justify-start gap-1",children:[o.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),o.jsxs("span",{className:"text-center md:text-left",children:["Encargado: ",e.manager]})]})]}),e.business_hours&&o.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mt-3",children:[o.jsx("div",{className:"text-xs font-medium customtext-neutral-dark mb-2",children:"Horarios de atenciÃ³n:"}),o.jsx("div",{className:"text-xs customtext-neutral-light",children:(()=>{try{const s=typeof e.business_hours=="string"?JSON.parse(e.business_hours):e.business_hours,k=new Date().toLocaleDateString("es-PE",{weekday:"long"}),N={lunes:"Lunes",martes:"Martes",miÃ©rcoles:"MiÃ©rcoles",jueves:"Jueves",viernes:"Viernes",sÃ¡bado:"SÃ¡bado",domingo:"Domingo"}[k.toLowerCase()]||k,h=s.find(w=>w.day.toLowerCase()===N.toLowerCase());if(h){const w=h.closed?"Hoy: Cerrado":`Hoy: ${h.open} - ${h.close}`,b=!h.closed&&(()=>{const C=new Date,v=C.getHours()*60+C.getMinutes(),[E,P]=h.open.split(":").map(Number),[_,q]=h.close.split(":").map(Number),T=E*60+P,L=_*60+q;return v>=T&&v<=L})();return o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{children:w}),o.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${b?"bg-primary/10 customtext-primary":"bg-red-100 text-red-800"}`,children:b?"Abierto":"Cerrado"})]})}return"Horarios disponibles"}catch{return"Horarios disponibles"}})()})]}),e.description&&o.jsx("div",{className:"hidden lg:block mt-3 pt-3 border-t border-secondary",children:o.jsx("p",{className:"text-sm customtext-neutral-light text-center md:text-left",children:e.description})})]})]})]},e.id))})]})},Y=()=>{const c=x.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),m=(a,r={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[a],content_type:"product",content_name:r.name||"",value:r.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:r.price||0,items:[{item_id:a,item_name:r.name||"",category:r.category||"",price:r.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:a,content_type:"product",content_name:r.name||"",value:r.price||0,currency:"PEN"}),console.log("âœ… ProductView tracked for product:",a))},i=async(a,r=1,t={})=>{var n;if(!(typeof window>"u"))try{const s=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)||""},body:JSON.stringify({product_id:a,quantity:r,...t})})).json();s.success&&s.tracking_scripts&&(u(s.tracking_scripts),console.log("âœ… AddToCart tracked successfully"))}catch(e){console.error("âŒ Error tracking AddToCart:",e)}},l=async(a,r)=>{var t;if(!(typeof window>"u"||c.current.hasTrackedInitiateCheckout))try{c.current.hasTrackedInitiateCheckout=!0;const e=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},body:JSON.stringify({cart_items:a.map(s=>({product_id:s.id,name:s.name,price:s.final_price||s.price,quantity:s.quantity,subtotal:(s.final_price||s.price)*s.quantity}))})})).json();e.success&&e.tracking_scripts&&(u(e.tracking_scripts),console.log("âœ… InitiateCheckout tracked successfully"))}catch(n){console.error("âŒ Error tracking InitiateCheckout:",n),c.current.hasTrackedInitiateCheckout=!1}},d=(a,r)=>{if(!(typeof window>"u")){console.log("ðŸŽ¯ Iniciando tracking de compra:",{orderId:a,conversionScripts:r});try{r?(console.log("ðŸ“Š Usando scripts de conversiÃ³n del servidor"),u(r)):(console.log("ðŸ”„ Obteniendo scripts de conversiÃ³n del API"),fetch(`/api/tracking/purchase/${a}`).then(t=>t.text()).then(t=>{t&&(u(t),console.log("âœ… Purchase tracked successfully"))}).catch(t=>{console.error("âŒ Error tracking Purchase:",t)}))}catch(t){console.error("âŒ Error general en trackPurchase:",t)}}},p=(a,r=[])=>{if(typeof window>"u"||c.current.hasTrackedPageView)return;c.current.hasTrackedPageView=!0;const t=r.reduce((n,e)=>n+(e.final_price||e.price)*e.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),a===1&&r.length>0&&window.fbq("track","AddToCart",{content_ids:r.map(n=>n.id),content_type:"product",value:t,currency:"PEN",num_items:r.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${a}`,page_location:window.location.href}),a===1&&r.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:t,items:r.map(n=>{var e;return{item_id:n.id,item_name:n.name,category:((e=n.category)==null?void 0:e.name)||"Sin categorÃ­a",quantity:n.quantity,price:n.final_price||n.price}})})),console.log(`âœ… Checkout PageView tracked - Step ${a}`)},u=a=>{if(typeof window>"u"||!a)return;console.log("ðŸŽ¯ Ejecutando scripts de tracking:",a);const r=document.createElement("div");r.innerHTML=a,r.querySelectorAll("script").forEach((n,e)=>{try{const s=document.createElement("script");s.textContent=n.textContent,console.log(`ðŸ“Š Ejecutando script de tracking ${e+1}:`,n.textContent.trim()),document.head.appendChild(s),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},100),console.log(`âœ… Script de tracking ${e+1} ejecutado exitosamente`)}catch(s){console.error(`âŒ Error ejecutando script de tracking ${e+1}:`,s),console.error("Script content:",n.textContent)}}),console.log("ðŸŽ¯ Todos los scripts de tracking procesados")};return{trackProductView:m,trackAddToCart:i,trackInitiateCheckout:l,trackPurchase:d,trackCheckoutPageView:p,resetTracking:()=>{c.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};export{z as O,X as S,F as U,K as p,Y as u};

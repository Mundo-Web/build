import{r as e,j as a,i as s,R as l,c as t}from"./vendor-react-DB2gWWlz.js";import{C as n}from"./CreateReactScript-7rAqIEI0.js";import{S as i}from"./SystemRest-B38HXDTO.js";import{S as r}from"./SwitchFormGroup-CUJX8XRh.js";import{G as o}from"./Global-BAGAPG-V.js";import{S as c}from"./SortByAfterField-DzAI86wF.js";import{I as d}from"./InputFormGroup-2FSTuTd0.js";import{T as m}from"./TextareaFormGroup-UGEg0Hiq.js";import{M as u}from"./Modal-5lTGbKHj.js";import{S as p}from"./SelectFormGroup-d3smK87G.js";import{S as h}from"./SetSelectValue-DCHQOIKz.js";import{M as x,a as f}from"./MenuItemContainer-C29lHQ3g.js";import{C as g,S as b}from"./SettingsRest-CQrUOUEh.js";import{G as j}from"./GalleryRest-ChODy_UV.js";import"./vendor-swiper-Cr_RrIb_.js";import"./TippyButton-Crd57m29.js";import"./General-ClVW7qxN.js";import"./LaravelSession-ByQnaUD3.js";import"./Menu-OQAZllby.js";import"./BooleanLimit-q2Ad9fGY.js";import"./BasicRest-rcCccbSV.js";import"./GoogleSignInButton-Bo5d3xNo.js";const v=(e="")=>{e=e.replace(/[^a-zA-Z0-9_{}]/g,"");const a=/{([^}]+)}/g,s=[];let l;for(;null!==(l=a.exec(e));)s.push(l[1]);return s},N=new i,y=l=>{const{id:t,name:n,path:i,extends_base:o=!1,menuable:c=!1,sitemapable:d=!1,setPages:m,onSEOClicked:u,onParamsClicked:p}=l,[h,x]=e.useState(!1),[f,g]=e.useState(!1),[b,j]=e.useState(!1),[y,w]=e.useState(!1),[k,C]=e.useState(!1),S=v(i);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"dropdown float-end",children:[a.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:a.jsx("i",{className:"mdi mdi-dots-vertical"})}),a.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[a.jsxs("button",{className:"dropdown-item",onClick:()=>u(l),children:[a.jsx("i",{className:"mdi mdi-cloud-search-outline me-1"}),"Editar SEO"]}),S.length>0&&a.jsxs("button",{className:"dropdown-item",onClick:()=>p(l),children:[a.jsx("i",{className:"mdi mdi-code-braces me-1"}),"Parámetros"]}),a.jsx("div",{className:"dropdown-divider"}),a.jsxs("button",{className:"dropdown-item",onClick:()=>(async e=>{await N.deletePage(e.id)&&(m(a=>a.filter(a=>a.id!=e.id)),$('[data-bs-toggle="tab"]').removeClass("active"),$(".tab-pane").removeClass("active"),$("#base-template-link").addClass("active"),$("#base-template").addClass("active"))})(l),children:[a.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar página"]})]})]}),a.jsxs("div",{children:[h?a.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:n,onBlur:async e=>{if(n===e.target.value)return x(!1);N.savePage({id:t,name:e.target.value})&&(x(!1),m(a=>a.map(a=>a.id===t?{...a,name:e.target.value}:a)))},autoFocus:!0}):a.jsx(s,{content:"Editar nombre",placement:"left",children:a.jsx("h4",{className:"header-title mb-1 d-block",onClick:()=>x(!0),style:{minWidth:"200px",cursor:"pointer"},children:n||"Sin nombre"})}),f?a.jsx("input",{className:"form-control form-control-sm mb-1",defaultValue:i,style:{minHeight:27,fieldSizing:"content"},onBlur:async e=>{if(i===e.target.value)return g(!1);const a=e.target.value;let s=structuredClone(a);const n=l.using??{};for(const l of v(a))s=s.replace(`{${l}}`,"").replace(`{${l}?}`,""),n[l]=n[l]??{model:null};const r=((e,a)=>{const s=new RegExp(`[${a}]+$`,"g");return e.replace(s,"")})(s,"/");N.savePage({id:t,path:a,pseudo_path:r,using:Object.keys(n).length>0?n:void 0})&&(g(!1),m(a=>a.map(a=>a.id===t?{...a,path:e.target.value}:a)))},autoFocus:!0}):a.jsx(s,{content:"Editar ruta",placement:"left",children:a.jsx("small",{className:"text-muted d-block mb-1",onClick:()=>g(!0),style:{minWidth:"200px",cursor:"pointer"},children:i||"Sin ruta"})})]}),a.jsxs("div",{className:"row",children:[a.jsx(r,{label:"Extiende de base",col:"col-lg-6 col-md-12 col-sm-6",checked:o,onChange:async e=>{j(!0);const a=e.target.checked,s=N.savePage({id:t,extends_base:a});j(!1),s&&m(e=>e.map(e=>e.id===t?{...e,extends_base:a}:e))},disabled:b}),a.jsx(r,{label:"Mostrar en menu",col:"col-lg-6 col-md-12 col-sm-6",checked:c,onChange:async e=>{w(!0);const a=e.target.checked,s=N.savePage({id:t,menuable:a});w(!1),s&&m(e=>e.map(e=>e.id===t?{...e,menuable:a}:e))},disabled:y}),a.jsx(r,{label:"Incluir en sitemap",col:"col-lg-6 col-md-12 col-sm-6",checked:d,onChange:async e=>{C(!0);const a=e.target.checked,s=N.savePage({id:t,sitemapable:a});C(!1),s&&m(e=>e.map(e=>e.id===t?{...e,sitemapable:a}:e))},disabled:k})]})]})},w=new i,k=[{value:"always",label:"Siempre"},{value:"hourly",label:"Cada hora"},{value:"daily",label:"Diario"},{value:"weekly",label:"Semanal"},{value:"monthly",label:"Mensual"},{value:"yearly",label:"Anual"},{value:"never",label:"Nunca"}],C=({dataLoaded:s,setDataLoaded:l,modalRef:t})=>{const n=e.useRef(null),i=e.useRef(null),r=e.useRef(null),c=e.useRef(null),x=e.useRef(null);return e.useEffect(()=>{n.current.value=`${s?.name} | ${o.APP_NAME}`,i.current.value=s?.description??"",h(r.current,s?.keywords??[]),c.current.value=s?.sitemap_priority??.8,h(x.current,s?.sitemap_frequency??"weekly")},[s]),a.jsx(u,{modalRef:t,title:`Editar SEO - ${s?.name}`,size:"md",onSubmit:async e=>{e.preventDefault();await w.savePage({id:s.id,description:i.current.value,keywords:$(r.current).val(),sitemap_priority:parseFloat(c.current.value)||.8,sitemap_frequency:$(x.current).val()||"weekly"})&&(l(null),$(t.current).modal("hide"))},children:a.jsxs("div",{id:"seo-container",children:[a.jsx(d,{eRef:n,label:"Título",disabled:!0}),a.jsx(m,{eRef:i,label:"Descripción",rows:2}),a.jsx(p,{eRef:r,label:"Palabras clave",tags:!0,multiple:!0,dropdownParent:"#seo-container"}),a.jsx("hr",{className:"my-3"}),a.jsxs("h6",{className:"text-muted mb-3",children:[a.jsx("i",{className:"fas fa-sitemap me-1"}),"Configuración del Sitemap"]}),a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-6",children:a.jsx(d,{eRef:c,label:"Prioridad (0.0 - 1.0)",type:"number",step:"0.1",min:"0",max:"1"})}),a.jsx("div",{className:"col-6",children:a.jsx(p,{eRef:x,label:"Frecuencia de cambio",dropdownParent:"#seo-container",children:k.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})})]})]})})},S=({className:e,system:s,component:l,onComponentClicked:t,onDeleteClicked:n,onEditDataClicked:i})=>{const r=l?.options??[],o=r.find(e=>e.id==s.value);return a.jsxs("div",{className:`dropdown ${e}`,"data-id":s.id,children:[a.jsxs("div",{className:"btn btn-light dropdown-toggle text-truncate w-100 text-start",type:"button",id:`dd-${s.id}`,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true",children:[a.jsx("i",{className:"mdi mdi-chevron-down ms-1 float-end"}),a.jsxs("span",{className:"handle-sortable",style:{cursor:"move"},children:[a.jsx("i",{className:"fa fa-ellipsis-v"}),a.jsx("i",{className:"fa fa-ellipsis-v"})]}),a.jsx("span",{className:"ms-1",children:s.name})]}),a.jsxs("div",{className:"dropdown-menu","aria-labelledby":`dd-${s.id}`,"data-popper-placement":"bottom-start","data-simplebar":!0,style:{maxHeight:"300px",width:"100%"},children:[r.length>1&&a.jsxs(a.Fragment,{children:[r.filter(e=>e.id!=s.value).map((e,n)=>a.jsxs("button",{className:"dropdown-item",onClick:()=>t({...s,name:`${l.name} - ${e.name}`,value:e.id}),children:[l.name," - ",e.name]},n)),a.jsx("div",{className:"dropdown-divider"})]}),(o?.using?.filters||o?.data)&&a.jsxs("button",{className:"dropdown-item",onClick:()=>i(s,o),children:[a.jsx("i",{className:"mdi mdi-pencil me-1"}),"Configurar datos"]}),a.jsxs("button",{className:"dropdown-item",onClick:()=>n(s),children:[a.jsx("i",{className:"mdi mdi-trash-can-outline me-1"}),"Eliminar"]})]})]})},R=({col:s,label:l,eRef:t,placeholder:n,required:i=!1,rows:r=3,value:o,onChange:c=()=>{}})=>{const[d,m]=e.useState(o),u=e.useRef(),p=e.useRef(null),h=t||u;return e.useEffect(()=>(p.current&&(p.current.toTextArea(),p.current=null),p.current=CodeMirror.fromTextArea(h.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2}),p.current.setValue(o),setTimeout(()=>{p.current.refresh()},125),p.current.on("change",e=>{const a=e.getValue();m(a),c({target:{value:a}})}),()=>{p.current&&(p.current.toTextArea(),p.current=null)}),[h]),e.useEffect(()=>{d!==o&&(m(o),p.current&&(p.current.setValue(o),setTimeout(()=>{p.current.refresh()},125)))},[o]),a.jsxs("div",{className:`form-group ${s} mb-2`,children:[a.jsxs("label",{htmlFor:"",className:"mb-1",children:[l," ",i&&a.jsx("b",{className:"text-danger",children:"*"})]}),a.jsx("textarea",{ref:h,className:"form-control",placeholder:n,required:i,rows:r,defaultValue:o,onChange:e=>m(e.target.value)})]})},E=new i,_=[{value:"fade-up",label:"Fade Up (por defecto)"},{value:"fade-down",label:"Fade Down"},{value:"fade-left",label:"Fade Left"},{value:"fade-right",label:"Fade Right"},{value:"fade",label:"Fade (solo opacidad)"},{value:"zoom-in",label:"Zoom In"},{value:"zoom-out",label:"Zoom Out"},{value:"slide-up",label:"Slide Up"},{value:"slide-down",label:"Slide Down"},{value:"slide-left",label:"Slide Left"},{value:"slide-right",label:"Slide Right"},{value:"blur-in",label:"Blur In"},{value:"scale-up",label:"Scale Up"},{value:"rotate-in",label:"Rotate In"},{value:"reveal",label:"Reveal (máscara)"},{value:"none",label:"Sin animación"}],F=[{value:"gcigc",label:"GCIGC (suave profesional)"},{value:"smooth",label:"Smooth"},{value:"ease",label:"Ease"},{value:"ease-in",label:"Ease In"},{value:"ease-out",label:"Ease Out"},{value:"ease-in-out",label:"Ease In Out"},{value:"spring",label:"Spring (rebote suave)"},{value:"bounce",label:"Bounce (rebote fuerte)"}],P=({dataLoaded:s,setDataLoaded:t,setSystems:n,modalRef:i})=>{const[r,o]=e.useState(s?.data||{}),[c,h]=e.useState(s?.element_id||""),[x,f]=e.useState([]),g={};g.model=e.useRef(null),g.filters=e.useRef(null),g.filtersMethod=e.useRef(null);e.useEffect(()=>{const e={...s?.data||{}};s?.component?.data?.forEach&&s?.component?.data?.forEach(a=>{a in e||(e[a]="")}),o(e),h(s?.element_id||""),g.model.current.value=s?.component?.using?.model??"",$(g.filters.current).val(s?.filters??[]).trigger("change"),$(g.filtersMethod.current).val(s?.filtersMethod??[]).trigger("change");const a=s?.component?.using?.model,l=s?.component?.using?.["filters:method"];a&&l&&E.simpleGet(`/api/admin/system/related/${a}/${l}`).then(e=>{f(e)})},[s]);const b=(e,a)=>{o({...r,[e]:a})};return a.jsxs(u,{modalRef:i,title:s?.name,onSubmit:async e=>{e.preventDefault();const a={...s?.data||{},...r},l=await E.save({id:s.id,data:a,element_id:c,filters:$(g.filters.current).val(),filters_method:s?.component?.using?.["filters:method"],filters_method_values:$(g.filtersMethod.current).val()});l&&(t(null),$(i.current).modal("hide"),n(e=>e.map(e=>e.id==s.id?l:e)))},size:s?.component?.data?.some(e=>e.startsWith("code:"))?"lg":"md",children:[a.jsxs("ul",{className:"nav nav-tabs nav-bordered",children:[a.jsx("li",{className:"nav-item",children:a.jsx("a",{href:"#tab-general","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link active",children:"General"})}),a.jsx("li",{className:"nav-item",hidden:!s?.component?.data?.length,children:a.jsx("a",{href:"#tab-info","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Información"})}),a.jsx("li",{className:"nav-item",children:a.jsxs("a",{href:"#tab-animation","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:[a.jsx("i",{className:"mdi mdi-animation-play me-1"}),"Animación"]})}),a.jsx("li",{className:"nav-item",hidden:!s?.component?.using?.filters&&!s?.component?.using?.["filters:method"],children:a.jsx("a",{href:"#tab-db","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Base de datos"})})]}),a.jsxs("div",{className:"tab-content",id:"data-modal-container",children:[a.jsxs("div",{className:"tab-pane active",id:"tab-general",children:[a.jsx(d,{label:"ID del elemento",value:c,onChange:e=>h(e.target.value),placeholder:"ej: contacto-principal, formulario-1"}),a.jsx("small",{className:"text-muted d-block mb-3",children:"Este ID se usa para anclas (#id), CSS personalizado y navegación. Se genera automáticamente pero puedes personalizarlo."})]}),a.jsx("div",{className:"tab-pane",id:"tab-info",hidden:!s?.component?.data?.length,children:s?.component?.data?.map((e,s)=>e.startsWith("code:")?a.jsx(R,{label:e.replace("code:",""),value:r[e]??"",rows:1,onChange:a=>o({...r,[e]:a.target.value})},s):a.jsx(l.Fragment,{children:e.startsWith("bool:")?a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:e.replace("bool:","")}),a.jsxs("div",{children:[a.jsxs("div",{className:"form-check form-check-inline",children:[a.jsx("input",{type:"radio",className:"form-check-input",id:`${e}-true`,name:e,value:"true",checked:!0===r[e],onChange:a=>b(e,"true"===a.target.value)}),a.jsx("label",{className:"form-check-label",htmlFor:`${e}-true`,children:"Sí"})]}),a.jsxs("div",{className:"form-check form-check-inline",children:[a.jsx("input",{type:"radio",className:"form-check-input",id:`${e}-false`,name:e,value:"false",checked:!1===r[e],onChange:a=>b(e,"true"===a.target.value)}),a.jsx("label",{className:"form-check-label",htmlFor:`${e}-false`,children:"No"})]})]})]}):a.jsx(m,{label:e,value:r[e]??"",rows:1,onChange:a=>o({...r,[e]:a.target.value})})},s))}),a.jsxs("div",{className:"tab-pane",id:"tab-animation",children:[a.jsxs("div",{className:"alert alert-info alert-dismissible fade show mb-3",role:"alert",children:[a.jsx("i",{className:"mdi mdi-information-outline me-1"}),"Configura animaciones de scroll estilo ",a.jsx("strong",{children:"gcigc.com"}),". Los elementos aparecerán animados al hacer scroll."]}),a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"form-group mb-3",children:[a.jsx("label",{className:"form-label",children:"Tipo de Animación"}),a.jsx("select",{className:"form-control",value:r.scroll_animation||"fade-up",onChange:e=>o({...r,scroll_animation:e.target.value}),children:_.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]})}),a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"form-group mb-3",children:[a.jsx("label",{className:"form-label",children:"Easing (curva de velocidad)"}),a.jsx("select",{className:"form-control",value:r.scroll_easing||"gcigc",onChange:e=>o({...r,scroll_easing:e.target.value}),children:F.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]})})]}),a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"form-group mb-3",children:[a.jsx("label",{className:"form-label",children:"Duración (segundos)"}),a.jsx("input",{type:"number",className:"form-control",step:"0.1",min:"0.1",max:"3",value:r.scroll_duration||.8,onChange:e=>o({...r,scroll_duration:e.target.value}),placeholder:"0.8"}),a.jsx("small",{className:"text-muted",children:"Recomendado: 0.6 - 1.0 segundos"})]})}),a.jsx("div",{className:"col-md-6",children:a.jsxs("div",{className:"form-group mb-3",children:[a.jsx("label",{className:"form-label",children:"Delay (segundos)"}),a.jsx("input",{type:"number",className:"form-control",step:"0.1",min:"0",max:"2",value:r.scroll_delay||0,onChange:e=>o({...r,scroll_delay:e.target.value}),placeholder:"0"}),a.jsx("small",{className:"text-muted",children:"Tiempo de espera antes de iniciar"})]})})]}),a.jsx("div",{className:"form-group mb-3",children:a.jsxs("div",{className:"form-check",children:[a.jsx("input",{type:"checkbox",className:"form-check-input",id:"scroll_disabled",checked:!0===r.scroll_disabled,onChange:e=>o({...r,scroll_disabled:e.target.checked})}),a.jsx("label",{className:"form-check-label",htmlFor:"scroll_disabled",children:"Desactivar animación para este componente"})]})}),a.jsx("div",{className:"card bg-light mb-0",children:a.jsxs("div",{className:"card-body py-2",children:[a.jsx("small",{className:"text-muted d-block mb-1",children:"Vista previa:"}),a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx("span",{className:"badge bg-primary",children:r.scroll_animation||"fade-up"}),a.jsx("span",{className:"badge bg-secondary",children:r.scroll_easing||"gcigc"}),a.jsxs("span",{className:"badge bg-info",children:[r.scroll_duration||.8,"s"]}),r.scroll_delay>0&&a.jsxs("span",{className:"badge bg-warning",children:["delay: ",r.scroll_delay,"s"]}),r.scroll_disabled&&a.jsx("span",{className:"badge bg-danger",children:"desactivado"})]})]})})]}),a.jsxs("div",{className:"tab-pane show",id:"tab-db",children:[a.jsx(d,{eRef:g.model,label:"Modelo",disabled:!0}),a.jsx(p,{eRef:g.filters,label:"Filtros",multiple:!0,dropdownParent:"#tab-db",hidden:!s?.component?.using?.filters,children:s?.component?.using?.filters?.map((e,s)=>a.jsx("option",{value:e,children:e},s))}),a.jsx("div",{hidden:!s?.component?.using?.["filters:method"],children:a.jsx(p,{eRef:g.filtersMethod,label:s?.component?.using?.["filters:method"]?.toTitleCase(),multiple:!0,dropdownParent:"#tab-db",changeWith:[x],children:x?.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})})]})]})]})},D=new i,L=({components:s,onClick:l})=>{const[t,n]=e.useState(""),i=s.filter(e=>e.options.length>0).filter(e=>{if(!t)return!0;const a=t.toLowerCase();return e.name.toLowerCase().includes(a)||e.options.some(e=>e.name.toLowerCase().includes(a))});return a.jsx("div",{className:"left-side-menu top-0 pt-2",children:a.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[a.jsx("div",{id:"sidebar-menu",className:"show",children:a.jsxs("ul",{id:"side-menu",children:[a.jsx("li",{className:"menu-title",children:"Lista de componentes"}),a.jsx("li",{className:"px-3 py-2",children:a.jsxs("div",{className:"position-relative",children:[a.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Buscar componentes...",value:t,onChange:e=>n(e.target.value),style:{backgroundColor:"#ffffff",color:"#8391a2",paddingLeft:"35px"}}),a.jsx("i",{className:"mdi mdi-magnify position-absolute",style:{left:"10px",top:"50%",transform:"translateY(-50%)",color:"#8391a2",fontSize:"16px"}})]})}),i.map((e,s)=>a.jsx(x,{title:e.name,icon:e.icon,children:e.options.map((s,t)=>a.jsx(f,{name:s.name,icon:s.icon,onClick:()=>{const a=$(".tab-pane:visible .components-container > div").last().data("id");l({name:`${e.name} - ${s.name}`,component:e.id,value:s.id,after_component:a})},children:s.name},t))},s)),0===i.length&&t&&a.jsx("li",{className:"px-3 py-2",children:a.jsx("small",{className:"text-muted",children:"No se encontraron componentes"})}),"          ",a.jsx("li",{className:"menu-title",children:"Sistema de respaldo"}),a.jsx(f,{icon:"mdi mdi-cogs",rightBarToggle:!0,children:"Configuraciones"}),a.jsx(f,{icon:"mdi mdi-cloud-download",onClick:async()=>{const e=await D.exportBK(),a=new Blob([JSON.stringify(e)],{type:"application/json"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="backup.json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)},children:"Exportar Backup"}),a.jsx("input",{type:"file",id:"file-input",accept:"application/json",style:{display:"none"},onChange:async e=>{const a=e.target.files[0];if(e.target.value=null,a){const e=new FormData;e.append("backup",a);if(!(await D.importBK(e)))return;location.reload()}}}),a.jsx(f,{icon:"mdi mdi-backup-restore",onClick:()=>{document.getElementById("file-input").click()},children:"Importar Backup"})]})}),a.jsx("div",{className:"clearfix"})]})})},B=({page:s,param:l,models:t,setUsing:n,setPages:i})=>{const r=e.useRef(),o=e.useRef(),c=e.useRef(),d=s?.using,[m,u]=e.useState(null);e.useEffect(()=>{$(r.current).val(d?.[l]?.model).trigger("change")},[l]),e.useEffect(()=>{n(e=>({...e,[l]:{...e[l],model:m?.name??null}})),$(o.current).val(d?.[l]?.field??null).trigger("change"),$(c.current).val(d?.[l]?.relations??[]).trigger("change")},[m]);const h=`${l}-container`;return a.jsxs("div",{id:h,className:"row",children:[a.jsxs("label",{className:"form-label",children:["Parámetro ",a.jsx("code",{children:l})]}),a.jsx(p,{eRef:r,label:"Modelo",col:"col-md-6",dropdownParent:`#${h}`,onChange:e=>{const a=r.current.value,s=t.find(e=>e.name==a)??null;u(s)},children:t.map((e,s)=>a.jsx("option",{value:e.name,children:e.name},s))}),a.jsx(p,{eRef:o,label:"Campo",col:"col-md-6",dropdownParent:`#${h}`,onChange:e=>{n(a=>({...a,[l]:{...a[l],field:e.target.value}}))},children:m?.fields?.map((e,s)=>a.jsx("option",{children:e},s))}),a.jsx("div",{hidden:0==(m?.relations?.length??0),children:a.jsx(p,{eRef:c,label:"Relaciones",multiple:!0,dropdownParent:`#${h}`,onChange:e=>{const a=$(e.target).val();n(e=>({...e,[l]:{...e[l],relations:a}}))},children:m?.relations?.map((e,s)=>a.jsx("option",{children:e},s))})})]})},I=new i,z=({dataLoaded:s,setDataLoaded:l,setPages:t,modalRef:n,models:i})=>{const r=v(s?.path??""),[o,c]=e.useState({});return e.useEffect(()=>{c(s?.using??{})},[s]),a.jsx(u,{modalRef:n,title:`Editar parámetros de URL - ${s?.name}`,onSubmit:async e=>{e.preventDefault();const a=await I.savePage({id:s.id,using:o});a&&(l(null),t(a),$(n.current).modal("hide"))},onClose:()=>l(null),children:r.map((e,l)=>a.jsx(B,{page:s,param:e,models:i,using:o,setUsing:c,setPages:t},l))})},U=new j,M=new g,A=new b,G=({colors:l,setColors:t,settings:n,setSettings:i})=>{const[r,o]=e.useState([{uuid:crypto.randomUUID(),col:"col-3",name:"Icon (1:1)",src:"icon.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-5",name:"Logo (13:4)",src:"logo.png",width:"100%",aspectRatio:3.25},{uuid:crypto.randomUUID(),col:"col-4",name:"Logo footer (1:1)",src:"logo-footer.png",width:"100%",aspectRatio:1},{uuid:crypto.randomUUID(),col:"col-12",name:"Loading (13:4)",src:"loading.png",width:"100%",aspectRatio:3.25}]),c=async e=>{const a=e.target.files?.[0]??null;if(!a)return;e.target.value=null;const s=e.target.name,l=new FormData;l.append("image",a),l.append("name",s);await U.save(l)&&o(e=>e.map(e=>(e.src==s&&(e.uuid=crypto.randomUUID()),e)))},d=async e=>{const a=e.target.getAttribute("data-color-id"),s=e.target.name,n=e.target.value;if(l.find(e=>e.id==a)[s]===n)return;const i=await M.save({id:a,[s]:n});i&&t(e=>e.map(e=>e.id==a?i.data:e))},m=async e=>{const a=e.target.getAttribute("data-id"),s=e.target.name;let l=e.target.value;"checkbox"==e.target.type&&(l=e.target.checked?"true":"false");if((n.find(e=>e.name==s)?.description??"")===l)return;const t=await A.save({name:s,value:l});t&&i(e=>e.map(e=>e.id==a?t.data:e))},u=e=>{const a=n.find(a=>a.name==e);return a?a.value:""};return a.jsx("div",{className:"right-bar",children:a.jsxs("div",{"data-simplebar":!0,className:"h-100",children:[a.jsxs("div",{className:"rightbar-title",children:[a.jsx("a",{href:"#",className:"right-bar-toggle float-end",children:a.jsx("i",{className:"mdi mdi-close"})}),a.jsx("h4",{className:"font-16 m-0 text-white",children:"Configuraciones"})]}),a.jsxs("div",{className:"p-2",children:[a.jsx("h5",{children:"Imágenes principales"}),a.jsx("div",{className:"row",children:r.map((e,s)=>{const l="file-"+e.uuid;return a.jsxs("div",{className:e.col,children:[a.jsx("input",{id:l,name:e.src,type:"file",accept:"image/png",hidden:!0,onChange:c}),a.jsx("label",{htmlFor:l,className:"form-label d-block mb-1",style:{cursor:"pointer"},children:e.name}),a.jsx("label",{htmlFor:l,style:{cursor:"pointer"},className:"w-100",children:a.jsx("img",{className:"border",src:`/assets/resources/${e.src}?v=${e.uuid}`,alt:"",style:{height:e.height,width:e.width,objectFit:"contain",objectPosition:"center",backgroundColor:"#f5f5f5",borderRadius:"4px",aspectRatio:e.aspectRatio}})})]},s)})}),a.jsx("hr",{className:"my-2"}),a.jsx("h5",{children:"Fuentes del sistema"}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Titulos"}),a.jsx(s,{content:"Nombre de la fuente",children:a.jsx("input",{type:"text",className:"form-control form-control-sm mb-1",name:"title-font-name",defaultValue:u("title-font-name"),onBlur:m})}),a.jsx(s,{content:"Enlace de la fuente",children:a.jsx("textarea",{className:"form-control form-control-sm",rows:1,name:"title-font-url",defaultValue:u("title-font-url"),onBlur:m,style:{minHeight:27,fieldSizing:"content"}})}),a.jsx(s,{content:"Marcar si el archivo es un archivo de fuente (otf, woff, woff2, etc)",children:a.jsxs("div",{className:"form-check mt-1",children:[a.jsx("input",{type:"checkbox",className:"form-check-input",name:"title-font-source",id:"title-font-source",defaultChecked:"true"==u("title-font-source"),onBlur:m}),a.jsx("label",{className:"form-check-label",htmlFor:"title-font-source",children:"¿Es este un archivo de fuente?"})]})})]}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{htmlFor:"",className:"form-label mb-1",children:"Parrafos"}),a.jsx(s,{content:"Nombre de la fuente",children:a.jsx("input",{type:"text",className:"form-control form-control-sm mb-1",name:"paragraph-font-name",defaultValue:u("paragraph-font-name"),onBlur:m})}),a.jsx(s,{content:"Enlace de la fuente",children:a.jsx("textarea",{className:"form-control form-control-sm",rows:1,name:"paragraph-font-url",defaultValue:u("paragraph-font-url"),onBlur:m,style:{minHeight:27,fieldSizing:"content"}})}),a.jsx(s,{content:"Marcar si el archivo es un archivo de fuente (otf, woff, woff2, etc)",children:a.jsxs("div",{className:"form-check mt-1",children:[a.jsx("input",{type:"checkbox",className:"form-check-input",name:"paragraph-font-source",id:"paragraph-font-source",defaultChecked:"true"==u("paragraph-font-source"),onBlur:m}),a.jsx("label",{className:"form-check-label",htmlFor:"paragraph-font-source",children:"¿Es este un archivo de fuente?"})]})})]}),a.jsx("hr",{className:"my-2"}),a.jsx("h5",{children:"Colores del sistema"}),a.jsx("div",{className:"d-flex flex-column gap-1",children:l.map((e,s)=>{const t=e.description?.startsWith("linear-gradient")||e.description?.startsWith("radial-gradient"),n="menu-admin"==e.name,i=l.find(e=>"primary"==e.name)?.description||"#6658dd";return a.jsxs("div",{children:[a.jsxs("div",{className:"input-group input-group-sm",children:[!t&&a.jsx("span",{className:"input-group-text px-1",children:a.jsx("input",{type:"color",name:"description","data-color-id":e.id,className:"p-0",style:{width:"20px",height:"20px",border:"1px solid #ced4da",borderRadius:"4px",cursor:"pointer"},defaultValue:e.description||i,onBlur:d})}),a.jsx("input",{type:"text",name:"name","data-color-id":e.id,className:"form-control form-control-sm",placeholder:"Color",defaultValue:e.name,onBlur:d,disabled:"primary"==e.name||n,style:{cursor:"primary"==e.name||n?"not-allowed":"text"}})]}),t?a.jsx("textarea",{name:"description","data-color-id":e.id,className:"form-control form-control-sm mt-1",placeholder:"Gradiente: linear-gradient(...)",defaultValue:e.description||"",onBlur:d,rows:2,style:{fontSize:"11px",minHeight:27,fieldSizing:"content"}}):a.jsx("input",{type:"text",name:"description","data-color-id":e.id,className:"form-control form-control-sm mt-1",placeholder:n?"Color del menú admin (por defecto: primary)":"Hex color",defaultValue:e.description||(n?i:""),onBlur:d,style:{fontSize:"11px"}})]},s)})})]})]})})},T=new i,V=({systems:l=[],pages:t=[],colors:n=[],components:i,models:r,settings:d=[]})=>{const m=e.useRef(null),p=e.useRef(null),h=e.useRef(null),x=e.useRef(null),[f,g]=e.useState(l),[b,j]=e.useState(t),[N,w]=e.useState(n),[k,R]=e.useState(d),[E,_]=e.useState(!1),[F,D]=e.useState(null),[B,I]=e.useState(null),[U,M]=e.useState(!1),[A,V]=e.useState(!1),[O,H]=e.useState(null),[W,q]=e.useState(!1),[Y,K]=e.useState(0),Z=async e=>{const a=$(".tab-pane:visible").data("id")??null;e.page_id=a;const s=await T.save(e);if(!s)return;const l=s;g(e=>e.some(e=>e.id===l.id)?e.map(e=>e.id===l.id?l:e):[...e,l])},J=async e=>{await T.delete(e.id)&&g(a=>a.filter(a=>a.id!=e.id))},X=e=>{const a=$(e.target).data("page-id"),s=$(e.target).data("page-path"),l=$(e.target).val();$(`#iframe-${a}`).removeAttr("src"),$(`#iframe-${a}`).attr("src",`${s}/${l}`)},Q=async e=>{D(e),$(m.current).modal("show")},ee=async e=>{D(e),$(p.current).modal("show")},ae=async(e,a)=>{I({...e,component:a}),$(x.current).modal("show")};e.useEffect(()=>{let e=null;return e=setInterval(async()=>{await(async()=>{if(W)return;if(U)return void clearInterval(e);const a=await T.hasRemoteChanges();a?(V(a.has_changes),H(a.last_commit),K(a.commits)):M(!0)})()},1e4),()=>clearInterval(e)},[U,W]),e.useEffect(()=>{const e=$("iframe:visible");e&&($(e).removeAttr("src"),$(e).attr("src",e.data("path")))},[f,N,k]),e.useEffect(()=>{[...$(".components-container")].forEach(e=>{try{$(e).hasClass("ui-sortable")&&$(e).sortable("destroy")}catch(a){}$(e).sortable({connectWith:".components-container",handle:".handle-sortable",forcePlaceholderSize:!0,update:async function(a,s){const l=[...$(e).children()],t={};if(l.forEach(e=>{const a=$(e).data("id"),s=$(e).prev().data("id")??null,l=f.find(e=>e.id==a);l?.after_component!==s&&(t[a]=s)}),Object.keys(t).length>0){if(!(await T.updateOrder(t)))return;g(e=>{const a=[...e];return Object.entries(t).forEach(([e,s])=>{const l=a.findIndex(a=>a.id==e);-1!==l&&(a[l]={...a[l],after_component:s})}),a})}}}).disableSelection()})},[b,f]),e.useEffect(()=>{document.title=`Sistema | ${o.APP_NAME}`},[]);const[se,le,te]=O?.split("\n")??[];return a.jsxs(a.Fragment,{children:[a.jsxs("div",{id:"wrapper position-relative",children:[a.jsx(L,{components:i,onClick:Z}),a.jsx("div",{className:"content-page mt-2 pb-3",style:{height:"max-content"},children:a.jsx("div",{className:"content mt-2",children:a.jsxs("div",{className:"container-fluid",children:[a.jsx("button",{className:"button-menu-mobile d-lg-none d-md-block position-absolute ",style:{zIndex:1,border:"none",borderRadius:"0 50% 50% 0",backgroundColor:"#fff",color:"#343a40",top:"50%",left:"0",transform:"translateY(-50%)",padding:"24px 0px 20px 6px ",fontWeight:"bold"},children:"〉"}),a.jsx("div",{className:"row",children:a.jsx("div",{className:"col-12",children:a.jsx("div",{className:"card mb-0",children:a.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 48px)"},children:[a.jsxs("ul",{className:"nav nav-tabs nav-bordered flex-nowrap",style:{overflowX:"auto",overflowY:"hidden"},children:[a.jsx("li",{className:"nav-item",children:a.jsx("a",{id:"base-template-link",href:"#base-template","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active h-100",children:"Base"})}),b.map((e,s)=>a.jsx("li",{className:"nav-item",children:a.jsxs("a",{href:`#page-${e.id}`,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link h-100",style:{whiteSpace:"nowrap"},children:[e.name,a.jsx("small",{className:"d-block text-muted",style:{fontWeight:"normal"},children:e.path})]})},s)),a.jsx("li",{className:"nav-item d-flex justify-content-center align-items-center px-2",children:a.jsx(s,{content:"Agregar página",children:a.jsx("button",{className:"nav-link btn btn-xs btn-white rounded-pill",onClick:async()=>{_(!0);const e=await T.savePage();e&&(_(!1),j(e))},disabled:E,children:E?a.jsx("i",{className:"mdi mdi-loading mdi-spin"}):a.jsx("i",{className:"mdi mdi-plus"})})})})]}),a.jsxs("div",{className:"tab-content",children:[a.jsx("div",{className:"tab-pane active",id:"base-template",children:a.jsxs("div",{className:"row",children:[a.jsx("div",{className:"col-md-4",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:a.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":null,children:c(f).filter(e=>null==e.page_id).map(e=>{i.find(a=>a.id==e.component);if("content"==e.component)return a.jsxs("button",{"data-id":e.id,className:"btn btn-light text-truncate w-100 text-start",type:"button",children:[a.jsx("i",{className:"fa fa-ellipsis-v"}),a.jsx("i",{className:"fa fa-ellipsis-v"}),a.jsx("span",{className:"ms-1",children:e.name})]},e.id);{const s=i.find(a=>a.id==e.component);return a.jsx(S,{className:"",system:e,component:s,onComponentClicked:Z,onDeleteClicked:J,onEditDataClicked:ae},e.id)}})})}),a.jsx("div",{className:"col-md-8",children:a.jsx("iframe",{src:"/base-template","data-path":"/base-template",className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 200px)",borderRadius:"4px"}})})]})}),b.map((e,s)=>a.jsx("div",{className:"tab-pane",id:`page-${e.id}`,"data-id":e.id,children:a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-md-4",style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:[a.jsx(y,{...e,models:r,setPages:j,onSEOClicked:Q,onParamsClicked:ee}),a.jsx("hr",{className:"my-2"}),a.jsx("div",{className:"d-flex flex-column gap-2 components-container","data-page-id":e.id,children:c(f).filter(a=>a.page_id==e.id).map(e=>{const s=i.find(a=>a.id==e.component);return a.jsx(S,{className:"",system:e,component:s,onComponentClicked:Z,onDeleteClicked:J,onEditDataClicked:ae},e.id)})})]}),a.jsxs("div",{className:"col-md-8",children:[a.jsxs("div",{className:"input-group mb-2",children:[a.jsxs("span",{className:"input-group-text",children:[e?.pseudo_path||e.path,v(e?.path).length>0&&"/"]}),v(e?.path).length>0&&a.jsx("input",{type:"text",className:"form-control",placeholder:"Parametros","data-page-path":e.pseudo_path,"data-page-id":e.id,onChange:X})]}),a.jsx("iframe",{id:`iframe-${e.id}`,src:e?.pseudo_path||e.path,"data-path":e?.pseudo_path||e.path,className:"w-100 h-100 border",style:{minHeight:"calc(100vh - 302px)",borderRadius:"4px"}})]})]})},s))]})]})})})})]})})}),A&&a.jsx(s,{content:`Tienes ${Y} cambios sin sincronizar`,children:a.jsxs("button",{className:"btn btn-dark p-0 position-absolute rounded-pill",style:{right:"20px",bottom:"20px",height:"40px",width:"40px"},onClick:()=>$(h.current).modal("show"),children:[a.jsx("small",{className:"position-absolute",style:{backgroundColor:"#ff5b5b",borderRadius:"50%",width:"18px",height:"18px",top:"-5px",left:"-5px"},children:Y}),a.jsx("i",{className:"mdi mdi-github mdi-24px"})]})})]}),a.jsx(u,{modalRef:h,title:"Cambios de Github",size:"sm",hideFooter:!0,children:a.jsxs("div",{className:"text-center",children:[a.jsx("i",{className:"mdi mdi-github mdi-48px"}),a.jsx("h5",{className:"mt-2",children:"Tienes cambios sin sincronizar"}),a.jsxs("div",{className:"mb-2 py-2",children:[a.jsx("b",{className:"d-block",children:se}),a.jsx("small",{className:"d-block text-muted",children:moment(le).fromNow()}),a.jsxs("span",{className:"d-block",children:["Commit: ",te]})]}),a.jsx("button",{className:"btn btn-primary mb-2",type:"button",onClick:()=>(async()=>{q(!0);const e=await T.fetchRemoteChanges();q(!1),e&&location.reload()})(),disabled:W,children:W?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Sincronizando"]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"mdi mdi-cloud-download me-1"}),"Sincronizar"]})})]})}),a.jsx(G,{colors:N,setColors:w,settings:k,setSettings:R}),a.jsx(C,{dataLoaded:F,setDataLoaded:D,modalRef:m}),a.jsx(z,{dataLoaded:F,setDataLoaded:D,setPages:j,modalRef:p,models:r}),a.jsx(P,{dataLoaded:B,setDataLoaded:I,setSystems:g,modalRef:x})]})};n((e,s)=>{t.createRoot(e).render(a.jsx(V,{...s}))});

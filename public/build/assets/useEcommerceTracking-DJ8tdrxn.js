import{c as m}from"./createLucideIcon-DfjclApS.js";import{m as h}from"./main-B6F2O9-U.js";import{G as s}from"./Global-CazroCzF.js";import{t as f}from"./CardProductKatya-ncpmQ0JU.js";import{r as k}from"./index-BOnQTV8N.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=m("OctagonX",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=m("UserRoundX",[["path",{d:"M2 21a8 8 0 0 1 11.873-7",key:"74fkxq"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m17 17 5 5",key:"p7ous7"}],["path",{d:"m22 17-5 5",key:"gqnmv0"}]]);function C(){let i="";for(let u=0;u<12;u++){const c=Math.floor(Math.random()*10);i+=c}return i}const b=i=>new Promise((u,c)=>{var p;try{if(console.log("ðŸ”„ Iniciando proceso de pago con Culqi...",i),!s.CULQI_ENABLED){console.error("âŒ Error: Culqi no estÃ¡ habilitado en la configuraciÃ³n"),c("MÃ©todo de pago no disponible: Culqi estÃ¡ deshabilitado");return}if(typeof window.Culqi>"u"){console.error("âŒ Error: Culqi no estÃ¡ definido. Verifique que el script de Culqi estÃ© cargado."),c("Error en la integraciÃ³n con Culqi: Script no cargado");return}if(!s.CULQI_PUBLIC_KEY){console.error("âŒ Error: CULQI_PUBLIC_KEY no estÃ¡ configurado"),c("Error de configuraciÃ³n: Clave pÃºblica de Culqi no encontrada");return}const l=C(i.email);console.log("ðŸ“ NÃºmero de orden generado:",l);let g=!1;try{window.Culqi.publicKey=s.CULQI_PUBLIC_KEY,console.log("âœ… Clave pÃºblica configurada exitosamente")}catch(e){console.error("âŒ Error al configurar la clave pÃºblica:",e),c("Error en la integraciÃ³n con Culqi: No se pudo configurar la clave pÃºblica");return}const d=parseFloat(i.amount.toFixed(2)),w=Math.round(d*100);console.log("ðŸ’° Configurando Culqi:"),console.log("   - Monto original:",i.amount),console.log("   - Monto redondeado (soles):",d),console.log("   - Monto en cÃ©ntimos:",w),console.log("   - Email:",i.email),window.Culqi.settings({title:s.CULQI_NAME||s.APP_NAME,email:i.email,currency:"PEN",amount:w,order:`${l}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:s.APP_URL+`/assets/resources/icon.png?v=${crypto.randomUUID()}`,bannerColor:s.APP_COLOR_PRIMARY,buttonBackground:s.APP_COLOR_PRIMARY}});const t=(p=window.Culqi)==null?void 0:p.close;t&&(window.Culqi.close=function(){return!window.Culqi.token&&!g&&(console.log("ðŸš« Modal de Culqi cerrado sin completar el pago"),c("Pago cancelado por el usuario")),t.apply(this,arguments)}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){c("No se obtuvo un token de Culqi");return}g=!0;const e=window.Culqi.token.id;console.log("âœ… Token generado:",e),i={...i,token:e,orderNumber:l},console.log("_request actualizado",i);const{status:n,result:r}=await h.Fetch("./api/pago",{method:"POST",body:JSON.stringify(i)});n||console.log((r==null?void 0:r.message)||"Error en el pago"),window.Culqi.close(),f.success("Â¡Pago exitoso!",{description:"Tu pago se procesÃ³ correctamente. Pronto recibirÃ¡s la confirmaciÃ³n de tu pedido.",duration:3e3,position:"top-right",richColors:!0}),u(r)}catch(e){f.error("Â¡Error en el Pago!",{description:e.message,duration:3e3,position:"top-right",richColors:!0}),c(e.message||"Error en el pago")}},window.addEventListener("message",function(e){e.data==="culqi_closed"&&c("Pago cancelado por el usuario")});const o=e=>{e.key==="Escape"&&!g&&(console.log("ðŸš« Modal de Culqi cerrado con Escape"),c("Pago cancelado por el usuario"))};document.addEventListener("keydown",o),setTimeout(()=>{document.removeEventListener("keydown",o)},3e5),document.addEventListener("culqi.error",function(e){var n,r;f.error("Â¡Error en Culqi!",{description:((n=e.detail)==null?void 0:n.message)||"Error desconocido",duration:3e3,position:"top-right",richColors:!0}),c(((r=e.detail)==null?void 0:r.message)||"Error desconocido")})}catch(l){f.error("Â¡Error en la integraciÃ³n con Culqi!",{description:l.message,duration:3e3,position:"top-right",richColors:!0}),c("Error en la integraciÃ³n con Culqi")}}),N=()=>{const i=k.useRef({hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}),u=(t,o={})=>{typeof window>"u"||(typeof window.fbq<"u"&&window.fbq("track","ViewContent",{content_ids:[t],content_type:"product",content_name:o.name||"",value:o.price||0,currency:"PEN"}),typeof window.gtag<"u"&&window.gtag("event","view_item",{currency:"PEN",value:o.price||0,items:[{item_id:t,item_name:o.name||"",category:o.category||"",price:o.price||0}]}),typeof window.ttq<"u"&&window.ttq.track("ViewContent",{content_id:t,content_type:"product",content_name:o.name||"",value:o.price||0,currency:"PEN"}),console.log("âœ… ProductView tracked for product:",t))},c=async(t,o=1,e={})=>{var n;if(!(typeof window>"u"))try{const a=await(await fetch("/api/tracking/add-to-cart",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)||""},body:JSON.stringify({product_id:t,quantity:o,...e})})).json();a.success&&a.tracking_scripts&&(d(a.tracking_scripts),console.log("âœ… AddToCart tracked successfully"))}catch(r){console.error("âŒ Error tracking AddToCart:",r)}},p=async(t,o)=>{var e;if(!(typeof window>"u"||i.current.hasTrackedInitiateCheckout))try{i.current.hasTrackedInitiateCheckout=!0;const r=await(await fetch("/api/tracking/initiate-checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},body:JSON.stringify({cart_items:t.map(a=>({product_id:a.id,name:a.name,price:a.final_price||a.price,quantity:a.quantity,subtotal:(a.final_price||a.price)*a.quantity}))})})).json();r.success&&r.tracking_scripts&&(d(r.tracking_scripts),console.log("âœ… InitiateCheckout tracked successfully"))}catch(n){console.error("âŒ Error tracking InitiateCheckout:",n),i.current.hasTrackedInitiateCheckout=!1}},l=(t,o)=>{if(!(typeof window>"u")){console.log("ðŸŽ¯ Iniciando tracking de compra:",{orderId:t,conversionScripts:o});try{o?(console.log("ðŸ“Š Usando scripts de conversiÃ³n del servidor"),d(o)):(console.log("ðŸ”„ Obteniendo scripts de conversiÃ³n del API"),fetch(`/api/tracking/purchase/${t}`).then(e=>e.text()).then(e=>{e&&(d(e),console.log("âœ… Purchase tracked successfully"))}).catch(e=>{console.error("âŒ Error tracking Purchase:",e)}))}catch(e){console.error("âŒ Error general en trackPurchase:",e)}}},g=(t,o=[])=>{if(typeof window>"u"||i.current.hasTrackedPageView)return;i.current.hasTrackedPageView=!0;const e=o.reduce((n,r)=>n+(r.final_price||r.price)*r.quantity,0);typeof window.fbq<"u"&&(window.fbq("track","PageView"),t===1&&o.length>0&&window.fbq("track","AddToCart",{content_ids:o.map(n=>n.id),content_type:"product",value:e,currency:"PEN",num_items:o.length})),typeof window.gtag<"u"&&(window.gtag("event","page_view",{page_title:`Checkout - Paso ${t}`,page_location:window.location.href}),t===1&&o.length>0&&window.gtag("event","view_cart",{currency:"PEN",value:e,items:o.map(n=>{var r;return{item_id:n.id,item_name:n.name,category:((r=n.category)==null?void 0:r.name)||"Sin categorÃ­a",quantity:n.quantity,price:n.final_price||n.price}})})),console.log(`âœ… Checkout PageView tracked - Step ${t}`)},d=t=>{if(typeof window>"u"||!t)return;console.log("ðŸŽ¯ Ejecutando scripts de tracking:",t);const o=document.createElement("div");o.innerHTML=t,o.querySelectorAll("script").forEach((n,r)=>{try{const a=document.createElement("script");a.textContent=n.textContent,console.log(`ðŸ“Š Ejecutando script de tracking ${r+1}:`,n.textContent.trim()),document.head.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},100),console.log(`âœ… Script de tracking ${r+1} ejecutado exitosamente`)}catch(a){console.error(`âŒ Error ejecutando script de tracking ${r+1}:`,a),console.error("Script content:",n.textContent)}}),console.log("ðŸŽ¯ Todos los scripts de tracking procesados")};return{trackProductView:u,trackAddToCart:c,trackInitiateCheckout:p,trackPurchase:l,trackCheckoutPageView:g,resetTracking:()=>{i.current={hasTrackedPageView:!1,hasTrackedInitiateCheckout:!1}}}};export{T as O,v as U,b as p,N as u};

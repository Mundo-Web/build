var O=Object.defineProperty;var q=(i,e,l)=>e in i?O(i,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[e]=l;var C=(i,e,l)=>q(i,typeof e!="symbol"?e+"":e,l);import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{r as h}from"./index-BH53Isel.js";import{c as G}from"./ReactAppend-DTVVXReZ.js";import{B as M}from"./Base-CK06_Hp4.js";import{C as I}from"./CreateReactScript-BoGwggCx.js";import{T as V}from"./Table-DitbKwtZ.js";import{D as T}from"./DxButton-DV0H-ZcL.js";import{R as E}from"./ReactAppend-D7S498fx.js";import{S as Y}from"./ProductCard-Ap6bpF1Q.js";import{B as z}from"./BasicRest-B3rfI5GY.js";import{G as R}from"./Global-ErywZRdd.js";import{N as s}from"./Number2Currency-e57Tgsuk.js";import{M as W}from"./Modal-CIqmjseY.js";import{i as H}from"./tippy-react.esm-BWiGTO87.js";import{S as J}from"./SaleStatusesRest-BClaSKoc.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-C_dOKkRB.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";class K extends z{constructor(){super(...arguments);C(this,"path","admin/sales")}}const p=new K;new J;const Q=({statuses:i=[]})=>{var d,b,f,N,y,g,v,_,w,S,k;const e=h.useRef(),l=h.useRef(),[t,j]=h.useState(null),[u,U]=h.useState([]),D=async n=>{const c=await p.save({id:t.id,status_id:n.target.value});console.log("onStatusChange",c),c&&(j(c),$(e.current).dxDataGrid("instance").refresh())},F=async n=>{const{isConfirmed:c}=await Y.fire({title:"Anular pedido",text:"Â¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!c||!await p.delete(n)||$(e.current).dxDataGrid("instance").refresh()},a=async n=>{const c=await p.get(n);console.log("Sale data loaded:",c.data),j(c.data),$(l.current).modal("show")};h.useEffect(()=>{},[t]);const A=Number(t==null?void 0:t.amount)+Number((t==null?void 0:t.delivery)||0)-Number((t==null?void 0:t.bundle_discount)||0)-Number((t==null?void 0:t.renewal_discount)||0)-Number((t==null?void 0:t.coupon_discount)||0);return r.jsxs(r.Fragment,{children:[r.jsx(V,{gridRef:e,title:"Pedidos",rest:p,toolBar:n=>{n.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(e.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(n,{data:c})=>{n.css("cursor","pointer"),n.on("click",()=>{a(c.id)}),E(n,r.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[r.jsxs("b",{className:"d-block",children:[c.name," ",c.lastname]}),r.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",R.APP_CORRELATIVE,"-",c.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(n,{data:c})=>{n.text(moment(c.created_at).format("LLL"))}},{dataField:"status.name",caption:"Estado",cellTemplate:(n,{data:c})=>{console.log(c),E(n,r.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:c.status.color?`${c.status.color}2e`:"#3333332e",color:c.status.color??"#333"},children:c.status.name}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(n,{data:c})=>{const m=Number(c.amount)||0,o=Number(c.delivery)||0,x=Number(c.bundle_discount)||0,B=Number(c.renewal_discount)||0,P=Number(c.coupon_discount)||0;n.text(`S/. ${s(m+o-x-B-P)}`)}},{caption:"Acciones",cellTemplate:(n,{data:c})=>{n.append(T({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>a(c.id)})),n.append(T({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>F(c.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(W,{modalRef:l,title:`Detalles del pedido #${R.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-8",children:[r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header p-2",children:r.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),r.jsx("div",{className:"card-body p-2",children:r.jsx("table",{className:"table table-borderless table-sm mb-0",children:r.jsxs("tbody",{children:[(t==null?void 0:t.payment_method)&&r.jsxs("tr",{children:[r.jsx("th",{children:"MÃ©todo de pago:"}),r.jsx("td",{children:t==null?void 0:t.payment_method})]}),(t==null?void 0:t.culqi_charge_id)&&r.jsxs("tr",{children:[r.jsx("th",{children:"ID de transacciÃ³n:"}),r.jsx("td",{children:t==null?void 0:t.culqi_charge_id})]}),r.jsxs("tr",{children:[r.jsx("th",{children:"Nombres:"}),r.jsx("td",{children:t==null?void 0:t.fullname})]}),r.jsxs("tr",{children:[r.jsx("th",{children:"Email:"}),r.jsx("td",{children:t==null?void 0:t.email})]}),r.jsxs("tr",{children:[r.jsx("th",{children:"TelÃ©fono:"}),r.jsx("td",{children:t==null?void 0:t.phone})]}),((t==null?void 0:t.document_type)||(t==null?void 0:t.documentType))&&r.jsxs("tr",{children:[r.jsx("th",{children:"Tipo de documento:"}),r.jsx("td",{children:(t==null?void 0:t.document_type)||(t==null?void 0:t.documentType)})]}),(t==null?void 0:t.document)&&r.jsxs("tr",{children:[r.jsx("th",{children:"NÃºmero de documento:"}),r.jsx("td",{children:t==null?void 0:t.document})]}),(t==null?void 0:t.delivery_type)&&r.jsxs("tr",{children:[r.jsx("th",{children:"Tipo de entrega:"}),r.jsx("td",{children:r.jsx("span",{className:"badge bg-info",children:(t==null?void 0:t.delivery_type)==="store_pickup"?"Retiro en Tienda":(t==null?void 0:t.delivery_type)==="free"?"EnvÃ­o Gratis":(t==null?void 0:t.delivery_type)==="express"?"EnvÃ­o Express":(t==null?void 0:t.delivery_type)==="standard"?"EnvÃ­o EstÃ¡ndar":(t==null?void 0:t.delivery_type)==="agency"?"Entrega en Agencia":t==null?void 0:t.delivery_type})})]}),(t==null?void 0:t.delivery_type)==="store_pickup"&&(t==null?void 0:t.store)&&r.jsxs("tr",{children:[r.jsx("th",{children:"Tienda para retiro:"}),r.jsxs("td",{children:[r.jsx("strong",{children:(d=t==null?void 0:t.store)==null?void 0:d.name}),r.jsxs("small",{className:"text-muted d-block",children:[(b=t==null?void 0:t.store)==null?void 0:b.address,((f=t==null?void 0:t.store)==null?void 0:f.district)&&r.jsxs(r.Fragment,{children:[", ",(N=t==null?void 0:t.store)==null?void 0:N.district]}),((y=t==null?void 0:t.store)==null?void 0:y.province)&&r.jsxs(r.Fragment,{children:[", ",(g=t==null?void 0:t.store)==null?void 0:g.province]})]}),((v=t==null?void 0:t.store)==null?void 0:v.phone)&&r.jsxs("small",{className:"text-info d-block",children:["ðŸ“ž ",(_=t==null?void 0:t.store)==null?void 0:_.phone]}),((w=t==null?void 0:t.store)==null?void 0:w.schedule)&&r.jsxs("small",{className:"text-success d-block",children:["ðŸ•’ ",(S=t==null?void 0:t.store)==null?void 0:S.schedule]})]})]}),(t==null?void 0:t.delivery_type)&&(t==null?void 0:t.delivery_type)!=="store_pickup"&&r.jsxs("tr",{children:[r.jsx("th",{children:"DirecciÃ³n de entrega:"}),r.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,r.jsxs("small",{className:"text-muted d-block",children:[t==null?void 0:t.district,","," ",t==null?void 0:t.province,","," ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&r.jsxs(r.Fragment,{children:["-"," ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&r.jsxs("tr",{children:[r.jsx("th",{children:"Referencia:"}),r.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&r.jsxs("tr",{children:[r.jsx("th",{children:"Comentario:"}),r.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.coupon_code)&&r.jsxs("tr",{children:[r.jsx("th",{children:"CupÃ³n aplicado:"}),r.jsxs("td",{children:[r.jsx("span",{className:"badge bg-success",children:t==null?void 0:t.coupon_code}),r.jsxs("small",{className:"text-success d-block",children:["Descuento: S/ ",s((t==null?void 0:t.coupon_discount)||0)]})]})]}),(t==null?void 0:t.invoiceType)&&r.jsxs("tr",{children:[r.jsxs("th",{children:[t==null?void 0:t.invoiceType,":"]}),r.jsxs("td",{children:[t==null?void 0:t.documentType," - ",t==null?void 0:t.document," ",r.jsx("br",{})," ",(t==null?void 0:t.document)&&(t==null?void 0:t.businessName)]})]}),(t==null?void 0:t.payment_proof)&&r.jsxs("tr",{children:[r.jsx("th",{children:"Comprobante de pago:"}),r.jsx("td",{children:r.jsx(H,{content:"Ver comprobante de pago",placement:"top",children:r.jsx("a",{href:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,target:"_blank",children:r.jsx("img",{src:`/storage/images/sale/${t==null?void 0:t.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"150px",cursor:"pointer"}})})})})]})]})})})]}),r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header p-2",children:r.jsx("h5",{className:"card-title mb-0",children:"ArtÃ­culos"})}),r.jsx("div",{className:"card-body p-2 table-responsive",children:r.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"w-20",children:"Imagen"}),r.jsx("th",{children:"Nombre"}),r.jsx("th",{children:"Precio"}),r.jsx("th",{children:"Cantidad"}),r.jsx("th",{children:"Subtotal"})]})}),r.jsx("tbody",{children:(k=t==null?void 0:t.details)==null?void 0:k.map((n,c)=>{const m=n.quantity*100/100,o=n.price*n.quantity;return r.jsxs("tr",{children:[r.jsx("td",{className:"max-w-20 p-0",children:n.image?r.jsx("img",{className:"object-scale-down mx-auto block",src:`/storage/images/item/${n.image}`,alt:n.name,style:{height:"5rem",width:"5rem",objectFit:"scale-down"}}):null}),r.jsxs("td",{children:[n.name,n.colors?" - "+n.colors:""]}),r.jsx("td",{align:"right",children:r.jsxs("span",{className:"text-nowrap",children:["S/"," ",s(n.price)]})}),r.jsx("td",{align:"center",children:m}),r.jsx("td",{align:"right",children:r.jsxs("span",{className:"text-nowrap",children:["S/"," ",s(o)]})})]},c)})})]})})]}),r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header p-2",children:r.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),r.jsxs("div",{className:"card-body p-2",children:[r.jsxs("div",{className:"d-flex justify-content-between",children:[r.jsx("b",{children:"Subtotal:"}),r.jsxs("span",{children:["S/"," ",s((t==null?void 0:t.amount)*1)]})]}),r.jsxs("div",{className:"d-flex justify-content-between",children:[r.jsx("b",{children:"EnvÃ­o:"}),r.jsxs("span",{children:["S/"," ",s(t==null?void 0:t.delivery)]})]}),(t==null?void 0:t.bundle_discount)>0&&r.jsxs("div",{className:"d-flex justify-content-between text-success",children:[r.jsx("span",{children:"Descuento por paquete:"}),r.jsxs("span",{children:["-S/ ",s(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal_discount)>0&&r.jsxs("div",{className:"d-flex justify-content-between text-success",children:[r.jsx("span",{children:"Descuento por renovaciÃ³n:"}),r.jsxs("span",{children:["-S/ ",s(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon_discount)>0&&r.jsxs("div",{className:"d-flex justify-content-between text-success",children:[r.jsxs("span",{children:["Descuento con cupÃ³n",(t==null?void 0:t.coupon_code)&&r.jsxs("small",{className:"text-muted d-block",children:["CÃ³digo: ",t==null?void 0:t.coupon_code]})]}),r.jsxs("span",{children:["-S/ ",s(t==null?void 0:t.coupon_discount)]})]}),(t==null?void 0:t.promotion_discount)>0&&r.jsxs("div",{className:"d-flex justify-content-between text-info",children:[r.jsxs("span",{children:[console.log(t==null?void 0:t.promotion_discount),"Descuentos por promociones",(t==null?void 0:t.applied_promotions)&&r.jsx("small",{className:"text-muted d-block",children:JSON.parse(t.applied_promotions).map((n,c)=>r.jsxs("div",{children:["â€¢ ",n.name,": ",n.description]},c))})]}),r.jsxs("span",{children:["-S/ ",s(t==null?void 0:t.promotion_discount)]})]}),r.jsx("hr",{className:"my-2"}),r.jsxs("div",{className:"d-flex justify-content-between",children:[r.jsx("b",{children:"Total:"}),r.jsx("span",{children:r.jsxs("strong",{children:["S/ ",s(A)]})})]})]})]})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header p-2",children:r.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),r.jsx("div",{className:"card-body p-2",children:r.jsxs("div",{className:"",children:[r.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),r.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:D,children:i.map((n,c)=>r.jsx("option",{value:n.id,children:n.name}))})]})})]}),r.jsxs("div",{className:"card",hidden:!0,children:[r.jsx("div",{className:"card-header p-2",children:r.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),r.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",children:u==null?void 0:u.map((n,c)=>{var m,o,x;return r.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e"},children:[r.jsx("i",{className:"mdi mdi-circle left-2",style:{color:n.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),r.jsx("b",{style:{color:n.status.color||"#333"},children:(m=n==null?void 0:n.status)==null?void 0:m.name}),r.jsxs("small",{className:"d-block text-truncate",children:[(o=n==null?void 0:n.user)==null?void 0:o.name," ",(x=n==null?void 0:n.user)==null?void 0:x.lastname]}),r.jsx("small",{className:"d-block text-muted",children:moment(n.created_at).format("YYYY-MM-DD HH:mm")})]},c)})})]})]})]})})]})};I((i,e)=>{G.createRoot(i).render(r.jsx(M,{...e,title:"Pedidos",children:r.jsx(Q,{...e})}))});

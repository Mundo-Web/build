import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r}from"./index-BOnQTV8N.js";import{C as g,N as y}from"./Number2Currency-D9Rjvh76.js";import{D as ze,C as gt,B as Ue,a as Qe,P as yt,b as jt,A as vt,O as Nt,I as nt,S as wt,c as Ct}from"./StorePickupSelector-CDjcQF6y.js";import{i as de}from"./tippy-react.esm-DmkRJDEW.js";import"./main-B6F2O9-U.js";import{t as le}from"./CardProductKatya-ncpmQ0JU.js";import{l as _t}from"./ShippingStep-C6i134TO.js";import{O as He,p as St,U as kt,u as Et}from"./useEcommerceTracking-DJ8tdrxn.js";import{I as Se}from"./InputForm-Dmyom2PO.js";import{S as It}from"./SelectForm-BvZde-dr.js";import{G as se}from"./Global-CazroCzF.js";import{C as ye}from"./circle-x-5vreeYph.js";import{m as Ie}from"./proxy-B0QLMKEh.js";import"./ProductNavigation-C3qRptTo.js";import"./ProductCard-D_AgkLlk.js";/* empty css              */import"./BlogCarousel-DCQ9UYu0.js";/* empty css               */import"./BlogCarrusel-klwTVD05.js";import{R as Pt}from"./PolicyModal-C80IvD61.js";import{H as Lt}from"./HtmlContent-ghmllTyl.js";import{X as Tt}from"./x-fof_H3Vv.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./General-BmbBKdsB.js";import"./createLucideIcon-DfjclApS.js";import"./sparkles-DvmvZ6mJ.js";import"./package-DBFPPBi1.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./index-BQJyKPGC.js";import"./useStateManager-7e1e8489.esm-JZ1pGKcX.js";import"./hoist-non-react-statics.cjs-Dk09vysS.js";import"./index-pSueRYGM.js";import"./index-B6ujFmsw.js";import"./floating-ui.dom-C6hn-rxH.js";import"./StoresRest-Bb6TODpG.js";import"./BasicRest-BML1C-ua.js";import"./BooleanLimit-D-OsQsek.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./check-D5vaIe6v.js";import"./ItemsRest-Dp5IKigO.js";import"./HeaderSearch-DicFuFIN.js";import"./CartItemRow-FwA1YhUV.js";import"./index-BZvh78jk.js";import"./eye-ScgfreHn.js";import"./index-Chjiymov.js";function qt({data:N,cart:_,setCart:oe,onContinue:ae,subTotal:$,envio:I,igv:me,fleteTotal:H,seguroImportacionTotal:v,derechoArancelarioTotal:F,totalFinal:pe,openModal:M,categorias:je,automaticDiscounts:Q,setAutomaticDiscounts:s,automaticDiscountTotal:ue,setAutomaticDiscountTotal:T,totalWithoutDiscounts:ve,generals:h,valorCIF:Pe,advDisplay:G,ipmDisplay:ie,subTotalConDescuentos:R}){var ee,fe,Ee,O,Ce,qe,De,f;const[A,U]=r.useState(Q||[]),[V,D]=r.useState(ue||0),[W,xe]=r.useState(!1),[Ne,l]=r.useState([]),[re,J]=r.useState([]),[ne,K]=r.useState(!1),[ce,a]=r.useState(null),[he,ke]=r.useState(null),B=_.length===0;r.useEffect(()=>{const i=_.filter(m=>m.type==="combo");if(console.log("üîç CartStep useEffect triggered:",{cartLength:_.length,subTotal:$,combosCount:i.length,combos:i}),_.length>0&&$>0)n();else{const m=[];U(m),D(0),l([]),J([]),s&&s(m),T&&T(0)}},[_,$]);const n=async()=>{xe(!0);try{const i=_.reduce((d,q)=>d+(q.quantity||0),0),m=_.filter(d=>d.type==="combo");console.log("üõí CartStep applying discounts:",{cart:_,subTotal:$,totalWithoutDiscounts:ve,totalQuantity:i,cartLength:_.length,combosInCart:m.length,combos:m,cartItems:_.map(d=>({id:d.id||d.item_id,name:d.name,quantity:d.quantity,price:d.price||d.final_price,category_id:d.category_id,type:d.type}))});const b=await ze.applyToCart(_,ve);if(console.log("üì• Server response:",{success:b.success,data:b.data,error:b.error,fullResult:b}),b.success&&b.data){console.log("‚úÖ Discounts found:",b.data.applied_discounts);const d=ze.formatDiscounts(b.data.applied_discounts),q=b.data.total_discount||0,te=ze.getFreeItems(b.data.applied_discounts),be=[];b.data.applied_discounts.forEach(j=>{j.suggested_items&&Array.isArray(j.suggested_items)&&be.push(...j.suggested_items)}),U(d),D(q),l(te),J(be),s&&s(d),T&&T(q),console.log("üîí Preserving original cart, not updating from server response")}else{console.error("‚ùå Discount application failed:",{error:b.error,success:b.success,data:b.data,fullResult:b});const d=[],q=0;U(d),D(q),l([]),J([]),s&&s(d),T&&T(q)}}catch(i){console.error("Error applying discount rules:",i);const m=[],b=0;U(m),D(b),l([]),J([]),s&&s(m),T&&T(b)}finally{xe(!1)}},S=i=>re.some(m=>m.item_id===i||m.triggering_item_id===i),Y=i=>re.find(m=>m.item_id===i||m.triggering_item_id===i),we=i=>{const m=Y(i.id);m&&(a(m),ke(i),K(!0))},Z=async i=>{try{console.log("CartStep - handleAddPromotionalItem received:",i),console.log("CartStep - current cart:",_),oe(m=>{console.log("CartStep - old cart before update:",m);const b=m.findIndex(d=>(d.item_id||d.id)===i.item_id);if(console.log("CartStep - existingItemIndex:",b),b!==-1){const d=[...m],q=i.quantity||i.suggested_quantity||1;return console.log("CartStep - adding quantity:",q),d[b].quantity+=q,console.log("CartStep - updated cart:",d),d}else{console.log("CartStep - item not found, creating new product");const d={id:i.item_id,name:i.item_name,quantity:i.quantity||i.suggested_quantity||1,price:i.value||0,final_price:i.value||0,image:i.item_image||"default.jpg",brand:{name:i.item_brand||"N/A"},sku:i.item_sku||"PROMO",stock:999};return[...m,d]}}),setTimeout(()=>{n()},100)}catch(m){console.error("Error adding promotional item:",m)}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:B?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito est√° vac√≠o"}),e.jsx("p",{className:"text-gray-500",children:"¬°Explora nuestros productos y encuentra algo especial!"})]}):_.map((i,m)=>e.jsx(gt,{...i,setCart:oe,categorias:je,hasPromotion:S(i.id),onPromotionClick:we},m))}),e.jsxs("div",{className:"lg:col-span-2 bg-[#F7F9FB] rounded-xl shadow-lg p-4 md:p-6 h-max mt-4 md:mt-0",children:[e.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:[g(),y($)]})]}),V>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Descuentos aplicados"}),e.jsxs("span",{className:"font-semibold",children:["-",g(),y(V)]})]}),V>0&&e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Subtotal con descuentos"}),e.jsxs("span",{className:"font-semibold",children:[g(),y(R||$-V)]})]}),Number((ee=h==null?void 0:h.find(i=>i.correlative==="importation_seguro"))==null?void 0:ee.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Seguro (",Number(((fe=h==null?void 0:h.find(i=>i.correlative==="importation_seguro"))==null?void 0:fe.description)||0).toFixed(2),"%)"]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(v)]})]}),H>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Flete",((Ee=h==null?void 0:h.find(i=>i.correlative==="importation_flete_descripcion"))==null?void 0:Ee.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(O=h==null?void 0:h.find(i=>i.correlative==="importation_flete_descripcion"))==null?void 0:O.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(H)]})]}),F>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Derecho Arancelario",((Ce=h==null?void 0:h.find(i=>i.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:Ce.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(qe=h==null?void 0:h.find(i=>i.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:qe.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(F)]})]}),W&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Verificando descuentos..."}),e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),e.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[e.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[e.jsxs("span",{children:["Total",((De=h==null?void 0:h.find(i=>i.correlative==="total_descripcion"))==null?void 0:De.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(f=h==null?void 0:h.find(i=>i.correlative==="total_descripcion"))==null?void 0:f.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[g(),y(pe)]})]}),V>0&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"line-through",children:[g(),y(ve||pe+V)]}),e.jsxs("span",{className:"ml-2 customtext-neutral-dark font-semibold",children:["Ahorras ",g(),y(V)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[e.jsx(Ue,{onClick:ae,disabled:B,className:`w-full ${(N==null?void 0:N.class_button)||"text-white"}`,children:B?"Carrito Vac√≠o":"Continuar Compra"}),e.jsx(Qe,{href:"/",className:"w-full",children:B?"Ir a Comprar":"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{href:"#",onClick:()=>M(1),className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{href:"#",onClick:()=>M(0),className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]}),e.jsx(yt,{isOpen:ne,onClose:()=>K(!1),suggestion:ce,onAddToCart:Z,productName:(he==null?void 0:he.name)||""})]})}function Dt({data:N,cart:_,setSale:oe,setCode:ae,setDelivery:$,setCart:I,onContinue:me,noContinue:H,subTotal:v,igv:F,fleteTotal:pe,seguroImportacionTotal:M,derechoArancelarioTotal:je,totalFinal:Q,user:s,setEnvio:ue,envio:T,ubigeos:ve=[],openModal:h,categorias:Pe,setCouponDiscount:G,setCouponCode:ie,automaticDiscounts:R=[],automaticDiscountTotal:A=0,setAutomaticDiscounts:U,setAutomaticDiscountTotal:V,totalWithoutDiscounts:D,conversionScripts:W,setConversionScripts:xe,onPurchaseComplete:Ne,generals:l,valorCIF:re,advDisplay:J,ipmDisplay:ne,subTotalConDescuentos:K}){var Xe,We,Je,Ze,et,tt,st,ot,at,it;const[ce,a]=r.useState(null),[he,ke]=r.useState(null);R.reduce((t,o)=>o.free_items&&Array.isArray(o.free_items)?[...t,...o.free_items]:t,[]);const B=[{value:"dni",label:"DNI"},{value:"ruc",label:"RUC"},{value:"ce",label:"CE"},{value:"pasaporte",label:"Pasaporte"}],[n,S]=r.useState({name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",documentType:((Xe=s==null?void 0:s.document_type)==null?void 0:Xe.toLowerCase())||"",document:(s==null?void 0:s.document_number)||"",department:(s==null?void 0:s.department)||"",province:(s==null?void 0:s.province)||"",district:(s==null?void 0:s.district)||"",address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:"",reference:(s==null?void 0:s.reference)||"",ubigeo:(s==null?void 0:s.ubigeo)||null});r.useEffect(()=>{if(s!=null&&s.ubigeo&&(s!=null&&s.district)&&(s!=null&&s.province)&&(s!=null&&s.department)){const t={value:s.ubigeo,label:`${s.district}, ${s.province}, ${s.department}`,data:{reniec:s.ubigeo,departamento:s.department,provincia:s.province,distrito:s.district}};ke(t),a(t),Ve(t)}},[s]),r.useEffect(()=>{s&&S(t=>{var o;return{...t,name:s.name||t.name,lastname:s.lastname||t.lastname,email:s.email||t.email,phone:s.phone||t.phone,documentType:((o=s.document_type)==null?void 0:o.toLowerCase())||t.documentType,document:s.document_number||t.document,department:s.department||t.department,province:s.province||t.province,district:s.district||t.district,address:s.address||t.address,number:s.number||t.number,reference:s.reference||t.reference,ubigeo:s.ubigeo||t.ubigeo}})},[s]);const[Y,we]=r.useState(!1),[Z,ee]=r.useState(!1),[fe,Ee]=r.useState([]),[O,Ce]=r.useState(null),[qe,De]=r.useState(null),[f,i]=r.useState({}),[m,b]=r.useState(""),[d,q]=r.useState(!1),[te,be]=r.useState(""),[j,Re]=r.useState(null),[Le,p]=r.useState(0),[w,ge]=r.useState(!1),[$e,_e]=r.useState(""),[Te,Be]=r.useState(null),[ct,Ge]=r.useState(!1),[lt,Oe]=r.useState(!1),dt=t=>{Be(t),i(o=>({...o,store:""}))},mt=t=>{var u,L,x;const o=["name","lastname","documentType","document","email","phone","ubigeo","address","shipping"];for(const E of o)if(t[E]){let k=null,C=!1;if(E==="ubigeo"?k=((L=(u=document.querySelector('[name="ubigeo"]'))==null?void 0:u.parentElement)==null?void 0:L.parentElement)||document.querySelector(".css-1s2u09g-control")||document.querySelector('[class*="react-select"]'):E==="shipping"?k=((x=document.querySelector('input[name="shipping"]'))==null?void 0:x.closest(".space-y-4"))||document.querySelector(".space-y-4 h3")||document.querySelector("h3"):(k=document.querySelector(`[name="${E}"]`),C=!0),k){k.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),C&&setTimeout(()=>{try{k.focus(),k.tagName==="INPUT"&&k.type==="text"&&k.select()}catch(c){console.warn("No se pudo enfocar el elemento:",c)}},600),pt(k);break}}},pt=t=>{if(!t)return;const o=document.createElement("div");if(o.style.cssText=`
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        `,!document.querySelector("#error-highlight-styles")){const L=document.createElement("style");L.id="error-highlight-styles",L.textContent=`
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.8; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `,document.head.appendChild(L)}const u=t.style.position;(!u||u==="static")&&(t.style.position="relative"),t.appendChild(o),setTimeout(()=>{o.parentNode&&(o.parentNode.removeChild(o),(!u||u==="static")&&(t.style.position=u))},1200)},Ve=async t=>{var u,L,x,E,k;if(!t)return;i(C=>({...C,ubigeo:""}));const{data:o}=t;S(C=>({...C,department:o.departamento,province:o.provincia,district:o.distrito,ubigeo:o.reniec})),we(!0);try{const C=_.reduce((z,Ae)=>z+Ae.final_price*Ae.quantity,0);console.log("üõí ShippingStep - Cart total calculado:",C),console.log("üõí ShippingStep - Cart items:",_.map(z=>({name:z.name,price:z.final_price,quantity:z.quantity,total:z.final_price*z.quantity}))),console.log("üí∞ ShippingStep - Comparaci√≥n de totales:"),console.log("   - Cart total (solo productos):",C),console.log("   - SubTotal prop:",v),console.log("   - IGV prop:",F),console.log("   - Total con IGV:",v+F),console.log("   - Total final prop:",Q);const c=await jt.getShippingCost({ubigeo:o.reniec,cart_total:C});console.log("üì¶ ShippingStep - Respuesta del backend:",c.data),console.log("‚úÖ ShippingStep - Califica para env√≠o gratis?",c.data.qualifies_free_shipping),console.log("üí∞ ShippingStep - Umbral requerido:",c.data.free_shipping_threshold),console.log("üîç ShippingStep - is_free:",c.data.is_free),console.log("üîç ShippingStep - Descripci√≥n standard:",(u=c.data.standard)==null?void 0:u.description),console.log("üîç ShippingStep - Tipo standard:",(L=c.data.standard)==null?void 0:L.type);const X=[];let rt=!1;if(c.data.is_free&&c.data.qualifies_free_shipping&&(console.log("‚úÖ ShippingStep - Es zona is_free=true Y califica por monto - Agregando env√≠o GRATIS"),X.push({type:"free",price:0,description:c.data.standard.description,deliveryType:c.data.standard.type,characteristics:c.data.standard.characteristics})),c.data.standard&&(!c.data.is_free||c.data.is_free&&!c.data.qualifies_free_shipping)){console.log("üì¶ ShippingStep - Agregando env√≠o NORMAL");let z=c.data.standard.description;c.data.is_free||(z=z.replace(/env√≠o gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),z||(z="Delivery a domicilio")),X.push({type:"standard",price:c.data.standard.price,description:z,deliveryType:c.data.standard.type,characteristics:c.data.standard.characteristics})}c.data.express&&c.data.express.price>0&&(console.log("‚ö° ShippingStep - Agregando env√≠o EXPRESS"),X.push({type:"express",price:c.data.express.price,description:c.data.express.description,deliveryType:c.data.express.type,characteristics:c.data.express.characteristics})),c.data.is_agency&&c.data.agency&&(console.log("üè¢ ShippingStep - Agregando env√≠o por AGENCIA"),X.push({type:"agency",price:c.data.agency.price||0,description:c.data.agency.description,deliveryType:c.data.agency.type,characteristics:c.data.agency.characteristics})),c.data.is_store_pickup&&(console.log("üè™ ShippingStep - Retiro en tienda disponible"),rt=!0),rt||c.data.is_store_pickup?(X.some(Ae=>Ae.type==="store_pickup")||(c.data.store_pickup?X.push({type:"store_pickup",price:c.data.store_pickup.price,description:c.data.store_pickup.description,deliveryType:c.data.store_pickup.type,characteristics:c.data.store_pickup.characteristics}):X.push({type:"store_pickup",price:0,description:"Retira tu pedido en una de nuestras tiendas",deliveryType:"Retiro en Tienda",characteristics:["Sin costo de env√≠o","Horarios flexibles","Atenci√≥n personalizada"]})),Ge(!0)):(Ge(!1),Be(null)),Ee(X),Ce(((x=X[0])==null?void 0:x.type)||null),ue(((E=X[0])==null?void 0:E.price)||0),q(!1),console.log("üìã ShippingStep - Opciones finales de env√≠o:",X),console.log("üöö ShippingStep - Precio de env√≠o seleccionado:",((k=X[0])==null?void 0:k.price)||0)}catch{le.error("Sin cobertura",{description:"No realizamos env√≠os a esta ubicaci√≥n.",icon:e.jsx(He,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}),Ee([]),Ce(null),ue(0),q(!1)}we(!1)},Ke=async t=>{var x,E;if(t.preventDefault(),Z)return;if(!s){Oe(!0);return}const o={},u=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,L=/^[0-9]{9}$/;if(n.name.trim()||(o.name="Nombre es requerido"),n.lastname.trim()||(o.lastname="Apellido es requerido"),n.documentType.trim()||(o.documentType="Tipo de documento es requerido"),n.document.trim()||(o.document="N√∫mero de documento es requerido"),n.email.trim()?u.test(n.email)||(o.email="Email inv√°lido"):o.email="Email es requerido",n.phone.trim()?L.test(n.phone.trim())||(o.phone="Tel√©fono debe tener exactamente 9 d√≠gitos"):o.phone="Tel√©fono es requerido",n.ubigeo||(o.ubigeo="Ubicaci√≥n es requerida"),n.address||(o.address="Direcci√≥n es requerida"),O||(o.shipping="Seleccione un m√©todo de env√≠o"),Object.keys(o).length>0){i(o);const k=Object.keys(o)[0],C={name:"Por favor ingrese su nombre",lastname:"Por favor ingrese su apellido",documentType:"Por favor seleccione el tipo de documento",document:"Por favor ingrese su n√∫mero de documento",email:(x=o.email)!=null&&x.includes("inv√°lido")?"Por favor ingrese un correo electr√≥nico v√°lido":"Por favor ingrese su correo electr√≥nico",phone:(E=o.phone)!=null&&E.includes("9 d√≠gitos")?"El tel√©fono debe tener exactamente 9 d√≠gitos":"Por favor ingrese su n√∫mero de tel√©fono",ubigeo:"Por favor seleccione su ubicaci√≥n de entrega",address:"Por favor ingrese su direcci√≥n de entrega",shipping:"Por favor seleccione un m√©todo de env√≠o"};le.error("Complete el campo requerido",{description:C[k],icon:e.jsx(ye,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),mt(o);return}ee(!0);try{if(!se.CULQI_ENABLED){le.error("M√©todo de pago no disponible",{description:"El procesamiento de pagos con tarjeta est√° temporalmente deshabilitado",icon:e.jsx(ye,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),ee(!1);return}if(!se.CULQI_PUBLIC_KEY){le.error("Error de configuraci√≥n",{description:"El sistema de pagos no est√° configurado correctamente",icon:e.jsx(ye,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),ee(!1);return}const k={user_id:s.id,...n,fullname:`${n.name} ${n.lastname}`,country:"Per√∫",document_type:n.documentType,amount:P(Me),delivery:P(T),seguro_importacion_total:P(M||0),derecho_arancelario_total:P(je||0),flete_total:P(pe||0),delivery_type:O,store_id:O==="store_pickup"?Te==null?void 0:Te.id:null,cart:_,coupon_id:(j==null?void 0:j.id)||null,coupon_code:(j==null?void 0:j.code)||null,coupon_discount:P(Le||0),applied_promotions:R||[],promotion_discount:P(A||0)};console.log("üì¶ Request completo a enviar:",k),console.log("üí∞ Monto final con cup√≥n:",Me),console.log("üéüÔ∏è Descuento del cup√≥n:",Le),console.log("üöö Costo de env√≠o:",T);const C=await St(k);if(console.log("üìã Respuesta completa del procesamiento:",C),C.status){if(console.log("‚úÖ Pago exitoso, procesando respuesta..."),oe(C.sale),$(C.delivery),ae(C.code),C.conversion_scripts&&(console.log("Scripts de conversi√≥n recibidos:",C.conversion_scripts),xe(C.conversion_scripts),Ne)){console.log("üéØ Ejecutando callback onPurchaseComplete...");try{await Ne(C.sale_id,C.conversion_scripts),console.log("‚úÖ Callback onPurchaseComplete ejecutado exitosamente")}catch(c){console.error("‚ùå Error en callback onPurchaseComplete:",c)}}console.log("üõí Limpiando carrito y continuando..."),I([]),me()}else console.log("‚ùå Pago rechazado:",C),le.error("Error en el pago",{description:C.message||"Pago rechazado",icon:e.jsx(He,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(k){console.error("üí• Error completo en handlePayment:",k),console.error("üí• Stack trace:",k.stack),console.error("üí• Error name:",k.name),console.error("üí• Error message:",k.message),le.error("Lo sentimos, no puede continuar con la compra",{description:`Ocurri√≥ un error al procesar el pedido: ${k.message}`,icon:e.jsx(He,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{ee(!1)}},ut=r.useCallback(_t.debounce((t,o)=>{if(t.length<3){o([]);return}fetch(`/api/ubigeo/search?q=${encodeURIComponent(t)}`).then(u=>{if(!u.ok)throw new Error("Error en la respuesta");return u.json()}).then(u=>{const L=u.map(x=>({value:x.reniec,label:`${x.distrito}, ${x.provincia}, ${x.departamento}`,data:{inei:x.inei,reniec:x.reniec,departamento:x.departamento,provincia:x.provincia,distrito:x.distrito}}));o(L)}).catch(u=>{o([])})},300),[]);r.useEffect(()=>{i(t=>{const o={...t};return n.name.trim()&&delete o.name,n.lastname.trim()&&delete o.lastname,n.documentType.trim()&&delete o.documentType,n.document.trim()&&delete o.document,n.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&delete o.email,n.phone.trim()&&/^[0-9]{9}$/.test(n.phone.trim())&&delete o.phone,n.address.trim()&&delete o.address,n.ubigeo&&delete o.ubigeo,O&&delete o.shipping,o})},[n,O]);const xt=t=>({control:o=>({...o,border:`1px solid ${t?"#ef4444":"#e5e7eb"}`,boxShadow:"none",minHeight:"50px","&:hover":{borderColor:t?"#ef4444":"#6b7280"},borderRadius:"0.75rem",padding:"2px 8px"}),menu:o=>({...o,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:o=>({...o,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})}),ht=async()=>{var t;if(!te.trim()){_e("Ingrese un c√≥digo de cup√≥n");return}ge(!0),_e("");try{const o=[...new Set(_.map(E=>E.category_id).filter(Boolean))],u=_.map(E=>E.id);console.log("Validando cup√≥n:",{code:te.trim(),cart_total:v,category_ids:o,product_ids:u});const L=await Ct.validateCoupon({code:te.trim(),cart_total:v,category_ids:o,product_ids:u});console.log("Respuesta del cup√≥n:",L);const x=L.data||L;if(x&&x.valid){Re(x.coupon);const E=Math.round(x.discount*100)/100;p(E),G&&G(E),ie&&ie(((t=x.coupon)==null?void 0:t.code)||te.trim()),le.success("Cup√≥n aplicado",{description:x.message||"Cup√≥n aplicado correctamente",duration:3e3,position:"top-center"})}else{const E=(x==null?void 0:x.message)||"Cup√≥n no v√°lido";_e(E),le.error("Cup√≥n no v√°lido",{description:E,icon:e.jsx(ye,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}}catch(o){console.error("Error al validar cup√≥n:",o),_e("Error al validar el cup√≥n"),le.error("Error",{description:o.message||"No se pudo validar el cup√≥n. Intente nuevamente.",icon:e.jsx(ye,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-center"})}finally{ge(!1)}},ft=()=>{Re(null),p(0),be(""),_e(""),G&&G(0),ie&&ie(""),le.success("Cup√≥n removido",{description:"El cup√≥n ha sido removido de su pedido",duration:2e3,position:"top-center"})},P=t=>{const o=typeof t=="string"?parseFloat(t):t;return parseFloat(o.toFixed(2))},Ye=P(Q)-P(A);let Fe=0;j&&(j.type==="percentage"||j.type==="percent"?Fe=Ye*Number(j.value)/100:j.type==="fixed"&&(Fe=Number(j.value))),r.useEffect(()=>{p(P(Fe)),G&&G(P(Fe))},[j,v,F,T,A]);const Me=Math.max(0,P(Ye-Fe)),bt=()=>{if(!lt)return null;const t=o=>{o.target===o.currentTarget&&Oe(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-2xl transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4",children:e.jsx(kt,{className:"h-8 w-8 customtext-primary"})}),e.jsx("h2",{className:"text-2xl font-bold customtext-neutral-dark mb-3",children:"Acceso requerido"}),e.jsx("p",{className:"customtext-neutral-light text-sm leading-relaxed",children:"Para continuar con su compra necesita iniciar sesi√≥n o crear una cuenta nueva."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{window.location.href="/iniciar-sesion"},className:"w-full py-3 px-6 bg-primary text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Iniciar sesi√≥n"}),e.jsx("button",{onClick:()=>{window.location.href="/crear-cuenta"},className:"w-full py-3 px-6 bg-accent text-white font-semibold rounded-lg  focus:outline-none focus:ring-2  focus:ring-offset-2 transition duration-200 transform hover:scale-[1.02]",children:"Crear cuenta nueva"}),e.jsx("button",{onClick:()=>Oe(!1),className:"w-full py-3 px-6 customtext-neutral-light hover:customtext-neutral-dark border border-secondary rounded-lg hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200",children:"Cancelar"})]})]})})})};return e.jsxs(e.Fragment,{children:[e.jsx(bt,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-4 md:space-y-6 bg-white p-4 md:p-6 rounded-xl shadow-sm",onSubmit:Ke,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Se,{name:"name",label:"Nombres",value:n.name,error:f.name,onChange:t=>{S(o=>({...o,name:t.target.value})),t.target.value.trim()&&f.name&&i(o=>({...o,name:""}))},required:!0,className:`border-gray-200 ${f.name?"border-red-500 bg-red-50":""}`}),e.jsx(Se,{name:"lastname",label:"Apellidos",value:n.lastname,error:f.lastname,onChange:t=>{S(o=>({...o,lastname:t.target.value})),t.target.value.trim()&&f.lastname&&i(o=>({...o,lastname:""}))},required:!0,className:`border-gray-200 ${f.lastname?"border-red-500 bg-red-50":""}`})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(It,{label:"Tipo de documento",options:B,placeholder:"Selecciona tu documento",labelClass:"block text-sm 2xl:!text-base mb-1 customtext-neutral-dark",value:n.documentType,error:f.documentType,onChange:t=>{S(o=>({...o,documentType:t})),t&&f.documentType&&i(o=>({...o,documentType:""}))},required:!0})}),e.jsx(Se,{name:"document",label:"N√∫mero de documento",value:n.document,error:f.document,onChange:t=>{S(o=>({...o,document:t.target.value})),t.target.value.trim()&&f.document&&i(o=>({...o,document:""}))},placeholder:"Ej: 12345678",required:!0,className:`border-gray-200 ${f.document?"border-red-500 bg-red-50":""}`})]}),e.jsx(Se,{name:"email",label:"Correo electr√≥nico",type:"email",value:n.email,error:f.email,onChange:t=>{S(o=>({...o,email:t.target.value})),t.target.value.trim()&&f.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.target.value)&&i(u=>({...u,email:""}))},required:!0,className:`border-gray-200 ${f.email?"border-red-500 bg-red-50":""}`}),e.jsx(Se,{name:"phone",label:"Tel√©fono",type:"tel",value:n.phone,error:f.phone,onChange:t=>{const o=t.target.value.replace(/\D/g,"");S(u=>({...u,phone:o})),o.length===9&&f.phone&&i(u=>({...u,phone:""}))},maxLength:"9",placeholder:"Ej: 987654321",required:!0,className:`border-gray-200 ${f.phone?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-sm 2xl:text-base mb-2 font-medium customtext-neutral-dark",children:["Distrito / Provincia / Departamento (Ubicaci√≥n de entrega)",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(vt,{name:"ubigeo",cacheOptions:!0,value:ce,loadOptions:ut,onChange:t=>{a(t),Ve(t),b("")},inputValue:m,onInputChange:(t,{action:o})=>{o==="input-change"&&b(t)},onFocus:()=>{a(null),b("")},onMenuOpen:()=>{ce&&(a(null),b(""))},placeholder:"Buscar por Distrito ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:t})=>t.length<3?"Buscar por Distrito ...":"No se encontraron resultados",isLoading:Y,styles:xt(!!f.ubigeo),formatOptionLabel:({data:t})=>e.jsxs("div",{className:"text-sm py-1",children:[e.jsx("div",{className:"font-medium",children:t.distrito}),e.jsxs("div",{className:"text-gray-500",children:[t.provincia,", ",t.departamento]})]}),className:"w-full rounded-xl transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),f.ubigeo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:f.ubigeo})]}),e.jsx(Se,{name:"address",label:"Direcci√≥n ",value:n.address,error:f.address,onChange:t=>{S(o=>({...o,address:t.target.value})),t.target.value.trim()&&f.address&&i(o=>({...o,address:""}))},required:!0,className:`border-gray-200 ${f.address?"border-red-500 bg-red-50":""}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Se,{label:"N√∫mero",value:n.number,onChange:t=>S(o=>({...o,number:t.target.value})),className:"border-gray-200"}),e.jsx(Se,{label:"Referencia",value:n.reference,onChange:t=>S(o=>({...o,reference:t.target.value})),className:"border-gray-200"})]}),fe.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"M√©todo de env√≠o"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:fe.map(t=>e.jsx(Nt,{title:t.deliveryType,price:t.price,description:t.description,selected:O===t.type,onSelect:()=>{Ce(t.type),ue(t.price),i(o=>({...o,shipping:"",store:""})),q(!1),t.type!=="store_pickup"&&Be(null)}},t.type))}),O&&fe.length>0&&e.jsx("div",{className:"space-y-3 mt-4",children:(()=>{var L;const t=((L=fe.find(x=>x.type===O))==null?void 0:L.characteristics)||[],o=t.length>1,u=o&&!d?t.slice(0,1):t;return e.jsxs(e.Fragment,{children:[u.map((x,E)=>e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsx(nt,{className:"customtext-primary"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:x})})]},`char-${E}`)),o&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{type:"button",onClick:()=>q(!d),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium customtext-primary hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:d?"Ver menos informaci√≥n":`Ver m√°s informaci√≥n (${t.length-1} m√°s)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${d?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})})()})]}),O==="store_pickup"&&ct&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(wt,{ubigeoCode:n.ubigeo,onStoreSelect:dt,selectedStore:Te,className:"border border-gray-200 rounded-xl p-4"}),f.store&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),f.store]})]}),!H&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-end gap-3 md:gap-4 mt-6",children:[e.jsx(Qe,{type:"button",onClick:()=>window.history.back(),className:"w-full md:w-auto",children:"Regresar"}),e.jsx(Ue,{type:"submit",loading:Y,className:"w-full md:w-auto",children:"Continuar"})]})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen"}),e.jsx("div",{className:"space-y-4 border-b-2 pb-6",children:_.map(t=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t.type==="combo"?`/storage/images/combo/${t.image}`:`/storage/images/item/${t.image}`,alt:t.name,className:"w-16 h-16 object-cover rounded-lg",onError:o=>o.target.src="/api/cover/thumbnail/null"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",t.quantity]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:[g(),y(t.final_price)]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[g(),y(P(v))]})]}),A>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Descuentos aplicados:"}),e.jsxs("span",{children:["-",g(),y(P(A))]})]}),Number((We=l==null?void 0:l.find(t=>t.correlative==="importation_seguro"))==null?void 0:We.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Seguro (",Number(((Je=l==null?void 0:l.find(t=>t.correlative==="importation_seguro"))==null?void 0:Je.description)||0).toFixed(2),"%):"]}),e.jsxs("span",{children:[g(),y(P(M))]})]}),pe>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Flete",((Ze=l==null?void 0:l.find(t=>t.correlative==="importation_flete_descripcion"))==null?void 0:Ze.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(et=l==null?void 0:l.find(t=>t.correlative==="importation_flete_descripcion"))==null?void 0:et.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[g(),y(P(pe))]})]}),Number((tt=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario"))==null?void 0:tt.description)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Derecho Arancelario",((st=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:st.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(ot=l==null?void 0:l.find(t=>t.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:ot.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[g(),y(P(je))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Env√≠o",((at=l==null?void 0:l.find(t=>t.correlative==="envio"))==null?void 0:at.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(it=l==null?void 0:l.find(t=>t.correlative==="envio"))==null?void 0:it.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[g(),y(P(T))]})]}),e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"¬øTienes un cup√≥n de descuento?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Ingresa tu c√≥digo de cup√≥n",value:te,onChange:t=>be(t.target.value.toUpperCase()),className:`w-full px-4 py-3 border customtext-neutral-dark  border-gray-100 rounded-xl focus:ring-0 focus:outline-0   transition-all duration-300 ${$e?"border-red-300 bg-red-50 text-red-900 focus:border-red-500 focus:ring-red-200":j?"border-gray-200 bg-white customtext-neutral-dark focus:ring-blue-200":" bg-white border-neutral-light focus:ring-0 focus:outline-0"} `,disabled:!!j||w}),w&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})})]}),j?e.jsx("button",{type:"button",onClick:ft,className:"px-4 py-3 bg-gray-200 customtext-neutral-dark text-sm rounded-xl hover:bg-gray-300 transition-colors duration-200",title:"Remover cup√≥n",children:e.jsx(ye,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",onClick:ht,disabled:w||!te.trim(),className:"px-6 py-3 bg-primary text-white text-sm font-medium rounded-xl hover:opacity-90 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 whitespace-nowrap",children:w?"Validando...":"Aplicar"})]}),$e&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ye,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:$e})]}),j&&e.jsx("div",{className:"bg-gray-50 border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"customtext-primary font-semibold text-sm",children:["Descto. ",j.type==="percentage"?`${j.value}%`:`${g()}${y(j.value)}`]}),e.jsx("p",{className:"customtext-primary text-xs mt-1",children:j.code})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-primary font-bold text-base",children:["-",g(),y(P(Le))]})})]})})]})}),R&&R.length>0&&e.jsx("div",{className:"space-y-4 border-t pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium customtext-neutral-dark mb-2",children:"üéâ Descuentos autom√°ticos aplicados:"}),R.map((t,o)=>e.jsx("div",{className:" border-2  rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 w-8/12",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"customtext-neutral-dark font-semibold text-sm",children:t.name}),t.description&&e.jsx("p",{className:"customtext-neutral-dark text-xs mt-1",children:t.description})]})]}),e.jsx("div",{className:"text-right w-4/12",children:e.jsxs("span",{className:"customtext-neutral-dark font-bold text-base",children:["-",g(),y(t.amount)]})})]})},o)),A>0&&e.jsx("div",{className:"l p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Total descuentos autom√°ticos:"}),e.jsxs("span",{className:"customtext-neutral-dark font-bold text-lg",children:["-",g(),y(A)]})]})})]})}),e.jsx("div",{className:"pt-4 border-t-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[g(),y(P(j?Me:Q))]})]})}),!se.CULQI_ENABLED&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nt,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"El procesamiento de pagos con tarjeta est√° temporalmente deshabilitado"})]})}),se.CULQI_ENABLED&&!se.CULQI_PUBLIC_KEY&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:"Error de configuraci√≥n: Sistema de pagos no configurado"})]})}),e.jsx(Ue,{onClick:Ke,disabled:Z||!se.CULQI_ENABLED||!se.CULQI_PUBLIC_KEY,loading:Z,className:`w-full mt-6 ${(N==null?void 0:N.class_button)||"text-white"} ${!se.CULQI_ENABLED||!se.CULQI_PUBLIC_KEY?"opacity-50 cursor-not-allowed":""}`,children:Z?"Procesando...":se.CULQI_ENABLED?se.CULQI_PUBLIC_KEY?`Pagar ${g()}${y(P(j?Me:Q))}`:"Configuraci√≥n pendiente":"Pago no disponible"}),e.jsx(Qe,{onClick:H,className:"w-full mt-3",disabled:Z,children:"Regresar al carrito"}),e.jsxs("p",{className:"text-xs md:text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{href:"#",onClick:()=>h(1),className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{href:"#",onClick:()=>h(0),className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})]})]})]})]})}function Rt({cart:N,code:_,delivery:oe,subTotal:ae,igv:$,fleteTotal:I=0,seguroImportacionTotal:me=0,derechoArancelarioTotal:H=0,totalFinal:v,couponDiscount:F=0,couponCode:pe=null,conversionScripts:M=null,automaticDiscounts:je=[],automaticDiscountTotal:Q=0,generals:s,valorCIF:ue,advDisplay:T,ipmDisplay:ve,subTotalConDescuentos:h}){var V,D,W,xe,Ne,l,re,J,ne,K,ce;console.log("ConfirmationStep - Props received:",{cart:N,cartLength:N==null?void 0:N.length,subTotal:ae,igv:$,totalFinal:v,delivery:oe,couponDiscount:F,automaticDiscountTotal:Q,seguroImportacionTotal:me,derechoArancelarioTotal:H,fleteTotal:I});const Pe=ae,G=h||ae-(F||0)-(Q||0),ie=$,R=me,A=H,U=v;return console.log("ConfirmationStep - Debug totals:",{passedSubTotal:ae,passedIgv:$,actualSubTotal:Pe,actualIgv:ie,passedSeguro:me,actualSeguro:R,passedDerecho:H,actualDerecho:A,passedTotalFinal:v,actualTotalFinal:U,delivery:oe,fleteTotal:I,advDisplay:T,ipmDisplay:ve,valorCIF:ue,cart:N.map(a=>({name:a.name,type:a.type,price:a.price,final_price:a.final_price,quantity:a.quantity,weight:a.weight}))}),r.useEffect(()=>{if(M){console.log("Executing conversion scripts...");try{if(M.head){const a=document.createElement("script");a.innerHTML=M.head,document.head.appendChild(a)}if(M.body){const a=document.createElement("script");a.innerHTML=M.body,document.body.appendChild(a)}console.log("Conversion scripts executed successfully")}catch(a){console.error("Error executing conversion scripts:",a)}}},[M]),e.jsx(Ie.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 md:p-10",children:e.jsxs(Ie.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.3},className:"text-center space-y-6",children:[e.jsx(Ie.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.5},className:"w-20 h-20 bg-secondary rounded-full mx-auto flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"‚úì"})}),e.jsx("h2",{className:"text-2xl md:text-3xl customtext-neutral-light animate-bounce",children:"¬°Gracias por tu compra! üéâ"}),e.jsx("p",{className:"customtext-neutral-dark text-3xl md:text-5xl font-bold",children:"Tu orden ha sido recibida"}),e.jsxs(Ie.div,{whileHover:{scale:1.05},className:"py-6 px-4 bg-secondary rounded-xl inline-block",children:[e.jsx("div",{className:"customtext-neutral-light",children:"C√≥digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-xl font-bold",children:`#${_}`})]}),e.jsxs("div",{className:"space-y-6 bg-[#F7F9FB] p-6 md:p-8 rounded-xl shadow-inner",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:N.map((a,he)=>{var B,n;const ke=()=>a.type==="combo"?a.final_price||a.price:a.final_price;return e.jsx(Ie.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:he*.2},className:"bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center sm:items-start",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-xl",children:e.jsx("img",{src:(a==null?void 0:a.type)==="combo"?`/storage/images/combo/${a==null?void 0:a.image}`:`/storage/images/item/${a==null?void 0:a.image}`,alt:a==null?void 0:a.name,className:"w-24 h-24 object-cover rounded-lg",onError:S=>S.target.src="/api/cover/thumbnail/null",loading:"lazy"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3",children:[e.jsxs("div",{className:"lg:w-8/12",children:[e.jsx("h3",{className:"font-semibold text-xl line-clamp-3 mb-2",children:a==null?void 0:a.name}),a.type==="combo"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full",children:"COMBO"})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contiene:"}),e.jsx("div",{className:"mt-1",children:a.combo_items&&a.combo_items.length>0?a.combo_items.map((S,Y)=>e.jsxs("div",{className:"text-xs text-gray-500",children:["‚Ä¢ ",S.quantity||1,"x ",S.name]},Y)):a.items&&a.items.length>0?a.items.map((S,Y)=>e.jsxs("div",{className:"text-xs text-gray-500",children:["‚Ä¢ ",S.quantity||1,"x ",S.name]},Y)):e.jsx("span",{className:"text-xs text-gray-400",children:"Informaci√≥n de combo no disponible"})})]})]})]}),e.jsx("div",{className:"mt-2 sm:mt-0 text-center lg:text-right lg:w-4/12",children:e.jsxs("div",{className:"font-bold text-lg customtext-primary",children:[g(),y(ke()*(a==null?void 0:a.quantity))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[((B=a==null?void 0:a.brand)==null?void 0:B.name)&&e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:((n=a==null?void 0:a.brand)==null?void 0:n.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:a==null?void 0:a.quantity})]}),(a==null?void 0:a.sku)&&e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark font-medium",children:(a==null?void 0:a.sku)||"N/A"})]})]})]})]})},he)})}),e.jsxs(Ie.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:[g(),y(Pe)]})]}),(F>0||Q>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center py-2 text-green-600",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Descuentos aplicados"}),e.jsxs("span",{className:"font-semibold",children:["-",g(),y((F||0)+(Q||0))]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-t pt-2",children:[e.jsx("span",{className:"customtext-neutral-dark font-semibold",children:"Subtotal con descuentos"}),e.jsxs("span",{className:"font-semibold",children:[g(),y(G)]})]})]}),Number((V=s==null?void 0:s.find(a=>a.correlative==="importation_seguro"))==null?void 0:V.description)>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Seguro (",Number(((D=s==null?void 0:s.find(a=>a.correlative==="importation_seguro"))==null?void 0:D.description)||0).toFixed(2),"%)"]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(R)]})]}),I>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Flete",((W=s==null?void 0:s.find(a=>a.correlative==="importation_flete_descripcion"))==null?void 0:W.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(xe=s==null?void 0:s.find(a=>a.correlative==="importation_flete_descripcion"))==null?void 0:xe.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(I)]})]}),Number((Ne=s==null?void 0:s.find(a=>a.correlative==="importation_derecho_arancelario"))==null?void 0:Ne.description)>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Derecho Arancelario",((l=s==null?void 0:s.find(a=>a.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:l.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(re=s==null?void 0:s.find(a=>a.correlative==="importation_derecho_arancelario_descripcion"))==null?void 0:re.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(A)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsxs("span",{className:"customtext-neutral-dark",children:["Env√≠o",((J=s==null?void 0:s.find(a=>a.correlative==="envio_descripcion"))==null?void 0:J.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(ne=s==null?void 0:s.find(a=>a.correlative==="envio_descripcion"))==null?void 0:ne.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{className:"font-semibold",children:[g(),y(oe)]})]}),e.jsx("div",{className:"py-4 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl md:text-2xl items-center",children:[e.jsxs("span",{children:["Total",((K=s==null?void 0:s.find(a=>a.correlative==="total_descripcion"))==null?void 0:K.description)&&e.jsx(de,{content:e.jsx("p",{className:"whitespace-pre-line",children:(ce=s==null?void 0:s.find(a=>a.correlative==="total_descripcion"))==null?void 0:ce.description}),allowHTML:!0,children:e.jsx("i",{className:"mdi mdi-information ms-1"})})]}),e.jsxs("span",{children:[g(),y(U)]})]})})]}),e.jsx(Ie.div,{className:"pt-6",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(Ue,{href:"/catalogo",className:"w-full mx-auto md:w-auto text-white",children:"Seguir Comprando"})})]})]})})})}function qs({cart:N,setCart:_,user:oe,ubigeos:ae=[],items:$,generals:I,data:me,categorias:H}){var j,Re,Le;const[v,F]=r.useState(1);r.useEffect(()=>{const p=N.filter(w=>w.type==="combo");console.log("üîç CheckoutSteps cart changed:",{totalItems:N.length,combos:p.length,currentStep:v,cart:N.map(w=>({id:w.id,name:w.name,type:w.type,quantity:w.quantity,final_price:w.final_price,price:w.price}))}),p.length===0&&N.length===0&&console.warn("üö® ALERT: Cart is empty - this might indicate combos were removed")},[N,v]);const pe=p=>p.type==="combo"?p.final_price||p.price:p.final_price,M=N.reduce((p,w)=>{const ge=pe(w);return p+ge*w.quantity},0);console.log(H,"eeeeeeeeeeee");const{trackCheckoutPageView:je,trackInitiateCheckout:Q,trackPurchase:s,resetTracking:ue}=Et(),[T,ve]=r.useState(0),[h,Pe]=r.useState(null),[G,ie]=r.useState([]),[R,A]=r.useState(0),U=M,V=T+R,D=Math.max(0,U-V),[W,xe]=r.useState(0),Ne=N.reduce((p,w)=>{const ge=Number(w.weight)||0;return p+ge*w.quantity},0),l=Number((j=I==null?void 0:I.find(p=>p.correlative==="importation_flete"))==null?void 0:j.description)||0,re=l>0?Ne*l:0,J=(Number((Re=I==null?void 0:I.find(p=>p.correlative==="importation_seguro"))==null?void 0:Re.description)||0)/100,ne=D*J;console.log("=== DEBUG C√ÅLCULOS ==="),console.log("subTotalConDescuentos:",D),console.log("seguroImportacion rate:",J),console.log("seguroImportacionTotal:",ne),console.log("fleteTotal:",re);const K=parseFloat(D)+parseFloat(re)+parseFloat(ne);console.log("valorCIF:",K);const ce=(Number((Le=I==null?void 0:I.find(p=>p.correlative==="importation_derecho_arancelario"))==null?void 0:Le.description)||0)/100,a=K*ce;console.log("derechoArancelarioRate:",ce),console.log("derechoArancelarioTotal:",a),console.log("=== FIN DEBUG ===");const he=0,ke=0,B=D+a+parseFloat(W),n=U+parseFloat(W)+parseFloat(ne)+parseFloat(a),S=he,Y=re,we=ne,Z=a,ee=ke,[fe,Ee]=r.useState([]),[O,Ce]=r.useState([]),[qe,De]=r.useState([]),[f,i]=r.useState(null);r.useEffect(()=>(je(v,N),()=>ue()),[]),r.useEffect(()=>{je(v,N),v===2&&Q(N,B)},[v]);const m=p=>{F(p),window.scrollTo({top:0,behavior:"smooth"})},b={privacy_policy:"Pol√≠ticas de privacidad",terms_conditions:"T√©rminos y condiciones",saleback_policy:"Pol√≠ticas de devolucion y cambio"},[d,q]=r.useState(null),te=p=>q(p),be=()=>q(null);return e.jsxs("div",{className:"min-h-screen bg-[#F7F9FB] py-4 md:py-12 px-2 sm:px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-3 md:p-8 rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("div",{className:"mb-4 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${v===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:" bg-primary text-white w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm",children:"1"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:v>1?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${v>1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${v>1?"bg-primary text-white":"bg-white customtext-primary"}`,children:"2"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Env√≠o"})]}),e.jsx("div",{className:"mb-4 lg:mb-0  flex-1 h-[2px] bg-gray-200 relative",children:e.jsx("div",{className:"absolute inset-0 bg-primary transition-all duration-500",style:{width:v>2?"100%":"0%"}})}),e.jsxs("div",{className:`flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 ${v===3?"customtext-primary  font-medium":"customtext-neutral-dark"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm ${v===3?"bg-primary text-white":"bg-white customtext-primary"}`,children:"3"}),e.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Confirmaci√≥n"})]})]})}),v===1&&e.jsx(qt,{data:me,cart:N,setCart:_,onContinue:()=>F(2),subTotal:U,envio:W,igv:S,fleteTotal:Y,seguroImportacionTotal:we,derechoArancelarioTotal:a,totalFinal:B,openModal:te,categorias:H,automaticDiscounts:G,setAutomaticDiscounts:ie,automaticDiscountTotal:R,setAutomaticDiscountTotal:A,totalWithoutDiscounts:n,generals:I,valorCIF:K,advDisplay:Z,ipmDisplay:ee,subTotalConDescuentos:D}),v===2&&e.jsx(Dt,{data:me,items:$,setCode:Ce,setDelivery:De,cart:N,setSale:Ee,setCart:_,onContinue:()=>m(3),noContinue:()=>m(1),subTotal:U,envio:W,setEnvio:xe,igv:S,fleteTotal:Y,seguroImportacionTotal:we,derechoArancelarioTotal:a,totalFinal:B,user:oe,ubigeos:ae,categorias:H,openModal:te,setCouponDiscount:ve,setCouponCode:Pe,automaticDiscounts:G,setAutomaticDiscounts:ie,valorCIF:K,advDisplay:Z,ipmDisplay:ee,subTotalConDescuentos:D,automaticDiscountTotal:R,setAutomaticDiscountTotal:A,totalWithoutDiscounts:n,conversionScripts:f,setConversionScripts:i,onPurchaseComplete:(p,w)=>{s(p,w)},generals:I}),v===3&&e.jsx(Rt,{code:O,delivery:qe,cart:fe,subTotal:U,envio:W,igv:S,fleteTotal:Y,seguroImportacionTotal:we,derechoArancelarioTotal:a,totalFinal:B,couponDiscount:T,couponCode:h,automaticDiscounts:G,automaticDiscountTotal:R,totalWithoutDiscounts:n,conversionScripts:f,setConversionScripts:i,onPurchaseComplete:(p,w)=>{s(p,w)},generals:I,valorCIF:K,advDisplay:Z,ipmDisplay:ee,subTotalConDescuentos:D})]}),Object.keys(b).map((p,w)=>{var _e;const ge=b[p],$e=((_e=I.find(Te=>Te.correlative==p))==null?void 0:_e.description)??"";return e.jsx(Pt,{isOpen:d===w,onRequestClose:be,contentLabel:ge,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:ge}),e.jsx("button",{onClick:be,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:e.jsx(Tt,{size:24,strokeWidth:2})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"prose prose-gray max-w-none",children:e.jsx(Lt,{html:$e})})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:be,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},w)})]})}export{qs as default};

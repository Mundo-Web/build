var R=Object.defineProperty;var T=(s,n,l)=>n in s?R(s,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[n]=l;var N=(s,n,l)=>T(s,typeof n!="symbol"?n+"":n,l);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BH53Isel.js";import{c as D}from"./ReactAppend-DTVVXReZ.js";import{B as E}from"./Base-CVtEsDqe.js";import{C as F}from"./CreateReactScript-DprzhEtl.js";import{T as B}from"./Table-DitbKwtZ.js";import{D as y}from"./DxButton-DV0H-ZcL.js";import{R as g}from"./ReactAppend-D7S498fx.js";import{S as A}from"./ProductCard-erObE6pO.js";import{B as P}from"./BasicRest-B3rfI5GY.js";import{G as v}from"./Global-ErywZRdd.js";import{N as o}from"./Number2Currency-e57Tgsuk.js";import{M}from"./Modal-DYPPCNUR.js";import{i as O}from"./tippy-react.esm-BWiGTO87.js";import{S as q}from"./SaleStatusesRest-BClaSKoc.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";class G extends P{constructor(){super(...arguments);N(this,"path","admin/sales")}}const h=new G;new q;const I=({statuses:s=[]})=>{var f;const n=m.useRef(),l=m.useRef(),p=m.useRef(),[e,u]=m.useState(null),[d,j]=m.useState([]),w=async r=>{if(!await h.save({id:e.id,status_id:r.target.value,notify_client:l.current.checked}))return;const i=await h.get(e.id);u(i.data),j(i.data.tracking.sort((a,x)=>new Date(x.created_at)-new Date(a.created_at))),$(n.current).dxDataGrid("instance").refresh()},_=async r=>{const{isConfirmed:c}=await A.fire({title:"Anular pedido",text:"¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!c||!await h.delete(r)||$(n.current).dxDataGrid("instance").refresh()},b=async r=>{l.current.checked=!0;const c=await h.get(r);u(c.data),j(c.data.tracking.sort((i,a)=>new Date(a.created_at)-new Date(i.created_at))),$(p.current).modal("show")};m.useEffect(()=>{},[e]);const S=Number(e==null?void 0:e.amount)+Number((e==null?void 0:e.delivery)||0)-Number((e==null?void 0:e.bundle_discount)||0)-Number((e==null?void 0:e.renewal_discount)||0)-Number((e==null?void 0:e.coupon_discount)||0);return t.jsxs(t.Fragment,{children:[t.jsx(B,{gridRef:n,title:"Pedidos",rest:h,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(r,{data:c})=>{r.css("cursor","pointer"),r.on("click",()=>{b(c.id)}),g(r,t.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[t.jsxs("b",{className:"d-block",children:[c.name," ",c.lastname]}),t.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",v.APP_CORRELATIVE,"-",c.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(r,{data:c})=>{r.text(moment(c.created_at).subtract(5,"hours").format("LLL"))}},{dataField:"status.name",caption:"Estado",cellTemplate:(r,{data:c})=>{g(r,t.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:c.status.color?`${c.status.color}2e`:"#3333332e",color:c.status.color??"#333"},children:c.status.name}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(r,{data:c})=>{const i=Number(c.amount)||0,a=Number(c.delivery)||0,x=Number(c.bundle_discount)||0,C=Number(c.renewal_discount)||0,k=Number(c.coupon_discount)||0;r.text(`S/. ${o(i+a-x-C-k)}`)}},{caption:"Acciones",cellTemplate:(r,{data:c})=>{r.append(y({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>b(c.id)})),r.append(y({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>_(c.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(M,{modalRef:p,title:`Detalles del pedido #${v.APP_CORRELATIVE}-${e==null?void 0:e.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-8",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),t.jsx("div",{className:"card-body p-2",children:t.jsx("table",{className:"table table-borderless table-sm mb-0",children:t.jsxs("tbody",{children:[(e==null?void 0:e.payment_method)&&t.jsxs("tr",{children:[t.jsx("th",{children:"Método de pago:"}),t.jsx("td",{children:e==null?void 0:e.payment_method})]}),(e==null?void 0:e.culqi_charge_id)&&t.jsxs("tr",{children:[t.jsx("th",{children:"ID de transacción:"}),t.jsx("td",{children:e==null?void 0:e.culqi_charge_id})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Nombres:"}),t.jsx("td",{children:e==null?void 0:e.fullname})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Email:"}),t.jsx("td",{children:e==null?void 0:e.email})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Teléfono:"}),t.jsx("td",{children:e==null?void 0:e.phone})]}),(e==null?void 0:e.delivery_type)&&t.jsxs("tr",{children:[t.jsx("th",{children:"Dirección:"}),t.jsxs("td",{children:[e==null?void 0:e.address," ",e==null?void 0:e.number,t.jsxs("small",{className:"text-muted d-block",children:[e==null?void 0:e.district,","," ",e==null?void 0:e.province,","," ",e==null?void 0:e.department,", ",e==null?void 0:e.country," ",(e==null?void 0:e.zip_code)&&t.jsxs(t.Fragment,{children:["-"," ",e==null?void 0:e.zip_code]})]})]})]}),(e==null?void 0:e.reference)&&t.jsxs("tr",{children:[t.jsx("th",{children:"Referencia:"}),t.jsx("td",{children:e==null?void 0:e.reference})]}),(e==null?void 0:e.comment)&&t.jsxs("tr",{children:[t.jsx("th",{children:"Comentario:"}),t.jsx("td",{children:e==null?void 0:e.comment})]}),(e==null?void 0:e.invoiceType)&&t.jsxs("tr",{children:[t.jsxs("th",{children:[e==null?void 0:e.invoiceType,":"]}),t.jsxs("td",{children:[e==null?void 0:e.documentType," - ",e==null?void 0:e.document," ",t.jsx("br",{})," ",(e==null?void 0:e.document)&&(e==null?void 0:e.businessName)]})]}),(e==null?void 0:e.payment_proof)&&t.jsxs("tr",{children:[t.jsx("th",{children:"Comprobante de pago:"}),t.jsx("td",{children:t.jsx(O,{content:"Ver comprobante de pago",placement:"top",children:t.jsx("a",{href:`/storage/images/sale/${e==null?void 0:e.payment_proof}`,target:"_blank",children:t.jsx("img",{src:`/storage/images/sale/${e==null?void 0:e.payment_proof}`,alt:"Comprobante de pago",className:"img-thumbnail",style:{maxWidth:"150px",cursor:"pointer"}})})})})]})]})})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Artículos"})}),t.jsx("div",{className:"card-body p-2 table-responsive",children:t.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"w-20",children:"Imagen"}),t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Precio"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Subtotal"})]})}),t.jsx("tbody",{children:(f=e==null?void 0:e.details)==null?void 0:f.map((r,c)=>{const i=r.quantity*100/100,a=r.price*r.quantity;return t.jsxs("tr",{children:[t.jsx("td",{className:"max-w-20 p-0",children:r.image?t.jsx("img",{className:"object-scale-down mx-auto block",src:`/storage/images/item/${r.image}`,alt:r.name,style:{height:"5rem",width:"5rem",objectFit:"scale-down"}}):null}),t.jsxs("td",{children:[r.name,r.colors?" - "+r.colors:""]}),t.jsx("td",{align:"right",children:t.jsxs("span",{className:"text-nowrap",children:["S/"," ",o(r.price)]})}),t.jsx("td",{align:"center",children:i}),t.jsx("td",{align:"right",children:t.jsxs("span",{className:"text-nowrap",children:["S/"," ",o(a)]})})]},c)})})]})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),t.jsxs("div",{className:"card-body p-2",children:[t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Subtotal:"}),t.jsxs("span",{children:["S/"," ",o((e==null?void 0:e.amount)*1)]})]}),t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Envío:"}),t.jsxs("span",{children:["S/"," ",o(e==null?void 0:e.delivery)]})]}),(e==null?void 0:e.coupon_discount)>0&&t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Descuento por cupon:"}),t.jsxs("span",{children:["- S/"," ",o(e==null?void 0:e.coupon_discount)]})]}),t.jsx("hr",{className:"my-2"}),t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Total:"}),t.jsx("span",{children:t.jsxs("strong",{children:["S/ ",o(S)]})})]})]})]})]}),t.jsxs("div",{className:"col-md-4",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),t.jsxs("div",{className:"card-body p-2",children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),t.jsx("select",{className:"form-select",id:"statusSelect",value:e==null?void 0:e.status_id,onChange:w,children:s.map((r,c)=>t.jsx("option",{value:r.id,children:r.name}))})]}),t.jsxs("div",{className:"form-check",children:[t.jsx("input",{ref:l,className:"form-check-input",type:"checkbox",id:"notifyClient",defaultChecked:!0}),t.jsx("label",{className:"form-check-label",htmlFor:"notifyClient",children:"Notificar al cliente"})]})]})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),t.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",children:d==null?void 0:d.map((r,c)=>t.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.color?`${r.color}2e`:"#3333332e"},children:[t.jsx("i",{className:"mdi mdi-circle left-2",style:{color:r.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),t.jsx("b",{style:{color:r.color||"#333"},children:r==null?void 0:r.name}),t.jsxs("small",{className:"d-block text-truncate",children:[r==null?void 0:r.user_name," ",r==null?void 0:r.user_lastname]}),t.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},c))})]})]})]})})]})};F((s,n)=>{D.createRoot(s).render(t.jsx(E,{...n,title:"Pedidos",children:t.jsx(I,{...n})}))});

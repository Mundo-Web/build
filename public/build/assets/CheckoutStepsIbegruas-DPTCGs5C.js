import{j as jsxRuntimeExports,h as Package,k as Minus,P as Plus,T as Trash2,r as reactExports,q as ReactModal,X,bx as CircleX,b7 as StateManagedSelect$1,b$ as AsyncSelect$1,s as server_browserExports,ac as CircleCheckBig,aX as TriangleAlert,bw as Info,m as mainExports}from"./vendor-react-DD0uBW7s.js";import{H as HtmlContent}from"./HtmlContent-CEAddvHS.js";import{G as General}from"./General-ClVW7qxN.js";import{t as toast}from"./GoogleSignInButton-BciphYP2.js";import{G as Global}from"./Global-BAGAPG-V.js";import{l as lodashExports}from"./ShippingStep-6aPVmI67.js";import{U as UploadVoucherModalYape,a as UploadVoucherModalBancs}from"./ShippingStepIbergruas-DWnYwLfm.js";import"./ProductDetailB-CQsLxkOQ.js";import"./CartKuchara-BG_NtHiU.js";import"./TippyButton-BXJTBPrK.js";import"./vendor-swiper-BQwfPLwm.js";import{C as CurrencySymbol,N as Number2Currency}from"./Number2Currency-BX4epFEo.js";import{B as ButtonPrimary,p as processCulqiPayment,C as CouponsRest}from"./culqiPayment-Cfa7Nt1h.js";import{A as AnimatedGiftBox,D as DiscountRulesRest,B as ButtonSecondary,P as PromotionModal,a as DeliveryPricesRest,O as OptionCard,S as StorePickupSelector}from"./StorePickupSelector-_WC8qGjo.js";import{O as OpenPayCardModal,p as processMercadoPagoPayment,a as processOpenPayPayment}from"./OpenPayCardModal-Cchy28m1.js";import{I as InputForm}from"./InputForm-Df0cVtxA.js";import{r as recoveryOrderData}from"./recoveryOrderData-BeqSa8z5.js";import"./VoucherUpload-oFHePJeI.js";import"./filepond-plugin-image-preview-DXJLhvZS.js";import"./SalesRest-C0CynmQb.js";import"./BasicRest-BuuGWTMX.js";import"./BooleanLimit-q2Ad9fGY.js";import"./HeaderSearch-BDxnXhqm.js";import"./CartItemRow-BnlaioF5.js";import"./vendor-motion-B85mKBc-.js";import"./ItemsRest-BoLMrPFW.js";import"./StoresRest-DDPv6IPO.js";const CardItemIbergruas=({setCart:e,hasPromotion:t,onPromotionClick:s,categorias:o,...a})=>{o?.find(e=>e.id===a?.category_id);const r="combo"===a.type,n=()=>{e(e=>e.filter(e=>r?!(e.id===a?.id&&"combo"===e.type):e.id!==a?.id))},i=r?a.final_price||a.price:a.final_price,c=a.price;return jsxRuntimeExports.jsx("div",{className:"w-full bg-transparent   p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row md:items-center  justify-between gap-4 w-full",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("img",{src:r?a?.image?`/storage/images/combo/${a.image}`:`/storage/images/item/${a.image}`:`/storage/images/item/${a?.image}`,alt:a?.name,className:"w-20 h-20 object-cover flex-shrink-0",onError:e=>e.target.src="/api/cover/thumbnail/null"}),r&&jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -right-1 bg-primary text-white rounded-full p-1",children:jsxRuntimeExports.jsx(Package,{size:12})}),t&&jsxRuntimeExports.jsx("div",{className:"absolute -top-2 -right-2",children:jsxRuntimeExports.jsx(AnimatedGiftBox,{onClick:()=>s(a),className:"group"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-lg  text-white mb-2 line-clamp-2",children:a?.name}),r&&jsxRuntimeExports.jsxs("p",{className:"text-xs customtext-primary font-medium mb-1",children:["Combo (",a.combo_items?.length||0," productos)"]}),r&&a.combo_items&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-white mb-2",children:["Incluye: ",a.combo_items.map(e=>e.name).join(", ")]}),a?.brand?.name||a?.category?.name&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-white",children:[a?.brand?.name?"Marca: ":"CategorÃ­a: ",jsxRuntimeExports.jsx("span",{className:"text-white",children:a?.brand?.name?a?.brand?.name:a?.category?.name})]}),!r&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-white",children:["Disponibilidad: ",jsxRuntimeExports.jsxs("span",{className:"text-white",children:[a?.stock>=a?.quantity?"En stock":"Agotado"," "]})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-white",children:["Codigo: ",jsxRuntimeExports.jsx("span",{className:"text-white",children:a?.sku})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-row justify-between md:flex-col items-end md:items-end gap-4 mt-4 md:mt-0 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"text-right text-white",children:[r&&a.discount>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-white line-through",children:[CurrencySymbol()," ",Number(c*a?.quantity).toFixed(2)]}),!r&&a?.discount>0&&a?.price>a?.final_price&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-white line-through",children:[CurrencySymbol()," ",Number(c*a?.quantity).toFixed(2)]}),jsxRuntimeExports.jsxs("div",{className:"font-bold text-lg",children:[CurrencySymbol()," ",Number(i*a?.quantity).toFixed(2)]}),r&&a.discount>0&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-red-500",children:["-",a.discount_percent,"% OFF"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center border border-white overflow-hidden shadow-sm",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{e(e=>e.map(e=>{if(r?e.id===a?.id&&"combo"===e.type:e.id===a?.id){const t=(e.quantity||1)-1;return t<=0?(n(),null):{...e,quantity:t}}return e}).filter(Boolean))},className:"p-2 text-white hover:bg-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Decrease quantity",children:jsxRuntimeExports.jsx(Minus,{size:16})}),jsxRuntimeExports.jsx("div",{className:"w-12 h-8 flex justify-center items-center text-white",children:jsxRuntimeExports.jsx("span",{className:"font-semibold text-sm",children:a?.quantity||1})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{e(e=>e.map(e=>r?e.id===a?.id&&"combo"===e.type?{...e,quantity:(e.quantity||1)+1}:e:e.id===a?.id?{...e,quantity:(e.quantity||1)+1}:e))},className:"p-2 text-white hover:bg-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Increase quantity",children:jsxRuntimeExports.jsx(Plus,{size:16})})]}),jsxRuntimeExports.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-red-500 transition-colors duration-200 rounded-full hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200","aria-label":"Remove item",children:jsxRuntimeExports.jsx(Trash2,{size:18})})]})]})]})},a?.id)};function CartStepIbergruas({data:e,cart:t,setCart:s,onContinue:o,subTotal:a,envio:r,igv:n,totalFinal:i,openModal:c,automaticDiscounts:l,setAutomaticDiscounts:m,automaticDiscountTotal:d,setAutomaticDiscountTotal:u,totalWithoutDiscounts:p}){const[x,h]=reactExports.useState(l||[]),[j,g]=reactExports.useState(d||0),[f,y]=reactExports.useState(!1),[b,E]=reactExports.useState([]),[v,C]=reactExports.useState([]),[R,N]=reactExports.useState(!1),[w,D]=reactExports.useState(null),[_,S]=reactExports.useState(null),T=0===t.length;reactExports.useEffect(()=>{if(t.length>0&&a>0)P();else{const e=[],t=0;h(e),g(t),E([]),C([]),m&&m(e),u&&u(t)}},[t,a]);const P=async()=>{y(!0);try{t.reduce((e,t)=>e+(t.quantity||0),0);const e=await DiscountRulesRest.applyToCart(t,p);if(e.success&&e.data){const t=DiscountRulesRest.formatDiscounts(e.data.applied_discounts),s=e.data.total_discount||0,o=DiscountRulesRest.getFreeItems(e.data.applied_discounts),a=[];e.data.applied_discounts.forEach(e=>{e.suggested_items&&Array.isArray(e.suggested_items)&&a.push(...e.suggested_items)}),h(t),g(s),E(o),C(a),m&&m(t),u&&u(s)}else{const e=[],t=0;h(e),g(t),E([]),C([]),m&&m(e),u&&u(t)}}catch(e){const t=[],s=0;h(t),g(s),E([]),C([]),m&&m(t),u&&u(s)}finally{y(!1)}},k=e=>{const t=(s=e.id,v.find(e=>e.item_id===s||e.triggering_item_id===s));var s;t&&(D(t),S(e),N(!0))};return jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-5 gap-4 md:gap-8",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-3 space-y-4 md:space-y-6",children:T?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[jsxRuntimeExports.jsx("svg",{className:"w-24 h-24 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Tu carrito estÃ¡ vacÃ­o"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"Â¡Explora nuestros productos y encuentra algo especial!"})]}):t.map((e,t)=>{return jsxRuntimeExports.jsx(CardItemIbergruas,{...e,setCart:s,hasPromotion:(o=e.id,v.some(e=>e.item_id===o||e.triggering_item_id===o)),onPromotionClick:k},t);var o})}),jsxRuntimeExports.jsxs("div",{className:"lg:col-span-2 bg-transparent border text-white  border-primary  p-4 md:p-6 h-max mt-4 md:mt-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6",children:"Resumen"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 md:space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-white",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(a)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-white",children:["IGV",parseFloat(General.igv_checkout||0)>0?` (${General.igv_checkout}%)`:""]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(n)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-white",children:"EnvÃ­o"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(r)]})]}),f&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-white",children:"Verificando descuentos..."}),jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]}),!f&&x.length>0&&jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("div",{className:"text-xl md:text-2xl font-bold pb-4 md:pb-6 text-white mb-2",children:"ðŸŽ‰ Descuentos aplicados:"}),x.map((e,t)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-white",children:[e.name,e.description&&jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold block",children:e.description})]}),jsxRuntimeExports.jsxs("span",{className:"text-white font-semibold",children:["-",CurrencySymbol()," ",Number2Currency(e.amount)]})]},t)),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm font-semibold text-white pt-1",children:[jsxRuntimeExports.jsx("span",{children:"Total descuentos:"}),jsxRuntimeExports.jsxs("span",{children:["-",CurrencySymbol()," ",Number2Currency(j)]})]})]}),jsxRuntimeExports.jsxs("div",{className:"py-3 border-y-2 mt-4 md:mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-lg md:text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," ",Number2Currency(i)]})]}),j>0&&jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[jsxRuntimeExports.jsxs("span",{className:"line-through",children:[CurrencySymbol()," ",Number2Currency(p||i+j)]}),jsxRuntimeExports.jsxs("span",{className:"ml-2 text-white font-semibold",children:["Ahorras ",CurrencySymbol()," ",Number2Currency(j)]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-3 md:pt-4",children:[jsxRuntimeExports.jsx(ButtonPrimary,{onClick:o,disabled:T,className:`w-full py-3 px-6 font-semibold focus:outline-none outline-none focus:border-0 text-lg transition-all duration-300 hover:opacity-90 bg-primary   !rounded-none  ${e?.class_button||" customtext-neutral-dark"}`,children:T?"Carrito VacÃ­o":"Continuar Compra"}),jsxRuntimeExports.jsx(ButtonSecondary,{href:"/",className:"w-full !rounded-none",children:T?"Ir a Comprar":"Cancelar"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("p",{className:"text-xs md:text-sm text-white",children:["Al realizar tu pedido, aceptas los ",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>c&&c(1),className:"customtext-primary font-bold",children:"TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>c&&c(0),className:"customtext-primary font-bold",children:"PolÃ­tica de Privacidad"}),"."]})})]})]}),jsxRuntimeExports.jsx(PromotionModal,{isOpen:R,onClose:()=>N(!1),suggestion:w,onAddToCart:async e=>{try{s(t=>{const s=t.findIndex(t=>(t.item_id||t.id)===e.item_id);if(-1!==s){const o=[...t],a=e.quantity||e.suggested_quantity||1;return o[s].quantity+=a,o}{const s={id:e.item_id,name:e.item_name,quantity:e.quantity||e.suggested_quantity||1,price:e.value||0,final_price:e.value||0,image:e.item_image||"default.jpg",brand:{name:e.item_brand||"N/A"},sku:e.item_sku||"PROMO",stock:999};return[...t,s]}}),setTimeout(()=>{P()},100)}catch(t){}},productName:_?.name||""})]})}function PaymentModalIbergruas({isOpen:e,onClose:t,onPaymentComplete:s,contacts:o=[]}){const[a,r]=reactExports.useState(null),[n,i]=reactExports.useState(!1);reactExports.useEffect(()=>{e||(i(!1),r(null))},[e]);const c=n||!a,l=o?.find(e=>"checkout_mercadopago"===e.correlative),m=o?.find(e=>"checkout_openpay"===e.correlative),d=o?.find(e=>"checkout_culqi"===e.correlative),u="text-white",p="text-white/70",x="border-white/30",h="bg-white/10",j="hover:bg-white/5";return jsxRuntimeExports.jsx(ReactModal,{isOpen:e,onRequestClose:t,className:"absolute left-1/2 -translate-x-1/2 bg-secondary shadow-2xl w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden rounded-none",overlayClassName:"fixed inset-0 bg-black bg-opacity-70 z-50",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:h-[85vh] lg:min-h-[85vh] lg:max-h-[85vh]",children:[jsxRuntimeExports.jsx("div",{className:"hidden md:block bg-black/20 h-full",children:jsxRuntimeExports.jsx("img",{src:`/assets/resources/payments.png?v=${crypto.randomUUID()}`,alt:Global.APP_NAME,className:"h-full w-full object-cover opacity-90",onError:e=>{e.target.onerror=null,e.target.src="/assets/img/logo-bk.svg"}})}),jsxRuntimeExports.jsxs("div",{className:"p-6 md:p-8 max-h-[90vh] md:max-h-[100vh] flex flex-col justify-center bg-secondary",children:[jsxRuntimeExports.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-white/60 hover:text-white transition-colors",disabled:n,children:jsxRuntimeExports.jsx(X,{size:24})}),jsxRuntimeExports.jsxs("div",{className:"mb-4 md:mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl md:text-2xl 2xl:text-3xl font-bold customtext-primary",children:"Â¿CÃ³mo deseas pagar tu pedido?"}),jsxRuntimeExports.jsx("p",{className:`mt-2 text-sm 2xl:text-base ${p}`,children:"Elige una de las opciones disponibles para completar tu pago de forma segura."})]}),"true"!==l?.description&&"true"!==m?.description&&"true"!==d?.description&&"true"!==General.get("checkout_dwallet")&&"true"!==General.get("checkout_transfer")?jsxRuntimeExports.jsx("div",{className:`${p} text-center py-4`,children:"Sin opciones de pago disponibles"}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"mt-3 space-y-3 overflow-y-auto max-h-[50vh] pr-2",children:["true"==l?.description&&jsxRuntimeExports.jsx("div",{className:"border p-4 cursor-pointer transition-all rounded-none "+("tarjeta"===a?`${x} ${h} border-white`:`${x} ${j}`),onClick:()=>r("tarjeta"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"tarjeta",name:"paymentMethod",checked:"tarjeta"===a,onChange:()=>r("tarjeta"),className:"hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"tarjeta",className:`font-semibold text-base 2xl:text-lg ${u}`,children:"Pago con Tarjeta"}),jsxRuntimeExports.jsx("p",{className:`text-sm 2xl:text-base mt-1 ${p}`,children:"Visa, Mastercard, American Express y mÃ¡s."}),parseFloat(General.get("checkout_mercadopago_commission")||0)>0&&jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-yellow-400 font-medium",children:["+ ComisiÃ³n ",General.get("checkout_mercadopago_commission"),"%"]})]}),jsxRuntimeExports.jsx("div",{className:"min-w-6 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"h-5 w-5 flex items-center justify-center border-2 rounded-none "+("tarjeta"===a?"bg-white border-white":"border-white/50"),children:"tarjeta"===a&&jsxRuntimeExports.jsx("div",{className:"h-2 w-2 bg-primary"})})})]})}),"true"==m?.description&&jsxRuntimeExports.jsx("div",{className:"border p-4 cursor-pointer transition-all rounded-none "+("openpay"===a?`${x} ${h} border-white`:`${x} ${j}`),onClick:()=>r("openpay"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"openpay",name:"paymentMethod",checked:"openpay"===a,onChange:()=>r("openpay"),className:"hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"openpay",className:`font-semibold text-base 2xl:text-lg ${u}`,children:"Pago con Tarjeta (OpenPay)"}),jsxRuntimeExports.jsx("p",{className:`text-sm 2xl:text-base mt-1 ${p}`,children:"Paga de forma segura con tu tarjeta de crÃ©dito o dÃ©bito."}),parseFloat(General.get("checkout_openpay_commission")||0)>0&&jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-yellow-400 font-medium",children:["+ ComisiÃ³n ",General.get("checkout_openpay_commission"),"%"]})]}),jsxRuntimeExports.jsx("div",{className:"min-w-6 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"h-5 w-5 flex items-center justify-center border-2 rounded-none "+("openpay"===a?"bg-white border-white":"border-white/50"),children:"openpay"===a&&jsxRuntimeExports.jsx("div",{className:"h-2 w-2 bg-primary"})})})]})}),"true"==d?.description&&jsxRuntimeExports.jsx("div",{className:"border p-4 cursor-pointer transition-all rounded-none "+("culqi"===a?`${x} ${h} border-white`:`${x} ${j}`),onClick:()=>r("culqi"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"culqi",name:"paymentMethod",checked:"culqi"===a,onChange:()=>r("culqi"),className:"hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"culqi",className:`font-semibold text-base 2xl:text-lg ${u}`,children:"Pago con Tarjeta (Culqi)"}),jsxRuntimeExports.jsx("p",{className:`text-sm 2xl:text-base mt-1 ${p}`,children:"Paga con tarjeta de crÃ©dito, dÃ©bito, Yape y mÃ¡s."}),parseFloat(General.get("checkout_culqi_commission")||0)>0&&jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-yellow-400 font-medium",children:["+ ComisiÃ³n ",General.get("checkout_culqi_commission"),"%"]})]}),jsxRuntimeExports.jsx("div",{className:"min-w-6 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"h-5 w-5 flex items-center justify-center border-2 rounded-none "+("culqi"===a?"bg-white border-white":"border-white/50"),children:"culqi"===a&&jsxRuntimeExports.jsx("div",{className:"h-2 w-2 bg-primary"})})})]})}),"true"==General.get("checkout_dwallet")&&jsxRuntimeExports.jsx("div",{className:"border p-4 cursor-pointer transition-all rounded-none "+("yape"===a?`${x} ${h} border-white`:`${x} ${j}`),onClick:()=>r("yape"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"yape",name:"paymentMethod",checked:"yape"===a,onChange:()=>r("yape"),className:"hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"yape",className:`font-semibold text-base 2xl:text-lg ${u}`,children:"Yape / Plin"}),jsxRuntimeExports.jsx("p",{className:`text-sm 2xl:text-base mt-1 ${p}`,children:parseFloat(General.get("checkout_dwallet_commission")||0)>0?"Pago rÃ¡pido desde tu celular.":"Realiza el pago desde tu celular sin comisiones."}),parseFloat(General.get("checkout_dwallet_commission")||0)>0&&jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-yellow-400 font-medium",children:["+ ComisiÃ³n ",General.get("checkout_dwallet_commission"),"%"]})]}),jsxRuntimeExports.jsx("div",{className:"min-w-6 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"h-5 w-5 flex items-center justify-center border-2 rounded-none "+("yape"===a?"bg-white border-white":"border-white/50"),children:"yape"===a&&jsxRuntimeExports.jsx("div",{className:"h-2 w-2 bg-primary"})})})]})}),"true"==General.get("checkout_transfer")&&jsxRuntimeExports.jsx("div",{className:"border p-4 cursor-pointer transition-all rounded-none "+("transferencia"===a?`${x} ${h} border-white`:`${x} ${j}`),onClick:()=>r("transferencia"),children:jsxRuntimeExports.jsxs("div",{className:"flex flex-row items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-start justify-center",children:[jsxRuntimeExports.jsx("input",{type:"radio",id:"transferencia",name:"paymentMethod",checked:"transferencia"===a,onChange:()=>r("transferencia"),className:"hidden"}),jsxRuntimeExports.jsx("label",{htmlFor:"transferencia",className:`font-semibold text-base 2xl:text-lg ${u}`,children:"Pago por Transferencia"}),jsxRuntimeExports.jsx("p",{className:`text-sm 2xl:text-base mt-1 ${p}`,children:"Haz una transferencia bancaria desde tu app o banca por internet."}),parseFloat(General.get("checkout_transfer_commission")||0)>0&&jsxRuntimeExports.jsxs("p",{className:"text-xs mt-1 text-yellow-400 font-medium",children:["+ ComisiÃ³n ",General.get("checkout_transfer_commission"),"%"]})]}),jsxRuntimeExports.jsx("div",{className:"min-w-6 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"h-5 w-5 flex items-center justify-center border-2 rounded-none "+("transferencia"===a?"bg-white border-white":"border-white/50"),children:"transferencia"===a&&jsxRuntimeExports.jsx("div",{className:"h-2 w-2 bg-primary"})})})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 space-y-3",children:[("true"===l?.description||"true"===m?.description||"true"===d?.description||"true"===General.get("checkout_dwallet")||"true"===General.get("checkout_transfer"))&&jsxRuntimeExports.jsx("button",{className:"w-full bg-primary customtext-neutral-dark py-3 rounded-none text-base 2xl:text-lg leading-normal font-semibold transition-all "+(c?"opacity-70 cursor-not-allowed":""),onClick:()=>{a&&(i(!0),s(a))},disabled:n,children:n?"Procesando...":"Confirmar pago"}),jsxRuntimeExports.jsx("button",{className:`w-full border border-white ${u} hover:bg-white/10 py-3 text-base 2xl:text-lg leading-normal rounded-none font-medium transition-all`,onClick:t,disabled:n,children:"Volver"})]})]})]})})}function ShippingStepIbergruas({cart:cart,setSale:setSale,setCode:setCode,setDelivery:setDelivery,setCart:setCart,onContinue:onContinue,noContinue:noContinue,subTotal:subTotal,igv:igv,totalFinal:totalFinal,user:user,setEnvio:setEnvio,envio:envio,prefixes:prefixes,ubigeos:ubigeos=[],contacts:contacts,totalPrice:totalPrice,descuentofinal:descuentofinal,setDescuentoFinal:setDescuentoFinal,data:data,openModal:openModal,setCouponDiscount:setParentCouponDiscount,setCouponCode:setParentCouponCode,automaticDiscounts:automaticDiscounts=[],automaticDiscountTotal:automaticDiscountTotal=0,totalWithoutDiscounts:totalWithoutDiscounts,conversionScripts:conversionScripts,setConversionScripts:setConversionScripts,onPurchaseComplete:onPurchaseComplete}){const formatPhoneNumber=(e,t)=>t?t.startsWith(e)?t:`${e}${t}`:"",cleanPhoneNumber=(e,t)=>e?e.startsWith(t)?e.substring(t.length):e:"";reactExports.useRef(null);const[coupon,setCoupon]=reactExports.useState(null),[selectedUbigeo,setSelectedUbigeo]=reactExports.useState(null),[defaultUbigeoOption,setDefaultUbigeoOption]=reactExports.useState(null),[autoDiscounts,setAutoDiscounts]=reactExports.useState([]),[autoDiscountTotal,setAutoDiscountTotal]=reactExports.useState(0);autoDiscounts.reduce((e,t)=>t.free_items&&Array.isArray(t.free_items)?e.concat(t.free_items):e,[]);const calculateAutomaticDiscounts=async(e,t)=>{if(!e||0===e.length)return{discounts:[],total:0};try{const t=await DiscountRulesRest.applyToCart(e,totalWithoutDiscounts);if(t.success&&t.data){DiscountRulesRest.formatDiscounts(t.data.applied_discounts);const e=t.data.total_discount||0;return{discounts:t.data.applied_discounts,total:e}}}catch(s){}return{discounts:[],total:0}};reactExports.useEffect(()=>{cart&&cart.length>0&&totalWithoutDiscounts?calculateAutomaticDiscounts(cart).then(e=>{setAutoDiscounts(e.discounts),setAutoDiscountTotal(e.total)}):(setAutoDiscounts([]),setAutoDiscountTotal(0))},[cart,automaticDiscounts,totalWithoutDiscounts]);const[formData,setFormData]=reactExports.useState(()=>{const e=user?.phone_prefix||"51",t=cleanPhoneNumber(user?.phone||"",e);return{name:user?.name||"",lastname:user?.lastname||"",email:user?.email||"",phone_prefix:e,phone:t,documentType:user?.document_type?.toLowerCase()||"dni",document:user?.document_number||"",department:user?.department||"",province:user?.province||"",district:user?.district||"",address:user?.address||"",number:user?.number||"",comment:user?.comment||"",reference:user?.reference||"",shippingOption:"delivery",ubigeo:user?.ubigeo||null,invoiceType:user?.invoiceType||"boleta",businessName:user?.businessName||""}});reactExports.useEffect(()=>{if(user){const e=user.phone_prefix||"51",t=cleanPhoneNumber(user.phone||"",e);setFormData(s=>({...s,name:user.name||"",lastname:user.lastname||"",email:user.email||"",phone_prefix:e,phone:t,documentType:user.document_type?.toLowerCase()||"dni",document:user.document_number||"",department:user.department||"",province:user.province||"",district:user.district||"",address:user.address||"",number:user.number||"",comment:user.comment||"",reference:user.reference||"",ubigeo:user.ubigeo||null,invoiceType:user.invoiceType||"boleta",businessName:user.businessName||""}))}},[user]),reactExports.useEffect(()=>{if(user?.ubigeo)if(user?.district&&user?.province&&user?.department){const e={value:user.ubigeo,label:`${user.district}, ${user.province}, ${user.department}`,data:{reniec:user.ubigeo,departamento:user.department,provincia:user.province,distrito:user.district}};setDefaultUbigeoOption(e),setSelectedUbigeo(e),handleUbigeoChange(e)}else fetch(`/api/ubigeo/find/${user.ubigeo}`).then(e=>e.json()).then(e=>{if(e&&e.distrito){const t={value:user.ubigeo,label:`${e.distrito}, ${e.provincia}, ${e.departamento}`,data:{reniec:user.ubigeo,departamento:e.departamento,provincia:e.provincia,distrito:e.distrito}};setDefaultUbigeoOption(t),setSelectedUbigeo(t),handleUbigeoChange(t)}}).catch(e=>{})},[user]);const getContact=e=>contacts.find(t=>t.correlative===e)?.description||"",hasPaymentMethods=(()=>{const e=contacts?.find(e=>"checkout_mercadopago"===e.correlative),t=contacts?.find(e=>"checkout_openpay"===e.correlative),s=contacts?.find(e=>"checkout_culqi"===e.correlative);return"true"===e?.description||"true"===t?.description||"true"===s?.description||"true"===General.get("checkout_dwallet")||"true"===General.get("checkout_transfer")})(),handleChange=e=>{const{name:t,value:s}=e.target;setFormData(e=>({...e,[t]:s})),"invoiceType"===t&&setFormData(e=>({...e,documentType:"factura"===s?"ruc":"dni",document:"",businessName:"factura"===s?e.businessName:""}))},[loading,setLoading]=reactExports.useState(!1),[paymentLoading,setPaymentLoading]=reactExports.useState(!1),[shippingOptions,setShippingOptions]=reactExports.useState([]),[selectedOption,setSelectedOption]=reactExports.useState(null),[costsGet,setCostsGet]=reactExports.useState(null),[errors,setErrors]=reactExports.useState({}),[searchInput,setSearchInput]=reactExports.useState(""),[expandedCharacteristics,setExpandedCharacteristics]=reactExports.useState(!1),[couponCode,setCouponCode]=reactExports.useState(""),[appliedCoupon,setAppliedCoupon]=reactExports.useState(null),[couponDiscount,setCouponDiscount]=reactExports.useState(0),[couponLoading,setCouponLoading]=reactExports.useState(!1),[couponError,setCouponError]=reactExports.useState(""),[selectedStore,setSelectedStore]=reactExports.useState(null),[showStoreSelector,setShowStoreSelector]=reactExports.useState(!1),[showLoginModal,setShowLoginModal]=reactExports.useState(!1),[paymentCommission,setPaymentCommission]=reactExports.useState(0),[selectedPaymentMethod,setSelectedPaymentMethod]=reactExports.useState(null),getAvailablePaymentMethods=()=>{const e=[],t=contacts?.find(e=>"checkout_mercadopago"===e.correlative),s=contacts?.find(e=>"checkout_openpay"===e.correlative),o=contacts?.find(e=>"checkout_culqi"===e.correlative);return"true"===t?.description&&e.push({id:"tarjeta",name:"Pago con Tarjeta (MercadoPago)",commission:parseFloat(General.get("checkout_mercadopago_commission")||0)}),"true"===s?.description&&e.push({id:"openpay",name:"Pago con Tarjeta (OpenPay)",commission:parseFloat(General.get("checkout_openpay_commission")||0)}),"true"===o?.description&&e.push({id:"culqi",name:"Pago con Tarjeta (Culqi)",commission:parseFloat(General.get("checkout_culqi_commission")||0)}),"true"===General.get("checkout_dwallet")&&e.push({id:"yape",name:"Yape / Plin",commission:parseFloat(General.get("checkout_dwallet_commission")||0)}),"true"===General.get("checkout_transfer")&&e.push({id:"transferencia",name:"Transferencia Bancaria",commission:parseFloat(General.get("checkout_transfer_commission")||0)}),e},availablePaymentMethods=getAvailablePaymentMethods(),hasSinglePaymentMethod=1===availablePaymentMethods.length,singlePaymentMethod=hasSinglePaymentMethod?availablePaymentMethods[0]:null;reactExports.useEffect(()=>{hasSinglePaymentMethod&&singlePaymentMethod&&!selectedPaymentMethod&&(setSelectedPaymentMethod(singlePaymentMethod.id),setPaymentCommission(singlePaymentMethod.commission))},[hasSinglePaymentMethod,singlePaymentMethod]),parseFloat(getContact("shipping_free"));const validateForm=()=>{const e={};return formData.name||(e.name="Nombre es requerido"),formData.lastname||(e.lastname="Apellido es requerido"),formData.email||(e.email="Email es requerido"),formData.phone||(e.phone="TelÃ©fono es requerido"),formData.ubigeo||(e.ubigeo="UbicaciÃ³n es requerida"),formData.address||(e.address="DirecciÃ³n es requerida"),formData.number||(e.number="NÃºmero es requerido"),formData.document||(e.document="Documento es requerido"),formData.email&&!/\S+@\S+\.\S+/.test(formData.email)&&(e.email="Email invÃ¡lido"),formData.document&&("dni"===formData.documentType&&8!==formData.document.length?e.document="DNI debe tener 8 dÃ­gitos":"ruc"===formData.documentType&&11!==formData.document.length&&(e.document="RUC debe tener 11 dÃ­gitos")),"factura"!==formData.invoiceType||formData.businessName||(e.businessName="RazÃ³n social es requerida para factura"),setErrors(e),0===Object.keys(e).length},handleStoreSelect=e=>{setSelectedStore(e),setFormData(t=>({...t,shippingOption:"pickup",address:e.address,department:e.department,province:e.province,district:e.district}))},focusFirstError=e=>{const t=Object.keys(e)[0];setTimeout(()=>{let e=null;e="ubigeo"===t?document.getElementById("ubigeo-select-container"):"phone_prefix"===t?document.querySelector(".select2-prefix-selector")?.parentElement:document.querySelector(`[name="${t}"]`),e&&(highlightElement(e),e.scrollIntoView({behavior:"smooth",block:"center"}),["INPUT","SELECT","TEXTAREA"].includes(e.tagName)&&e.focus())},100)},highlightElement=e=>{e.classList.add("highlight-error"),setTimeout(()=>e.classList.remove("highlight-error"),2e3)},handleUbigeoChange=async e=>{if(!e)return;setErrors(e=>({...e,ubigeo:""}));const{data:t}=e;setFormData(e=>({...e,department:t.departamento,province:t.provincia,district:t.distrito,ubigeo:t.reniec||t.inei})),setLoading(!0);try{const e=cart.reduce((e,t)=>e+t.final_price*t.quantity,0),s=await DeliveryPricesRest.getShippingCost({ubigeo:t.reniec||t.inei,cart_total:e}),o=[];if(s.data.is_free&&s.data.qualifies_free_shipping&&o.push({type:"free",price:0,description:s.data.standard.description,deliveryType:s.data.standard.type,characteristics:s.data.standard.characteristics}),s.data.standard&&(!s.data.is_free||s.data.is_free&&!s.data.qualifies_free_shipping)){let e=s.data.standard.description;s.data.is_free||(e=e.replace(/envÃ­o gratis.*?/gi,"").replace(/envio gratis.*?/gi,"").replace(/gratis.*?compras.*?/gi,"").replace(/mayor.*?200.*?/gi,"").replace(/200.*?mayor.*?/gi,"").replace(/\s+/g," ").trim(),e||(e="Delivery a domicilio")),o.push({type:"standard",price:s.data.standard.price,description:e,deliveryType:s.data.standard.type,characteristics:s.data.standard.characteristics})}if(s.data.express&&s.data.express.price>0&&o.push({type:"express",price:s.data.express.price,description:s.data.express.description,deliveryType:s.data.express.type,characteristics:s.data.express.characteristics}),s.data.is_agency&&s.data.agency){const e=s.data.agency.price||0,t=s.data.agency.payment_on_delivery||!1,a=s.data.needs_consultation||!1;o.push({type:"agency",price:e,description:s.data.agency.description,deliveryType:s.data.agency.type,characteristics:s.data.agency.characteristics,paymentOnDelivery:t,showConsultButton:a})}if(s.data.is_store_pickup&&s.data.store_pickup&&o.push({type:"store_pickup",price:0,description:s.data.store_pickup.description,deliveryType:s.data.store_pickup.type,characteristics:s.data.store_pickup.characteristics,selectedStores:s.data.store_pickup.selected_stores}),0===o.length)throw new Error("No hay opciones de envÃ­o disponibles");setShippingOptions(o),setSelectedOption(o[0]?.type||null),setEnvio(o[0]?.price||0)}catch(s){toast.error("Sin cobertura",{description:"No realizamos envÃ­os a esta ubicaciÃ³n",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"top-right"}),setShippingOptions([]),setSelectedOption(null),setEnvio(0)}setLoading(!1)};reactExports.useEffect(()=>{selectedUbigeo&&handleUbigeoChange(selectedUbigeo)},[cart,subTotal,descuentofinal]);const loadOptions=reactExports.useCallback(lodashExports.debounce((e,t)=>{e.length<3?t([]):fetch(`/api/ubigeo/search?q=${encodeURIComponent(e)}`).then(e=>{if(!e.ok)throw new Error("Error en la respuesta");return e.json()}).then(e=>{const s=e.map(e=>({value:e.reniec,label:`${e.distrito}, ${e.provincia}, ${e.departamento}`,data:{inei:e.inei,reniec:e.reniec,departamento:e.departamento,provincia:e.provincia,distrito:e.distrito}}));t(s)}).catch(e=>{t([])})},300),[]);reactExports.useEffect(()=>{const e=e=>{const t=e.element.dataset.code,s=e.element.dataset.flag;return server_browserExports.renderToString(jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("span",{className:"inline-block w-8 font-emoji text-center",children:s}),jsxRuntimeExports.jsx("b",{className:"me-1",children:e.text}),jsxRuntimeExports.jsx("span",{className:"text-sm text-opacity-20",children:t})]}))};$(".select2-prefix-selector").select2({dropdownCssClass:"py-1",containerCssClass:"!border !border-gray-300 !rounded p-2 !h-[42px]",arrowCssClass:'!text-primary top-1/2 -translate-y-1/2"',templateResult:function(t){return t.id?$(e(t)):t.text},templateSelection:function(t){return t.id?$(e(t)):t.text},matcher:function(e,t){if(!e.term||!t.element)return t;const s=t.element.dataset.country||"",o=t.text||"";return s.toLowerCase().includes(e.term.toLowerCase())||o.toLowerCase().includes(e.term.toLowerCase())?t:null}})},[formData.phone_prefix]);const[showPaymentModal,setShowPaymentModal]=reactExports.useState(!1),[showOpenPayModal,setShowOpenPayModal]=reactExports.useState(!1),[openPayTokenData,setOpenPayTokenData]=reactExports.useState(null),[showVoucherModal,setShowVoucherModal]=reactExports.useState(!1),[showVoucherModalBancs,setShowVoucherModalBancs]=reactExports.useState(!1),[currentPaymentMethod,setCurrentPaymentMethod]=reactExports.useState(null),[paymentRequest,setPaymentRequest]=reactExports.useState(null),handleContinueClick=e=>{e.preventDefault(),e&&e.preventDefault&&e.preventDefault(),user?validateForm()?selectedOption?hasSinglePaymentMethod&&singlePaymentMethod?handlePaymentComplete(singlePaymentMethod.id):setShowPaymentModal(!0):toast.error("Seleccione envÃ­o",{description:"Debe elegir un mÃ©todo de envÃ­o",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"}):focusFirstError(errors):setShowLoginModal(!0)},handlePaymentComplete=async paymentMethod=>{try{let commission=0;switch(paymentMethod){case"tarjeta":commission=parseFloat(General.get("checkout_mercadopago_commission")||0);break;case"culqi":commission=parseFloat(General.get("checkout_culqi_commission")||0);break;case"openpay":commission=parseFloat(General.get("checkout_openpay_commission")||0);break;case"yape":commission=parseFloat(General.get("checkout_dwallet_commission")||0);break;case"transferencia":commission=parseFloat(General.get("checkout_transfer_commission")||0);break;default:commission=0}if(setPaymentCommission(commission),setSelectedPaymentMethod(paymentMethod),setShowPaymentModal(!1),setCurrentPaymentMethod(paymentMethod),"openpay"===paymentMethod)return void setShowOpenPayModal(!0);if("tarjeta"===paymentMethod){if(!window.MercadoPago)return;const selectedShippingOption=shippingOptions.find(e=>e.type===selectedOption),deliveryType=selectedShippingOption?selectedShippingOption.deliveryType:"domicilio",mercadopagoCommission=parseFloat(General.get("checkout_mercadopago_commission")||0),totalBeforeCommissionCalc=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),commissionAmount=roundToTwoDecimals(totalBeforeCommissionCalc*(mercadopagoCommission/100)),finalTotalWithCommission=Math.max(0,roundToTwoDecimals(totalBeforeCommissionCalc+commissionAmount)),request={user_id:user?.id||"",name:formData?.name||"",lastname:formData?.lastname||"",fullname:`${formData?.name} ${formData?.lastname}`,phone_prefix:formData?.phone_prefix||"51",email:formData?.email||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"PerÃº",department:formData?.department||"",province:formData?.province||"",district:formData?.district||"",ubigeo:formData?.ubigeo||"",address:formData?.address||"",number:formData?.number||"",comment:formData?.comment||"",reference:formData?.reference||"",amount:finalTotalWithCommission,delivery:envio,delivery_type:deliveryType,cart:cart,invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:finalTotalWithCommission};try{const response=await processMercadoPagoPayment(request),data=response;data.status?(setSale(data.sale),setDelivery(data.delivery),setCode(data.code),conversionScripts&&Array.isArray(conversionScripts)&&conversionScripts.forEach(script=>{try{eval(script)}catch(error){}}),onPurchaseComplete&&onPurchaseComplete(data)):toast.error("Error en el Pago",{description:"El pago ha sido rechazado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(error){toast.error("Error en el Pago",{description:"No se llegÃ³ a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}}else if("culqi"===paymentMethod){setPaymentLoading(!0);try{if(!Global.CULQI_ENABLED)return toast.error("MÃ©todo de pago no disponible",{description:"El procesamiento de pagos con Culqi estÃ¡ temporalmente deshabilitado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),void setPaymentLoading(!1);if(!Global.CULQI_PUBLIC_KEY)return toast.error("Error de configuraciÃ³n",{description:"El sistema de pagos Culqi no estÃ¡ configurado correctamente",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"top-center"}),void setPaymentLoading(!1);const e=shippingOptions.find(e=>e.type===selectedOption),t=e?e.deliveryType:"domicilio",s=parseFloat(General.get("checkout_culqi_commission")||0),o=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),a=roundToTwoDecimals(o*(s/100)),r=Math.max(0,roundToTwoDecimals(o+a)),n={user_id:user?.id||"",name:formData?.name||"",lastname:formData?.lastname||"",fullname:`${formData?.name} ${formData?.lastname}`,phone_prefix:formData?.phone_prefix||"51",email:formData?.email||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"PerÃº",department:formData?.department||"",province:formData?.province||"",district:formData?.district||"",ubigeo:formData?.ubigeo||"",address:formData?.address||"",number:formData?.number||"",comment:formData?.comment||"",reference:formData?.reference||"",amount:r,delivery:envio,delivery_type:t,cart:cart,invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:"culqi",coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:r},i=await processCulqiPayment(n);if(i.status){if(setSale(i.sale),setDelivery(i.delivery),setCode(i.code),i.conversion_scripts&&(setConversionScripts(i.conversion_scripts),onPurchaseComplete))try{await onPurchaseComplete(i.sale_id,i.conversion_scripts)}catch(callbackError){}setCart([]),onContinue()}else toast.error("Error en el pago",{description:i.message||"Pago rechazado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}catch(error){"Pago cancelado por el usuario"!==error&&toast.error("Error en el Pago",{description:error.message||error||"No se pudo procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{setPaymentLoading(!1)}}else if("yape"===paymentMethod){const e=shippingOptions.find(e=>e.type===selectedOption),t=e?e.deliveryType:"domicilio",s=parseFloat(General.get("checkout_dwallet_commission")||0),o=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),a=roundToTwoDecimals(o*(s/100)),r=Math.max(0,roundToTwoDecimals(o+a)),n={user_id:user?.id||"",name:formData?.name||"",lastname:formData?.lastname||"",fullname:`${formData?.name} ${formData?.lastname}`,phone_prefix:formData?.phone_prefix||"51",email:formData?.email||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"PerÃº",department:formData?.department||"",province:formData?.province||"",district:formData?.district||"",ubigeo:formData?.ubigeo||"",address:formData?.address||"",number:formData?.number||"",comment:formData?.comment||"",reference:formData?.reference||"",amount:r,delivery:envio,delivery_type:t,details:JSON.stringify(cart.map(e=>({id:e.id,quantity:e.quantity}))),invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,payment_proof:null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:r};setPaymentRequest(n),setShowVoucherModal(!0)}else if("transferencia"===paymentMethod){const e=shippingOptions.find(e=>e.type===selectedOption),t=e?e.deliveryType:"domicilio",s=parseFloat(General.get("checkout_transfer_commission")||0),o=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),a=roundToTwoDecimals(o*(s/100)),r=Math.max(0,roundToTwoDecimals(o+a)),n={user_id:user?.id||"",name:formData?.name||"",lastname:formData?.lastname||"",fullname:`${formData?.name} ${formData?.lastname}`,phone_prefix:formData?.phone_prefix||"51",email:formData?.email||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"PerÃº",department:formData?.department||"",province:formData?.province||"",district:formData?.district||"",ubigeo:formData?.ubigeo||"",address:formData?.address||"",number:formData?.number||"",comment:formData?.comment||"",reference:formData?.reference||"",amount:r,delivery:envio,delivery_type:t,details:JSON.stringify(cart.map(e=>({id:e.id,quantity:e.quantity}))),invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:paymentMethod||null,payment_proof:null,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:r};setPaymentRequest(n),setShowVoucherModalBancs(!0)}}catch(error){toast.error("Error en el Pago",{description:"No se llegÃ³ a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}},handleOpenPayTokenCreated=async tokenData=>{try{setOpenPayTokenData(tokenData),setShowOpenPayModal(!1),setPaymentLoading(!0);const selectedShippingOption=shippingOptions.find(e=>e.type===selectedOption),deliveryType=selectedShippingOption?selectedShippingOption.deliveryType:"domicilio",openpayCommission=parseFloat(General.get("checkout_openpay_commission")||0),totalBeforeCommissionCalc=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),commissionAmount=roundToTwoDecimals(totalBeforeCommissionCalc*(openpayCommission/100)),finalTotalWithCommission=Math.max(0,roundToTwoDecimals(totalBeforeCommissionCalc+commissionAmount)),request={user_id:user?.id||"",name:formData?.name||"",lastname:formData?.lastname||"",fullname:`${formData?.name} ${formData?.lastname}`,phone_prefix:formData?.phone_prefix||"51",email:formData?.email||"",phone:formatPhoneNumber(formData.phone_prefix||"51",formData.phone),country:"PerÃº",department:formData?.department||"",province:formData?.province||"",district:formData?.district||"",ubigeo:formData?.ubigeo||"",address:formData?.address||"",number:formData?.number||"",comment:formData?.comment||"",reference:formData?.reference||"",amount:finalTotalWithCommission,delivery:envio,delivery_type:deliveryType,cart:cart,invoiceType:formData.invoiceType||"",documentType:formData.documentType||"",document:formData.document||"",businessName:formData.businessName||"",payment_method:"openpay",source_id:tokenData.token,device_session_id:tokenData.device_session_id,coupon_id:appliedCoupon?appliedCoupon.id:null,coupon_discount:calculatedCouponDiscount||0,automatic_discounts:autoDiscounts,automatic_discount_total:autoDiscountTotal,applied_promotions:autoDiscounts,promotion_discount:autoDiscountTotal||0,total_amount:finalTotalWithCommission},response=await processOpenPayPayment(request);response&&response.status?(setSale(response.sale),setDelivery(response.delivery),setCode(response.code),setCart([]),localStorage.removeItem("cart"),conversionScripts&&Array.isArray(conversionScripts)&&conversionScripts.forEach(script=>{try{eval(script)}catch(error){}}),onPurchaseComplete&&onPurchaseComplete(response),toast.success("Â¡Pago exitoso!",{description:"Tu pedido ha sido procesado correctamente",icon:jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-5 w-5 text-green-500"}),duration:2e3,position:"bottom-center"}),setTimeout(()=>{onContinue()},1500)):(toast.error("Error en el Pago",{description:response?.message||"El pago ha sido rechazado",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"}),setPaymentLoading(!1))}catch(error){toast.error("Error en el Pago",{description:error.message||error||"No se llegÃ³ a procesar el pago",icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"}),setPaymentLoading(!1)}};reactExports.useEffect(()=>{setErrors(e=>{const t={...e};return Object.keys(formData).forEach(e=>{formData[e]&&delete t[e]}),t})},[formData]);const validateCoupon=async()=>{if(couponCode.trim()){setCouponLoading(!0),setCouponError("");try{"TEST50"===couponCode.toUpperCase()&&subTotal<100&&toast.warning("InformaciÃ³n importante",{description:`El cupÃ³n TEST50 requiere un monto mÃ­nimo de ${CurrencySymbol()} 100.00. Tu carrito actual: ${CurrencySymbol()} ${Number2Currency(subTotal)}`,icon:jsxRuntimeExports.jsx(TriangleAlert,{className:"h-5 w-5 text-yellow-500"}),duration:5e3,position:"bottom-center"});const e=[...new Set(cart.map(e=>e.category_id).filter(Boolean))],t=[...new Set(cart.map(e=>e.id||e.item_id).filter(Boolean))],s=await CouponsRest.validateCoupon({code:couponCode.trim(),cart_total:subTotal,category_ids:e,product_ids:t}),o=s.data||s;if(o&&o.valid){setAppliedCoupon(o.coupon);const e=Math.round(100*o.discount)/100;setCouponDiscount(e),setCouponCode(""),setParentCouponCode&&setParentCouponCode(o.coupon.code),setParentCouponDiscount&&setParentCouponDiscount(e),toast.success("CupÃ³n aplicado",{description:`Descuento de ${CurrencySymbol()} ${Number2Currency(e)} aplicado`,icon:jsxRuntimeExports.jsx(CircleCheckBig,{className:"h-5 w-5 text-green-500"}),duration:3e3,position:"bottom-center"})}else{const e=o?.message||"CupÃ³n invÃ¡lido o no aplicable a estos productos";setCouponError(e);let t=e;e.includes("monto mÃ­nimo")&&(t=`${e} Tu carrito actual: ${CurrencySymbol()} ${Number2Currency(subTotal)}`),toast.error("CupÃ³n invÃ¡lido",{description:t,icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:4e3,position:"bottom-center"})}}catch(e){const t=e.response?.data?.message||"Error al validar el cupÃ³n";setCouponError(t),toast.error("Error de validaciÃ³n",{description:t,icon:jsxRuntimeExports.jsx(CircleX,{className:"h-5 w-5 text-red-500"}),duration:3e3,position:"bottom-center"})}finally{setCouponLoading(!1)}}else setCouponError("Ingrese un cÃ³digo de cupÃ³n")},removeCoupon=()=>{setAppliedCoupon(null),setCouponCode(""),setCouponDiscount(0),setCouponError(""),setParentCouponCode&&setParentCouponCode(""),setParentCouponDiscount&&setParentCouponDiscount(0),toast.success("CupÃ³n removido",{description:"El cupÃ³n ha sido removido del pedido",icon:jsxRuntimeExports.jsx(Info,{className:"h-5 w-5 text-blue-500"}),duration:2e3,position:"bottom-center"})},roundToTwoDecimals=e=>Math.round(100*(parseFloat(e)+Number.EPSILON))/100,totalBase=roundToTwoDecimals(subTotal)+roundToTwoDecimals(igv)+roundToTwoDecimals(envio)-roundToTwoDecimals(autoDiscountTotal);let calculatedCouponDiscount=couponDiscount||0;const totalBeforeCommission=Math.max(0,roundToTwoDecimals(totalBase-calculatedCouponDiscount)),calculatedCommission=roundToTwoDecimals(totalBeforeCommission*(paymentCommission/100));reactExports.useEffect(()=>{setParentCouponDiscount&&setParentCouponDiscount(calculatedCouponDiscount)},[appliedCoupon,couponDiscount,setParentCouponDiscount]);const finalTotalWithCoupon=Math.max(0,roundToTwoDecimals(totalBeforeCommission+calculatedCommission)),displayTotal=calculatedCommission>0||appliedCoupon?finalTotalWithCoupon:totalFinal,LoginModal=()=>jsxRuntimeExports.jsx(ReactModal,{isOpen:showLoginModal,onRequestClose:()=>setShowLoginModal(!1),className:"modal-content max-w-md mx-auto mt-20 bg-white rounded-lg p-6",overlayClassName:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Iniciar SesiÃ³n Requerido"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"Debe iniciar sesiÃ³n para continuar con su compra"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 justify-center",children:[jsxRuntimeExports.jsx("button",{onClick:()=>setShowLoginModal(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancelar"}),jsxRuntimeExports.jsx("button",{onClick:()=>{setShowLoginModal(!1),window.location.href="/iniciar-sesion"},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Iniciar SesiÃ³n"})]})]})}),selectStyles=e=>({control:t=>({...t,border:"1px solid "+(e?"#ef4444":"#e5e7eb"),boxShadow:"none",minHeight:"50px","&:hover":{borderColor:e?"#ef4444":"#6b7280"},borderRadius:"none",padding:"2px 8px",backgroundColor:"transparent",color:"white"}),menu:e=>({...e,zIndex:9999,marginTop:"4px",borderRadius:"none"}),option:e=>({...e,color:"#1f2937",backgroundColor:"white","&:hover":{backgroundColor:"#f3f4f6"},padding:"12px 16px"})});return reactExports.useEffect(()=>{if(coupon){let e=0;e="percentage"===coupon.type?totalPrice*(coupon.amount/100):coupon.amount,setDescuentoFinal(e)}else setDescuentoFinal(0)},[totalPrice,coupon]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("style",{jsx:!0,children:"\n                .highlight-error {\n                    animation: highlight 2s ease-in-out;\n                    border: 2px solid #ef4444 !important;\n                    box-shadow: 0 0 10px rgba(239, 68, 68, 0.3) !important;\n                }\n                \n                @keyframes highlight {\n                    0% { transform: scale(1); }\n                    50% { transform: scale(1.02); }\n                    100% { transform: scale(1); }\n                }\n                \n                .modal-overlay {\n                    z-index: 9999;\n                }\n                \n                .modal-content {\n                    max-height: 90vh;\n                    overflow-y: auto;\n                }\n            "}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 lg:gap-8 ",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-3",children:jsxRuntimeExports.jsxs("form",{className:"space-y-6 bg-transparent text-white py-6 px-4 sm:px-6 rounded-2xl font-paragraph",onSubmit:e=>e.preventDefault(),children:[jsxRuntimeExports.jsxs("div",{className:"sectionInformation space-y-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 c ",children:"InformaciÃ³n del contacto"}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(InputForm,{type:"text",label:"Nombres",name:"name",value:formData.name,error:errors.name,onChange:handleChange,placeholder:"Nombres",required:!0,labelClass:"text-white",className:"!rounded-none bg-transparent text-white"}),jsxRuntimeExports.jsx(InputForm,{label:"Apellidos",type:"text",name:"lastname",value:formData.lastname,error:errors.lastname,onChange:handleChange,placeholder:"Apellidos",required:!0,labelClass:"text-white",className:"!rounded-none bg-transparent text-white"})]}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 ",children:[jsxRuntimeExports.jsx(InputForm,{label:"Correo electrÃ³nico",type:"email",name:"email",value:formData.email,error:errors.email,onChange:handleChange,placeholder:"Ej. hola@gmail.com",required:!0,labelClass:"text-white",className:"!rounded-none bg-transparent text-white"}),jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsxs("label",{htmlFor:"phone",className:"block text-sm 2xl:text-base mb-1 c",children:["Celular ",jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 w-full",children:[jsxRuntimeExports.jsx("div",{className:"max-w-[120px]",children:jsxRuntimeExports.jsx(StateManagedSelect$1,{name:"phone_prefix",value:prefixes.find(e=>e.realCode===formData.phone_prefix)?{value:prefixes.find(e=>e.realCode===formData.phone_prefix).realCode,label:`${prefixes.find(e=>e.realCode===formData.phone_prefix).beautyCode}`,flag:prefixes.find(e=>e.realCode===formData.phone_prefix).flag,code:prefixes.find(e=>e.realCode===formData.phone_prefix).beautyCode,country:prefixes.find(e=>e.realCode===formData.phone_prefix).country}:null,onChange:e=>setFormData(t=>({...t,phone_prefix:e?.value||""})),options:prefixes.sort((e,t)=>e.country.localeCompare(t.country)).map(e=>({value:e.realCode,label:e.beautyCode,flag:e.flag,code:e.beautyCode,country:e.country})),formatOptionLabel:({flag:e,code:t,country:s},{context:o})=>{const a=prefixes.find(e=>e.country===s),r=a?.isoCode?.ISO1?.toLowerCase()||s.toLowerCase().substring(0,2),n=[`https://flagsapi.com/${r.toUpperCase()}/flat/24.png`,`https://flagcdn.com/${r}.svg`,`https://purecatamphetamine.github.io/country-flag-icons/3x2/${r.toUpperCase()}.svg`,`https://cdn.jsdelivr.net/gh/hampusborgos/country-flags@main/svg/${r}.svg`,`https://raw.githubusercontent.com/lipis/flag-icons/main/flags/4x3/${r}.svg`];let i=0;const c="value"===o;return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 !rounded-none",children:[jsxRuntimeExports.jsx("img",{src:n[0],alt:`Bandera de ${s}`,className:"w-6 h-4 object-cover flex-shrink-0 border "+(c?"border-white":"border-gray-300"),onError:e=>{if(i++,i<n.length)e.target.src=n[i];else{e.target.style.display="none";const t=e.target.nextElementSibling;t&&t.classList.contains("flag-fallback")&&(t.style.display="flex")}},style:{minWidth:"24px",minHeight:"16px"}}),jsxRuntimeExports.jsx("div",{className:"flag-fallback w-6 h-4 bg-gray-200 flex items-center justify-center flex-shrink-0 border border-gray-300",style:{display:"none",minWidth:"24px",minHeight:"16px"},children:jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-500",children:r.toUpperCase()})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-sm "+(c?"text-white":"customtext-neutral-dark"),children:t})]})},placeholder:"PaÃ­s",isClearable:!1,isSearchable:!0,styles:{control:e=>({...e,minHeight:"48px",border:"1px solid #d1d5db",borderRadius:"0.75rem",fontSize:"14px",borderRadius:"none",backgroundColor:"transparent",color:"white !important","&:hover":{borderColor:"#9ca3af"},"&:focus-within":{borderColor:"none",color:"white !important",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.1)"},"&:active":{borderColor:"none",color:"white !important"},"&:selected":{borderColor:"none",color:"white !important"}}),option:(e,t)=>({...e,backgroundColor:t.isSelected?"#3b82f6":t.isFocused?"#f3f4f6":"white",color:t.isSelected?"white":"#374151",padding:"8px 12px"}),singleValue:e=>({...e,display:"flex",alignItems:"center",gap:"6px"}),menu:e=>({...e,zIndex:9999})},filterOption:(e,t)=>e.data.country.toLowerCase().includes(t.toLowerCase())||e.data.code.toLowerCase().includes(t.toLowerCase())})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx(InputForm,{type:"text",id:"phone",name:"phone",value:formData.phone,error:errors.phone,onChange:handleChange,placeholder:"000 000 000",labelClass:"text-white",className:"!rounded-none bg-transparent text-white"})})]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),jsxRuntimeExports.jsxs("div",{className:"sectionDelivery space-y-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 c",children:"DirecciÃ³n de envÃ­o"}),jsxRuntimeExports.jsxs("div",{id:"ubigeo-select-container",className:"form-group",children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm 2xl:text-base mb-1 c ",children:["Distrito / Provincia / Departamento (UbicaciÃ³n de entrega)",jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),jsxRuntimeExports.jsx(AsyncSelect$1,{name:"ubigeo",cacheOptions:!0,value:selectedUbigeo,loadOptions:loadOptions,onChange:e=>{setSelectedUbigeo(e),handleUbigeoChange(e),setSearchInput("")},inputValue:searchInput,onInputChange:(e,{action:t})=>{"input-change"===t&&setSearchInput(e)},onFocus:()=>{setSelectedUbigeo(null),setSearchInput("")},onMenuOpen:()=>{selectedUbigeo&&(setSelectedUbigeo(null),setSearchInput(""))},placeholder:"Buscar por distrito | provincia | departamento ...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:e})=>e.length<3?"Buscar por distrito | provincia | departamento ...":"No se encontraron resultados",isLoading:loading,styles:selectStyles(!!errors.ubigeo),formatOptionLabel:({data:e},{context:t})=>{const s="value"===t;return jsxRuntimeExports.jsxs("div",{className:"text-sm py-1",children:[jsxRuntimeExports.jsx("div",{className:"font-medium "+(s?"text-white":"customtext-neutral-dark"),children:e.distrito}),jsxRuntimeExports.jsxs("div",{className:s?"text-gray-300":"text-gray-500",children:[e.provincia,", ",e.departamento]})]})},className:"w-full !!rounded-none transition-all duration-300",menuPortalTarget:document.body,isClearable:!0}),errors.ubigeo&&jsxRuntimeExports.jsx("div",{className:"text-red-500 text-sm mt-1",children:errors.ubigeo})]}),jsxRuntimeExports.jsx(InputForm,{label:"Avenida / Calle / JirÃ³n",type:"text",name:"address",value:formData.address,error:errors.address,onChange:handleChange,placeholder:"Ingresa el nombre de la calle",required:!0,labelClass:"text-white",className:"!rounded-none bg-transparent text-white"}),jsxRuntimeExports.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsx(InputForm,{label:"NÃºmero",type:"text",name:"number",value:formData.number,error:errors.number,onChange:handleChange,placeholder:"Ingresa el nÃºmero de la calle",required:!0,labelClass:"text-white",className:"!rounded-none bg-transparent text-white"}),jsxRuntimeExports.jsx(InputForm,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque",type:"text",name:"comment",value:formData.comment,onChange:handleChange,placeholder:"Ej. Casa 3, Dpto 101",labelClass:"text-white",className:"!rounded-none bg-transparent text-white"})]}),shippingOptions.length>0&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 c",children:"MÃ©todo de envÃ­o"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:shippingOptions.map(e=>{const t=selectedUbigeo?.data,s=`Hola, necesito consultar el costo de envÃ­o para: ${t?`${t.distrito}, ${t.provincia}, ${t.departamento}`:"mi ubicaciÃ³n"}. Â¿Me pueden ayudar?`;return jsxRuntimeExports.jsx(OptionCard,{title:e.deliveryType,price:e.price,description:e.description,selected:selectedOption===e.type,paymentOnDelivery:e.paymentOnDelivery||!1,showConsultButton:e.showConsultButton||!1,advisors:General.whatsapp_advisors||[],consultMessage:s,onSelect:()=>{setSelectedOption(e.type),setEnvio(e.price),"store_pickup"===e.type?setShowStoreSelector(!0):(setShowStoreSelector(!1),setSelectedStore(null))},className:"!rounded-none"},e.type)})}),selectedOption&&shippingOptions.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-4 mt-4",children:shippingOptions.find(e=>e.type===selectedOption)?.characteristics?.map((e,t)=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4 text-white px-4 ",children:[jsxRuntimeExports.jsx("div",{className:"w-5 flex-shrink-0",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info customtext-primary",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("path",{d:"M12 16v-4"}),jsxRuntimeExports.jsx("path",{d:"M12 8h.01"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium c",children:e})})]},`char-${t}`))}),showStoreSelector&&"store_pickup"===selectedOption&&jsxRuntimeExports.jsx(StorePickupSelector,{ubigeo:selectedUbigeo?.data?.reniec||selectedUbigeo?.data?.inei,onStoreSelect:handleStoreSelect,selectedStore:selectedStore,specificStores:shippingOptions.find(e=>"store_pickup"===e.type)?.selectedStores})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-[#66483966] py-[0.6px]"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium c",children:"Tipo de comprobante"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"radio",className:"sr-only",name:"invoiceType",value:"boleta",checked:"boleta"===formData.invoiceType,onChange:handleChange}),jsxRuntimeExports.jsx("div",{className:"w-5 h-5 border-2 rounded-full transition-all duration-200 "+("boleta"===formData.invoiceType?"border-primary bg-primary":"border-gray-300 bg-white group-hover:border-gray-400"),children:"boleta"===formData.invoiceType&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})})]}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-sm font-medium c",children:"Boleta"})]}),jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center cursor-pointer group",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"radio",className:"sr-only",name:"invoiceType",value:"factura",checked:"factura"===formData.invoiceType,onChange:handleChange}),jsxRuntimeExports.jsx("div",{className:"w-5 h-5 border-2 rounded-full transition-all duration-200 "+("factura"===formData.invoiceType?"border-primary bg-primary":"border-gray-300 bg-white group-hover:border-gray-400"),children:"factura"===formData.invoiceType&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})})]}),jsxRuntimeExports.jsx("span",{className:"ml-3 text-sm font-medium c",children:"Factura"})]})]})]}),jsxRuntimeExports.jsx(InputForm,{label:"dni"===formData.documentType?"DNI":"RUC",type:"text",name:"document",value:formData.document,error:errors.document,onChange:handleChange,placeholder:"Ingrese su "+("dni"===formData.documentType?"DNI":"RUC"),maxLength:"dni"===formData.documentType?"8":"11",required:!0,labelClass:"text-white",className:"!rounded-none bg-transparent text-white"}),"factura"===formData.invoiceType&&jsxRuntimeExports.jsx(InputForm,{label:"RazÃ³n Social",type:"text",name:"businessName",value:formData.businessName,onChange:handleChange,placeholder:"Ingrese la razÃ³n social",labelClass:"text-white",className:"!rounded-none bg-transparent text-white"})]})}),jsxRuntimeExports.jsxs("div",{className:"bg-transparent rounded-none border text-white border-primary p-6 col-span-2 h-max font-paragraph",children:[jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold pb-6 c",children:"Resumen de compra"}),jsxRuntimeExports.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:cart.map((e,t)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-white p-0 rounded-xl",children:jsxRuntimeExports.jsx("img",{src:`/storage/images/item/${e.image}`,alt:e.name,className:"w-20 h-20 object-cover  "})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold c text-base 2xl:text-lg mb-2",children:e.name}),e?.color&&jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color:"," ",jsxRuntimeExports.jsx("span",{className:"c",children:e.color})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",jsxRuntimeExports.jsxs("span",{className:"c",children:[e.quantity," "]})]})]})]})},e.id))}),jsxRuntimeExports.jsx("div",{className:"mt-6",children:appliedCoupon?jsxRuntimeExports.jsx("div",{className:"bg-secondary border  rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium c   ",children:["CupÃ³n aplicado: ",appliedCoupon.code]}),jsxRuntimeExports.jsxs("p",{className:"text-xs customtext-neutral-light",children:["Descuento: ","percentage"===appliedCoupon.type?`${appliedCoupon.value}%`:`${CurrencySymbol()} ${Number2Currency(appliedCoupon.value)}`]})]})]}),jsxRuntimeExports.jsx("button",{onClick:removeCoupon,className:"text-red-600 hover:text-red-700 transition-colors",title:"Remover cupÃ³n",children:jsxRuntimeExports.jsx(CircleX,{})})]})}):jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"CÃ³digo de cupÃ³n",className:"w-full rounded-none bg-transparent border py-3 px-4 text-sm outline-none uppercase focus:border-[#C5B8D4] "+(couponError?"border-red-500":"border-gray-300"),value:couponCode,onChange:e=>{setCouponCode(e.target.value),setCouponError("")},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),validateCoupon())},disabled:couponLoading}),jsxRuntimeExports.jsx("button",{className:"rounded-none  px-4 py-2 text-sm text-white transition-all duration-300 hover:opacity-90 "+(couponLoading?"bg-gray-400 cursor-not-allowed":data?.gradient?"bg-gradient":"bg-primary"),type:"button",onClick:validateCoupon,disabled:couponLoading,children:couponLoading?"...":"Aplicar"})]})})}),couponError&&jsxRuntimeExports.jsx("div",{className:"mt-2 text-red-500 text-sm",children:couponError}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"c",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(subTotal)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"c",children:["IGV",parseFloat(General.igv_checkout||0)>0?` (${General.igv_checkout}%)`:""]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(igv)]})]}),autoDiscountTotal>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-green-600",children:[jsxRuntimeExports.jsx("span",{children:"Descuentos automÃ¡ticos"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["-",CurrencySymbol()," ",Number2Currency(autoDiscountTotal)]})]}),appliedCoupon&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-blue-600",children:[jsxRuntimeExports.jsxs("span",{children:["Descuento cupÃ³n (",appliedCoupon.code,")"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["-",CurrencySymbol()," ",Number2Currency(calculatedCouponDiscount)]})]}),paymentCommission>0&&selectedPaymentMethod&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-yellow-600",children:[jsxRuntimeExports.jsxs("span",{children:["ComisiÃ³n ",hasSinglePaymentMethod&&singlePaymentMethod?`${singlePaymentMethod.name} `:"","(",paymentCommission,"%)"]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["+",CurrencySymbol()," ",Number2Currency(calculatedCommission)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"c",children:"EnvÃ­o"}),jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"free"===selectedOption||"store_pickup"===selectedOption||0===envio?jsxRuntimeExports.jsx("span",{className:"c",children:"Gratis"}):`${CurrencySymbol()} ${Number2Currency(envio)}`})]}),jsxRuntimeExports.jsx("div",{className:"py-3 border-y-2 mt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," ",Number2Currency(displayTotal)]})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 pt-4",children:[jsxRuntimeExports.jsx("button",{className:`w-full py-3 px-6 !rounded-none font-semibold text-lg transition-all duration-300 ${hasPaymentMethods?"hover:opacity-90 bg-primary":"opacity-50 cursor-not-allowed bg-gray-400"} ${data?.class_button||" customtext-neutral-dark"}`,onClick:handleContinueClick,disabled:!hasPaymentMethods,title:hasPaymentMethods?"":"No hay mÃ©todos de pago disponibles",children:hasSinglePaymentMethod?"Comprar":"Continuar"}),jsxRuntimeExports.jsx("div",{id:"mercadopago-button-container"}),jsxRuntimeExports.jsx(ButtonSecondary,{className:"!rounded-none",onClick:noContinue,children:"Cancelar"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("p",{className:"text-sm c",children:["Al realizar tu pedido, aceptas los",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>openModal&&openModal(1),className:"customtext-primary font-bold",children:" TÃ©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",jsxRuntimeExports.jsx("a",{href:"#",onClick:()=>openModal&&openModal(0),className:"customtext-primary font-bold",children:" PolÃ­tica de Privacidad"}),"."]})})]})]})]}),jsxRuntimeExports.jsx(PaymentModalIbergruas,{isOpen:showPaymentModal,contacts:contacts,onClose:()=>setShowPaymentModal(!1),onPaymentComplete:handlePaymentComplete}),jsxRuntimeExports.jsx(OpenPayCardModal,{isOpen:showOpenPayModal,onClose:()=>setShowOpenPayModal(!1),onTokenCreated:handleOpenPayTokenCreated}),jsxRuntimeExports.jsx(UploadVoucherModalYape,{isOpen:showVoucherModal,cart:cart,subTotal:subTotal,igv:igv,totalFinal:displayTotal,envio:envio,request:paymentRequest,onClose:()=>setShowVoucherModal(!1),paymentMethod:currentPaymentMethod,coupon:appliedCoupon,descuentofinal:calculatedCouponDiscount,autoDiscounts:autoDiscounts,autoDiscountTotal:autoDiscountTotal}),jsxRuntimeExports.jsx(UploadVoucherModalBancs,{isOpen:showVoucherModalBancs,cart:cart,subTotal:subTotal,igv:igv,totalFinal:displayTotal,envio:envio,contacts:contacts,request:paymentRequest,onClose:()=>setShowVoucherModalBancs(!1),paymentMethod:currentPaymentMethod,coupon:appliedCoupon,descuentofinal:calculatedCouponDiscount,autoDiscounts:autoDiscounts,autoDiscountTotal:autoDiscountTotal}),jsxRuntimeExports.jsx(LoginModal,{})]})}function ConfirmationStepIbergruas({setCart:e,cart:t,code:s,delivery:o,data:a,automaticDiscounts:r=[],automaticDiscountTotal:n=0,couponDiscount:i=0,couponCode:c=null}){const[l,m]=reactExports.useState(null),[d,u]=reactExports.useState(!0),[p,x]=reactExports.useState(null);if(reactExports.useEffect(()=>{s&&((async()=>{try{const e=await recoveryOrderData({code:s});m(e.order)}catch(e){x(e.message)}finally{u(!1)}})(),mainExports.Local.delete(`${Global.APP_CORRELATIVE}_cart`),mainExports.Local.set(`${Global.APP_CORRELATIVE}_cart`,[]))},[s]),d)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-transparent rounded-lg shadow p-6 font-paragraph text-center",children:jsxRuntimeExports.jsx("p",{children:"Cargando detalles de la orden..."})})});if(p)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-transparent rounded-lg shadow p-6 font-paragraph text-center text-red-500",children:jsxRuntimeExports.jsxs("p",{children:["Error al cargar la orden: ",p]})})});if(!l)return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-transparent rounded-lg shadow p-6 font-paragraph text-center",children:jsxRuntimeExports.jsx("p",{children:"No se encontraron datos de la orden"})})});const h=l?.items?.reduce((e,t)=>{let s=0;s="combo"===t.type?t.final_price||t.price||0:t.price||0;return e+s*(t.quantity||0)},0)||0,j=parseFloat((h/1.18).toFixed(2)),g=parseFloat((h-j).toFixed(2)),f=parseFloat(l.delivery||0),y=parseFloat(l.coupon_discount||0),b=parseFloat(l.automatic_discount_total||0),E=parseFloat(j)+parseFloat(g)+f-y-b;return jsxRuntimeExports.jsx("div",{className:"mx-auto",children:jsxRuntimeExports.jsx("div",{className:"bg-transparent rounded-lg shadow p-6 font-paragraph",children:jsxRuntimeExports.jsxs("div",{className:"text-center space-y-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-base xl:text-xl customtext-neutral-light",children:"Gracias por tu compra ðŸŽ‰"}),jsxRuntimeExports.jsx("p",{className:"text-white text-2xl xl:text-5xl font-semibold",children:"Tu orden ha sido recibida"}),jsxRuntimeExports.jsxs("div",{className:"py-4",children:[jsxRuntimeExports.jsx("div",{className:" customtext-neutral-light",children:"CÃ³digo de pedido"}),jsxRuntimeExports.jsxs("div",{className:"text-white text-lg font-semibold",children:["#",l.code]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 text-white max-w-lg bg-transparent mx-auto p-8 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6 border-b-2 pb-6",children:[l.items.map((e,t)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-transparent rounded-xl w-max",children:jsxRuntimeExports.jsx("img",{src:e.image?`/storage/images/item/${e.image}`:"/assets/img/noimage/no_img.jpg",alt:e.name,className:"w-20 h-20 object-cover rounded",onError:e=>e.target.src="/assets/img/noimage/no_img.jpg"})}),jsxRuntimeExports.jsxs("div",{className:"text-start",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-lg",children:[e.name,e.is_free&&jsxRuntimeExports.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Â¡GRATIS!"})]}),e?.color&&jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color: ",jsxRuntimeExports.jsx("span",{className:"text-white",children:e.color})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",jsxRuntimeExports.jsx("span",{className:"text-white",children:parseInt(e.quantity)})," - Precio: ",jsxRuntimeExports.jsxs("span",{className:"text-white",children:[" ",CurrencySymbol()," ",Number2Currency(e.price)]}),e.is_free&&jsxRuntimeExports.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:"(PromociÃ³n)"})]})]})]})},t)),l.free_items&&l.free_items.length>0&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"pt-4 border-t border-dashed border-green-300",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-bold text-green-600 mb-3",children:"ðŸŽ Productos gratuitos por promociones:"}),l.free_items.map((e,t)=>jsxRuntimeExports.jsx("div",{className:"rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-transparent rounded-xl w-max border-2 border-green-200",children:jsxRuntimeExports.jsx("img",{src:e.image?`/storage/images/item/${e.image}`:"/assets/img/noimage/no_img.jpg",alt:e.name,className:"w-20 h-20 object-cover rounded",onError:e=>e.target.src="/assets/img/noimage/no_img.jpg"})}),jsxRuntimeExports.jsxs("div",{className:"text-start",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-lg",children:[e.name,jsxRuntimeExports.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Â¡GRATIS!"})]}),e?.color&&jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color: ",jsxRuntimeExports.jsx("span",{className:"text-white",children:e.color})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",jsxRuntimeExports.jsx("span",{className:"text-white",children:parseInt(e.quantity)}),jsxRuntimeExports.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:'- Por promociÃ³n "Compra X Lleva Y"'})]})]})]})},`free-${t}`))]})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 mt-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-white",children:"Subtotal"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(j)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-white",children:"IGV"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(g)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-white",children:"EnvÃ­o"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:[CurrencySymbol()," ",Number2Currency(l.delivery)]})]}),l.coupon_id&&jsxRuntimeExports.jsxs("div",{className:"mb-2 mt-2 flex justify-between items-center border-b pb-2 text-sm font-bold",children:[jsxRuntimeExports.jsxs("span",{children:["CupÃ³n aplicado"," "]}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," -",Number2Currency(l.coupon_discount)]})]}),l.automatic_discounts&&l.automatic_discounts.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-2 mt-2 border-b pb-2",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-bold text-green-600 mb-1",children:"Descuentos automÃ¡ticos aplicados:"}),l.automatic_discounts.map((e,t)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-green-700",children:[e.rule_name||e.name||"Descuento automÃ¡tico",jsxRuntimeExports.jsx("small",{className:"block text-xs font-light text-gray-600",children:e.description||"PromociÃ³n especial"})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-green-600",children:[CurrencySymbol()," -",Number2Currency(e.discount_amount||e.amount||0)]})]},t)),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm font-bold text-green-600 mt-1 pt-1 border-t",children:[jsxRuntimeExports.jsx("span",{children:"Total descuentos automÃ¡ticos:"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," -",Number2Currency(l.automatic_discount_total||0)]})]})]}),jsxRuntimeExports.jsx("div",{className:"py-3 border-y-2 mt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[jsxRuntimeExports.jsx("span",{children:"Total"}),jsxRuntimeExports.jsxs("span",{children:[CurrencySymbol()," ",Number2Currency(E)]})]})})]}),jsxRuntimeExports.jsx("div",{className:"pt-3",children:jsxRuntimeExports.jsx(ButtonPrimary,{href:"/catalogo",className:` !rounded-none customtext-neutral-dark ${a?.class_button} `,children:"  Seguir Comprando"})})]})]})})})}function CheckoutStepsIbegruas({cart:e,setCart:t,user:s,prefixes:o,ubigeos:a,items:r,contacts:n,data:i,generals:c=[]}){const[l,m]=reactExports.useState(1),[d,u]=reactExports.useState(0),p=e.reduce((e,t)=>e+("combo"===t.type?t.final_price||t.price:t.final_price)*t.quantity,0),[x,h]=reactExports.useState(0),j=parseFloat(General.igv_checkout||0);let g,f;j>0?(g=p,f=parseFloat((p*(j/100)).toFixed(2))):(g=parseFloat((p/1.18).toFixed(2)),f=parseFloat((p-g).toFixed(2)));const[y,b]=reactExports.useState(0),[E,v]=reactExports.useState(null),[C,R]=reactExports.useState([]),[N,w]=reactExports.useState(0),[D,_]=reactExports.useState(null),S=e=>_(e),T=()=>_(null),P={privacy_policy:"PolÃ­ticas de privacidad",terms_conditions:"TÃ©rminos y condiciones",saleback_policy:"PolÃ­ticas de devolucion y cambio"},k=g+f+parseFloat(x),M=y+N+d,$=Math.max(0,k-M),[O,q]=reactExports.useState([]),[F,I]=reactExports.useState([]),[L,A]=reactExports.useState([]);reactExports.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("code");e&&(I(e),m(3))},[window.location.search]),reactExports.useEffect(()=>{F&&mainExports.Local.delete(`${Global.APP_CORRELATIVE}_cart`)},[F]),reactExports.useEffect(()=>{(()=>{const e=document.createElement("script");e.src="https://sdk.mercadopago.com/js/v2",e.async=!0,document.body.appendChild(e)})()},[]);const G=e=>{m(e),window.scrollTo({top:0,behavior:"smooth"})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-secondary py-4 md:py-12 ",children:[jsxRuntimeExports.jsxs("div",{className:"bg-secondary px-primary 2xl:px-0 2xl:max-w-7xl mx-auto rounded-lg md:rounded-xl shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"mb-4 md:mb-8",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-1 md:gap-4 max-w-3xl mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 "+(l>=1?"customtext-primary font-medium":"text-white"),children:[jsxRuntimeExports.jsx("span",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm bg-primary text-white border-primary",children:"1"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"Carrito"})]}),jsxRuntimeExports.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:jsxRuntimeExports.jsx("div",{className:"absolute inset-0 transition-all duration-500 bg-primary",style:{width:l>1?"100%":"0%"}})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 "+(l>1?"customtext-primary font-medium":"text-white"),children:[jsxRuntimeExports.jsx("span",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm "+(l>1?"bg-primary text-white border-transparent":"bg-white customtext-primary  border-primary"),children:"2"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"EnvÃ­o"})]}),jsxRuntimeExports.jsx("div",{className:"mb-4 lg:mb-0 flex-1 h-[2px] bg-gray-200 relative",children:jsxRuntimeExports.jsx("div",{className:"absolute inset-0 transition-all duration-500 "+(i?.gradient?"bg-gradient":"bg-primary"),style:{width:l>2?"100%":"0%"}})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center md:flex-row md:items-center gap-1 md:gap-2 "+(3===l?(i?.gradient?"customtext-gradient":"customtext-primary")+" font-medium":"text-white"),children:[jsxRuntimeExports.jsx("span",{className:"w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs md:text-sm "+(3===l?i?.gradient?"bg-gradient text-white border-transparent":"bg-primary text-white border-primary":i?.gradient?"bg-white customtext-gradient border-gradient":"bg-white customtext-primary border-primary"),children:"3"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] md:text-sm text-center",children:"ConfirmaciÃ³n"})]})]})}),1===l&&jsxRuntimeExports.jsx(CartStepIbergruas,{data:i,cart:e,setCart:t,onContinue:()=>G(2),subTotal:g,totalPrice:p,envio:x,igv:f,totalFinal:$,openModal:S,automaticDiscounts:C,setAutomaticDiscounts:R,automaticDiscountTotal:N,setAutomaticDiscountTotal:w,totalWithoutDiscounts:k}),2===l&&jsxRuntimeExports.jsx(ShippingStepIbergruas,{data:i,setCode:I,setDelivery:A,cart:e,setSale:q,setCart:t,onContinue:()=>G(3),noContinue:()=>G(1),subTotal:g,totalPrice:p,envio:x,setEnvio:h,igv:f,totalFinal:$,user:s,prefixes:o,contacts:n,ubigeos:a,items:r,descuentofinal:d,setDescuentoFinal:u,openModal:S,setCouponDiscount:b,setCouponCode:v,automaticDiscounts:C,setAutomaticDiscounts:R,automaticDiscountTotal:N,setAutomaticDiscountTotal:w,totalWithoutDiscounts:k}),3===l&&jsxRuntimeExports.jsx(ConfirmationStepIbergruas,{data:i,code:F,setCart:t,delivery:L,cart:O,subTotal:g,totalPrice:p,envio:x,igv:f,totalFinal:$,descuentofinal:d,setDescuentoFinal:u,couponDiscount:y,couponCode:E,automaticDiscounts:C,automaticDiscountTotal:N,totalWithoutDiscounts:k})]}),Object.keys(P).map((e,t)=>{const s=P[e],o=c.find(t=>t.correlative==e)?.description??"";return jsxRuntimeExports.jsx(ReactModal,{isOpen:D===t,onRequestClose:T,contentLabel:s,className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center p-4 z-50",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-[999]",ariaHideApp:!1,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 pr-4",children:s}),jsxRuntimeExports.jsx("button",{onClick:T,className:"flex-shrink-0 text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 hover:bg-gray-100 rounded-full","aria-label":"Cerrar modal",children:jsxRuntimeExports.jsx(X,{size:24,strokeWidth:2})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:jsxRuntimeExports.jsx("div",{className:"prose prose-gray max-w-none",children:jsxRuntimeExports.jsx(HtmlContent,{html:o})})}),jsxRuntimeExports.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:jsxRuntimeExports.jsx("button",{onClick:T,className:"px-6 py-2 bg-primary text-white rounded-lg  transition-colors duration-200 font-medium",children:"Cerrar"})})]})},t)})]})}export{CheckoutStepsIbegruas as default};

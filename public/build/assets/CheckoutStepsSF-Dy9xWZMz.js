import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as c}from"./index-BH53Isel.js";import{N as j}from"./Number2Currency-e57Tgsuk.js";import{B as L,a as X,A as le,O as oe,D as J}from"./OptionCard-A0coJtz8.js";import{T as Q}from"./trash-2-DK1wnsDn.js";import{M as W}from"./minus-jyhodMPN.js";import{P as Y}from"./plus-Bot15Khs.js";import{u as q}from"./ubigeo-Q-ocg024.js";import{m as y}from"./main-BSEyQEJW.js";import{I as P}from"./InputForm-DN14ZGms.js";import{s as ie}from"./server.browser-Bf4gQIc7.js";import{l as ce}from"./CheckoutSteps-BUdl33kp.js";import{R as de}from"./PaymentModal-BB1JXzaZ.js";import{G as O}from"./Global-ErywZRdd.js";import"./index-yBjzXJbu.js";import"./useStateManager-7e1e8489.esm-oj4m82YY.js";import"./hoist-non-react-statics.cjs-kbdZbs82.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";import"./createLucideIcon-Cy5Ya80P.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index-Chjiymov.js";const K=({setCart:m,...o})=>{const p=()=>{m(u=>u.filter(d=>d.id!==o.id))},i=()=>{m(u=>u.map(d=>d.id===o.id?{...d,quantity:(d.quantity||1)+1}:d))},l=()=>{m(u=>u.map(d=>{if(d.id===o.id){const g=(d.quantity||1)-1;return g<=0?(p(o.id),null):{...d,quantity:g}}return d}).filter(Boolean))};return console.log(o),e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hidden md:table-row border-b bg-gray-50 font-font-general",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:`/storage/images/item/${o.image}`,alt:o.name,className:"w-16 h-16 object-cover rounded mr-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm 2xl:text-base font-semibold customtext-neutral-dark",children:o.name}),e.jsxs("div",{className:"text-[12px] 2xl:text-sm customtext-neutral-dark space-y-1 mt-1",children:[e.jsxs("p",{children:["Color: ",o.color]}),e.jsx("button",{onClick:p,className:" text-red-500 transition-colors duration-200 rounded-full hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200","aria-label":"Remove item",children:e.jsx(Q,{size:18})})]})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsx("button",{type:"button",onClick:l,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors","aria-label":"Decrease quantity",children:e.jsx(W,{size:16})}),e.jsx("div",{className:"w-8 h-8 flex justify-center items-center bg-white",children:e.jsx("span",{className:"font-semibold text-sm",children:o.quantity||1})}),e.jsx("button",{type:"button",onClick:i,className:"p-2 text-gray-600 hover:bg-gray-100 transition-colors","aria-label":"Increase quantity",children:e.jsx(Y,{size:16})})]})})}),e.jsxs("td",{className:"px-4 py-4 text-right min-w-32",children:[e.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(o.price).toFixed(2)]}),e.jsxs("div",{className:"font-bold",children:["S/ ",Number(o.final_price).toFixed(2)]})]}),e.jsxs("td",{className:"px-4 py-4 text-right font-bold",children:["S/ ",Number(o.final_price*o.quantity).toFixed(2)]})]},o.id),e.jsx("div",{className:"md:hidden bg-gray-50  rounded-lg shadow p-4 mb-4 w-full font-font-general",children:e.jsxs("div",{className:"flex items-start gap-4 relative",children:[e.jsx("img",{src:`/storage/images/item/${o.image}`,alt:o.name,className:"w-20 h-20 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1 leading-tight customtext-neutral-dark",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Color: ",o.color]}),e.jsxs("div",{className:"mt-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden shadow-sm w-20",children:[e.jsx("button",{onClick:l,className:"p-2 text-gray-600 hover:bg-gray-100",children:e.jsx(W,{size:16})}),e.jsx("div",{className:"w-12 h-8 flex justify-center items-center bg-white",children:e.jsx("span",{className:"font-semibold text-sm",children:o.quantity||1})}),e.jsx("button",{onClick:i,className:"p-2 text-gray-600 hover:bg-gray-100",children:e.jsx(Y,{size:16})})]}),e.jsxs("div",{className:"text-right mt-2",children:[e.jsxs("div",{className:"text-xs text-gray-500 line-through",children:["S/ ",Number(o.price).toFixed(2)]}),e.jsxs("div",{className:"font-bold",children:["S/ ",Number(o.final_price).toFixed(2)]}),e.jsxs("div",{className:"text-sm font-bold mt-1",children:["Subtotal: S/ ",Number(o.final_price*o.quantity).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:p,className:"absolute -top-2 -right-2 text-red-500 transition-colors duration-200 rounded-full hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-200","aria-label":"Remove item",children:e.jsx(Q,{size:18})})]})})]})};function me({cart:m,setCart:o,onContinue:p,subTotal:i,envio:l,igv:u,totalFinal:d}){return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 md:gap-8",children:[e.jsxs("div",{className:"lg:col-span-3 flex flex-row w-full",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg w-full",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"!font-font-general",children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-sm 2xl:text-base font-semibold customtext-neutral-dark",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-sm 2xl:text-base font-semibold customtext-neutral-dark",children:"Cantidad"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-sm 2xl:text-base font-semibold customtext-neutral-dark",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-sm 2xl:text-base font-semibold customtext-neutral-dark",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((g,k)=>e.jsx(K,{...g,setCart:o},k))})]})}),e.jsx("div",{className:"md:hidden space-y-4 w-full",children:m.map((g,k)=>e.jsx(K,{...g,setCart:o},k))})]}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max font-font-general",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6 customtext-neutral-dark",children:"Resumen de compra"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(i)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(u)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(l)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",j(d)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(L,{className:"rounded-2xl xl:rounded-3xl",onClick:p,children:"  Continuar"}),e.jsx(X,{className:"rounded-2xl xl:rounded-3xl",href:"/",children:" Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]})]})}const xe=m=>new Promise(async(o,p)=>{try{console.log("Datos para MercadoPago:",m);const{status:i,result:l}=await y.Fetch("./api/mercadopago/preference",{method:"POST",body:JSON.stringify(m)});if(!i||!l.preference_id){y.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(l==null?void 0:l.message)||"Error al crear la preferencia de pago",type:"danger"}),p((l==null?void 0:l.message)||"Error al crear la preferencia de pago");return}console.log("✅ Preferencia creada:",l);const u=new window.MercadoPago(l.public_key,{locale:"es-PE"});setTimeout(()=>{window.location.href=l.redirect_url},500),o(l)}catch(i){console.error("Error en processMercadoPagoPayment:",i),y.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message||"Error en la integración con MercadoPago",type:"danger"}),p(i.message||"Error en la integración con MercadoPago")}});function pe({isOpen:m,onClose:o,onPaymentComplete:p}){const[i,l]=c.useState("tarjeta"),[u,d]=c.useState(!1);c.useEffect(()=>{i==="tarjeta"&&m&&g()},[i,m]);const g=()=>{d(!0),p(),setTimeout(()=>{d(!1),o()},1e3)};return e.jsx(de,{isOpen:m,onRequestClose:o,className:"absolute left-1/2 -translate-x-1/2 bg-white rounded-2xl shadow-lg w-[95%] max-w-4xl top-1/2 -translate-y-1/2 overflow-hidden",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 z-50",ariaHideApp:!1,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[e.jsx("div",{className:"hidden md:block bg-[#f8f5f2] h-full",children:e.jsx("img",{src:"/assets/img/salafabulosa/portadapagos.png",alt:"Métodos de pago",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"p-6 max-h-[90vh] md:max-h-[100vh] flex flex-col justify-center ",children:[e.jsxs("div",{className:"mb-0 md:mb-4",children:[e.jsx("h2",{className:"text-xl md:text-2xl 2xl:text-3xl font-bold text-primary",children:"¿Cómo deseas pagar tu pedido?"}),e.jsx("p",{className:"text-primary mt-2 text-sm 2xl:text-base",children:"Elige una de las opciones disponibles para completar tu pago de forma segura."})]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${i==="tarjeta"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-[#3a2723]"}`,onClick:()=>l("tarjeta"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"tarjeta",name:"paymentMethod",checked:i==="tarjeta",onChange:()=>l("tarjeta"),className:"h-5 w-5 text-primary focus:ring-primary hidden"}),e.jsx("label",{htmlFor:"tarjeta",className:"font-medium text-base 2xl:text-lg",children:"Pago con Tarjeta"}),e.jsx("p",{className:"text-[#5c504c] text-sm 2xl:text-base ml-7 mt-1",children:"Renueva tus espacios con estilo: Fundas exclusivas para cada temporada."})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${i==="tarjeta"?"bg-[#3a2723]":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${i==="tarjeta"?"bg-white":""}`})})})]})}),e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${i==="yape"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-[#3a2723]"}`,onClick:()=>l("yape"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"yape",name:"paymentMethod",checked:i==="yape",onChange:()=>l("yape"),className:"h-5 w-5 text-primary focus:ring-[#3a2723] hidden"}),e.jsx("label",{htmlFor:"yape",className:"font-medium text-base 2xl:text-lg",children:"Yape / Plin"}),e.jsx("p",{className:"text-[#5c504c] text-sm 2xl:text-base ml-7 mt-1",children:"Realiza el pago desde tu celular sin comisiones."})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${i==="yape"?"bg-[#3a2723]":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${i==="yape"?"bg-white":""}`})})})]})}),e.jsx("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-colors ${i==="transferencia"?"border-primary bg-[#f8f5f2]":"border-gray-200 hover:border-2 hover:border-[#3a2723]"}`,onClick:()=>l("transferencia"),children:e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-start justify-center space-x-2",children:[e.jsx("input",{type:"radio",id:"transferencia",name:"paymentMethod",checked:i==="transferencia",onChange:()=>l("transferencia"),className:"h-5 w-5 text-primary focus:ring-[#3a2723] hidden"}),e.jsx("label",{htmlFor:"transferencia",className:"font-medium text-base 2xl:text-lg",children:"Pago por Transferencia"}),e.jsx("p",{className:"text-[#5c504c] text-sm 2xl:text-base ml-7 mt-1",children:"Haz una transferencia bancaria desde tu app o banca por internet."})]}),e.jsx("div",{className:"min-w-5 flex items-center justify-center",children:e.jsx("div",{className:`h-5 w-5 rounded-full flex items-center justify-center ${i==="transferencia"?"bg-[#3a2723]":"border-2 border-[#d0ccca]"}`,children:e.jsx("div",{className:`h-2 w-2 rounded-full ${i==="transferencia"?"bg-white":""}`})})})]})})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("button",{className:`w-full bg-[#3a2723] hover:bg-[#2a1d1a] text-white py-3 rounded-3xl text-base 2xl:text-lg leading-normal font-medium transition-colors ${u?"opacity-70 cursor-not-allowed":""}`,onClick:g,disabled:u,children:u?"Procesando...":"Pagar ahora"}),e.jsx("button",{className:"w-full border border-[#3a2723] text-[#3a2723] hover:bg-[#f8f5f2] py-3 text-base 2xl:text-lg leading-normal rounded-3xl font-medium transition-colors",onClick:o,disabled:u,children:"Volver"})]})]})]})})}function he({cart:m,setSale:o,setCode:p,setDelivery:i,setCart:l,onContinue:u,noContinue:d,subTotal:g,igv:k,totalFinal:S,user:r,setEnvio:b,envio:E,prefixes:T,ubigeos:M=[]}){var V,H;const[s,h]=c.useState({name:(r==null?void 0:r.name)||"",lastname:(r==null?void 0:r.lastname)||"",email:(r==null?void 0:r.email)||"",phone_prefix:(r==null?void 0:r.phone_prefix)||"51",phone:(r==null?void 0:r.phone)||"",department:(r==null?void 0:r.department)||"",province:(r==null?void 0:r.province)||"",district:(r==null?void 0:r.district)||"",address:(r==null?void 0:r.address)||"",number:(r==null?void 0:r.number)||"",comment:(r==null?void 0:r.comment)||"",shippingOption:"delivery",ubigeo:null,invoiceType:(r==null?void 0:r.invoiceType)||"boleta",documentType:(r==null?void 0:r.documentType)||"dni",document:(r==null?void 0:r.document)||"",businessName:(r==null?void 0:r.businessName)||""}),f=a=>{const{name:t,value:n}=a.target;h(x=>({...x,[t]:n})),t==="invoiceType"&&h(x=>({...x,documentType:n==="factura"?"ruc":"dni",document:"",businessName:n==="factura"?x.businessName:""}))},[v,z]=c.useState(""),[N,w]=c.useState(""),[F,A]=c.useState(""),[fe,Z]=c.useState([]),[ye,ee]=c.useState([]),[je,B]=c.useState([]),[be,ve]=c.useState(0),[se,D]=c.useState(!1),[_,G]=c.useState([]),[R,I]=c.useState(null),[Ne,we]=c.useState(null);c.useEffect(()=>{const a=[...new Set(q.map(t=>t.departamento))];Z(a)},[]);const ae=async a=>{if(!a)return;console.log("selected",a);const{data:t}=a;h(n=>({...n,department:t.departamento,province:t.provincia,district:t.distrito,ubigeo:t.reniec})),D(!0);try{const n=await J.getShippingCost({ubigeo:t.reniec}),x=[];n.data.is_free?(x.push({type:"free",price:0,description:n.data.standard.description,deliveryType:n.data.standard.type,characteristics:n.data.standard.characteristics}),n.data.express.price>0&&x.push({type:"express",price:n.data.express.price,description:n.data.express.description,deliveryType:n.data.express.type,characteristics:n.data.express.characteristics})):n.data.is_agency?x.push({type:"agency",price:n.data.agency.price,description:n.data.agency.description,deliveryType:n.data.agency.type,characteristics:n.data.agency.characteristics}):x.push({type:"standard",price:n.data.standard.price,description:n.data.standard.description,deliveryType:n.data.standard.type,characteristics:n.data.standard.characteristics}),G(x),I(x[0].type),b(x[0].price)}catch(n){console.error("Error al obtener precios de envío:",n),y.Notify.add({icon:"/assets/img/icon.svg",title:"Sin cobertura",body:"No realizamos envíos a esta ubicación",type:"danger"}),G([]),I(null),b(0)}D(!1)},te=c.useCallback(ce.debounce((a,t)=>{if(a.length<3){t([]);return}console.log("inputValue",a),fetch(`/api/ubigeo/search?q=${encodeURIComponent(a)}`).then(n=>{if(!n.ok)throw new Error("Error en la respuesta");return n.json()}).then(n=>{const x=n.map(C=>({value:C.reniec,label:`${C.distrito}, ${C.provincia}, ${C.departamento}`,data:{inei:C.inei,reniec:C.reniec,departamento:C.departamento,provincia:C.provincia,distrito:C.distrito}}));t(x)}).catch(n=>{console.error("Error:",n),t([])})},300),[]);c.useEffect(()=>{if(v){const a=[...new Set(q.filter(t=>t.departamento===v).map(t=>t.provincia))];ee(a),w(""),A(""),B([]),h(t=>({...t,department:v,province:"",district:""}))}},[v]),c.useEffect(()=>{if(N){const a=q.filter(t=>t.departamento===v&&t.provincia===N).map(t=>t.distrito);B(a),A(""),h(t=>({...t,province:N,district:""}))}},[N]),c.useEffect(()=>{F&&(h(t=>({...t,district:F})),(async()=>{try{const t=await J.getShippingCost({department:v,district:F});b(t.data.price),j(t.data.price)>0?I("express"):I("free")}catch(t){console.error("Error fetching shipping cost:",t),alert("No se pudo obtener el costo de envío.")}})())},[F]);const re=async a=>{if(a&&a.preventDefault&&a.preventDefault(),!r){y.Notify.add({icon:"/assets/img/icon.svg",title:"Iniciar Sesión",body:"Se requiere que incie sesión para realizar la compra",type:"danger"});return}if(!s.document){y.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Formulario",body:`El campo ${s.documentType==="dni"?"DNI":"RUC"} es obligatorio`,type:"danger"});return}if(s.invoiceType==="factura"&&!s.businessName){y.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Formulario",body:"El campo Razón Social es obligatorio para factura",type:"danger"});return}if(!s.name||!s.lastname||!s.email||!s.address||!s.phone||!s.ubigeo){y.Notify.add({icon:"/assets/img/icon.svg",title:"Campos incompletos",body:"Complete todos los campos obligatorios",type:"danger"});return}if(!R){y.Notify.add({icon:"/assets/img/icon.svg",title:"Seleccione envío",body:"Debe elegir un método de envío",type:"danger"});return}if(!window.MercadoPago){console.error("❌ MercadoPago aún no se ha cargado.");return}try{const t={user_id:(r==null?void 0:r.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,phone_prefix:(s==null?void 0:s.phone_prefix)||"51",email:(s==null?void 0:s.email)||"",phone:`${s.phone_prefix}${s.phone}`,country:"Perú",department:v||"",province:N||"",district:F||"",ubigeo:null,address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",amount:S||0,delivery:E,cart:m,invoiceType:s.invoiceType||"",documentType:s.documentType||"",document:s.document||"",businessName:s.businessName||""},x=await xe(t);x.status?(o(x.sale),i(x.delivery),p(x.code)):y.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:"El pago ha sido rechazado",type:"danger"})}catch(t){console.log(t),y.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:"No se llegó a procesar el pago",type:"danger"})}};c.useEffect(()=>{const a=t=>{const n=t.element.dataset.code,x=t.element.dataset.flag;return ie.renderToString(e.jsxs("span",{children:[e.jsx("span",{className:"inline-block w-8 font-emoji text-center",children:x}),e.jsx("b",{className:"me-1",children:t.text}),e.jsx("span",{className:"text-sm text-opacity-20",children:n})]}))};$(".select2-prefix-selector").select2({dropdownCssClass:"py-1",containerCssClass:"!border !border-gray-300 !rounded p-2 !h-[42px]",arrowCssClass:'!text-primary top-1/2 -translate-y-1/2"',templateResult:function(t){if(!t.id)return t.text;var n=$(a(t));return n},templateSelection:function(t){if(!t.id)return t.text;var n=$(a(t));return n},matcher:function(t,n){if(!t.term||!n.element)return n;const x=n.element.dataset.country||"",C=n.text||"";return x.toLowerCase().includes(t.term.toLowerCase())||C.toLowerCase().includes(t.term.toLowerCase())?n:null}})},[s.phone_prefix]);const[ne,U]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-y-8 lg:gap-8 ",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("form",{className:"space-y-6 bg-[#f9f9f9] p-6 rounded-2xl font-font-general",onSubmit:a=>a.preventDefault(),children:[e.jsxs("div",{className:"sectionInformation space-y-3.5",children:[e.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark ",children:"Información del contacto"}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 ",children:[e.jsx(P,{type:"text",label:"Nombres",name:"name",value:s.name,onChange:f,placeholder:"Nombres"}),e.jsx(P,{label:"Apellidos",type:"text",name:"lastname",value:s.lastname,onChange:f,placeholder:"Apellidos"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 ",children:[e.jsx(P,{label:"Correo electrónico",type:"email",name:"email",value:s.email,onChange:f,placeholder:"Ej. hola@gmail.com"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm mb-1",children:"Celular"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"select2-prefix-selector w-[200px] p-2 border border-gray-300 rounded",onChange:a=>setSelectedPrefix(a.target.value),name:"phone_prefix",value:s.phone_prefix,children:[e.jsx("option",{value:"",children:"Selecciona un país"}),T.sort((a,t)=>a.country.localeCompare(t.country)).map((a,t)=>e.jsx("option",{value:a.realCode,"data-code":a.beautyCode,"data-flag":a.flag,"data-country":a.country},t))]}),e.jsx("input",{type:"text",id:"phone",name:"phone",value:s.phone,onChange:f,className:"flex-1 p-2 border border-gray-300 rounded",placeholder:"000 000 000"})]})]})]})]}),e.jsxs("div",{className:"sectionDelivery space-y-3.5",children:[e.jsx("h3",{className:"block text-xl 2xl:text-2xl font-bold mb-4 customtext-neutral-dark ",children:"Direccion de envio"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-sm 2xl:text-base mb-1 customtext-neutral-dark ",children:"Ubicación de entrega"}),e.jsx(le,{cacheOptions:!0,defaultOptions:!0,loadOptions:te,onChange:ae,placeholder:"Buscar distrito, provincia o departamento...",loadingMessage:()=>"Buscando ubicaciones...",noOptionsMessage:({inputValue:a})=>a.length<3?"Buscar distrito, provincia o departamento...":"No se encontraron resultados",isLoading:se,styles:{control:a=>({...a,border:"1px solid transparent",boxShadow:"none",minHeight:"50px","&:hover":{borderColor:"transparent"},borderRadius:"0.75rem"}),menu:a=>({...a,zIndex:9999,marginTop:"4px",borderRadius:"8px"}),option:a=>({...a,color:"inherit","&:hover":{color:"white"},backgroundColor:"inherit","&:hover":{backgroundColor:"#f4f4f5"}})},formatOptionLabel:({data:a})=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:a.distrito}),e.jsxs("div",{className:"text-gray-500",children:[a.provincia,", ",a.departamento]})]}),className:"w-full border focus:bg-primary focus:text-white border-gray-300 rounded-xl  transition-all duration-300",menuPortalTarget:document.body,menuPosition:"fixed"})]}),e.jsx(P,{label:"Avenida / Calle / Jirón",type:"text",name:"address",value:s.address,onChange:f,placeholder:"Ingresa el nombre de la calle"}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Número",type:"text",name:"number",value:s.number,onChange:f,placeholder:"Ingresa el número de la calle"}),e.jsx(P,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque (opcional)",type:"text",name:"comment",value:s.comment,onChange:f,placeholder:"Ej. Casa 3, Dpto 101"})]}),_.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Método de envío"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:_.map(a=>e.jsx(oe,{title:(a.type==="free"||a.type==="express"||a.type==="agency",a.deliveryType),price:a.price,description:a.description,selected:R===a.type,onSelect:()=>{I(a.type),b(a.price)}},a.type))}),console.log(_.find(a=>a.type===R)),R&&_.length>0&&e.jsx("div",{className:"space-y-4 mt-4",children:(H=(V=_.find(a=>a.type===R))==null?void 0:V.characteristics)==null?void 0:H.map((a,t)=>e.jsxs("div",{className:"flex items-start gap-4 bg-[#F7F9FB] p-4 rounded-xl",children:[e.jsx("div",{className:"w-5 flex-shrink-0",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-info customtext-primary",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium customtext-neutral-dark",children:a})})]},`char-${t}`))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium customtext-neutral-dark",children:"Tipo de comprobante"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio",name:"invoiceType",value:"boleta",checked:s.invoiceType==="boleta",onChange:f}),e.jsx("span",{className:"ml-2",children:"Boleta"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio",name:"invoiceType",value:"factura",checked:s.invoiceType==="factura",onChange:f}),e.jsx("span",{className:"ml-2",children:"Factura"})]})]})]}),e.jsx(P,{label:s.documentType==="dni"?"DNI":"RUC",type:"text",name:"document",value:s.document,onChange:f,placeholder:`Ingrese su ${s.documentType==="dni"?"DNI":"RUC"}`,maxLength:s.documentType==="dni"?"8":"11"}),s.invoiceType==="factura"&&e.jsx(P,{label:"Razón Social",type:"text",name:"businessName",value:s.businessName,onChange:f,placeholder:"Ingrese la razón social"})]})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max font-font-general",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6 customtext-neutral-dark",children:"Resumen de compra"}),e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:m.map((a,t)=>e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-0 rounded-xl",children:e.jsx("img",{src:`/storage/images/item/${a.image}`,alt:a.name,className:"w-20 h-20 object-cover rounded  "})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold customtext-neutral-dark text-base 2xl:text-lg mb-2",children:a.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:a.color})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",e.jsxs("span",{className:"customtext-neutral-dark",children:[a.quantity," "]})]})]})]})},a.id))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(g)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(k)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(E)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",j(S)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsxs(L,{className:"payment-button",onClick:()=>U(!0),children:[" ","Continuar"]}),e.jsx("div",{id:"mercadopago-button-container"}),e.jsxs(X,{onClick:d,children:[" ","Cancelar"]})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",e.jsx("a",{className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",e.jsx("a",{className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]})]}),e.jsx(pe,{isOpen:ne,onClose:()=>U(!1),onPaymentComplete:re})]})}const ue=({code:m})=>new Promise(async(o,p)=>{try{console.log("Codigo de venta:",m);const{status:i,result:l}=await y.Fetch("./api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:m})});if(!i||!l.order){y.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:(l==null?void 0:l.message)||"Error no se pudo cargar la orden",type:"danger"}),p((l==null?void 0:l.message)||"Error no se pudo cargar la orde");return}o(l)}catch(i){console.error("Error en processMercadoPagoPayment:",i),y.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message||"Error en la integración con MercadoPago",type:"danger"}),p(i.message||"Error en la integración con MercadoPago")}});function ge({setCart:m,cart:o,code:p,delivery:i}){var M;const[l,u]=c.useState(null),[d,g]=c.useState(!0),[k,S]=c.useState(null);if(c.useEffect(()=>{p&&((async()=>{try{const h=await ue({code:p});u(h.order)}catch(h){S(h.message)}finally{g(!1)}})(),y.Local.delete(`${O.APP_CORRELATIVE}_cart`),y.Local.set(`${O.APP_CORRELATIVE}_cart`,[]))},[p]),d)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center",children:e.jsx("p",{children:"Cargando detalles de la orden..."})})});if(k)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center text-red-500",children:e.jsxs("p",{children:["Error al cargar la orden: ",k]})})});if(!l)return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general text-center",children:e.jsx("p",{children:"No se encontraron datos de la orden"})})});const b=((((M=l==null?void 0:l.items)==null?void 0:M.reduce((s,h)=>{const f=h.price||0,v=h.quantity||0;return s+f*v},0))||0)/1.18).toFixed(2),E=(b*.18).toFixed(2),T=parseFloat(b)+parseFloat(E)+parseFloat(l.delivery);return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6 font-font-general",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-base xl:text-xl customtext-neutral-light",children:"Gracias por tu compra 🎉"}),e.jsx("p",{className:"customtext-neutral-dark text-2xl xl:text-5xl font-semibold",children:"Tu orden ha sido recibida"}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:" customtext-neutral-light",children:"Código de pedido"}),e.jsxs("div",{className:"customtext-neutral-dark text-lg font-semibold",children:["#",l.code]})]}),e.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:l.items.map((s,h)=>e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl w-max",children:e.jsx("img",{src:s.image?`/storage/images/item/${s.image}`:"/assets/img/noimage/no_img.jpg",alt:s.name,className:"w-20 h-20 object-cover rounded",onError:f=>f.target.src="/assets/img/noimage/no_img.jpg"})}),e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"font-medium text-lg",children:s.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Color: ",e.jsx("span",{className:"customtext-neutral-dark",children:s.color})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark",children:parseInt(s.quantity)})," - Precio: ",e.jsxs("span",{className:"customtext-neutral-dark",children:[" S/ ",j(s.price)]})]})]})]})},h))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(b)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(E)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(l.delivery)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",j(T)]})]})})]}),e.jsx("div",{className:"pt-3",children:e.jsx(L,{href:"/catalogo",children:"  Seguir Comprando"})})]})]})})})}function He({cart:m,setCart:o,user:p,prefixes:i,ubigeos:l,items:u}){const[d,g]=c.useState(1),S=(m.reduce((N,w)=>{const F=w.final_price;return N+F*w.quantity},0)/1.18).toFixed(2),r=(S*.18).toFixed(2),[b,E]=c.useState(0),T=parseFloat(S)+parseFloat(r)+parseFloat(b),[M,s]=c.useState([]),[h,f]=c.useState([]),[v,z]=c.useState([]);return c.useEffect(()=>{const w=new URLSearchParams(window.location.search).get("code");w&&(f(w),g(3))},[window.location.search]),c.useEffect(()=>{h&&y.Local.delete(`${O.APP_CORRELATIVE}_cart`)},[h]),c.useEffect(()=>{(()=>{const w=document.createElement("script");w.src="https://sdk.mercadopago.com/js/v2",w.async=!0,document.body.appendChild(w)})()},[]),e.jsxs("div",{className:"min-h-screen bg-white py-6 px-primary",children:[e.jsxs("div",{className:"bg-white  py-8 sm:p-8 rounded-xl",children:[e.jsxs("div",{className:`mb-4 xl:mb-8 grid lg:grid-cols-5 !font-font-general ${d===3?"mx-auto max-w-3xl":""} `,children:[e.jsxs("div",{className:`flex items-center justify-between  mx-1 gap-2 lg:mx-5 ${d===3?"lg:col-span-5":"lg:col-span-3"}  text-center`,children:[e.jsx("div",{className:`text-sm sm:text-base 2xl:text-lg tracking-tight ${d===1?"customtext-primary font-semibold":"customtext-neutral-dark"}`,children:"Carrito de compra"}),e.jsx("div",{className:`text-sm sm:text-base 2xl:text-lg tracking-tight ${d===2?"customtext-primary font-semibold":"customtext-neutral-dark"}`,children:"Detalles de envío"}),e.jsx("div",{className:`text-sm sm:text-base 2xl:text-lg tracking-tight ${d===3?"customtext-primary font-semibold":"customtext-neutral-dark"}`,children:"Orden confirmada"})]}),e.jsx("div",{className:`mt-4 h-1 max-w-3xl bg-gray-200 ${d===3?"lg:col-span-5":"lg:col-span-3"} `,children:e.jsx("div",{className:"h-1 bg-primary transition-all duration-500",style:{width:`${(d-1)/2*100}%`}})})]}),d===1&&e.jsx(me,{cart:m,setCart:o,onContinue:()=>g(2),subTotal:S,envio:b,igv:r,totalFinal:T}),d===2&&e.jsx(he,{setCode:f,setDelivery:z,cart:m,setSale:s,setCart:o,onContinue:()=>g(3),noContinue:()=>g(1),subTotal:S,envio:b,setEnvio:E,igv:r,totalFinal:T,user:p,prefixes:i,ubigeos:l,items:u}),d===3&&e.jsx(ge,{code:h,setCart:o,delivery:v,cart:M,subTotal:S,envio:b,igv:r,totalFinal:T})]}),e.jsx("section",{className:"px-[5%] xl:px-[8%] bg-white py-12 xl:py-16 font-paragraph",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-start items-center bg-gradient-to-br from-[#FFFFFF] to-[#91502D1A] w-full rounded-3xl relative",children:[e.jsxs("div",{className:"flex flex-col gap-5 py-8 px-5 lg:pl-16 xl:pl-20  justify-start items-start w-full 2xl:w-3/5 max-w-xl 2xl:max-w-5xl text-white text-left",children:[e.jsx("h1",{className:"customtext-primary text-opacity-20 font-bold text-3xl md:text-4xl xl:text-5xl",children:"¡Tu compra merece un envío GRATIS!"}),e.jsx("p",{className:"customtext-primary  font-normal text-base xl:text-lg 2xl:text-xl",children:"Llévate tus regalos favoritos y obtén envío gratis en compras mayores a S/100."}),e.jsx("div",{className:"flex flex-col",children:e.jsx("a",{className:"w-auto bg-primary px-6 py-3 2xl:py-4 2xl:px-8 rounded-3xl text-white font-font-general leading-none text-base 2xl:text-xl",children:"Seguir comprando"})})]}),e.jsx("div",{className:"xl:absolute right-0 bottom-0 flex flex-col ml-5 w-full items-end  md:w-6/12 2xl:w-2/5 mt-0 md:-mb-14 ",children:e.jsx("img",{src:"/assets/img/backgrounds/resources/image-cart.png",onError:N=>N.target.src="/assets/img/noimage/no_img.jpg",className:"object-contain min-h-[300px] max-h-[500px] md:object-contain  xl:max-h-[400px]  md:max-h-none w-full object-bottom"})})]})})]})}export{He as default};
